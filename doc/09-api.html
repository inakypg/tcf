

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8. APIs &mdash; Test Case Framework 0.11 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. Glossary" href="glossary.html" />
    <link rel="prev" title="7. Architecture" href="07-Architecture.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Test Case Framework
          

          
          </a>

          
            
            
              <div class="version">
                0.11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../02-QUICKSTART.html">1. Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-guides.html">2. Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-server-setup.html">3. Server deployment guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-HOWTOs.html">4. Examples and HOWTOs</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-RFAQs.html">5. Rationales and Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-troubleshooting.html">6. Support &amp; Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-Architecture.html">7. Architecture</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">8. APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-tcfl.tc">8.1. <em>TCF run</em>: testcase API and target manipulation during testcases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tcf-s-backbone-test-case-finder-and-runner">8.1.1. TCF’s backbone test case finder and runner</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#testcase-run-identification">8.1.1.1. Testcase run identification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-tcfl.tl">8.1.2. Test library (utilities for testcases)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-tcfl.pos">8.1.3. Provisioning/deploying/flashing PC-class devices with a Provisioning OS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#core-provisioning-os-functionality">8.1.3.1. Core Provisioning OS functionality</a></li>
<li class="toctree-l4"><a class="reference internal" href="#provisioning-os-bootloader-configuration-for-efi-systems">8.1.3.2. Provisioning OS: bootloader configuration for EFI systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="#provisioning-os-partitioning-schema-for-multiple-root-fss-per-device">8.1.3.3. Provisioning OS: partitioning schema for multiple root FSs per device</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-tcfl.target_ext_buttons">8.1.4. Other target interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#press-and-release-buttons-in-the-target">8.1.4.1. Press and release buttons in the target</a></li>
<li class="toctree-l4"><a class="reference internal" href="#capture-snapshots-or-streams-of-target-data-such-as-screenshots-audio-video-network-etc">8.1.4.2. Capture snapshots or streams of target data, such as screenshots, audio, video, network, etc</a></li>
<li class="toctree-l4"><a class="reference internal" href="#raw-access-to-the-target-s-serial-consoles">8.1.4.3. Raw access to the target’s serial consoles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-target-s-debugging-capabilities">8.1.4.4. Access target’s debugging capabilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flash-the-target-with-fastboot">8.1.4.5. Flash the target with fastboot</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flash-the-target-with-jtags-and-other-mechanism">8.1.4.6. Flash the target with JTAGs and other mechanism</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flash-the-target-with-ioc-flash-server-app">8.1.4.7. Flash the target with <em>ioc_flash_server_app</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#power-on-or-off-the-target-or-any-its-power-rail-components">8.1.4.8. Power on or off the target or any its power rail components</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-commands-a-shell-available-on-a-target-s-serial-console">8.1.4.9. Run commands a shell available on a target’s serial console</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-commands-to-the-target-and-copy-files-back-and-forth-using-ssh">8.1.4.10. Run commands to the target and copy files back and forth using SSH</a></li>
<li class="toctree-l4"><a class="reference internal" href="#copy-files-from-and-to-the-server-s-user-storage-area">8.1.4.11. Copy files from and to the server’s user storage area</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plug-or-unplug-things-to-from-a-target">8.1.4.12. Plug or unplug things to/from a target</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-and-remove-network-tunnels-to-the-target-via-the-server">8.1.4.13. Create and remove network tunnels to the target via the server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-tcfl.app">8.1.5. <em>TCF run</em> Application builders</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tcf-run-report-drivers">8.1.6. <em>TCF run</em> report drivers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-tcfl.config">8.2. <em>TCF</em> client configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration-api-for-tcf">8.2.1. Configuration API for <em>tcf</em></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-tcfl">8.3. <em>TCF</em> client internals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#expecting-things-that-have-to-happen">8.3.1. Expecting things that have to happen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#client-api-for-accessing-ttbd-s-rest-api">8.3.2. Client API for accessing <em>ttbd</em>’s REST API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zephyr-s-sanitycheck-testcase-ini-driver-for-testcase-integration">8.3.3. Zephyr’s SanityCheck testcase.ini driver for testcase integration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#target-metadata">8.4. Target metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#common-metadata">8.4.1. Common metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interface-specific-metadata">8.4.2. Interface specific metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#driver-targe-type-specific-metadata">8.4.3. Driver / targe type specific metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#provisioning-os-specific-metadata">8.4.4. Provisioning OS specific metadata</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ttbd-http-api">8.5. <em>ttbd</em> HTTP API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-target-interface">8.5.1. Basic target interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-interface-access">8.5.2. General interface access</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#power">8.5.2.1. Power</a></li>
<li class="toctree-l4"><a class="reference internal" href="#console">8.5.2.2. Console</a></li>
<li class="toctree-l4"><a class="reference internal" href="#capture">8.5.2.3. Capture</a></li>
<li class="toctree-l4"><a class="reference internal" href="#buttons">8.5.2.4. Buttons</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fastboot">8.5.2.5. Fastboot</a></li>
<li class="toctree-l4"><a class="reference internal" href="#images">8.5.2.6. Images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ioc-flash-server-app">8.5.2.7. IOC_flash_server_app</a></li>
<li class="toctree-l4"><a class="reference internal" href="#things">8.5.2.8. Things</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#examples">8.5.3. Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-listing-targets-over-http">8.5.3.1. Example: listing targets over HTTP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-reading-the-console-s-from-http">8.5.3.2. Example: Reading the console(s) from HTTP</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-conf_00_lib">8.6. <em>ttbd</em> Configuration API for targets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration-api-for-capturing-audio-and-video">8.6.1. Configuration API for capturing audio and video</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-api-for-mcus-used-with-the-zephyr-os-and-others">8.6.2. Configuration API for MCUs used with the Zephyr OS and others</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-api-for-pdus-and-other-power-switching-equipment">8.6.3. Configuration API for PDUs and other power switching equipment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-ttbl.config">8.7. <em>ttbd</em> Configuration API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-ttbl">8.8. <em>ttbd</em> internals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-ttbl.user_control">8.8.1. User access control and authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-ttbl.console">8.8.2. Console Management Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#access-target-s-serial-consoles-bidirectional-channels">8.8.2.1. Access target’s serial consoles / bidirectional channels</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-interface">8.8.3. Debugging Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-ttbl.power">8.8.4. Power Control Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#control-power-to-targets">8.8.4.1. Control power to targets</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controlling-targets-via-ipmi">8.8.4.2. Controlling targets via IPMI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#power-control-module-to-start-dhcp-daemon-when-a-network-is-powered-on">8.8.4.3. Power control module to start DHCP daemon when a network is powered on</a></li>
<li class="toctree-l4"><a class="reference internal" href="#drivers-to-create-targets-on-virtual-machine-using-qemu">8.8.4.4. Drivers to create targets on virtual machine using QEMU</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interaction-with-jtags-and-similar-using-openocd">8.8.4.5. Interaction with JTAGs and similar using OpenOCD</a></li>
<li class="toctree-l4"><a class="reference internal" href="#power-control-module-to-start-a-rsync-daemon-when-a-network-is-powered-on">8.8.4.6. Power control module to start a rsync daemon when a network is powered-on</a></li>
<li class="toctree-l4"><a class="reference internal" href="#power-control-module-to-start-a-socat-daemon-when-a-network-is-powered-on">8.8.4.7. Power control module to start a socat daemon when a network is powered-on</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-ttbl.buttons">8.8.5. Other interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#press-target-s-buttons">8.8.5.1. Press target’s buttons</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stream-and-snapshot-capture-interace">8.8.5.2. Stream and snapshot capture interace</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interface-for-common-debug-operations">8.8.5.3. Interface for common debug operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interface-to-provide-flash-the-target-using-fastboot">8.8.5.4. Interface to provide flash the target using fastboot</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flash-binaries-images-into-the-target">8.8.5.5. Flash binaries/images into the target</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interface-to-flash-the-target-using-ioc-flash-server-app">8.8.5.6. Interface to flash the target using <em>ioc_flash_server_app</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#connect-targets-to-other-targets">8.8.5.7. Connect targets to other targets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-commonl">8.8.6. Common helper library</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-Status.html">10. Current status and plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-CHANGELOG.html">11. TCF release v0.11</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Test Case Framework</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>8. APIs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/doc/09-api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="apis">
<h1>8. APIs<a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-tcfl.tc">
<span id="tcf-run-testcase-api-and-target-manipulation-during-testcases"></span><h2>8.1. <em>TCF run</em>: testcase API and target manipulation during testcases<a class="headerlink" href="#module-tcfl.tc" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tcf-s-backbone-test-case-finder-and-runner">
<h3>8.1.1. TCF’s backbone test case finder and runner<a class="headerlink" href="#tcf-s-backbone-test-case-finder-and-runner" title="Permalink to this headline">¶</a></h3>
<p>This implements a high level test case finder and runner to find and
execute test cases.</p>
<p>The execution of each test case consists of the following phases:</p>
<blockquote>
<div><ul class="simple">
<li>configure</li>
<li>build</li>
<li>target acquisition</li>
<li>deploy</li>
<li>one or more evaluation sequences
(each consisting of setup, start, evaluation per se, teardown)</li>
<li>clean [not executed by default]</li>
</ul>
</div></blockquote>
<p>the configuration, build and deployment phases happen in the local
host; the evaluation phases can happen in the local host (for static
tests) or in remote targets (for dynamic tests).</p>
<p>The backbone is designed so multiple drivers (test case drivers) can
be implemented that find test cases and specify to the backbone how to
build, run and test for success or failure. This is done by
subclassing <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.tc_c</span></code></a> and extending or redefining
<a class="reference internal" href="#tcfl.tc.tc_c.is_testcase" title="tcfl.tc.tc_c.is_testcase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tc_c.is_testcase()</span></code></a>.</p>
<p>Testcases are defined also by subclassing <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.tc_c</span></code></a> and
implementing the different methods the meta runner will call to
evaluate. Testcases can manipulate targets (if they need any) by using
the APIs defined by <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a>.</p>
<p>The runner will collect the list of available targets and determine
whih testcases have to be run on which targets, and then create an
instance of each testcase for those groups of targets where it has to
run. All the instances will then be run in parallel throgh a
multiprocessing pool.</p>
<p>To testcases report results via the report API, which are handled by
drivers defined following <a class="reference internal" href="#tcfl.tc.report_driver_c" title="tcfl.tc.report_driver_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.report_driver_c</span></code></a>, which can
be subclassed and extended to report to different destinations
according to need. Default drivers report to console and logfiles.</p>
<div class="section" id="testcase-run-identification">
<span id="tc-id"></span><h4>8.1.1.1. Testcase run identification<a class="headerlink" href="#testcase-run-identification" title="Permalink to this headline">¶</a></h4>
<p>A message identification mechanism for which all the messages are
prefixed with a code:</p>
<p>[RUNID:]HASH{CBDEL}[XX][.N]</p>
<ul class="simple">
<li>RUNID is a constant string to identify a run of a set of test cases
(defaults to nothing, can be autogenerated with <cite>-i</cite> or an specific
string given with <cite>-i RUNID</cite>).</li>
<li>HASH is a base32 encoded hash of the testcase name, targets where it
is to be run and their <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>.</li>
<li>CBDEL is one capital letter representing the phase being ran
(Configure, Build, Deploy, Evaluation, cLean)</li>
<li>[XX]: base32 encoded hash of the BSP name, applies only to dynamic
test case builds per BSP.</li>
</ul>
<p>This helps locating anything specific to a testcase by grepping in the
logfile for a given string and adding more components restricts the
output.</p>
<p>This means that the message IDs are stable across runs, save RUNIDs
being specified.</p>
<p>We also use the RUNID:TC combination for a ticket when requesting a
target lock–note this does not conflict with other users, as the
tickets are namespaced per-user. This allows the server log to be used
to crossreference what was being ran, to sort out issues.</p>
<p>The <em>hash</em> length (number of characters used) is controlled by
<a class="reference internal" href="#tcfl.tc.tc_c.hashid_len" title="tcfl.tc.tc_c.hashid_len"><code class="xref py py-data docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.hashid_len</span></code></a>.</p>
<dl class="function">
<dt id="tcfl.tc.import_mp_pathos">
<code class="descclassname">tcfl.tc.</code><code class="descname">import_mp_pathos</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.import_mp_pathos" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.tc.import_mp_std">
<code class="descclassname">tcfl.tc.</code><code class="descname">import_mp_std</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.import_mp_std" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="tcfl.tc.exception">
<em class="property">exception </em><code class="descclassname">tcfl.tc.</code><code class="descname">exception</code><span class="sig-paren">(</span><em>description</em>, <em>attachments=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.exception" title="Permalink to this definition">¶</a></dt>
<dd><p>General base exception for reporting results of any phase of test
cases</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>msg</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – a message to report</li>
<li><strong>attachments</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>a dictionary of items to report, with a
few special fields:</p>
<ul>
<li><cite>target</cite>: this is a <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> which shall be used
for reporting</li>
<li><cite>dlevel</cite>: this is an integer that indicates the relative
level of verbosity (FIXME: link to detailed explanation)</li>
<li><cite>alevel</cite>: this is an integer that indicates the relative
level of verbosity for attachments (FIXME: link to detailed
explanation)</li>
<li>any other fields will be passed verbatim and reported</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Have to use a dictionary (vs using kwargs) so the name of the
keys can contain spaces, for better reporting.</p>
<dl class="method">
<dt id="tcfl.tc.exception.attachments_get">
<code class="descname">attachments_get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.exception.attachments_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.exception.attachments_update">
<code class="descname">attachments_update</code><span class="sig-paren">(</span><em>d</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.exception.attachments_update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update an exception’s attachments</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.exception.tag">
<code class="descname">tag</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.exception.tag" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.exception.descr">
<code class="descname">descr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.exception.descr" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the conceptual name of this exception in present tense</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pass_e</span><span class="p">()</span><span class="o">.</span><span class="n">descr</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;pass&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fail_e</span><span class="p">()</span><span class="o">.</span><span class="n">descr</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;fail&quot;</span>
<span class="gp">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.exception.descr_past">
<code class="descname">descr_past</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.exception.descr_past" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the conceptual name of this exception in past tense</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pass_e</span><span class="p">()</span><span class="o">.</span><span class="n">descr</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;passed&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fail_e</span><span class="p">()</span><span class="o">.</span><span class="n">descr</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;failed&quot;</span>
<span class="gp">...</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="exception">
<dt id="tcfl.tc.pass_e">
<em class="property">exception </em><code class="descclassname">tcfl.tc.</code><code class="descname">pass_e</code><span class="sig-paren">(</span><em>description</em>, <em>attachments=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.pass_e" title="Permalink to this definition">¶</a></dt>
<dd><p>The test case passed</p>
<dl class="attribute">
<dt id="tcfl.tc.pass_e.tag">
<code class="descname">tag</code><em class="property"> = 'PASS'</em><a class="headerlink" href="#tcfl.tc.pass_e.tag" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="exception">
<dt id="tcfl.tc.blocked_e">
<em class="property">exception </em><code class="descclassname">tcfl.tc.</code><code class="descname">blocked_e</code><span class="sig-paren">(</span><em>description</em>, <em>attachments=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.blocked_e" title="Permalink to this definition">¶</a></dt>
<dd><p>The test case could not be completed because something failed and
disallowed testing if it woud pass or fail</p>
<dl class="attribute">
<dt id="tcfl.tc.blocked_e.tag">
<code class="descname">tag</code><em class="property"> = 'BLCK'</em><a class="headerlink" href="#tcfl.tc.blocked_e.tag" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="exception">
<dt id="tcfl.tc.error_e">
<em class="property">exception </em><code class="descclassname">tcfl.tc.</code><code class="descname">error_e</code><span class="sig-paren">(</span><em>description</em>, <em>attachments=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.error_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Executing the test case found an error</p>
<dl class="attribute">
<dt id="tcfl.tc.error_e.tag">
<code class="descname">tag</code><em class="property"> = 'ERRR'</em><a class="headerlink" href="#tcfl.tc.error_e.tag" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="exception">
<dt id="tcfl.tc.failed_e">
<em class="property">exception </em><code class="descclassname">tcfl.tc.</code><code class="descname">failed_e</code><span class="sig-paren">(</span><em>description</em>, <em>attachments=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.failed_e" title="Permalink to this definition">¶</a></dt>
<dd><p>The test case failed</p>
<dl class="attribute">
<dt id="tcfl.tc.failed_e.tag">
<code class="descname">tag</code><em class="property"> = 'FAIL'</em><a class="headerlink" href="#tcfl.tc.failed_e.tag" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="exception">
<dt id="tcfl.tc.skip_e">
<em class="property">exception </em><code class="descclassname">tcfl.tc.</code><code class="descname">skip_e</code><span class="sig-paren">(</span><em>description</em>, <em>attachments=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.skip_e" title="Permalink to this definition">¶</a></dt>
<dd><p>A decission was made to skip executing the test case</p>
<dl class="attribute">
<dt id="tcfl.tc.skip_e.tag">
<code class="descname">tag</code><em class="property"> = 'SKIP'</em><a class="headerlink" href="#tcfl.tc.skip_e.tag" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="data">
<dt id="tcfl.tc.valid_results">
<code class="descclassname">tcfl.tc.</code><code class="descname">valid_results</code><em class="property"> = {'BLCK': ('block', 'blocked'), 'ERRR': ('error', 'errored'), 'FAIL': ('fail', 'failed'), 'PASS': ('pass', 'passed'), 'SKIP': ('skip', 'skipped')}</em><a class="headerlink" href="#tcfl.tc.valid_results" title="Permalink to this definition">¶</a></dt>
<dd><p>List of valid results and translations in present and past tense</p>
<ul class="simple">
<li><em>pass</em>: the testcase has passed (raise <a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.pass_e</span></code></a>)</li>
<li><em>fail</em>: the testcase found a problem it <strong>was</strong> looking for, like an
assertion failure or inconsistency in the code being exercised (raise
<a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.failed_e</span></code></a>)</li>
<li><em>errr</em>: the testcase found a problem it <strong>was not</strong> looking for,
like a driver crash; raise <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a>,</li>
<li><em>blck</em>: the testcase has blocked due to an infrastructure issue
which forbids from telling if it passed, failed or errored (raise
<a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.blocked_e</span></code></a>)</li>
<li><em>skip</em>: the testcase has detected a condition that deems it not
applicable and thus shall be skipped (raise
<a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.skip_e</span></code></a>)</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="tcfl.tc.target_extension_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">target_extension_c</code><span class="sig-paren">(</span><em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_extension_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement API extensions to targets</p>
<p>An API extension allows you to extend the API for the
<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> class so that more functionality can
be added to the <cite>target</cite> objects passed to testcase methods (like
build*(), eval*(), etc) and used as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">extension_a</span><span class="p">(</span><span class="n">target_extension_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">report_info</span><span class="p">(</span><span class="s2">&quot;Hello world from extension_a&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">variable</span> <span class="o">=</span> <span class="mi">34</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target_c</span><span class="o">.</span><span class="n">extension_register</span><span class="p">(</span><span class="n">etension_a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
</pre></div>
</div>
<p>Now, in an (e.g) evaluation function in a testcase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="k">def</span> <span class="nf">eval_something</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">target1</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>     <span class="n">target1</span><span class="o">.</span><span class="n">extension_a</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>     <span class="k">if</span> <span class="n">target1</span><span class="o">.</span><span class="n">extension_a</span><span class="o">.</span><span class="n">variable</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">do_something</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
</pre></div>
</div>
<p>Extensions have to be registered with
<a class="reference internal" href="#tcfl.tc.target_c.extension_register" title="tcfl.tc.target_c.extension_register"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.target_c.extension_register()</span></code></a>. Unregister with
<a class="reference internal" href="#tcfl.tc.target_c.extension_unregister" title="tcfl.tc.target_c.extension_unregister"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.target_c.extension_unregister()</span></code></a></p>
<p>The extension can be anything, but are commonly used to provide
the code to access APIs that are not distributed as part of the
core TCF distribution (like for example, an API to access an
special sensor).</p>
<p>A package might add support on the server side for an interface to
access the target and on the client side to access said
interfaces.</p>
<p>The <cite>__init__()</cite> method will typically first check if the target
meets the criteria needed for the extension to work or be used. If
not it can raise <a class="reference internal" href="#tcfl.tc.target_extension_c.unneeded" title="tcfl.tc.target_extension_c.unneeded"><code class="xref py py-class docutils literal notranslate"><span class="pre">target_extension_c.unneeded</span></code></a> to avoid
the extension to be created.</p>
<p>Then it proceeds to create an instance that will be attached to
the target for later use.</p>
<dl class="exception">
<dt id="tcfl.tc.target_extension_c.unneeded">
<em class="property">exception </em><code class="descname">unneeded</code><a class="headerlink" href="#tcfl.tc.target_extension_c.unneeded" title="Permalink to this definition">¶</a></dt>
<dd><p>Raise this from __init__() if this extension is not needed for
this target.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_extension_c.target">
<code class="descname">target</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_extension_c.target" title="Permalink to this definition">¶</a></dt>
<dd><p>Target this extension applies to</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc.report_driver_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">report_driver_c</code><a class="headerlink" href="#tcfl.tc.report_driver_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Reporting driver interface</p>
<p>To create a reporting driver, subclass this class, implement
<a class="reference internal" href="#tcfl.tc.report_driver_c.report" title="tcfl.tc.report_driver_c.report"><code class="xref py py-meth docutils literal notranslate"><span class="pre">report()</span></code></a> and then create an instance, adding it calling
<a class="reference internal" href="#tcfl.tc.report_driver_c.add" title="tcfl.tc.report_driver_c.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a>.</p>
<p>A testcase reports information by calling the <cite>report_*()</cite> APIs in
<a class="reference internal" href="#tcfl.tc.reporter_c" title="tcfl.tc.reporter_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">reporter_c</span></code></a>, which multiplexes into each reporting driver
registered with <a class="reference internal" href="#tcfl.tc.report_driver_c.add" title="tcfl.tc.report_driver_c.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a>, calling each drivers <a class="reference internal" href="#tcfl.tc.report_driver_c.report" title="tcfl.tc.report_driver_c.report"><code class="xref py py-meth docutils literal notranslate"><span class="pre">report()</span></code></a>
function which will direct it to the appropiate place.</p>
<p>Drivers can be created to dump the information in any format and
to whichever location, as needed.</p>
<p>For examples, look at:</p>
<ul class="simple">
<li><a class="reference internal" href="02-guides.html#module-tcfl.report_console" title="tcfl.report_console"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tcfl.report_console</span></code></a></li>
<li><a class="reference internal" href="02-guides.html#module-tcfl.report_jinja2" title="tcfl.report_jinja2"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tcfl.report_jinja2</span></code></a></li>
<li><a class="reference internal" href="02-guides.html#module-tcfl.report_taps" title="tcfl.report_taps"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tcfl.report_taps</span></code></a></li>
<li><a class="reference internal" href="02-guides.html#module-tcfl.report_mongodb" title="tcfl.report_mongodb"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tcfl.report_mongodb</span></code></a></li>
</ul>
<dl class="method">
<dt id="tcfl.tc.report_driver_c.report">
<code class="descname">report</code><span class="sig-paren">(</span><em>reporter</em>, <em>tag</em>, <em>ts</em>, <em>delta</em>, <em>level</em>, <em>message</em>, <em>alevel</em>, <em>attachments</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.report_driver_c.report" title="Permalink to this definition">¶</a></dt>
<dd><p>Low level report from testcases</p>
<p>The reporting API calls this function for the final recording
of a reported message. In here basically anything can be
done–but they being called frequently, it has to be efficient
or will slow testcase execution considerably. Actions done in
this function can be:</p>
<ul class="simple">
<li>filtering (to only run for certain testcases, log levels, tags or
messages)</li>
<li>dump data to a database</li>
<li>record to separate files based on whichever logic</li>
<li>etc</li>
</ul>
<p>When a testcase is completed, it will issue a message
<em>COMPLETION &lt;result&gt;</em>, which marks the end of the testcase.</p>
<p>When all the testcases are run, the global testcase reporter
(<a class="reference internal" href="#tcfl.tc.tc_global" title="tcfl.tc.tc_global"><code class="xref py py-data docutils literal notranslate"><span class="pre">tcfl.tc.tc_global</span></code></a>) will issue a <em>COMPLETION &lt;result&gt;</em>
message. The global testcase reporter can be identified because
it has an attribute <em>skip_reports</em> set to <em>True</em> and thus can
be identified with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_tc</span><span class="p">,</span> <span class="s2">&quot;skip_reports&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">do_somethin_for_the_global_reporter</span>
</pre></div>
</div>
<p>Important points:</p>
<ul>
<li><p class="first"><strong>do not rely on globals</strong>; this call is not lock protected
for concurrency; will be called for <em>every</em> single report the
internals of the test runner and the testcases do from
multiple threads at the same time. Expect a <em>lot</em> of calls.</p>
<p>Must be ready to accept multiple threads calling from
different contexts. It is a good idea to use thread local
storage (TLS) to store state if needed. See an example in
<a class="reference internal" href="02-guides.html#tcfl.report_console.driver" title="tcfl.report_console.driver"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.report_console.driver</span></code></a>).</p>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>reporter</strong> (<a class="reference internal" href="#tcfl.tc.reporter_c" title="tcfl.tc.reporter_c"><em>reporter_c</em></a>) – who is reporting this; this can be
a <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">testcase</span></code></a> or a <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">target</span></code></a>.</li>
<li><strong>tag</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – type of report (PASS, ERRR, FAIL, BLCK, INFO,
DATA); note they are all same length and described in
<a class="reference internal" href="#tcfl.tc.valid_results" title="tcfl.tc.valid_results"><code class="xref py py-data docutils literal notranslate"><span class="pre">valid_results</span></code></a>.</li>
<li><strong>ts</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – timestamp for when the message got generated
(in seconds)</li>
<li><strong>delta</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – time lapse from when the testcase started
execution until this message was generated.</li>
<li><strong>level</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – report level for the <em>message</em> (versus for
the attachments); note report levels greater or equal to
1000 are used to pass control messages, so they might not be
subject to normal verbosity control (for example, for a log
file you might want to always include them).</li>
<li><strong>message</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>single line string describing the message
to report.</p>
<p>If the message starts with  <em>“COMPLETION “</em>, this is the
final message issued to mark the result of executing a
single testcase. At this point, you can use fields such
as <a class="reference internal" href="#tcfl.tc.tc_c.result" title="tcfl.tc.tc_c.result"><code class="xref py py-data docutils literal notranslate"><span class="pre">tc_c.result</span></code></a> and <a class="reference internal" href="#tcfl.tc.tc_c.result_eval" title="tcfl.tc.tc_c.result_eval"><code class="xref py py-data docutils literal notranslate"><span class="pre">tc_c.result_eval</span></code></a> and it
can be used as a synchronization point to for example, flush
a file to disk or upload a complete record to a database.</p>
<p>Python2: note this has been converted to unicode UTF-8</p>
</li>
<li><strong>alevel</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – report level for the attachments</li>
<li><strong>attachments</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>extra information to add to the
message being reported; shall be reported as <em>KEY: VALUE</em>;
VALUE shall be recursively reported:</p>
<ul>
<li>lists/tuples/sets shall be reported indicating the index
of the member (such as <em>KEYNAME[3]: VALUE</em></li>
<li>dictionaries shall be recursively reported</li>
<li>strings and integers shall be reported as themselves</li>
<li>any other data type can be reported as what it’s <em>repr</em>
function returns when converting it to unicode ro whatever
representation the driver can do.</li>
</ul>
<p>You can use functions such <a class="reference internal" href="#commonl.data_dump_recursive" title="commonl.data_dump_recursive"><code class="xref py py-func docutils literal notranslate"><span class="pre">commonl.data_dump_recursive()</span></code></a>
to convert a dictionary to a unicode representation.</p>
<p>This might contain strings that are not valid UTF-8, so you
need to convert them using <a class="reference internal" href="#commonl.mkutf8" title="commonl.mkutf8"><code class="xref py py-func docutils literal notranslate"><span class="pre">commonl.mkutf8()</span></code></a> or
similar. <a class="reference internal" href="#commonl.data_dump_recursive" title="commonl.data_dump_recursive"><code class="xref py py-func docutils literal notranslate"><span class="pre">commonl.data_dump_recursive()</span></code></a> do that for you.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.report_driver_c.add">
<em class="property">classmethod </em><code class="descname">add</code><span class="sig-paren">(</span><em>obj</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.report_driver_c.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a driver to handle other report mechanisms</p>
<p>A report driver is used by <em>tcf run</em>, the meta test runner, to
report information about the execution of testcases.</p>
<p>A driver implements the reporting in whichever way it decides
it needs to suit the application, uploading information to a
server, writing it to files, printing it to screen, etc.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">my_report_driver</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">report_driver_c</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">report_driver_c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">my_report_driver</span><span class="p">())</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>obj</strong> (<a class="reference internal" href="#tcfl.tc.report_driver_c" title="tcfl.tc.report_driver_c"><em>tcfl.tc.report_driver_c</em></a>) – object subclasss of
<a class="reference internal" href="#tcfl.tc.report_driver_c" title="tcfl.tc.report_driver_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.report_driver_c</span></code></a> that implements the
reporting.</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) where is this being registered;
defaults to the caller of this function.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.report_driver_c.remove">
<em class="property">classmethod </em><code class="descname">remove</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.report_driver_c.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a report driver previously added with <a class="reference internal" href="#tcfl.tc.report_driver_c.add" title="tcfl.tc.report_driver_c.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>obj</strong> (<a class="reference internal" href="#tcfl.tc.report_driver_c" title="tcfl.tc.report_driver_c"><em>tcfl.tc.report_driver_c</em></a>) – object subclasss of
<a class="reference internal" href="#tcfl.tc.report_driver_c" title="tcfl.tc.report_driver_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.report_driver_c</span></code></a> that implements the
reporting.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.report_driver_c.ident_simplify">
<em class="property">classmethod </em><code class="descname">ident_simplify</code><span class="sig-paren">(</span><em>ident</em>, <em>runid</em>, <em>hashid</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.report_driver_c.ident_simplify" title="Permalink to this definition">¶</a></dt>
<dd><p>If any looks like:</p>
<blockquote>
<div>RUNID:HASHID[SOMETHING]</div></blockquote>
<p>simplify it by returning <em>SOMETHING</em></p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc.reporter_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">reporter_c</code><span class="sig-paren">(</span><em>testcase=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.reporter_c" title="Permalink to this definition">¶</a></dt>
<dd><p>High level reporting API</p>
<p>Embedded as part of a target or testcase, allows them to report in
a unified way</p>
<p>This class accesses members that are undefined in here but defined
by the class that inherits it (tc_c and target_c):</p>
<ul class="simple">
<li>self.kws</li>
</ul>
<dl class="method">
<dt id="tcfl.tc.reporter_c.report_pass">
<code class="descname">report_pass</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.reporter_c.report_pass" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.reporter_c.report_fail">
<code class="descname">report_fail</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.reporter_c.report_fail" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.reporter_c.report_error">
<code class="descname">report_error</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.reporter_c.report_error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.reporter_c.report_blck">
<code class="descname">report_blck</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.reporter_c.report_blck" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.reporter_c.report_skip">
<code class="descname">report_skip</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.reporter_c.report_skip" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.reporter_c.report_info">
<code class="descname">report_info</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.reporter_c.report_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.reporter_c.report_data">
<code class="descname">report_data</code><span class="sig-paren">(</span><em>domain</em>, <em>name</em>, <em>value</em>, <em>expand=True</em>, <em>level=2</em>, <em>dlevel=0</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.reporter_c.report_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Report measurable data</p>
<p>When running a testcase, if data is collected that has to be
reported for later analysis, use this function to report
it. This will be reported by the report driver in a way that
makes it easy to collect later on.</p>
<p>Measured data is identified by a <em>domain</em> and a <em>name</em>, plus
then the actual value.</p>
<p>A way to picture how this data can look once aggregated is as
a table per domain, on which each invocation is a row and each
column will be the values for each name.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>domain</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – to which domain this measurement applies
(eg: “Latency Benchmark %(type)s”);</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the value  (eg: “context switch
(microseconds)”); it is recommended to always add the unit
the measurement represents.</li>
<li><strong>value</strong> – value to report for the given domain and name;
any type can be reported.</li>
<li><strong>expand</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – <p>(optional) by default, the <em>domain</em> and
<em>name</em> fields will be %(FIELD)s expanded with the keywords
of the testcase or target. If <em>False</em>, it will not be
expanded.</p>
<p>This enables to, for example, specify a domain of “Latency
measurements for target %(type)s” which will automatically
create a different domain for each type of target.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.reporter_c.report_tweet">
<code class="descname">report_tweet</code><span class="sig-paren">(</span><em>what</em>, <em>result</em>, <em>extra_report=''</em>, <em>ignore_nothing=False</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>dlevel_failed=0</em>, <em>dlevel_blocked=0</em>, <em>dlevel_passed=0</em>, <em>dlevel_skipped=0</em>, <em>dlevel_error=0</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.reporter_c.report_tweet" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc.target_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">target_c</code><span class="sig-paren">(</span><em>rt</em>, <em>testcase</em>, <em>bsp_model</em>, <em>target_want_name</em>, <em>extensions_only=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c" title="Permalink to this definition">¶</a></dt>
<dd><p>A remote target that can be manipulated</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>rt</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – remote target descriptor (dictionary) as returned
by <a class="reference internal" href="#tcfl.ttb_client.rest_target_find_all" title="tcfl.ttb_client.rest_target_find_all"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.ttb_client.rest_target_find_all()</span></code></a> and others.</li>
<li><strong>tescase</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tc_c</em></a>) – testcase descriptor to which this target
instance will be uniquely assigned.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>A target always operate in a given <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>, as decided
by the testcase runner. If a remote target A has two BSP models (1
and 2) and a testcase T shall be run on both, it will create two
testcase instances, T1 and T2. Each will be assigned an instance
of <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">target_c</span></code></a>, A1 and A2 respectively, representing the
same target A, but each set to a different <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>.</p>
<p>Note these object expose the basic target API, but then different
extensions provide APIs to access other interfaces, depending on
if the target exposes it or not; these is the current list of
implemented interfaces:</p>
<ul class="simple">
<li><a class="reference internal" href="#tcfl.target_ext_console.extension" title="tcfl.target_ext_console.extension"><code class="xref py py-class docutils literal notranslate"><span class="pre">console</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_capture.extension" title="tcfl.target_ext_capture.extension"><code class="xref py py-class docutils literal notranslate"><span class="pre">capture</span></code></a> for
stream and snapshot captures of audio, video, network traffic,
etc</li>
<li><a class="reference internal" href="#tcfl.target_ext_debug.extension" title="tcfl.target_ext_debug.extension"><code class="xref py py-class docutils literal notranslate"><span class="pre">debug</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_fastboot.extension" title="tcfl.target_ext_fastboot.extension"><code class="xref py py-class docutils literal notranslate"><span class="pre">fastboot</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_images.extension" title="tcfl.target_ext_images.extension"><code class="xref py py-class docutils literal notranslate"><span class="pre">images</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_ioc_flash_server_app.extension" title="tcfl.target_ext_ioc_flash_server_app.extension"><code class="xref py py-class docutils literal notranslate"><span class="pre">ioc_flash_server_app</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_power.extension" title="tcfl.target_ext_power.extension"><code class="xref py py-class docutils literal notranslate"><span class="pre">power</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_shell.shell" title="tcfl.target_ext_shell.shell"><code class="xref py py-class docutils literal notranslate"><span class="pre">shell</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_ssh.ssh" title="tcfl.target_ext_ssh.ssh"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssh</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_tunnel.tunnel" title="tcfl.target_ext_tunnel.tunnel"><code class="xref py py-class docutils literal notranslate"><span class="pre">tunnel</span></code></a></li>
<li><a class="reference internal" href="#tcfl.app_zephyr.zephyr" title="tcfl.app_zephyr.zephyr"><code class="xref py py-class docutils literal notranslate"><span class="pre">zephyr</span></code></a></li>
</ul>
<dl class="attribute">
<dt id="tcfl.tc.target_c.want_name">
<code class="descname">want_name</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.want_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Name this target is known to by the testcase (as it was
claimed with the <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.target()</span></code></a> decorator)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.rt">
<code class="descname">rt</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.rt" title="Permalink to this definition">¶</a></dt>
<dd><p>Remote tags of this target</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.id">
<code class="descname">id</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.id" title="Permalink to this definition">¶</a></dt>
<dd><p>(short) id of this target</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.fullid">
<code class="descname">fullid</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.fullid" title="Permalink to this definition">¶</a></dt>
<dd><p>Full id of this target</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.type">
<code class="descname">type</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.type" title="Permalink to this definition">¶</a></dt>
<dd><p>Type name of this target</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.ticket">
<code class="descname">ticket</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.ticket" title="Permalink to this definition">¶</a></dt>
<dd><p>ticket used to acquire this target</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.testcase">
<code class="descname">testcase</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.testcase" title="Permalink to this definition">¶</a></dt>
<dd><p>Testcase that this target is currently executing</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.bsp_model">
<code class="descname">bsp_model</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.bsp_model" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a> this target is currently configured for</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.bsps">
<code class="descname">bsps</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.bsps" title="Permalink to this definition">¶</a></dt>
<dd><p>List of BSPs supported by this target’s currently selected
<a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.keep_active">
<code class="descname">keep_active</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.keep_active" title="Permalink to this definition">¶</a></dt>
<dd><p>Make sure the testcase indicates the daemon that this
target is to be marked as active during the testcase
execution of expectation loops.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.bsps_stub">
<code class="descname">bsps_stub</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.bsps_stub" title="Permalink to this definition">¶</a></dt>
<dd><p>Dict of BSPs that have to be stubbed for the board to work
correctly in the current <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a> (if the board
has two BSPs but BSP1 needs to have an image of something
so BSP2 can start). The App builder can manipulate this to
remove BSPs that can be ignored. The value is a tuple (app,
srcinfo) that indicates the App builder that will build the
stub and with which source information (path to the
source).</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.bsp">
<code class="descname">bsp</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.bsp" title="Permalink to this definition">¶</a></dt>
<dd><p>BSP (inside the <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>) this target is currently
configured for</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.tmpdir">
<code class="descname">tmpdir</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.tmpdir" title="Permalink to this definition">¶</a></dt>
<dd><p>Temporary directory where to store files – this is the same
as the testcase’s – it is needed for the report driver to
find where to put stuff.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.kws">
<code class="descname">kws</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.kws" title="Permalink to this definition">¶</a></dt>
<dd><p>Keywords for <code class="docutils literal notranslate"><span class="pre">%(KEY)[sd]</span></code> substitution specific to the
testcase or target and its current active <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>
and BSP as set with <a class="reference internal" href="#tcfl.tc.target_c.bsp_set" title="tcfl.tc.target_c.bsp_set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bsp_set()</span></code></a>.</p>
<p>FIXME: elaborate on testcase keywords, target keyworkds</p>
<p>These are obtained from the remote target descriptor
(<cite>self.rt</cite>) as obtained from the remote <em>ttbd</em> server.</p>
<p>These can be used to generate strings based on information,
as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span> <span class="nb">print</span> <span class="s2">&quot;Something </span><span class="si">%(id)s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">kws</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">target</span><span class="o">.</span><span class="n">shcmd_local</span><span class="p">(</span><span class="s2">&quot;cp </span><span class="si">%(id)s</span><span class="s2">.config final.config&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To find which fields are available for a target:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list -vv TARGETNAME
</pre></div>
</div>
<p>The testcase will provide also other fields, in
<code class="xref py py-data docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.kws</span></code>, which are rolled in in this variable
too. See how to more available keywords <a class="reference internal" href="04-HOWTOs.html#finding-testcase-metadata"><span class="std std-ref">here</span></a></p>
<p>Note that testcases might be setting more keywords in the
target or the testcase with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">kw_set</span><span class="p">(</span><span class="s2">&quot;keywordname&quot;</span><span class="p">,</span> <span class="s2">&quot;somevalue&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">kw_set</span><span class="p">(</span><span class="s2">&quot;keywordname&quot;</span><span class="p">,</span> <span class="s2">&quot;somevalue&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>as well, any of the target’s properties set with
<a class="reference internal" href="#tcfl.tc.target_c.property_set" title="tcfl.tc.target_c.property_set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TARGET.property_set</span></code></a>
(or it’s command line equivalent <code class="docutils literal notranslate"><span class="pre">tcf</span> <span class="pre">property-set</span> <span class="pre">TARGET</span>
<span class="pre">PROPERTY</span> <span class="pre">VALUE</span></code>) will show up as keywords.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.kws_origin">
<code class="descname">kws_origin</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.kws_origin" title="Permalink to this definition">¶</a></dt>
<dd><p>Origin of keys defined in self.kws</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.do_acquire">
<code class="descname">do_acquire</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.do_acquire" title="Permalink to this definition">¶</a></dt>
<dd><p>Shall we acquire this target? By default the testcases get
the targets they request acquired for exclusive use, but in
some cases, it might not be needed (default: True)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.lock">
<code class="descname">lock</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.lock" title="Permalink to this definition">¶</a></dt>
<dd><p>Note this only applies mainly to _*set()* operations and
remember other testcases can’t use the target.</p>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.target_c.extension_register">
<em class="property">classmethod </em><code class="descname">extension_register</code><span class="sig-paren">(</span><em>ext_cls</em>, <em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.extension_register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register an extension to the <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> class.</p>
<p>This is usually called from a config file to register an
extension provided by a package.</p>
<p>See <a class="reference internal" href="#tcfl.tc.target_extension_c" title="tcfl.tc.target_extension_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">target_extension_c</span></code></a> for details</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ext_cls</strong> (<a class="reference internal" href="#tcfl.tc.target_extension_c" title="tcfl.tc.target_extension_c"><em>target_extension_c</em></a>) – a class that provides an extension</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the extension (defaults to
the class name)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.target_c.extension_unregister">
<em class="property">classmethod </em><code class="descname">extension_unregister</code><span class="sig-paren">(</span><em>ext_cls</em>, <em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.extension_unregister" title="Permalink to this definition">¶</a></dt>
<dd><p>Unregister an extension to the <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> class.</p>
<p>This is usually used by unit tests. There usually is no need
to unregister extensions.</p>
<p>See <a class="reference internal" href="#tcfl.tc.target_extension_c" title="tcfl.tc.target_extension_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">target_extension_c</span></code></a> for details</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ext_cls</strong> (<a class="reference internal" href="#tcfl.tc.target_extension_c" title="tcfl.tc.target_extension_c"><em>target_extension_c</em></a>) – a class that provides an extension</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the extension (defaults to
the class name)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.bsps_all">
<code class="descname">bsps_all</code><a class="headerlink" href="#tcfl.tc.target_c.bsps_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of all BSPs in the target (note this might be
more than the ones available in the currentlt selected BSP
model).</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.bsp_set">
<code class="descname">bsp_set</code><span class="sig-paren">(</span><em>bsp=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.bsp_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the active BSP</p>
<p>If the BSP is omitted, this will select the first BSP in the
current BSP model. This means that if there is a preference in
multiple BSPs, they have to be listed as such in the target’s
configuration.</p>
<p>If there are no BSPs, this will raise an exception</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) The name of any BSP supported by
the board (not necessarily in the BSP-Model list of active
BSPs. These are always in <a class="reference internal" href="#tcfl.tc.target_c.bsps_all" title="tcfl.tc.target_c.bsps_all"><code class="xref py py-attr docutils literal notranslate"><span class="pre">bsps_all</span></code></a>.
If this argument is False, then the active BSP is reset to none.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.kws_set">
<code class="descname">kws_set</code><span class="sig-paren">(</span><em>d</em>, <em>bsp=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.kws_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a bunch of target’s keywords and values</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>d</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – A dictionary of keywords and values</li>
<li><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) BSP for which we want to set the
keywords; if omitted, we are setting the keywords for the whole
target</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.kw_set">
<code class="descname">kw_set</code><span class="sig-paren">(</span><em>kw</em>, <em>val</em>, <em>bsp=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.kw_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a target’s keyword and value</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>kw</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – A string describing naming the keyword/value pair</li>
<li><strong>val</strong> – the value (can be anything)</li>
<li><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) BSP for which we want to set the
keyword; if omitted, we are setting the keyword for the whole
target</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.kw_unset">
<code class="descname">kw_unset</code><span class="sig-paren">(</span><em>kw</em>, <em>bsp=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.kw_unset" title="Permalink to this definition">¶</a></dt>
<dd><p>Unset a target’s string keyword</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>kw</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – keyword name</li>
<li><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) BSP for which we want to unset the
keyword; if omitted, we are setting the keyword for the whole
target</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.kws_required_verify">
<code class="descname">kws_required_verify</code><span class="sig-paren">(</span><em>kws</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.kws_required_verify" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify if a target exports required keywords, raise blocked
exception if any is missing.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.ic_field_get">
<code class="descname">ic_field_get</code><span class="sig-paren">(</span><em>ic</em>, <em>field</em>, <em>field_description=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.ic_field_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Obtain the value of a field for a target in an interconnect</p>
<p>A target might be a member of one or more interconnects, as
described by its tags (<em>interconnects</em> section).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ic</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – target describing the interconnect
of which this target is a member (as defined in a
&#64; <a class="reference internal" href="#tcfl.tc.interconnect" title="tcfl.tc.interconnect"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.interconnect()</span></code></a> decorator to the testcase
class)</li>
<li><strong>field</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the filed whose value we want.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">eval_somestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target1</span><span class="p">,</span> <span class="n">target2</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">target1</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;ifconfig eth0 </span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>                     <span class="o">%</span> <span class="p">(</span><span class="n">target2</span><span class="o">.</span><span class="n">addr_get</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="s1">&#39;ipv4&#39;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="n">target2</span><span class="o">.</span><span class="n">ic_field_get</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="s1">&#39;ipv4_addr_len&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.addr_get">
<code class="descname">addr_get</code><span class="sig-paren">(</span><em>ic</em>, <em>tech</em>, <em>instance=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.addr_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Obtain the address for a target in an interconnect</p>
<p>A target might be a member of one or more interconnects, as
described by its tags (<em>interconnects</em> section).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ic</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – target describing the interconnect
of which this target is a member (as defined in a
&#64; <a class="reference internal" href="#tcfl.tc.interconnect" title="tcfl.tc.interconnect"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.interconnect()</span></code></a> decorator to the testcase
class)</li>
<li><strong>tech</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>name of the technology on which address we
are interested.</p>
<p>As part of said membership, one or more key/value pairs can be
specified. Assigned addresses are always called
<em>TECHNOLOGY_addr</em>, were <em>TECHNOLOGY</em> can be things like
<em>ipv4</em>, <em>ipv6</em>, <em>bt</em>, <em>mac</em>, etc…</p>
<p>If <em>tech</em> fits a whole key name, it will be used instead.</p>
</li>
<li><strong>instance</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) when this target has multiple
connections to the same interconnect (via multiple physical
or virtual network interfaces), you can select which
instance of those it is wanted.</p>
<p>By default this will return the default instance (eg, the
one corresponding to the interconnect <code class="docutils literal notranslate"><span class="pre">ICNAME</span></code>), but if an
instance is added, it will return the IP address for
<code class="docutils literal notranslate"><span class="pre">ICNAME#INSTANCE</span></code> as declared in the target’s
configuration with functions such as
<a class="reference internal" href="#ttbl.test_target.add_to_interconnect" title="ttbl.test_target.add_to_interconnect"><code class="xref py py-func docutils literal notranslate"><span class="pre">ttbl.test_target.add_to_interconnect()</span></code></a>.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>When the target, for the current testcase is member of a
single interconnect, any <em>TECHNOLOGY_addr</em> for the
interconnect key/value will be available in the <a class="reference internal" href="#tcfl.tc.target_c.kws" title="tcfl.tc.target_c.kws"><code class="xref py py-attr docutils literal notranslate"><span class="pre">kws</span></code></a>
member as for example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;ipv4_addr&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>However, when member of multiple interconnects, which members
are promoted to top level is undertermined if both
interconnects provide address information for the same
technology. Use this function to obtain the
interconnect-specific information.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">eval_somestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target1</span><span class="p">,</span> <span class="n">target2</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">target1</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;scp /etc/passwd </span><span class="si">%s</span><span class="s2">:/etc/passwd&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>                     <span class="o">%</span> <span class="n">target2</span><span class="o">.</span><span class="n">addr_get</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="s1">&#39;ipv4&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.app_get">
<code class="descname">app_get</code><span class="sig-paren">(</span><em>bsp=None</em>, <em>noraise=True</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.app_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the App builder that is assigned to a particular BSP in
the target.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Name of the BSP we are querying the App
builder for. Can be omitted if the current <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>
for the target contains a single BSP, and thus it’ll be
auto-guessed.</li>
<li><strong>noraise</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) if True, do not raise an
exception if we cannot find an App Builder and just return
Nones.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.shcmd_local">
<code class="descname">shcmd_local</code><span class="sig-paren">(</span><em>cmd</em>, <em>origin=None</em>, <em>reporter=None</em>, <em>logfile=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.shcmd_local" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a shell command in the local machine, substituting
<em>%(KEYWORD)[sd]</em> with keywords defined by the target and testcase.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.acquire">
<code class="descname">acquire</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.acquire" title="Permalink to this definition">¶</a></dt>
<dd><p>Acquire a target</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.release">
<code class="descname">release</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release a target</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.active">
<code class="descname">active</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.active" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark an owned target as active</p>
<p>For long running tests, indicate to the server that this
target is still active.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.property_get">
<code class="descname">property_get</code><span class="sig-paren">(</span><em>property_name</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.property_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a property from the target</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>property_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Name of the property to read</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns str:</th><td class="field-body">value of the property (if set) or None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.property_set">
<code class="descname">property_set</code><span class="sig-paren">(</span><em>property_name</em>, <em>value=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.property_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a property on the target</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>property_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Name of the property to read</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) Value to set; <em>None</em> to unset it</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.disable">
<code class="descname">disable</code><span class="sig-paren">(</span><em>reason='disabled by the administrator'</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable a target, setting an optional reason</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>reason</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) string describing the reason
[default: none]</td>
</tr>
</tbody>
</table>
<p>This sets a field <em>disabled</em> in the inventory with
the messages; convention is this means it is disabled.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.enable">
<code class="descname">enable</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable a (maybe disabled) target</p>
<p>This removes the <em>disabled</em> field from the inventory.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.thing_plug">
<code class="descname">thing_plug</code><span class="sig-paren">(</span><em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.thing_plug" title="Permalink to this definition">¶</a></dt>
<dd><p>Connect a thing described in the target’s <a class="reference internal" href="#tcfl.tc.tags" title="tcfl.tc.tags"><code class="xref py py-attr docutils literal notranslate"><span class="pre">tags</span></code></a>
<em>things</em> dictionary to the target.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>thing</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – thing to connect</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.thing_unplug">
<code class="descname">thing_unplug</code><span class="sig-paren">(</span><em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.thing_unplug" title="Permalink to this definition">¶</a></dt>
<dd><p>Disconnect a thing described in the target’s <a class="reference internal" href="#tcfl.tc.tags" title="tcfl.tc.tags"><code class="xref py py-attr docutils literal notranslate"><span class="pre">tags</span></code></a>
<em>things</em> dictionary from the target.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>thing</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – thing to disconnect</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.thing_list">
<code class="descname">thing_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.thing_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of connected things</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.console_tx">
<code class="descname">console_tx</code><span class="sig-paren">(</span><em>data</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.console_tx" title="Permalink to this definition">¶</a></dt>
<dd><p>Transmits the data over the given console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> – data to be sent; data can be anything that can be
transformed into a sequence of bytes</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of console over which to
send the data (otherwise use the default one).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note this function is equivalent to
<code class="xref py py-meth docutils literal notranslate"><span class="pre">target.console.write</span></code>, which is the raw
version of this function.</p>
<p>See <a class="reference internal" href="#tcfl.tc.target_c.send" title="tcfl.tc.target_c.send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send()</span></code></a> for a version that works with the expect sequence</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.crlf">
<code class="descname">crlf</code><a class="headerlink" href="#tcfl.tc.target_c.crlf" title="Permalink to this definition">¶</a></dt>
<dd><p>What will <a class="reference internal" href="#tcfl.tc.target_c.send" title="tcfl.tc.target_c.send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target_c.send()</span></code></a> use for CR/LF when sending data
to the target’s consoles. Defaults to <code class="docutils literal notranslate"><span class="pre">\r\n</span></code>, but it can be
set to any string, even <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> for an empty string.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.send">
<code class="descname">send</code><span class="sig-paren">(</span><em>data</em>, <em>console=None</em>, <em>crlf=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.send" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#tcfl.tc.target_c.console_tx" title="tcfl.tc.target_c.console_tx"><code class="xref py py-meth docutils literal notranslate"><span class="pre">console_tx()</span></code></a>, transmits the string of data
over the given console.</p>
<p>This function, however, differs in takes only strings and that
it will append a CRLF sequence at the end of the given
string. As well, it will <em>flush</em> the receive pipe so that next
time we <a class="reference internal" href="#tcfl.tc.target_c.expect" title="tcfl.tc.target_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">expect()</span></code></a> something, it will be only for anything
received after we called this function (so we’ll expect to see
even the sending of the command).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – string of data to send</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of console over which to
send the data (otherwise use the default one).</li>
<li><strong>ctlf</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) CRLF technique to use, or what to
append to the string as a CRLF:</p>
<ul>
<li>None: use whatever is in <a class="reference internal" href="#tcfl.tc.target_c.crlf" title="tcfl.tc.target_c.crlf"><code class="xref py py-attr docutils literal notranslate"><span class="pre">target_c.crlf</span></code></a></li>
<li><code class="docutils literal notranslate"><span class="pre">\r</span></code>: use carriage return</li>
<li><code class="docutils literal notranslate"><span class="pre">\r\n</span></code>: use carriage return and line feed</li>
<li><code class="docutils literal notranslate"><span class="pre">\n</span></code>: use line feed</li>
<li><code class="docutils literal notranslate"><span class="pre">ANYSTRING</span></code>: append <em>ANYSTRING</em></li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.on_console_rx">
<code class="descname">on_console_rx</code><span class="sig-paren">(</span><em>regex_or_str</em>, <em>timeout=None</em>, <em>console=None</em>, <em>result='pass'</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.on_console_rx" title="Permalink to this definition">¶</a></dt>
<dd><p>Set up an action to perform (pass, fail, block or skip)
when a string or regular expresison is received on a given
console in this target.</p>
<p>Note this does not wait for said string; you need to run the
testcase’s <em>expecter</em> loop with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span> <span class="bp">self</span><span class="o">.</span><span class="n">tls</span><span class="o">.</span><span class="n">expecter</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Als well, those actions will be performed when running
<a class="reference internal" href="#tcfl.tc.target_c.expect" title="tcfl.tc.target_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">expect()</span></code></a> or <a class="reference internal" href="#tcfl.tc.target_c.wait" title="tcfl.tc.target_c.wait"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wait()</span></code></a> for blocking versions.</p>
<p>This allows you to specify many different things you are
waiting for from one or <em>more</em> targets and wait for all of
them at the same time and block until all of them are received
(or timeout).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>regex_or_str</strong> – string or regular expression (compiled
with <a class="reference external" href="https://docs.python.org/2.7/library/re.html#re.compile" title="(in Python v2.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">re.compile()</span></code></a>.</li>
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – Seconds to wait for regex_or_str to be
received, raise <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.failed_e</span></code></a>
otherwise. If <em>False</em>, no timeout check is done; if <em>None</em>,
it is taken from the default timeout set by the testcase.</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of console from which to
receive the data</li>
<li><strong>result</strong> – <p>what to do when that regex_or_str is found on
the given console:</p>
<ul>
<li><em>pass</em>, (default) raise <a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.pass_e</span></code></a></li>
<li><em>block</em>, raise <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.blocked_e</span></code></a></li>
<li><em>error</em>, raise <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a>,</li>
<li><em>failed</em>, raise <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.failed_e</span></code></a>,</li>
<li><em>blocked</em>, raise <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.blocked_e</span></code></a></li>
</ul>
<p>Note that when running an expecter loop, if seven different
actions are added indicating they are expected to pass, the
seven of them must have raised a pass exception (or
indicated passage somehow) before the loop will consider it
a full pass. See <a class="reference internal" href="#tcfl.expecter.expecter_c.run" title="tcfl.expecter.expecter_c.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.expecter.expecter_c.run()</span></code></a>.</p>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first"><a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.pass_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.blocked_e</span></code></a>, <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.failed_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a>, <a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.skip_e</span></code></a>,
any other exception from runtimes.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>True</em> if a poller for the console was added to the
testcase’s expecter loop, <em>False</em> otherwise.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.wait">
<code class="descname">wait</code><span class="sig-paren">(</span><em>regex_or_str</em>, <em>timeout=None</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.wait" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for a particular regex/string to be received on a given
console of this target before a given timeout.</p>
<p>See <a class="reference internal" href="#tcfl.tc.target_c.expect" title="tcfl.tc.target_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">expect()</span></code></a> for a version that just raises
exceptions when the output is not received.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – Seconds to wait for regex_or_str to be
received, raise <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a>
otherwise. If <em>False</em>, no timeout check is done; if <em>None</em>,
it is taken from the default timeout set by the testcase.</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of console from which to
receive the data</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>True</em> if the output was received before the
timeout, <em>False</em> otherwise.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.expect">
<code class="descname">expect</code><span class="sig-paren">(</span><em>regex_or_str</em>, <em>timeout=None</em>, <em>console=None</em>, <em>name=None</em>, <em>raise_on_timeout=&lt;class 'tcfl.tc.failed_e'&gt;</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.expect" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for a particular regex/string to be received on a given
console of this target before a given timeout.</p>
<p>Similar to <a class="reference internal" href="#tcfl.tc.target_c.wait" title="tcfl.tc.target_c.wait"><code class="xref py py-func docutils literal notranslate"><span class="pre">wait()</span></code></a>, it will raise an exception if
&#64;regex_or_str is not received before &#64;timeout on &#64;console.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – Seconds to wait for regex_or_str to be
received, raise <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a>
otherwise. If <em>False</em>, no timeout check is done; if <em>None</em>,
it is taken from the default timeout set by the testcase.</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of console from which to
receive the data</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) when reporting information about
this expectation, what origin shall it list, eg:</p>
<ul>
<li><em>None</em> (default) to get the current caller</li>
<li><em>commonl.origin_get(2)</em> also to get the current caller</li>
<li><em>commonl.origin_get(1)</em> also to get the current function</li>
</ul>
<p>or something as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;somefilename:43&quot;</span>
</pre></div>
</div>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Nothing, if the output is received.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.blocked_e</span></code></a> on error,
<a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a> if not received,
any other runtime exception.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.stub_app_add">
<code class="descname">stub_app_add</code><span class="sig-paren">(</span><em>bsp</em>, <em>_app</em>, <em>app_src</em>, <em>app_src_options=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.stub_app_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add App builder information for a BSP that has to be stubbed.</p>
<p>When running on a target that has multiple BSPs but some of
then will not be used by the current <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>, stubs
might have to be added to those BSPs to make sure their CPUs
are not going wild. Use this function to specify which app
builder is going to be used, the path to the stub source and
build options. The App building mechanism will take it from
there.</p>
<p>An app builder might determine that a given BSP needs no stub;
in said case it can remove it from the dict
<a class="reference internal" href="#tcfl.tc.target_c.bsps_stub" title="tcfl.tc.target_c.bsps_stub"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bsps_stub()</span></code></a> with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">target</span><span class="o">.</span><span class="n">bsps_stub</span><span class="p">[</span><span class="n">BSPNAME</span><span class="p">]</span>
</pre></div>
</div>
<p>This is like the app information added by _target_app_add(),
but it is stored in the target_c instance, not to the testcase
class.</p>
<p>This is because the stubbing that has to be done is specific
to each target (as the BSPs to stub each target have might be
different depending on the target and BSP-model).</p>
<p>Note this information is only added if there is nothing
existing about said BSP. To override, you need to delete and
add:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">target</span><span class="o">.</span><span class="n">bsps_stub</span><span class="p">[</span><span class="n">BSPNAME</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">stub_app_add</span><span class="p">(</span><span class="n">BSPNAME</span><span class="p">,</span> <span class="n">etc</span> <span class="n">etc</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="tcfl.tc.target_c.create_from_cmdline_args">
<em class="property">static </em><code class="descname">create_from_cmdline_args</code><span class="sig-paren">(</span><em>args</em>, <em>target_name=None</em>, <em>iface=None</em>, <em>extensions_only=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.create_from_cmdline_args" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Create a <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> object from command line</dt>
<dd>arguments</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>args</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/argparse.html#argparse.Namespace" title="(in Python v2.7)"><em>argparse.Namespace</em></a>) – arguments from argparse</li>
<li><strong>target_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the target, by
default is taken from <em>args.target</em>.</li>
<li><strong>iface</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) target must support the given
interface, otherwise an exception is raised.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">instance of <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> representing
said target, if it is available.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.ttbd_iface_call">
<code class="descname">ttbd_iface_call</code><span class="sig-paren">(</span><em>interface</em>, <em>call</em>, <em>method='PUT'</em>, <em>component=None</em>, <em>stream=False</em>, <em>raw=False</em>, <em>files=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.ttbd_iface_call" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute a general interface call to TTBD, the TCF remoting server</p>
<p>This allows to call any interface on the server that provides
this target. It is used to implement higher level calls.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>interface</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – interface name (eg: “power”, “console”,
etc); normally any new style interface listed in the
target’s <em>interfaces</em> tag.</li>
<li><strong>call</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the call implemented by such
interface (eg: for power, “on”, “off”); these are described
on the interface’s implementation.</li>
<li><strong>method</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional, defaults to <em>PUT</em>); HTTP method
to use to call; one of <em>PUT</em>, <em>GET</em>, <em>DELETE</em>,
<em>POST</em>. The interface dictates the method.</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional, default <em>None</em>) for
interfaces that implement multiple components (a common
pattern), specify which component the call applies to.</li>
<li><strong>files</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – (optional) dictionary of keys pointing to
file names that have to be streamed to the server. Keys are
strings with names of the files, values opened file
descriptors (or iterables). FIXME: needs more clarification
on how this works.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Rest of the arguments are a dictionary keyed by string with
values that will be serialized to pass the remote call
as arguments, and thus are interface specific.</p>
<p>Anything that is an interable or dictionary will be
serialized as JSON. The rest are kept as body arguments so the
daemon can decode it properly.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.bsp_model_suffix">
<code class="descname">bsp_model_suffix</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.bsp_model_suffix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.bsp_suffix">
<code class="descname">bsp_suffix</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.bsp_suffix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.report_mk_prefix">
<code class="descname">report_mk_prefix</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.report_mk_prefix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc.target_group_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">target_group_c</code><span class="sig-paren">(</span><em>descr</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_group_c" title="Permalink to this definition">¶</a></dt>
<dd><p>A unique group of targets (each set to an specific <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP
model</span></a>) assigned to to a testcase for execution.</p>
<p>A testcase can query a <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> instance of the
remote target to manipualte it by declaring it as an argument to a
testcase method, querying the <a class="reference internal" href="#tcfl.tc.target_group_c.targets" title="tcfl.tc.target_group_c.targets"><code class="xref py py-attr docutils literal notranslate"><span class="pre">targets</span></code></a> dictionary or
calling <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mytarget&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">mytest</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mytarget</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mytarget</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mytarget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_group</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;mytarget&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mytarget</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mytarget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s2">&quot;mytarget&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mytarget</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="tcfl.tc.target_group_c.name">
<code class="descname">name</code><a class="headerlink" href="#tcfl.tc.target_group_c.name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_group_c.name_set">
<code class="descname">name_set</code><span class="sig-paren">(</span><em>tgid</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_group_c.name_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_group_c.len">
<code class="descname">len</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_group_c.len" title="Permalink to this definition">¶</a></dt>
<dd><p>Return number of targets in the group</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_group_c.target">
<code class="descname">target</code><span class="sig-paren">(</span><em>target_name</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_group_c.target" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the instance of <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> that represents a
remote target that met the specification requested</p>
<p><a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.target()</span></code></a> decorator with name <em>target_name</em></p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_group_c.target_add">
<code class="descname">target_add</code><span class="sig-paren">(</span><em>target_name</em>, <em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_group_c.target_add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_group_c.targets">
<code class="descname">targets</code><a class="headerlink" href="#tcfl.tc.target_group_c.targets" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> descriptor for a remote target
keyed by the name they were requested with the
<a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.target()</span></code></a> decorator.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc.result_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">result_c</code><span class="sig-paren">(</span><em>passed=0</em>, <em>errors=0</em>, <em>failed=0</em>, <em>blocked=0</em>, <em>skipped=0</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="tcfl.tc.result_c.total">
<code class="descname">total</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.total" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.result_c.summary">
<code class="descname">summary</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.summary" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.result_c.normalized">
<code class="descname">normalized</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.normalized" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.tc.result_c.from_retval">
<em class="property">static </em><code class="descname">from_retval</code><span class="sig-paren">(</span><em>retval</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.from_retval" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.result_c.report">
<code class="descname">report</code><span class="sig-paren">(</span><em>tc</em>, <em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.report" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.tc.result_c.report_from_exception">
<em class="property">static </em><code class="descname">report_from_exception</code><span class="sig-paren">(</span><em>_tc</em>, <em>e</em>, <em>attachments=None</em>, <em>force_result=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.report_from_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Given an exception, report using the testcase or target report
infrastructure on the exception, traces to it as well as any
attachments it came with and return a valid <a class="reference internal" href="#tcfl.tc.result_c" title="tcfl.tc.result_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">result_c</span></code></a>
code.</p>
<p>By default, this is the mapping:</p>
<ul class="simple">
<li><a class="reference internal" href="#tcfl.tc.reporter_c.report_pass" title="tcfl.tc.reporter_c.report_pass"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tc.report_pass</span></code></a> is used for
<a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">pass_e</span></code></a></li>
<li><a class="reference internal" href="#tcfl.tc.reporter_c.report_error" title="tcfl.tc.reporter_c.report_error"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tc.report_pass</span></code></a> is used for
<a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">error_e</span></code></a></li>
<li><a class="reference internal" href="#tcfl.tc.reporter_c.report_fail" title="tcfl.tc.reporter_c.report_fail"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tc.report_pass</span></code></a> is used for
<a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">failed_e</span></code></a></li>
<li><a class="reference internal" href="#tcfl.tc.reporter_c.report_blck" title="tcfl.tc.reporter_c.report_blck"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tc.report_pass</span></code></a> is used for
<a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">blocked_e</span></code></a> and any other exception</li>
<li><a class="reference internal" href="#tcfl.tc.reporter_c.report_skip" title="tcfl.tc.reporter_c.report_skip"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tc.report_pass</span></code></a> is used for
<a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">skip_e</span></code></a></li>
</ul>
<p>However, it can be forced by passing as <em>force_result</em> or each
testcase can be told to consider specific exceptions as others
per reporting using the <a class="reference internal" href="#tcfl.tc.tc_c.exception_to_result" title="tcfl.tc.tc_c.exception_to_result"><code class="xref py py-attr docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.exception_to_result</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>force_result</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – force the exception to be
interpreted as <a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.pass_e</span></code></a>, <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">error_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">failed_e</span></code></a>, <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.blocked_e</span></code></a>, or <a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">skip_e</span></code></a>; note
there is also translation that can be done from
<a class="reference internal" href="#tcfl.tc.tc_c.exception_to_result" title="tcfl.tc.tc_c.exception_to_result"><code class="xref py py-attr docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.exception_to_result</span></code></a>.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="tcfl.tc.result_c.from_exception_cpe">
<em class="property">static </em><code class="descname">from_exception_cpe</code><span class="sig-paren">(</span><em>tc</em>, <em>e</em>, <em>result_e=&lt;class 'tcfl.tc.error_e'&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.from_exception_cpe" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.tc.result_c.from_exception">
<em class="property">static </em><code class="descname">from_exception</code><span class="sig-paren">(</span><em>fn</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.from_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Call a phase function to translate exceptions into
<a class="reference internal" href="#tcfl.tc.result_c" title="tcfl.tc.result_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.result_c</span></code></a> return codes.</p>
<p>Passes through the return code, unless it is None, in which
case we just return result_c(1, 0, 0, 0, 0)</p>
<p>Note this function prints some more extra detail in case of
fail/block/skip.
it.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc.tc_logadapter_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">tc_logadapter_c</code><span class="sig-paren">(</span><em>logger</em>, <em>extra</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_logadapter_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Logging adapter to prefix test case’s current <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>,
bsp and target name.</p>
<p>Initialize the adapter with a logger and a dict-like object which
provides contextual information. This constructor signature allows
easy stacking of LoggerAdapters, if so desired.</p>
<p>You can effectively pass keyword arguments as shown in the
following example:</p>
<p>adapter = LoggerAdapter(someLogger, dict(p1=v1, p2=”v2”))</p>
<dl class="attribute">
<dt id="tcfl.tc.tc_logadapter_c.id">
<code class="descname">id</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_logadapter_c.id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_logadapter_c.prefix">
<code class="descname">prefix</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_logadapter_c.prefix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_logadapter_c.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>msg</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_logadapter_c.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the logging message and keyword arguments passed in to
a logging call to insert contextual information. You can either
manipulate the message itself, the keyword args or both. Return
the message and kwargs modified (or not) to suit your needs.</p>
<p>Normally, you’ll only need to override this one method in a
LoggerAdapter subclass for your specific needs.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.tc.tags">
<code class="descclassname">tcfl.tc.</code><code class="descname">tags</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tags" title="Permalink to this definition">¶</a></dt>
<dd><p>Add tags to a testcase</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>args</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – every <cite>arg</cite> is converted into a boolean tag
(present, thus True)</li>
<li><strong>kwargs</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – every argument <cite>name = value</cite> is added as tag
<cite>name</cite> with value <cite>value</cite>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.tc.serially">
<code class="descclassname">tcfl.tc.</code><code class="descname">serially</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.serially" title="Permalink to this definition">¶</a></dt>
<dd><p>Force a testcase method to run serially (vs <a class="reference internal" href="#tcfl.tc.concurrently" title="tcfl.tc.concurrently"><code class="xref py py-func docutils literal notranslate"><span class="pre">concurrently()</span></code></a>).</p>
<p>Remember methods that are ran serially are run first and by
default are those that</p>
<ul class="simple">
<li>take more than one target as arguments</li>
<li>are evaluation methods</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="tcfl.tc.concurrently">
<code class="descclassname">tcfl.tc.</code><code class="descname">concurrently</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.concurrently" title="Permalink to this definition">¶</a></dt>
<dd><p>Force a testcase method to run concurrently after all the serial
methods (vs decorator <a class="reference internal" href="#tcfl.tc.serially" title="tcfl.tc.serially"><code class="xref py py-func docutils literal notranslate"><span class="pre">serially()</span></code></a>).</p>
<p>Remember methods that are ran concurrently are run after the
serial methods and by default those that:</p>
<ul class="simple">
<li>are not evaluation methods</li>
<li>take only one target as argument (if you force two methods that
share a target to run in parallel, it is your responsiblity to
ensure proper synchronization</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="tcfl.tc.target_want_add">
<code class="descclassname">tcfl.tc.</code><code class="descname">target_want_add</code><span class="sig-paren">(</span><em>_tc</em>, <em>target_want_name</em>, <em>spec</em>, <em>origin</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_want_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a requirement for a target to a testcase instance</p>
<p>Given a testcase instance, add a requirement for it to need a
target, filtered with the given specification (<em>spec</em>, which
defaults to any), a name and optional arguments in the form of
keywords.</p>
<p>This is equivalent to the <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.target()</span></code></a> decorator, which
adds the requirement to the class, not to the instance. Please
refer to it for the arguments.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tc.target">
<code class="descclassname">tcfl.tc.</code><code class="descname">target</code><span class="sig-paren">(</span><em>spec=None</em>, <em>name=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a requirement for a target to a testcase instance</p>
<p>For each target this testcase will need, a <a class="reference internal" href="02-guides.html#target-specification"><span class="std std-ref">filtering
specification</span></a> can be given (<em>spec</em>), a
name (or it will default to <em>targetN</em> except for the first one,
which is just <em>target</em>) and optional arguments in the form of
keywords.</p>
<p>Of those optional arguments, the most important are the app_*
arguments. An app_* argument is supplying a source path for an
application that has to be (maybe) configured, built and deployed
to the target. The decorator will add phase methods to the
testcase to configure, build and deploy the application. Now,
depending on the application drivers installed, the application
can be built or not. FIXME make this explanation better.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>spec</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="02-guides.html#target-specification"><span class="std std-ref">specification</span></a> to
filter against the tags the remote target exposes.</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name for the target (must not exist already). If
none, first declared target is called <em>target</em>, the next
<em>target1</em>, then <em>target2</em> and so on.</li>
<li><strong>kwargs</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>extra keyword arguments are allowed, which
might be used in different ways that are still TBD. Main ones
recognized:</p>
<blockquote>
<div><ul>
<li><em>app_NAME = dict(BSP1: PATH1, BSP1: PATH2)</em>: specify a list
of paths to apps that shall be built and deployed to the
given BSPs by App builder <em>app_NAME</em>; App builders exist for
Zephyr, Arduino Sketch and other setups, so you don’t
manually have to build your apps. You can create your own
too.<p>When a board is being run in a multiple BSP mode, each BSP
has to be added to an App builder if using the App builder
support, otherwise is an error condition.</p>
</li>
<li><em>app_NAME = PATH</em>: the same, but one for when one BSP is
used; it applies to <cite>any</cite> BSP in a single <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>
target.<p>FIXME: add link to app builders</p>
</li>
<li><dl class="first docutils">
<dt><em>app_NAME_options = STRING</em>: Extra options to pass to the APP</dt>
<dd>builder FIXME: support also BSP_options?</dd>
</dl>
</li>
</ul>
<ul id="tcf-target-modes">
<li><dl class="first docutils">
<dt><em>mode</em>: how to consider this target at the time of generating</dt>
<dd>multiple permutations of targets to run a testcase:<ul class="last">
<li><em>any</em>: run the testcase on any target that can
be found to match the specification</li>
<li><em>one-per-type</em>: run the testcase on one target of each
type that meets the specification (so if five targets
match the specification but they are all of the same type,
only one will run it; however, if there are two different
types in the set of five, one of each type will run it)</li>
<li><em>all</em>: run on every single target that matches the
specification</li>
</ul>
</dd>
</dl>
<p>Specially on testcases that require multiple targets, there
can be a huge number of permutations on how to run the
testcase to ensure maximum coverage of different combinations
of targets; some experimentation is needed to decide how to
tell TCF to run the testcase and balance how many resources
are used.</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.tc.interconnect">
<code class="descclassname">tcfl.tc.</code><code class="descname">interconnect</code><span class="sig-paren">(</span><em>spec=None</em>, <em>name=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.interconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a requirement for an interconnect to a testcase instance</p>
<p>An interconect is a target that binds two or more targets
together, maybe provides interconnectivity services (networking or
any other); we declare it’s need just like any other
target–however, we add the name to an special list so it is
easier to handle later.</p>
<p>The arguments are the same as to <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.target()</span></code></a>.</p>
</dd></dl>

<dl class="class">
<dt id="tcfl.tc.expectation_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">expectation_c</code><span class="sig-paren">(</span><em>target</em>, <em>poll_period</em>, <em>timeout=0</em>, <em>raise_on_timeout=&lt;class 'tcfl.tc.error_e'&gt;</em>, <em>raise_on_found=None</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.expectation_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Expectations are something we expect to find in the data polled
from a source.</p>
<p>An object implementing this interface can be given to
<a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a> as something to expect, which can be,
for example:</p>
<ul class="simple">
<li>text in a serial console output</li>
<li>templates in an image capture</li>
<li>audio in an audio capture</li>
<li>network data in a network data capture</li>
<li>…</li>
</ul>
<p>when what is being expected is found, <a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a>
can return data about it (implementation specific) can be
returned to the caller or exceptions can be raised (eg: if we see
an error), or if not found, timeout exceptions can be raised.</p>
<p>See <a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a> for more details and FIXME for
implementation examples.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>the <a class="reference internal" href="#tcfl.tc.expectation_c.poll" title="tcfl.tc.expectation_c.poll"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll()</span></code></a> and <a class="reference internal" href="#tcfl.tc.expectation_c.detect" title="tcfl.tc.expectation_c.detect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">detect()</span></code></a> methods will be
called in a loop until all the expectations have been
detected.</p>
<p class="last">It is recommended that internal state is only saved in
the <em>buffers</em> and <em>buffers_poll</em> storage areas provided
(vs storing inside the object).</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – target on which this expectation
is operating.</li>
<li><strong>poll_period</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – how often this data needs to be polled
in seconds (default <em>1s</em>).</li>
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – maximum time to wait for this expectation;
raises an exception of type <em>raise_on_timeout</em> if the timeout is
exceeded. If zero (default), no timeout is raised, which
effectively treats an expectation as optional or along with
<em>raise_on_found</em> above, to raise an exception if an expectation
is to be associated with an error condition.</li>
<li><strong>raise_on_timeout</strong> (<a class="reference internal" href="#tcfl.tc.exception" title="tcfl.tc.exception"><em>tcfl.tc.exception</em></a>) – (optional) a <em>type</em>
(<strong>not an instance</strong>) to throw when not found before the
timeout; a subclass of <a class="reference internal" href="#tcfl.tc.exception" title="tcfl.tc.exception"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.exception</span></code></a>.</li>
<li><strong>raise_on_found</strong> (<a class="reference internal" href="#tcfl.tc.exception" title="tcfl.tc.exception"><em>tcfl.tc.exception</em></a>) – <p>an <em>instance</em> (<strong>not a
type</strong>) to throw when found; this is useful to implement errors,
such as <em>if I see this image in the screen, bail out</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;wait for boot&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">crash</span> <span class="o">=</span> <span class="n">image_on_screenshot</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="n">target</span><span class="p">,</span> <span class="s1">&#39;screen&#39;</span><span class="p">,</span> <span class="s1">&#39;icon-crash.png&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="n">raise_on_found</span> <span class="o">=</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">error_e</span><span class="p">(</span><span class="s2">&quot;Crash found&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="n">timeout</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">login_prompt</span> <span class="o">=</span> <span class="n">image_on_screenshot</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="n">target</span><span class="p">,</span> <span class="s1">&#39;screen&#39;</span><span class="p">,</span> <span class="s1">&#39;canary-login-prompt.png&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="n">timeout</span> <span class="o">=</span> <span class="mi">4</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>Note you need to tell it also <em>zero</em> timeout, otherwise it will
complain if it didn’t find it.</p>
<p>The exception’s attachments will be updated with the dictionary
of data returned by the expectation’s <a class="reference internal" href="#tcfl.tc.expectation_c.detect" title="tcfl.tc.expectation_c.detect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">detect()</span></code></a>.</p>
</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) when reporting information about
this expectation, what origin shall it list, eg:</p>
<ul>
<li><em>None</em> (default) to get the current caller</li>
<li><em>commonl.origin_get(2)</em> also to get the current caller</li>
<li><em>commonl.origin_get(1)</em> also to get the current function</li>
</ul>
<p>or something as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;somefilename:43&quot;</span>
</pre></div>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="tcfl.tc.expectation_c.poll_context">
<code class="descname">poll_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.expectation_c.poll_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a string that uniquely identifies the polling source for
this expectation so multiple expectations that are polling
from the same place don’t poll repeatedly.</p>
<p>For example, if we are looking for multiple image templates in
a screenshot, it does not make sense to take one screenshot
per image. It can take one screenshot and look for the images
in the same place.</p>
<p>Thus:</p>
<ul>
<li><p class="first">if we are polling from target with role <em>target.want_name</em>
from it’s screen capturer called <em>VGA</em>, our context becomes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">want_name</span><span class="p">,</span> <span class="s2">&quot;VGA&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>so it follows that for a generic expectation from a
screenshot capturer stored in <em>self.capturer</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">want_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">capturer</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">for a serial console, it would become:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">want_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">console_name</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.expectation_c.poll">
<code class="descname">poll</code><span class="sig-paren">(</span><em>testcase</em>, <em>run_name</em>, <em>buffers_poll</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.expectation_c.poll" title="Permalink to this definition">¶</a></dt>
<dd><p>Poll a given expectation for new data from their data source</p>
<p>The expect engine will call this from
<a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a> periodically to get data where to
detect what we are expecting. This data could be serial
console output, video output, screenshots, network data,
anything.</p>
<p>The implementation of this interface will store the data
(append, replace, depending on the nature of it) in
<em>buffers_poll</em>.</p>
<p>For example, a serial console reader might read from the
serial console and append to a file; a screenshot capturer
might capture the screenshot and put it in a file and make the
file name available in <em>buffers_poll[‘filename’]</em>.</p>
<p>Note that when we are working with multiple expectations, if a
number of them share the same data source (as determined by
<a class="reference internal" href="#tcfl.tc.expectation_c.poll_context" title="tcfl.tc.expectation_c.poll_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll_context()</span></code></a>), only one poll per each will be done and
they will be expected to share the polled data stored in
<em>buffers_poll</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>testcase</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – testcase for which we are
polling.</li>
<li><strong>run_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of this run of
<a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a>–they are always different.</li>
<li><strong>buffers_poll</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary where we can store state
for this poll so it can be shared between calls. Detection
methods that use the same poling source (as given by
<a class="reference internal" href="#tcfl.tc.expectation_c.poll_context" title="tcfl.tc.expectation_c.poll_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll_context()</span></code></a>) will all be given the same storage
space.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.expectation_c.detect">
<code class="descname">detect</code><span class="sig-paren">(</span><em>testcase</em>, <em>run_name</em>, <em>buffers_poll</em>, <em>buffers</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.expectation_c.detect" title="Permalink to this definition">¶</a></dt>
<dd><p>Look for what is being expected in the polled data</p>
<p>After the <a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a> has polled data (with
<a class="reference internal" href="#tcfl.tc.expectation_c.poll" title="tcfl.tc.expectation_c.poll"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll()</span></code></a> above) and stored it in <em>buffers_poll</em>, this
function is called to detect what we are expecting in that
data.</p>
<p>Note the form of the data is completely specific to this
expectation object. It can be data saved into the
<em>buffers_poll</em> dictionary or that can be referring to a file
in the filesystem. See FIXME examples.</p>
<p>For example, a serial console detector might take the data
polled by <a class="reference internal" href="#tcfl.tc.expectation_c.poll" title="tcfl.tc.expectation_c.poll"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll()</span></code></a>, load it and look for a string in there.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>testcase</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – testcase for which we are
detecting.</li>
<li><strong>run_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of this run of
<a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a>–they are always different.</li>
<li><strong>buffers_poll</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary where the polled data has
is available. Note Detection methods that use the same
poling source (as given by <a class="reference internal" href="#tcfl.tc.expectation_c.poll_context" title="tcfl.tc.expectation_c.poll_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll_context()</span></code></a>) will all be
given the same storage space. as per <a class="reference internal" href="#tcfl.tc.expectation_c.poll" title="tcfl.tc.expectation_c.poll"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll()</span></code></a> above.</li>
<li><strong>buffers</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary available exclusively to this
expectation object to keep data from run to run.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>information about the detection; if <em>None</em>, this
means the detection process didn’t find what is being looked
for and the detection process will continue.</p>
<p>If not <em>None</em> is returned, whatever it is, it is considered
what was expected has been found.</p>
<p><a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a> will save this in a dictionary
of results specific to each expectation object that
will be returned to the user as the return value of
<a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a>.</p>
<p>As well, if a <em>raise_on_found</em> exception was given, these
fields are added to the attachments.</p>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.expectation_c.flush">
<code class="descname">flush</code><span class="sig-paren">(</span><em>testcase</em>, <em>run_name</em>, <em>buffers_poll</em>, <em>buffers</em>, <em>results</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.expectation_c.flush" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate collateral for this expectation</p>
<p>This is called by <a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a> when all the
expectations are completed and can be used to for example, add
marks to an image indicating where a template or icon was
detected.</p>
<p>Note different expectations might be creating collateral from
the same source, on which case you need to pile on (eg: adding
multiple detectio marks to the same image)</p>
<p>Collateral files shall be generated with name
<a class="reference internal" href="#tcfl.tc.tc_c.report_file_prefix" title="tcfl.tc.tc_c.report_file_prefix"><code class="xref py py-data docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.report_file_prefix</span></code></a> such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">collateral_filename</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">report_file_prefix</span> <span class="o">+</span> <span class="s2">&quot;something&quot;</span>
</pre></div>
</div>
<p>will generate filename <cite>report-RUNID:HASHID.something</cite>; thus,
when multiple testcases are executed in parallel, they will
not override each other’s collateral.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>testcase</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – testcase for which we are
detecting.</li>
<li><strong>run_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of this run of
<a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a>–they are always different.</li>
<li><strong>buffers_poll</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary where the polled data has
is available. Note Detection methods that use the same
poling source (as given by <a class="reference internal" href="#tcfl.tc.expectation_c.poll_context" title="tcfl.tc.expectation_c.poll_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll_context()</span></code></a>) will all be
given the same storage space. as per <a class="reference internal" href="#tcfl.tc.expectation_c.poll" title="tcfl.tc.expectation_c.poll"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll()</span></code></a> above.</li>
<li><strong>buffers</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary available exclusively to this
expectation object to keep data from run to run. This was
used by <a class="reference internal" href="#tcfl.tc.expectation_c.detect" title="tcfl.tc.expectation_c.detect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">detect()</span></code></a> to store data needed during the
detection process.</li>
<li><strong>results</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of results generated by
<a class="reference internal" href="#tcfl.tc.expectation_c.detect" title="tcfl.tc.expectation_c.detect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">detect()</span></code></a> as a result of the detection process.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.expectation_c.on_timeout">
<code class="descname">on_timeout</code><span class="sig-paren">(</span><em>run_name</em>, <em>poll_context</em>, <em>ellapsed</em>, <em>timeout</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.expectation_c.on_timeout" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an action when the expectation times out being found</p>
<p>Called by the innards of the expec engine when the expectation
times out; by default, raises a generic exception (as
specified during the expectation’s creation); can be overriden
to offer a more specific message, etc.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc.tc_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">tc_c</code><span class="sig-paren">(</span><em>name</em>, <em>tc_file_path</em>, <em>origin</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c" title="Permalink to this definition">¶</a></dt>
<dd><p>A testcase, with instructions for configuring, building, deploying,
setting up, running, evaluating, tearing down and cleaning up.</p>
<p>Derive this class to create a testcase, implementing the different
testcase methods to build, deploy and evaluate if it is considered
a pass or a failure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">sometest</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_device_present</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>         <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/dev/expected_device&quot;</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>             <span class="k">raise</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">error_e</span><span class="p">(</span><span class="s2">&quot;Device not connected&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_mode_correct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>         <span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s2">&quot;/dev/expected_device&quot;</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>         <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mh">0x644</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>             <span class="k">raise</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">failed_e</span><span class="p">(</span><span class="s2">&quot;wrong mode&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the class will be ignored as a testcase if its name
starts with <em>_base_</em>; this is useful to create common
code which will be instantiated in another class without
it being confused with a testcase.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – the name of the testcase</li>
<li><strong>tc_file_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – the path to the file where the testcase
was found</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – the origin of the testcase (in most cases this
is a string <em>FILENAME:LINE</em>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note that in the most cases, the three arguments will be the same,
as the name of the testcase will be the same as the path where the
test case is found and if there is only one testcase per file, the
origin is either line 1 or no line.</p>
<p>When a file contains specifies multiple testcases, then they can
be created such as:</p>
<blockquote>
<div><ul class="simple">
<li>name TCFILEPATH#TCCASENAME</li>
<li>tc_file_path TCFILEPATH</li>
<li>origin TCFILEPATH:LINENUMBER (matching the line number where
the subcase is specified)</li>
</ul>
</div></blockquote>
<p>this allows a well defined namespace in which cases from multiple
files that are run at the same time don’t conflict in name.</p>
<p>The runner will call the testcase methods to evaluate the test;
any failure/blockage causes the evaluation to stop and move on to
the next testcase:</p>
<ul>
<li><p class="first"><em>configure*()</em> for getting source code, configuring a buid,
etc ..</p>
</li>
<li><p class="first"><em>build*()</em> for building anything that is needed to run the
testcase</p>
</li>
<li><p class="first"><em>deploy*()</em> for deploying the build products or artifacts
needed to run the testcase to the diffrent targets</p>
</li>
<li><p class="first">For evaluating:</p>
<ul class="simple">
<li><em>setup*()</em> to setup the system/fixture for an evaluation run</li>
<li><em>start*()</em> to start/power-on the targets or anything needed
for the test case evaluation</li>
<li><em>eval*()</em> to actually do evaluation actions</li>
<li><em>teardown*()</em> for powering off</li>
</ul>
<p>As well, any <em>test*()</em> methods will be run similarly, but for
each, the sequence called will be setup/start/test/teardown (in
contrast to <em>eval</em> methods, where they are run in sequence
without calling setup/start/teardown in between).</p>
</li>
<li><p class="first"><em>clean*()</em> for cleaning up (ran only if <em>-L</em> is passed on the
command line)</p>
</li>
<li><dl class="first docutils">
<dt><em>class_teardown</em> is mostly used for self-testing and debugging,</dt>
<dd><p class="first last">but are functions called whenever every single testcase of the
same class has completed executing.</p>
</dd>
</dl>
</li>
</ul>
<p>Methods can take no arguments or the names of one or more targets
they will operate with/on. These targets are declared using the
<a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.target()</span></code></a> (for a normal target) and
<a class="reference internal" href="#tcfl.tc.interconnect" title="tcfl.tc.interconnect"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.interconnect()</span></code></a> (for a target that
interconnects/groups the rest of the targets together).</p>
<p>The methods that take no targets will be called sequentially in
<strong>alphabetical order</strong> (not in declaration order!). The methods
that take different targets will be called in parallel (to
maximize multiple cores, unless decorated with
<a class="reference internal" href="#tcfl.tc.serially" title="tcfl.tc.serially"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.serially()</span></code></a>). Evaluation functions are always called
sequentially, except if decorated with :func:</p>
<p>The testcase methods use the APIs exported by this class and module:</p>
<blockquote>
<div><ul>
<li><p class="first">to report information at the appropiate log level:
<a class="reference internal" href="#tcfl.tc.reporter_c.report_pass" title="tcfl.tc.reporter_c.report_pass"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reporter_c.report_pass()</span></code></a>, <a class="reference internal" href="#tcfl.tc.reporter_c.report_fail" title="tcfl.tc.reporter_c.report_fail"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reporter_c.report_fail()</span></code></a>,
<a class="reference internal" href="#tcfl.tc.reporter_c.report_blck" title="tcfl.tc.reporter_c.report_blck"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reporter_c.report_blck()</span></code></a> and <a class="reference internal" href="#tcfl.tc.reporter_c.report_info" title="tcfl.tc.reporter_c.report_info"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reporter_c.report_info()</span></code></a></p>
</li>
<li><p class="first">raise an exception to indicate result of this method:</p>
<ul class="simple">
<li><em>pass</em>, raise <a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.pass_e</span></code></a> (or simply return)</li>
<li><em>failed</em>, raise <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.failed_e</span></code></a>,</li>
<li><em>error</em>, raise <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a>,</li>
<li><em>blocked</em>, raise <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.blocked_e</span></code></a>; any other
uncaught Python exception is also converted to this.</li>
<li><em>skipped</em>, raise <a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.skip_e</span></code></a></li>
</ul>
</li>
<li><p class="first">run commands in the local machine with <a class="reference internal" href="#tcfl.tc.tc_c.shcmd_local" title="tcfl.tc.tc_c.shcmd_local"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shcmd_local()</span></code></a>; the
command can be formatted with <em>%(KEYWORD)[sd]</em> that will be
substituted with values found in <code class="xref py py-attr docutils literal notranslate"><span class="pre">kws</span></code>.</p>
</li>
<li><p class="first">Interact with the remote targets through instances of
<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">target_c</span></code></a> that represent them:</p>
<ul>
<li><p class="first">via arguments to the method</p>
</li>
<li><p class="first">via <a class="reference internal" href="#tcfl.tc.tc_c.targets" title="tcfl.tc.tc_c.targets"><code class="xref py py-attr docutils literal notranslate"><span class="pre">targets</span></code></a>, a dictionary keyed by the names of the
targets requested with the <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal notranslate"><span class="pre">target()</span></code></a> and
<a class="reference internal" href="#tcfl.tc.interconnect" title="tcfl.tc.interconnect"><code class="xref py py-func docutils literal notranslate"><span class="pre">interconnect()</span></code></a> decorators; for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">interconnect</span><span class="p">()</span>    <span class="c1"># named &quot;ic&quot; by default</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>          <span class="c1"># named &quot;target1&quot; by default</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>          <span class="c1"># named &quot;target&quot; by default</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">mytest</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">target1</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ic</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target1</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_group</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target2</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;Ready&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mytarget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s2">&quot;ic&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ic</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;targets are online&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">for</span> <span class="n">_n</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
<span class="gp">&gt;&gt;&gt; </span>           <span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
</li>
</ul>
<p><a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">target_c</span></code></a> expose APIs to act on the targets, such as
power control, serial console access, image deployment</p>
</li>
</ul>
</div></blockquote>
<dl class="attribute">
<dt id="tcfl.tc.tc_c.origin">
<code class="descname">origin</code><em class="property"> = '/home/inaky/t/master-tcf.git/tcfl/tc.py:7191'</em><a class="headerlink" href="#tcfl.tc.tc_c.origin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.build_only">
<code class="descname">build_only</code><em class="property"> = []</em><a class="headerlink" href="#tcfl.tc.tc_c.build_only" title="Permalink to this definition">¶</a></dt>
<dd><p>List of places where we declared this testcase is build only</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.targets">
<code class="descname">targets</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.targets" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">Target</span> <span class="pre">objects</span></code></a>) in which this
testcase is running (keyed by target want name, as given to
decorators <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.target()</span></code></a> and
func:<cite>tcfl.tc.interconnect</cite>.
Note this maps to <code class="docutils literal notranslate"><span class="pre">self._target_groups_c.targets()</span></code> for
convenience.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.result_eval">
<code class="descname">result_eval</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.result_eval" title="Permalink to this definition">¶</a></dt>
<dd><p>Result of the last evaluation run</p>
<p>When an evaluation is run (setup/start/eval/teardown), this
variable reflexts the evaluation status; it is meant to be
used during the <em>teardown</em> phase, so for example, in case
of failure, the teardown phase might decide to gather
information about the current target’s state.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.result">
<code class="descname">result</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.result" title="Permalink to this definition">¶</a></dt>
<dd><p>Result of the last run of all phases in this testcase</p>
<p>we might need to look at this in other testcases executed
inmediately after (as added with <a class="reference internal" href="#tcfl.tc.tc_c.post_tc_append" title="tcfl.tc.tc_c.post_tc_append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">post_tc_append()</span></code></a>).</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.ts_start">
<code class="descname">ts_start</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.ts_start" title="Permalink to this definition">¶</a></dt>
<dd><p>time when this testcase was created (and thus all
references to it’s inception are done); note in
__init_shallow__() we update this for when we assign it to
a target group to run.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.report_file_prefix">
<code class="descname">report_file_prefix</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.report_file_prefix" title="Permalink to this definition">¶</a></dt>
<dd><p>Report file prefix</p>
<p>When needing to create report file collateral of any kind,
prefix it with this so it always shows in the same location
for all the collateral related to this testcase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span>   <span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">file_copy_from</span><span class="p">(</span><span class="s2">&quot;remotefile&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                               <span class="bp">self</span><span class="o">.</span><span class="n">report_file_prefix</span> <span class="o">+</span> <span class="s2">&quot;remotefile&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>will produce <em>LOGDIR/report-RUNID:HASHID.remotefile</em> if
<em>–log-dir LOGDIR -i RUNID</em> was provided as command line.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span>   <span class="n">target</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;screen&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                      <span class="bp">self</span><span class="o">.</span><span class="n">report_file_prefix</span> <span class="o">+</span> <span class="s2">&quot;screenshot.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>will produce <em>LOGDIR/report-RUNID:HASHID.screenshot.png</em></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.subcases">
<code class="descname">subcases</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.subcases" title="Permalink to this definition">¶</a></dt>
<dd><p>list of subcases this test is asked to execute by the test
case runner (see <a class="reference internal" href="#tcfl.tc.tc_c.subtc" title="tcfl.tc.tc_c.subtc"><code class="xref py py-data docutils literal notranslate"><span class="pre">subtc</span></code></a>)</p>
<p>Subcases follow the format
<em>NAME/SUBNAME/SUBSUBNAME/SUBSUBSUBNAME…</em></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.subtc">
<code class="descname">subtc</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.subtc" title="Permalink to this definition">¶</a></dt>
<dd><p>list of subcases this testcase contains</p>
<p>Note this is different to <a class="reference internal" href="#tcfl.tc.tc_c.subcases" title="tcfl.tc.tc_c.subcases"><code class="xref py py-data docutils literal notranslate"><span class="pre">subcases</span></code></a> in that this is
the final list the testcase has collected after doing
discovery in the machine and (possibly) examining the
execution logs.</p>
<p>It is ordered by addition time, so things sub-execute in
addition order.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.parent">
<code class="descname">parent</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.parent" title="Permalink to this definition">¶</a></dt>
<dd><p>parent of this testcase (normally used for subcases)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.do_acquire">
<code class="descname">do_acquire</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.do_acquire" title="Permalink to this definition">¶</a></dt>
<dd><p>do we have to actually acquire any targets?</p>
<p>in general (default), the testcases need to acquire the
targets where they are going to be executed, but in some
cases, they do not.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.is_static">
<code class="descname">is_static</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.is_static" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <em>True</em> if the testcase is <em>static</em> (needs to targets to
execute), <em>False</em> otherwise.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.hashid_len">
<code class="descname">hashid_len</code><em class="property"> = 6</em><a class="headerlink" href="#tcfl.tc.tc_c.hashid_len" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of characters in the testcase’s <a class="reference internal" href="glossary.html#term-hash"><span class="xref std std-term">hash</span></a></p>
<p>The testcase’s <em>HASHID</em> is a unique identifier to identify a
testcase the group of test targets where it ran.</p>
<p>This defines the lenght of such hash; before it used 4 to be
four but once over 40k testcases are being run, conflicts start
to pop up, where more than one testcase/target combo maps to
the same hash.</p>
<blockquote>
<div><p>32 ^ 4 = 1048576 unique combinations</p>
<p>32 ^ 6 = 1073741824 unique combinations</p>
</div></blockquote>
<p>6 chars offers a keyspace 1024 times larger with base32 than
4 chars. Base64 increases the amount, but not that much
compared to the ease of confusion between caps and non caps.</p>
<p>So it has been raised to 6.</p>
<p>FIXME: add a registry to warn of used ids</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.relpath_to_abs">
<code class="descname">relpath_to_abs</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.relpath_to_abs" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a path relative to the test script’s source, make it absolute.</p>
<dl class="docutils">
<dt>&#64;returns string with the absolutized path if relative, the</dt>
<dd>same if already absolute</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.shcmd_local">
<code class="descname">shcmd_local</code><span class="sig-paren">(</span><em>cmd</em>, <em>origin=None</em>, <em>reporter=None</em>, <em>logfile=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.shcmd_local" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a shell command in the local machine, substituting
%(KEYWORD)[sd] with keywords defined by the testcase.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) when reporting information about
this expectation, what origin shall it list, eg:</p>
<ul class="simple">
<li><em>None</em> (default) to get the current caller</li>
<li><em>commonl.origin_get(2)</em> also to get the current caller</li>
<li><em>commonl.origin_get(1)</em> also to get the current function</li>
</ul>
<p>or something as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;somefilename:43&quot;</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.tc_c.file_ignore_add_regex">
<em class="property">classmethod </em><code class="descname">file_ignore_add_regex</code><span class="sig-paren">(</span><em>regex</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.file_ignore_add_regex" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a regex to match a file name to ignore when looking
for testcase files</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Regular expression to match against the
file name (not path)</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – [optional] string describing where this
regular expression comes from (eg: <a class="reference external" href="FILE:LINENO">FILE:LINENO</a>).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.tc_c.dir_ignore_add_regex">
<em class="property">classmethod </em><code class="descname">dir_ignore_add_regex</code><span class="sig-paren">(</span><em>regex</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.dir_ignore_add_regex" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a regex to match a directory name to ignore when looking
for testcase files</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Regular expression to match against the
directory name (not path)</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – [optional] string describing where this
regular expression comes from (eg: <a class="reference external" href="FILE:LINENO">FILE:LINENO</a>).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.tc_c.driver_add">
<em class="property">classmethod </em><code class="descname">driver_add</code><span class="sig-paren">(</span><em>_cls</em>, <em>origin=None</em>, <em>*args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.driver_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a driver to handle test cases (a subclass of :class:tc_c)</p>
<p>A testcase driver is a subclass of <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.tc_c</span></code></a> which
overrides the methods used to locate testcases and implements the
different testcase configure/build/evaluation functions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">my_tc_driver</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="o">.</span><span class="n">driver_add</span><span class="p">(</span><span class="n">my_tc_driver</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>_cls</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – testcase driver</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) origin of this call</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.hook_pre">
<code class="descname">hook_pre</code><em class="property"> = []</em><a class="headerlink" href="#tcfl.tc.tc_c.hook_pre" title="Permalink to this definition">¶</a></dt>
<dd><p>(list of callables) a list of functions to call before starting
execution of each test case instance (right before any phases
are run)</p>
<p>Usable to do final testcase touch up, adding keywords needed
for the site deployment. etc.</p>
<p>Note these will be called as methods in the order in the list,
so the first argument will be always be the the testcase
instance.</p>
<p>E.g.: in a TCF configuration file <cite>.tcf/conf_hook.py</cite> you can
set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">_my_hook_fn</span><span class="p">(</span><span class="n">tc</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># Classify testcases based on category:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># - red</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># - green</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># - blue</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># tc_name keyword has the path of the testcase, which</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># we are using for the sake of example to categorize;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># keywords can be dumped by running `tcf run</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># /usr/share/examples/test_dump_kws*py.</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">name</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;tc_name&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">categories</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span> <span class="p">]:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="c1"># if test&#39;s path has CATEGORY, add it</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">if</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">categories</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">categories</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">categories</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;uncategorized&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tc</span><span class="o">.</span><span class="n">kw_set</span><span class="p">(</span><span class="s1">&#39;categories&#39;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">categories</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;DEBUG categories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">categories</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="o">.</span><span class="n">hook_pre</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_my_hook_fn</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>this is a global variable for all testcases of all classes
and instances assigned to run in different targets</li>
<li>these functions will execute on different threads
and processes, so <strong>do not use shared data or global
variables</strong>.</li>
<li>only add to this list from configuration files, never from
testcases or testcase driver code.</li>
</ul>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.type_map">
<code class="descname">type_map</code><em class="property"> = {}</em><a class="headerlink" href="#tcfl.tc.tc_c.type_map" title="Permalink to this definition">¶</a></dt>
<dd><p>(dict) a dictionary to translate target type names, from
<em>TYPE[:BSP]</em> to another name to use when reporting as it is
useful/convenient to your application (eg: if what you are
testing prefers other type names); will be only translated if
present. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_c</span><span class="o">.</span><span class="n">type_map</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># translate to Zephyr names</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;arduino-101:x86&quot;</span> <span class="o">=</span> <span class="s2">&quot;arduino_101&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;arduino-101:arc&quot;</span> <span class="o">=</span> <span class="s2">&quot;arduino_101_ss&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.exception_to_result">
<code class="descname">exception_to_result</code><em class="property"> = {&lt;type 'exceptions.AssertionError'&gt;: &lt;class 'tcfl.tc.blocked_e'&gt;}</em><a class="headerlink" href="#tcfl.tc.tc_c.exception_to_result" title="Permalink to this definition">¶</a></dt>
<dd><p>Map exception types to results</p>
<p>this allows to automaticall map an exception raised
automatically and be converted to a type. Any testcase can
define their own version of this to decide how to convert
exceptions from the default of them being considered blockage
to skip, fail or pass</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">configure_exceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">exception_to_result</span><span class="p">[</span><span class="ne">OSError</span><span class="p">]</span> <span class="o">=</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">error_e</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.eval_repeat">
<code class="descname">eval_repeat</code><em class="property"> = 1</em><a class="headerlink" href="#tcfl.tc.tc_c.eval_repeat" title="Permalink to this definition">¶</a></dt>
<dd><p>How many times do we repeat the evaluation (for stress/MTBF)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.eval_count">
<code class="descname">eval_count</code><em class="property"> = 0</em><a class="headerlink" href="#tcfl.tc.tc_c.eval_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Which evaluation are we currently running (out of <a class="reference internal" href="#tcfl.tc.tc_c.eval_repeat" title="tcfl.tc.tc_c.eval_repeat"><code class="xref py py-data docutils literal notranslate"><span class="pre">eval_repeat</span></code></a>)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.testcase_patchers">
<code class="descname">testcase_patchers</code><em class="property"> = []</em><a class="headerlink" href="#tcfl.tc.tc_c.testcase_patchers" title="Permalink to this definition">¶</a></dt>
<dd><p>List of callables that will be executed when a testcase is
identified; these can modify as needed the testcase (eg:
scanning for tags)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.runid">
<code class="descname">runid</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.runid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.runid_visible">
<code class="descname">runid_visible</code><em class="property"> = ''</em><a class="headerlink" href="#tcfl.tc.tc_c.runid_visible" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.tmpdir">
<code class="descname">tmpdir</code><em class="property"> = '/tmp/tcf.run-CTpFVg'</em><a class="headerlink" href="#tcfl.tc.tc_c.tmpdir" title="Permalink to this definition">¶</a></dt>
<dd><p>temporary directory where testcases can drop things; this will
be specific to each testcase instance (testcase and target
group where it runs).</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.buffers">
<code class="descname">buffers</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.buffers" title="Permalink to this definition">¶</a></dt>
<dd><p>temporary directory where to store information (serial console,
whatever) that will be captured on each different evaluation;
on each invocation of the evaluation, a new buffer dir will be
allocated and code that captures things from the target will
store captures in there.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.jobs">
<code class="descname">jobs</code><em class="property"> = 1</em><a class="headerlink" href="#tcfl.tc.tc_c.jobs" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of testcases running on targets</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.rt_all">
<code class="descname">rt_all</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.rt_all" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.release">
<code class="descname">release</code><em class="property"> = True</em><a class="headerlink" href="#tcfl.tc.tc_c.release" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.report_mk_prefix">
<code class="descname">report_mk_prefix</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.report_mk_prefix" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the prefix we use for the logging/reports when some
parameter changes.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.target_group">
<code class="descname">target_group</code><a class="headerlink" href="#tcfl.tc.tc_c.target_group" title="Permalink to this definition">¶</a></dt>
<dd><p>Group of targets this testcase is being ran on</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.tag_set">
<code class="descname">tag_set</code><span class="sig-paren">(</span><em>tagname</em>, <em>value=None</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.tag_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a testcase tag.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tagname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the tag (string)</li>
<li><strong>value</strong> – (optional) value for the tag; can be a string,
bool; if none specified, it is set to True</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) origin of the tag; defaults to
the calling function</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note that there are a few tags that have speciall conventions:</p>
<ul>
<li><p class="first"><em>component/COMPONENTNAME</em> is a tag with value
<em>COMPONENTNAME</em> and it is used to classify the testcases by
component. Multiple tags like this might exist if the
testcase belongs to multiple components. Note it should be a
single word.</p>
<p>TCF will create a tag <em>components</em> with value <em>COMPONENTNAME1
COMPONENTNAME2 …</em> (space separated list of components)
which shall match the <em>component/COMPONENTx</em>
<em>name</em> contains the name of the testcase after testcase
instantiation.</p>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.tags_set">
<code class="descname">tags_set</code><span class="sig-paren">(</span><em>_tags</em>, <em>origin=None</em>, <em>overwrite=True</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.tags_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set multiple testcase tags.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tags</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of tags and values</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) origin of the tag; defaults to
the calling function</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Same notes as for <a class="reference internal" href="#tcfl.tc.tc_c.tag_set" title="tcfl.tc.tc_c.tag_set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tag_set()</span></code></a> apply</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.kw_set">
<code class="descname">kw_set</code><span class="sig-paren">(</span><em>key</em>, <em>value</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.kw_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a testcase’s keyword and value</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – keyword name</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – value</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) where this comes from</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.kw_unset">
<code class="descname">kw_unset</code><span class="sig-paren">(</span><em>kw</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.kw_unset" title="Permalink to this definition">¶</a></dt>
<dd><p>Unset a string keyword for later substitution in commands</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>kw</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – keyword name</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.kws_set">
<code class="descname">kws_set</code><span class="sig-paren">(</span><em>d</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.kws_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a bunch of testcase’s keywords and values</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>d</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – A dictionary of keywords and values</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.expect_global_append">
<code class="descname">expect_global_append</code><span class="sig-paren">(</span><em>exp</em>, <em>skip_duplicate=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.expect_global_append" title="Permalink to this definition">¶</a></dt>
<dd><p>Append an expectation to the testcase global expectation list</p>
<p>Refer to <a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">expect()</span></code></a> for more information</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.expect_global_remove">
<code class="descname">expect_global_remove</code><span class="sig-paren">(</span><em>exp</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.expect_global_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove an expectation from the testcase global expectation list</p>
<p>Refer to <a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">expect()</span></code></a> for more information</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.expect_tls_append">
<code class="descname">expect_tls_append</code><span class="sig-paren">(</span><em>exp</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.expect_tls_append" title="Permalink to this definition">¶</a></dt>
<dd><p>Append an expectation to the thread-specific expectation list</p>
<p>Refer to <a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">expect()</span></code></a> for more information</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.expect_tls_remove">
<code class="descname">expect_tls_remove</code><span class="sig-paren">(</span><em>exp</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.expect_tls_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove an expectation from the testcase global expectation list</p>
<p>Refer to <a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">expect()</span></code></a> for more information</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.expect">
<code class="descname">expect</code><span class="sig-paren">(</span><em>*exps_args</em>, <em>**exps_kws</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.expect" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for a list of things we expect to happen</p>
<p>This is a generalization of the pattern <em>expect this string in
a serial console</em> where we can wait, in the same loop for many
things (expectations) from multiple sources such as serial
console, screen shots, network captures, audio captures, etc…</p>
<p>Each expectation is an object that implements the
<a class="reference internal" href="#tcfl.tc.expectation_c" title="tcfl.tc.expectation_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">expectation_c</span></code></a> interface which indicates how to:</p>
<blockquote>
<div><ul class="simple">
<li>poll from a data source</li>
<li>detect what we are expecting in the polled data</li>
<li>generate collateral for said detected data</li>
</ul>
</div></blockquote>
<p>This function will enter into a loop, polling the different
expectation data sources according to the poll periods they
establish, then detecting data and reporting the results back
to the user and raising exceptions if so the user indicates want
(eg: raise an exception if timeout looking for a shell prompt,
or raise an exception if a <em>kernel panic</em> string is found).</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;waiting for desktop to boot&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">timeout</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">text_on_console</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;Kernel Panic&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;kernel panic watchdog&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                    <span class="n">raise_on_found</span> <span class="o">=</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">error_e</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="s2">&quot;Kernel Panic found!&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">image_on_screenshot</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s1">&#39;screen&#39;</span><span class="p">,</span> <span class="s1">&#39;icon-power.png&#39;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">config_button</span> <span class="o">=</span> <span class="n">image_on_screenshot</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s1">&#39;screen&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                        <span class="s1">&#39;icon-config.png&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>The first expectation will be called <em>kernel panic watchdog</em>
and will raise an exception if the console print a
(oversimplified for the sake of the example) kernel panic
message. If not found, nothing happens.</p>
<p>The second will default to be called whatever the
<code class="xref py py-class docutils literal notranslate"><span class="pre">image_on_screenshot</span></code> calls it (<em>icon-power.png</em>),
while the second will have it’s name overriden to
<em>config_button</em>. These last two will capture an screenshot
from the target’s screenshot capturer called <em>screen</em> and the
named icons need to be found for the call to be
succesful. Otherwise, error exceptions due to timeout will be
raised.</p>
<p>The list of expectations that will be always scanned is in
this order:</p>
<ul class="simple">
<li>testcase’s global list of expectations (add with
<a class="reference internal" href="#tcfl.tc.tc_c.expect_global_append" title="tcfl.tc.tc_c.expect_global_append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">expect_global_append()</span></code></a>)</li>
<li>testcase’s thread specific list of expectations (add with
<a class="reference internal" href="#tcfl.tc.tc_c.expect_tls_append" title="tcfl.tc.tc_c.expect_tls_append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">expect_tls_append()</span></code></a>)</li>
<li>list of expectations in the arguments</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>exps_args</strong> (<a class="reference internal" href="#tcfl.tc.expectation_c" title="tcfl.tc.expectation_c"><em>expectation_c</em></a>) – <p>expectation objects which are
expected to be self-named (their implementations will assign
names or a default will be given). eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="o">.</span><span class="n">text_on_console</span><span class="p">(</span><span class="n">args</span><span class="o">..</span><span class="n">etc</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="o">.</span><span class="n">image_on_screenshot</span><span class="p">(</span><span class="n">args</span><span class="o">..</span><span class="n">etc</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><strong>exps_kws</strong> (<a class="reference internal" href="#tcfl.tc.expectation_c" title="tcfl.tc.expectation_c"><em>expectation_c</em></a>) – <p>expectation objects named after
the keyword they are assigned to; note the keywords <em>name</em>
and <em>timeout</em> are reserved. eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">shell_prompt</span> <span class="o">=</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="o">.</span><span class="n">text_on_console</span><span class="p">(</span><span class="n">args</span><span class="o">..</span><span class="n">etc</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">firefox_icon</span> <span class="o">=</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="o">.</span><span class="n">image_on_screenshot</span><span class="p">(</span><span class="n">args</span><span class="o">..</span><span class="n">etc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – <p>Maximum time of seconds to wait for all
non-optional expectations to be met.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>a name for this execution, used for reporting
and generation of collateral; it defaults to a test-specific
monotonically increasing number shared amongst all the
threads running in this testcase. eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;shell prompt received&quot;</span>
</pre></div>
</div>
</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) when reporting information about
this expectation, what origin shall it list, eg:</p>
<ul>
<li><em>None</em> (default) to get the current caller</li>
<li><em>commonl.origin_get(2)</em> also to get the current caller</li>
<li><em>commonl.origin_get(1)</em> also to get the current function</li>
</ul>
<p>or something as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;somefilename:43&quot;</span>
</pre></div>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.tag_get">
<code class="descname">tag_get</code><span class="sig-paren">(</span><em>tagname</em>, <em>value_default</em>, <em>origin_default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.tag_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a tuple (value, origin) with the value of the tag and
where it was defined.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.target_event">
<code class="descname">target_event</code><em class="property"> = &lt;threading._Event object&gt;</em><a class="headerlink" href="#tcfl.tc.tc_c.target_event" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.assign_timeout">
<code class="descname">assign_timeout</code><em class="property"> = 1000</em><a class="headerlink" href="#tcfl.tc.tc_c.assign_timeout" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum time (seconds) to wait to succesfully acquire a set of targets</p>
<p>In heavily contented scenarios or large executions, this
becomes oversimplistic and not that useful and shall be
delegated to something like Jenkins timing out after so long
running things.</p>
<p>In that case set it to over that timeout (eg: 15 hours); it’ll
keep trying to assign until killed; in a tcf <a class="reference internal" href="04-HOWTOs.html#tcf-client-configuration"><span class="std std-ref">configuration
file</span></a>, add:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="o">.</span><span class="n">assign_timeout</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>
</pre></div>
</div>
<p>or even in the testcase itself, before it assigns (in build or
config methods)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">assign_timeout</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.targets_active">
<code class="descname">targets_active</code><span class="sig-paren">(</span><em>*skip_targets</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.targets_active" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark each target this testcase use as being used</p>
<p>This is to be called when operations are being done on the
background that the daemon can’t see and thus consider the
target active (e.g.: you are copying a big file over SSH)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">mytest</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_some</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">targets_active</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
</pre></div>
</div>
<p>If any target is to be skipped, they can be passed as arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">interconnect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">mytest</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_some</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">targets_active</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.finalize">
<code class="descname">finalize</code><span class="sig-paren">(</span><em>result</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.finalize" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.mkticket">
<code class="descname">mkticket</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.mkticket" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.post_tc_append">
<code class="descname">post_tc_append</code><span class="sig-paren">(</span><em>tc</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.post_tc_append" title="Permalink to this definition">¶</a></dt>
<dd><p>Append a testcase that shall be executed inmediately after
this testcase is done executing in the same target group.</p>
<p>This is a construct that can be used for:</p>
<ul class="simple">
<li>execute other testcases that have been detected as needed
only during runtime</li>
<li>reporting subtestcases of a main testcase (relying only on
the output of the main testcase execution, such as in
<a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c" title="tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c</span></code></a>.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>tc</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tc_c</em></a>) – <p>[instance of a] testcase to append; note this
testcase will be executed in the same target group as this
testcase is being executed. So the testcase has to declare
at the same targets (with the same names) or a subset of
them. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target3&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">some_tc</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_something</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target2</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">new_tc</span> <span class="o">=</span> <span class="n">another_tc</span><span class="p">(</span><span class="n">SOMEPARAMS</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">post_tc_append</span><span class="p">(</span><span class="n">new_tc</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">another_tc</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_something</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target2</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">report_info</span><span class="p">(</span><span class="s2">&quot;I&#39;m running on target2&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target3&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">yet_another_tc</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_something</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target1</span><span class="p">,</span> <span class="n">target3</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">report_info</span><span class="p">(</span><span class="s2">&quot;I&#39;m running on target1 and target3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.file_regex">
<code class="descname">file_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#tcfl.tc.tc_c.file_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.tc_c.is_testcase">
<em class="property">classmethod </em><code class="descname">is_testcase</code><span class="sig-paren">(</span><em>path</em>, <em>from_path</em>, <em>tc_name</em>, <em>subcases_cmdline</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.is_testcase" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine if a given file describes one or more testcases and
crete them</p>
<p>TCF’s test case discovery engine calls this method for each
file that could describe one or more testcases. It will
iterate over all the files and paths passed on the command
line files and directories, find files and call this function
to enquire on each.</p>
<p>This function’s responsibility is then to look at the contents
of the file and create one or more objects of type
<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.tc_c</span></code></a> which represent the testcases to be
executed, returning them in a list.</p>
<p>When creating <a class="reference internal" href="glossary.html#term-testcase-driver"><span class="xref std std-term">testcase driver</span></a>, the driver has to
create its own version of this function. The default
implementation recognizes python files called <em>test_*.py</em> that
contain one or more classes that subclass <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.tc_c</span></code></a>.</p>
<p>See examples of drivers in:</p>
<ul class="simple">
<li><a class="reference internal" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase" title="tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase()</span></code></a></li>
<li><a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase()</span></code></a></li>
<li><a class="reference internal" href="04-HOWTOs.html#module-examples.test_ptest_runner" title="examples.test_ptest_runner"><code class="xref py py-meth docutils literal notranslate"><span class="pre">examples.test_ptest_runner()</span></code></a> (<a class="reference internal" href="glossary.html#term-impromptu-testcase-driver"><span class="xref std std-term">impromptu
testcase driver</span></a>)</li>
</ul>
<p>note drivers need to be registered with
<a class="reference internal" href="#tcfl.tc.tc_c.driver_add" title="tcfl.tc.tc_c.driver_add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.driver_add()</span></code></a>; on the other hand, a Python
<a class="reference internal" href="glossary.html#term-impromptu-testcase-driver"><span class="xref std std-term">impromptu testcase driver</span></a> needs no registration, but
the test class has to be called <em>_driver</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – path and filename of the file that has to be
examined; this is always a regular file (or symlink to it).</li>
<li><strong>from_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>source command line argument this file
was found on; e.g.: if <em>path</em> is <em>dir1/subdir/file</em>, and the
user ran:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf run somefile dir1/ dir2/
</pre></div>
</div>
<p><em>tcf run</em> found this under the second argument and thus:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">from_path</span> <span class="o">=</span> <span class="s2">&quot;dir1&quot;</span>
</pre></div>
</div>
</li>
<li><strong>tc_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – testcase name the core has determine based
on the path and subcases specified on the command line; the
driver can override it, but it is recommended it is kept.</li>
<li><strong>subcases_cmdline</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – <p>list of subcases the user
has specified in the command line; e.g.: for:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf run test_something.py#sub1#sub2
</pre></div>
</div>
<p>this would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">subcases_cmdline</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;sub1&#39;</span><span class="p">,</span> <span class="s1">&#39;sub2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of testcases found in <em>path</em>, empty if none
found or file not recognized / supported.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.tc_c.find_in_path">
<em class="property">classmethod </em><code class="descname">find_in_path</code><span class="sig-paren">(</span><em>tcs</em>, <em>path</em>, <em>subcases_cmdline</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.find_in_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a path, scan for test cases and put them in the
dictionary &#64;tcs based on filename where found.
list of zero or more paths, scan them for files that
contain testcase tc information and report them.
:param dict tcs: dictionary where to add the test cases found</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – path where to scan for test cases</li>
<li><strong>subcases</strong> (<em>list</em>) – list of subcase names the testcase should
consider</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">result_c with counts of tests passed/failed (zero,
as at this stage we cannot know), blocked (due to error
importing) or skipped(due to whichever condition).</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.class_result">
<code class="descname">class_result</code><em class="property"> = 0 (0 0 0 0 0)</em><a class="headerlink" href="#tcfl.tc.tc_c.class_result" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc.subtc_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">subtc_c</code><span class="sig-paren">(</span><em>name</em>, <em>tc_file_path</em>, <em>origin</em>, <em>parent</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.subtc_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper for reporting sub testcases</p>
<p>This is used to implement a pattern where a testcase reports, when
executed, multiple subcases that are always executed. Then the
output is parsed and reported as individual testcases.</p>
<p>As well as the parameters in <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.tc_c</span></code></a>, the
following parameter is needed:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>parent</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – testcase which is the parent of this
testcase.</td>
</tr>
</tbody>
</table>
<p>Refer to this <a class="reference internal" href="04-HOWTOs.html#example-subcases"><span class="std std-ref">simplified example</span></a> for a
usage example.</p>
<p>Note these subcases are just an artifact to report the subcases
results individually, so they do not actually need to acquire or
physically use the targets.</p>
<dl class="method">
<dt id="tcfl.tc.subtc_c.update">
<code class="descname">update</code><span class="sig-paren">(</span><em>result</em>, <em>summary</em>, <em>output</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.subtc_c.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the results this subcase will report</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>result</strong> (<a class="reference internal" href="#tcfl.tc.result_c" title="tcfl.tc.result_c"><em>tcfl.tc.result_c</em></a>) – result to be reported</li>
<li><strong>summary</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – one liner summary of the execution report</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.subtc_c.eval_50">
<code class="descname">eval_50</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.subtc_c.eval_50" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.tc.subtc_c.clean">
<em class="property">static </em><code class="descname">clean</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.subtc_c.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.subtc_c.class_result">
<code class="descname">class_result</code><em class="property"> = 0 (0 0 0 0 0)</em><a class="headerlink" href="#tcfl.tc.subtc_c.class_result" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.tc.find">
<code class="descclassname">tcfl.tc.</code><code class="descname">find</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.find" title="Permalink to this definition">¶</a></dt>
<dd><p>Discover test cases in a list of paths</p>
</dd></dl>

<dl class="data">
<dt id="tcfl.tc.tc_global">
<code class="descclassname">tcfl.tc.</code><code class="descname">tc_global</code><em class="property"> = &lt;tcfl.tc.tc_c object&gt;</em><a class="headerlink" href="#tcfl.tc.tc_global" title="Permalink to this definition">¶</a></dt>
<dd><p>Global testcase reporter</p>
<p>Used to report top-level progress and messages beyond the actual
testcases we have to execute</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tc.testcases_discover">
<code class="descclassname">tcfl.tc.</code><code class="descname">testcases_discover</code><span class="sig-paren">(</span><em>tcs_filtered</em>, <em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.testcases_discover" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.tc.argp_setup">
<code class="descclassname">tcfl.tc.</code><code class="descname">argp_setup</code><span class="sig-paren">(</span><em>arg_subparsers</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.argp_setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>
<div class="section" id="module-tcfl.tl">
<span id="test-library-utilities-for-testcases"></span><h3>8.1.2. Test library (utilities for testcases)<a class="headerlink" href="#module-tcfl.tl" title="Permalink to this headline">¶</a></h3>
<p>Common utilities for test cases</p>
<dl class="function">
<dt id="tcfl.tl.zephyr_tags">
<code class="descclassname">tcfl.tl.</code><code class="descname">zephyr_tags</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.zephyr_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate the build environment and make sure all it is needed to
build Zephyr apps is in place.</p>
<p>If not, return a dictionary defining a <em>skip</em> tag with the reason
that can be fed directly to decorator <a class="reference internal" href="#tcfl.tc.tags" title="tcfl.tc.tags"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.tags()</span></code></a>; usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">qal</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tags</span><span class="p">(</span><span class="o">**</span><span class="n">qal</span><span class="o">.</span><span class="n">zephyr_tests_tags</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">some_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.console_dump_on_failure">
<code class="descclassname">tcfl.tl.</code><code class="descname">console_dump_on_failure</code><span class="sig-paren">(</span><em>testcase</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.console_dump_on_failure" title="Permalink to this definition">¶</a></dt>
<dd><p>If a testcase has errored, failed or blocked, dump the consoles of
all the targets.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>testcase</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – testcase whose targets’ consoles we
want to dump</td>
</tr>
</tbody>
</table>
<p>Usage: in a testcase’s teardown function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tl</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">some_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">teardown_SOMETHING</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">console_dump_on_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.setup_verify_slip_feature">
<code class="descclassname">tcfl.tl.</code><code class="descname">setup_verify_slip_feature</code><span class="sig-paren">(</span><em>zephyr_client</em>, <em>zephyr_server</em>, <em>_ZEPHYR_BASE</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.setup_verify_slip_feature" title="Permalink to this definition">¶</a></dt>
<dd><p>The Zephyr kernel we use needs to support
CONFIG_SLIP_MAC_ADDR, so if any of the targets needs SLIP
support, make sure that feature is Kconfigurable
Note we do this after building, because we need the full
target’s configuration file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>zephyr_client</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – Client Zephyr target</li>
<li><strong>zephyr_server</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – Client Server target</li>
<li><strong>_ZEPHYR_BASE</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Path of Zephyr source code</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Usage: in a testcase’s setup methods, before building Zephyr code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span>    <span class="nd">@staticmethod</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">setup_SOMETHING</span><span class="p">(</span><span class="n">zephyr_client</span><span class="p">,</span> <span class="n">zephyr_server</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">setup_verify_slip_feature</span><span class="p">(</span><span class="n">zephyr_client</span><span class="p">,</span> <span class="n">zephyr_server</span><span class="p">,</span>
<span class="go">                                              tcfl.tl.ZEPHYR_BASE)</span>
</pre></div>
</div>
<p>Look for a complete example in
<a class="reference download internal" href="../_downloads/test_network_linux_zephyr_echo.py" download=""><code class="xref download docutils literal notranslate"><span class="pre">../examples/test_network_linux_zephyr_echo.py</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.teardown_targets_power_off">
<code class="descclassname">tcfl.tl.</code><code class="descname">teardown_targets_power_off</code><span class="sig-paren">(</span><em>testcase</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.teardown_targets_power_off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off all the targets used on a testcase.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>testcase</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – testcase whose targets we are to
power off.</td>
</tr>
</tbody>
</table>
<p>Usage: in a testcase’s teardown function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tl</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">some_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">teardown_SOMETHING</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">teardown_targets_power_off</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Note this is usually not necessary as the daemon will power off
the targets when cleaning them up; usually when a testcase fails,
you want to keep them on to be able to inspect them.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.tcpdump_enable">
<code class="descclassname">tcfl.tl.</code><code class="descname">tcpdump_enable</code><span class="sig-paren">(</span><em>ic</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.tcpdump_enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Ask an interconnect to capture IP traffic with TCPDUMP</p>
<p>Note this is only possible if the server to which the interconnect
is attached has access to it; if the interconnect is based on the
:class:vlan_pci driver, it will support it.</p>
<p>Note the interconnect <em>must be</em> power cycled after this for the
setting to take effect. Normally you do this in the <em>start</em> method
of a multi-target testcase</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">tcpdump_enable</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">ic</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.tcpdump_collect">
<code class="descclassname">tcfl.tl.</code><code class="descname">tcpdump_collect</code><span class="sig-paren">(</span><em>ic</em>, <em>filename=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.tcpdump_collect" title="Permalink to this definition">¶</a></dt>
<dd><p>Collects from an interconnect target the tcpdump capture</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ic</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – interconnect target</li>
<li><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the local file where to
copy the tcpdump data to; defaults to
<em>report-RUNID:HASHID-REP.tcpdump</em> (where REP is the repetition
count)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.linux_os_release_get">
<code class="descclassname">tcfl.tl.</code><code class="descname">linux_os_release_get</code><span class="sig-paren">(</span><em>target</em>, <em>prefix=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.linux_os_release_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return in a dictionary the contents of a file /etc/os-release (if
it exists)</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.linux_ssh_root_nopwd">
<code class="descclassname">tcfl.tl.</code><code class="descname">linux_ssh_root_nopwd</code><span class="sig-paren">(</span><em>target</em>, <em>prefix=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.linux_ssh_root_nopwd" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure a SSH deamon to allow login as root with no passwords</p>
<p id="howto-restart-sshd">In a script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">linux_ssh_root_nopwd</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;systemctl restart sshd&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>wait for <em>sshd</em> to be fully ready; it is a hack</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>           <span class="c1"># wait for sshd to fully restart</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># this assumes BASH</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;while ! exec 3&lt;&gt;/dev/tcp/localhost/22; do&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot; sleep 1s; done&quot;</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p class="first">why not <em>nc</em>? easy and simple; not default installed in most distros</p>
</li>
<li><p class="first">why not <em>curl</em>? most distros have it installed; if SSH is replying
with the SSH-2.0 string, then likely the daemon is ready</p>
<p>Recent versions of curl now check for HTTP headers, so can’t be
really used for this</p>
</li>
<li><p class="first">why not plain <em>ssh</em>? because that might fail by many other
reasons, but you can check the debug in <em>ssh -v</em> messages for a
<em>debug1: Remote protocol version</em> string; output is harder to
keep under control and <em>curl</em> is kinda faster, but:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh -v localhost 2&gt;&amp;1 -t echo | fgrep -q &#39;debug1: Remote protocol version&#39;
</pre></div>
</div>
<p>is a valid test</p>
</li>
<li><p class="first">why not <em>netstat</em>? for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$  while ! netstat -antp | grep -q &#39;^tcp.*:22.*LISTEN.*sshd&#39;; do sleep 1s; done
</pre></div>
</div>
<dl class="docutils">
<dt><em>netstat</em> is not always available, when available, that is also</dt>
<dd><p class="first last">a valid test</p>
</dd>
</dl>
</li>
</ul>
<p>Things you can do after this:</p>
<ol class="arabic">
<li><p class="first">switch over to an SSH console if configured (they are faster
and depending on the HW, more reliable):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">setup_preferred</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.deploy_linux_ssh_root_nopwd">
<code class="descclassname">tcfl.tl.</code><code class="descname">deploy_linux_ssh_root_nopwd</code><span class="sig-paren">(</span><em>_ic</em>, <em>target</em>, <em>_kws</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.deploy_linux_ssh_root_nopwd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.tl.linux_ipv4_addr_get_from_console">
<code class="descclassname">tcfl.tl.</code><code class="descname">linux_ipv4_addr_get_from_console</code><span class="sig-paren">(</span><em>target</em>, <em>ifname</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.linux_ipv4_addr_get_from_console" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the IPv4 address of a Linux Interface from the Linux shell
using the <em>ip addr show</em> command.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>target</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – target on which to find the IPv4
address.</li>
<li><strong>ifname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the interface for which we want to find
the IPv4 address.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><strong>tcfl.tc.error_e</strong></a> – if it cannot find the IP address.</p>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">interconnect</span><span class="p">(</span><span class="s2">&quot;ipv4_addr&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;pos_capable&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">ip4</span> <span class="o">=</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">linux_ipv4_addr_get_from_console</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;eth0&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">ip4_config</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">addr_get</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="s2">&quot;ipv4&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="k">if</span> <span class="n">ip4</span> <span class="o">!=</span> <span class="n">ip4_config</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>           <span class="k">raise</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">failed_e</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>               <span class="s2">&quot;assigned IPv4 addr </span><span class="si">%s</span><span class="s2"> is different than&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>               <span class="s2">&quot; expected from configuration </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ip4</span><span class="p">,</span> <span class="n">ip4_config</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.sh_export_proxy">
<code class="descclassname">tcfl.tl.</code><code class="descname">sh_export_proxy</code><span class="sig-paren">(</span><em>ic</em>, <em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.sh_export_proxy" title="Permalink to this definition">¶</a></dt>
<dd><p>If the interconnect <em>ic</em> defines a proxy environment, issue a
shell command in <em>target</em> to export environment variables that
configure it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_some</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">sh_export_proxy</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
<p>would yield a command such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export  http_proxy=http://192.168.98.1:8888           https_proxy=http://192.168.98.1:8888           no_proxy=127.0.0.1,192.168.98.1/24,fc00::62:1/112           HTTP_PROXY=$http_proxy           HTTPS_PROXY=$https_proxy           NO_PROXY=$no_proxy
</pre></div>
</div>
<p>being executed in the target</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.linux_wait_online">
<code class="descclassname">tcfl.tl.</code><code class="descname">linux_wait_online</code><span class="sig-paren">(</span><em>ic</em>, <em>target</em>, <em>loops=20</em>, <em>wait_s=0.5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.linux_wait_online" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait on the serial console until the system is assigned an IP</p>
<p>We make the assumption that once the system is assigned the IP
that is expected on the configuration, the system has upstream
access and thus is online.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.linux_rsync_cache_lru_cleanup">
<code class="descclassname">tcfl.tl.</code><code class="descname">linux_rsync_cache_lru_cleanup</code><span class="sig-paren">(</span><em>target</em>, <em>path</em>, <em>max_kbytes</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.linux_rsync_cache_lru_cleanup" title="Permalink to this definition">¶</a></dt>
<dd><p>Cleanup an LRU rsync cache in a path in the target</p>
<p>An LRU rsync cache is a file tree which is used as an accelerator
to rsync trees in to the target for the POS deployment system;</p>
<p>When it grows too big, we need to purge the files/dirs that were
uploaded longest ago (as this indicates when it was the last time
they were used). For that we use the mtime and we sort by it.</p>
<p>Note this is quite naive, since we can’t really calculate well the
space occupied by directories, which adds to the total…</p>
<p>So it sorts by reverse mtime (newest first) and iterates over the
list until the accumulated size is more than max_kbytes; then it
starts removing files.</p>
</dd></dl>

<dl class="data">
<dt id="tcfl.tl.swupd_bundle_add_timeouts">
<code class="descclassname">tcfl.tl.</code><code class="descname">swupd_bundle_add_timeouts</code><em class="property"> = {'LyX': 500, 'R-rstudio': 1200, 'big-data-basic': 800, 'c-basic': 500, 'computer-vision-basic': 800, 'container-virt': 800, 'containers-basic-dev': 1200, 'database-basic-dev': 800, 'desktop': 480, 'desktop-autostart': 480, 'desktop-dev': 2500, 'desktop-kde-apps': 800, 'devpkg-clutter-gst': 800, 'devpkg-gnome-online-accounts': 800, 'devpkg-gnome-panel': 800, 'devpkg-nautilus': 800, 'devpkg-opencv': 800, 'education': 800, 'education-primary': 800, 'game-dev': 6000, 'games': 800, 'java-basic': 1600, 'java11-basic': 1600, 'java12-basic': 1600, 'java13-basic': 1600, 'java9-basic': 1600, 'machine-learning-basic': 1200, 'machine-learning-tensorflow': 800, 'machine-learning-web-ui': 1200, 'mail-utils-dev ': 1000, 'maker-cnc': 800, 'maker-gis': 800, 'network-basic-dev': 1200, 'openstack-common': 800, 'os-clr-on-clr': 8000, 'os-clr-on-clr-dev': 8000, 'os-core-dev': 800, 'os-testsuite': 1000, 'os-testsuite-phoronix': 2000, 'os-testsuite-phoronix-desktop': 1000, 'os-testsuite-phoronix-server': 1000, 'os-util-gui': 800, 'os-utils-gui-dev': 6000, 'python-basic-dev': 800, 'qt-basic-dev': 2400, 'service-os-dev': 800, 'storage-cluster': 800, 'storage-util-dev': 800, 'storage-utils-dev': 1000, 'supertuxkart': 800, 'sysadmin-basic-dev': 1000, 'texlive': 1000}</em><a class="headerlink" href="#tcfl.tl.swupd_bundle_add_timeouts" title="Permalink to this definition">¶</a></dt>
<dd><p>Timeouts for adding different, big size bundles</p>
<p>To add to this configuration, specify in a client configuration
file or on a test script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">swupd_bundle_add_timeouts</span><span class="p">[</span><span class="s1">&#39;BUNDLENAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TIMEOUT</span>
</pre></div>
</div>
<p>note timeout for adding a bundle defaults to 240 seconds.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.swupd_bundle_add">
<code class="descclassname">tcfl.tl.</code><code class="descname">swupd_bundle_add</code><span class="sig-paren">(</span><em>ic</em>, <em>target</em>, <em>bundle_list</em>, <em>debug=None</em>, <em>url=None</em>, <em>wait_online=True</em>, <em>set_proxy=True</em>, <em>fix_time=None</em>, <em>add_timeout=None</em>, <em>become_root=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.swupd_bundle_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Install bundles into a Clear distribution</p>
<p>This is a helper that install a list of bundles into a Clear
distribution taking care of a lot of the hard work.</p>
<p>While it is preferrable to have an open call to <em>swupd bundle-add</em>
and it should be as simple as that, we have found we had to
repeatedly take manual care of many issues and thus this helper
was born. It will take take care of:</p>
<ul>
<li><p class="first">wait for network connectivity [convenience]</p>
</li>
<li><p class="first">setup proxy variables [convenience]</p>
</li>
<li><p class="first">set swupd URL from where to download [convenience]</p>
</li>
<li><p class="first">fix system’s time for SSL certification (in <em>broken</em> HW)</p>
</li>
<li><p class="first">retry bundle-add calls when they fail due:
- random network issues
- issues such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">cannot</span> <span class="n">acquire</span> <span class="n">lock</span> <span class="n">file</span><span class="o">.</span> <span class="n">Another</span> <span class="n">swupd</span> <span class="n">process</span> <span class="ow">is</span>           <span class="n">already</span> <span class="n">running</span>  <span class="p">(</span><span class="n">possibly</span> <span class="n">auto</span><span class="o">-</span><span class="n">update</span><span class="p">)</span>
</pre></div>
</div>
<p>all retryable after a back-off wait.</p>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ic</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – interconnect the target uses for
network connectivity</li>
<li><strong>target</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – target on which to operate</li>
<li><strong>bundle_list</strong> – name of the bundle to add or list of them;
note they will be added each in a separate <em>bundle-add</em> command</li>
<li><strong>debug</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) run <em>bundle-add</em> with <code class="docutils literal notranslate"><span class="pre">--debug--</span></code>;
if <em>None</em>, defaults to environment <em>SWUPD_DEBUG</em> being defined
to any value.</li>
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) set the given <em>url</em> for the swupd’s
repository with <em>swupd mirror</em>; if <em>None</em>, defaults to
environment <em>SWUPD_URL</em> if defined, otherwise leaves the
system’s default setting.</li>
<li><strong>wait_online</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) waits for the system to have
network connectivity (with <a class="reference internal" href="#tcfl.tl.linux_wait_online" title="tcfl.tl.linux_wait_online"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tl.linux_wait_online()</span></code></a>);
defaults to <em>True</em>.</li>
<li><strong>set_proxy</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) sets the proxy environment with
<a class="reference internal" href="#tcfl.tl.sh_export_proxy" title="tcfl.tl.sh_export_proxy"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tl.sh_export_proxy()</span></code></a> if the interconnect exports proxy
information; defaults to <em>True</em>.</li>
<li><strong>fix_time</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) fixes the system’s time if <em>True</em>
to the client’s time.; if <em>None</em>, defaults to environment
<em>SWUPD_FIX_TIME</em> if defined, otherwise <em>False</em>.</li>
<li><strong>add_timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) timeout to set to wait for the
<em>bundle-add</em> to complete; defaults to whatever is configured in
the <a class="reference internal" href="#tcfl.tl.swupd_bundle_add_timeouts" title="tcfl.tl.swupd_bundle_add_timeouts"><code class="xref py py-data docutils literal notranslate"><span class="pre">tcfl.tl.swupd_bundle_add_timeouts</span></code></a> or the the default
of 240 seconds.</li>
<li><strong>become_root</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – <p>(optional) if <em>True</em> run the command as super
user using <em>su</em> (defaults to <em>False</em>). To be used when the script has the
console logged in as non-root.</p>
<p>This uses <em>su</em> vs <em>sudo</em> as some installations will not install
<em>sudo</em> for security reasons.</p>
<p>Note this function assumes <em>su</em> is configured to work without
asking any passwords. For that, PAM module <em>pam_unix.so</em> has to
be configured to include the option <em>nullok</em> in target’s files
such as:</p>
<ul>
<li><em>/etc/pam.d/common-auth</em></li>
<li><em>/usr/share/pam.d/su</em></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">tcf-image-setup.sh</span></code> will do this for you if using it to set
images.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-tcfl.pos">
<span id="provisioning-deploying-flashing-pc-class-devices-with-a-provisioning-os"></span><h3>8.1.3. Provisioning/deploying/flashing PC-class devices with a Provisioning OS<a class="headerlink" href="#module-tcfl.pos" title="Permalink to this headline">¶</a></h3>
<div class="section" id="core-provisioning-os-functionality">
<h4>8.1.3.1. Core Provisioning OS functionality<a class="headerlink" href="#core-provisioning-os-functionality" title="Permalink to this headline">¶</a></h4>
<p>This module provides tools to image devices with a Provisioning OS.</p>
<p>The general operation mode for this is instructing the device to boot
the <a class="reference internal" href="glossary.html#term-pos"><span class="xref std std-term">Provisioning OS</span></a>; at this point, the test script (or
via the <em>tcf</em> client line) can interact with the POS over the serial
console.</p>
<p>Then the device can be partitioned, formatted, etc with general Linux
command line. As well, we can provide an <a class="reference internal" href="#module-ttbl.rsync" title="ttbl.rsync"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rsync</span> <span class="pre">server</span></code></a> to provide OS images that can be flashed</p>
<p>Booting to POS can be accomplished:</p>
<ul class="simple">
<li>by network boot and root over NFS</li>
<li>by a special boot device pre-configured to always boot POS</li>
<li>any other</li>
</ul>
<p>Server side modules used actively by this system:</p>
<ul class="simple">
<li>DHCP server <a class="reference internal" href="#module-ttbl.dhcp" title="ttbl.dhcp"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ttbl.dhcp</span></code></a>: provides dynamic IP address
assignment; it can be configured so a pre-configured IP address is
always assigned to a target and will provide also PXE/TFTP boot
services to boot into POS mode (working in conjunction with a HTTP,
TFTP and NFS servers).</li>
<li>rsync server <a class="reference internal" href="#module-ttbl.rsync" title="ttbl.rsync"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ttbl.rsync</span></code></a>: provides access to images to rsync
into partitions (which is way faster than some other imaging methods
when done over a 1Gbps link).</li>
<li>port redirector <a class="reference internal" href="#module-ttbl.socat" title="ttbl.socat"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ttbl.socat</span></code></a>: not strictly needed for POS, but
useful to redirect ports out of the <a class="reference internal" href="glossary.html#term-nut"><span class="xref std std-term">NUT</span></a> to the greater
Internet. This comes handy if as part of the testing external
software has to be installed or external services acccessed.</li>
</ul>
<p>Note installation in the server side is needed, as described in
<a class="reference internal" href="03-server-setup.html#pos-setup"><span class="std std-ref">POS setup</span></a>.</p>
<dl class="function">
<dt id="tcfl.pos.image_spec_to_tuple">
<code class="descclassname">tcfl.pos.</code><code class="descname">image_spec_to_tuple</code><span class="sig-paren">(</span><em>i</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.image_spec_to_tuple" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.pos.image_list_from_rsync_output">
<code class="descclassname">tcfl.pos.</code><code class="descname">image_list_from_rsync_output</code><span class="sig-paren">(</span><em>output</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.image_list_from_rsync_output" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.pos.image_select_best">
<code class="descclassname">tcfl.pos.</code><code class="descname">image_select_best</code><span class="sig-paren">(</span><em>image</em>, <em>available_images</em>, <em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.image_select_best" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.pos.target_power_cycle_to_pos_pxe">
<code class="descclassname">tcfl.pos.</code><code class="descname">target_power_cycle_to_pos_pxe</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.target_power_cycle_to_pos_pxe" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.pos.target_power_cycle_to_normal_pxe">
<code class="descclassname">tcfl.pos.</code><code class="descname">target_power_cycle_to_normal_pxe</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.target_power_cycle_to_normal_pxe" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="tcfl.pos.persistent_tcf_d">
<code class="descclassname">tcfl.pos.</code><code class="descname">persistent_tcf_d</code><em class="property"> = '/persistent.tcf.d'</em><a class="headerlink" href="#tcfl.pos.persistent_tcf_d" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of the directory created in the target’s root filesystem to
cache test content</p>
<p>This is maintained by the provisioning process, althought it might
be cleaned up to make room.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.pos.mk_persistent_tcf_d">
<code class="descclassname">tcfl.pos.</code><code class="descname">mk_persistent_tcf_d</code><span class="sig-paren">(</span><em>target</em>, <em>subdirs=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.mk_persistent_tcf_d" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.pos.deploy_linux_kernel">
<code class="descclassname">tcfl.pos.</code><code class="descname">deploy_linux_kernel</code><span class="sig-paren">(</span><em>ic</em>, <em>target</em>, <em>_kws</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.deploy_linux_kernel" title="Permalink to this definition">¶</a></dt>
<dd><p>Deploy a linux kernel tree in the local machine to the target’s
root filesystem (<a class="reference internal" href="04-HOWTOs.html#example-linux-kernel"><span class="std std-ref">example</span></a>).</p>
<p>A Linux kernel can be built and installed in a separate root
directory in the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">ROOTDIR</span><span class="o">/</span><span class="n">boot</span><span class="o">/*</span>
<span class="o">-</span> <span class="n">ROOTDIR</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">modules</span><span class="o">/*</span>
</pre></div>
</div>
<p>all those will be rsync’ed to the target’s <em>/boot</em> and
<em>/lib/modules</em> (caching on the target’s persistent rootfs area for
performance) after flashing the OS image. Thus, it will overwrite
whatever kernels where in there.</p>
<p>The target’s <em>/boot/EFI</em> directories will be kept, so that the
bootloader configuration can pull the information to configure the
new kernel using the existing options.</p>
<p>Build the Linux kernel from a <em>linux</em> source directory to a
<em>build</em> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir -p build
$ cp CONFIGFILE build/.config
$ make -C PATH/TO/SRC/linux O=build oldconfig
$ make -C build all
</pre></div>
</div>
<p>(or your favourite configuration and build mechanism), now it can
be installed into the root directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir -p root
$ make -C build INSTALLKERNEL=ignoreme           INSTALL_PATH=root/boot INSTALL_MOD_PATH=root           install modules_install
</pre></div>
</div>
<p>The <em>root</em> directory can now be given to
<a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-func docutils literal notranslate"><span class="pre">target.pos.deploy_image</span></code></a>
as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">deploy_linux_kernel_tree</span> <span class="o">=</span> <span class="n">ROOTDIR</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">deploy_image</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="n">IMAGENAME</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="n">extra_deploy_fns</span> <span class="o">=</span> <span class="p">[</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">deploy_linux_kernel</span> <span class="p">])</span>
</pre></div>
</div>
<p>or if using the <a class="reference internal" href="#tcfl.pos.tc_pos_base" title="tcfl.pos.tc_pos_base"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.pos.tc_pos_base</span></code></a> test class template,
it can be done such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">tc_pos_base</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">deploy_00</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">rootdir</span> <span class="o">=</span> <span class="n">ROOTDIR</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target</span><span class="o">.</span><span class="n">deploy_linux_kernel_tree</span> <span class="o">=</span> <span class="n">rootdir</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">deploy_image_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">extra_deploy_fns</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">tcfl</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">deploy_linux_kernel</span> <span class="p">])</span>
</pre></div>
</div>
<p><em>ROOTDIR</em> can be hardcoded, but remember if given relative, it is
relative to the directory where <em>tcf run</em> was executed from, not
where the testcase source is.</p>
<p><strong>Low level details</strong></p>
<p>When the target’s image has been flashed in place,
<a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.pos.deploy_image</span></code></a> is
asked to call this function.</p>
<p>The client will rsync the tree from the local machine to the
persistent space using <a class="reference internal" href="#tcfl.pos.extension.rsync" title="tcfl.pos.extension.rsync"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target.pos.rsync</span></code></a>,
which also caches it in a persistent area to speed up multiple
transfers. From there it will be rsynced to its final
location.</p>
</dd></dl>

<dl class="data">
<dt id="tcfl.pos.capability_fns">
<code class="descclassname">tcfl.pos.</code><code class="descname">capability_fns</code><em class="property"> = {'boot_config': {'uefi': &lt;function boot_config_multiroot at 0x7f94dac48250&gt;}, 'boot_config_fix': {'uefi': &lt;function boot_config_fix at 0x7f94dac482d0&gt;}, 'boot_to_normal': {'pxe': &lt;function target_power_cycle_to_normal_pxe at 0x7f94dad247d0&gt;}, 'boot_to_pos': {'pxe': &lt;function target_power_cycle_to_pos_pxe at 0x7f94dad24750&gt;}, 'mount_fs': {'multiroot': &lt;function mount_fs at 0x7f94dac40050&gt;}}</em><a class="headerlink" href="#tcfl.pos.capability_fns" title="Permalink to this definition">¶</a></dt>
<dd><p>Functions to boot a target into POS</p>
<p>Different target drivers can be loaded and will add members to
these dictionaries to extend the abilities of the core system to
put targets in Provisioning OS mode.</p>
<p>This then allows a single test script to work with multiple target
types without having to worry about details.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.pos.capability_register">
<code class="descclassname">tcfl.pos.</code><code class="descname">capability_register</code><span class="sig-paren">(</span><em>capability</em>, <em>value</em>, <em>fns</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.capability_register" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="tcfl.pos.extension">
<em class="property">class </em><code class="descclassname">tcfl.pos.</code><code class="descname">extension</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> to handle Provisioning
OS capabilities.</p>
<dl class="method">
<dt id="tcfl.pos.extension.cap_fn_get">
<code class="descname">cap_fn_get</code><span class="sig-paren">(</span><em>capability</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.cap_fn_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a target’s POS capability.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>capability</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the capability, as defined in
the target’s tag <a class="reference internal" href="#pos-capable"><span class="std std-ref">*pos_capable*</span></a>.</li>
<li><strong>default</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) default to use if not
specified; DO NOT USE! WILL BE DEPRECATED!</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.pos.extension.boot_to_pos">
<code class="descname">boot_to_pos</code><span class="sig-paren">(</span><em>pos_prompt=None</em>, <em>timeout=60</em>, <em>boot_to_pos_fn=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.boot_to_pos" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.pos.extension.boot_normal">
<code class="descname">boot_normal</code><span class="sig-paren">(</span><em>boot_to_normal_fn=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.boot_normal" title="Permalink to this definition">¶</a></dt>
<dd><p>Power cycle the target (if neeed) and boot to normal OS (vs
booting to the Provisioning OS).</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.pos.extension.mount_fs">
<code class="descname">mount_fs</code><span class="sig-paren">(</span><em>image</em>, <em>boot_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.mount_fs" title="Permalink to this definition">¶</a></dt>
<dd><p>Mount the target’s filesystems in /mnt</p>
<p>When completed, this function has (maybe)
formatted/reformatted and mounted all of the target’s
filesystems starting in /mnt.</p>
<p>For example, if the final system would have filesystems <em>/boot</em>,
<em>/</em> and <em>/home</em>, this function would mount them on:</p>
<ul class="simple">
<li>/ on /mnt/</li>
<li>/boot on /mnt/boot</li>
<li>/home on /mnt/home</li>
</ul>
<p>This allows <a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-meth docutils literal notranslate"><span class="pre">deploy_image()</span></code></a> to rysnc content into the
final system.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>image</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the image we are going to deploy in
this target</li>
<li><strong>boot_dev</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – device name the system will use to boot</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.pos.extension.rsyncd_start">
<code class="descname">rsyncd_start</code><span class="sig-paren">(</span><em>ic</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.rsyncd_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start an <em>rsync</em> server on a target running Provisioning OS</p>
<p>This can be used to receive deployment files from any location
needed to execute later in the target. The server is attached to
the <code class="docutils literal notranslate"><span class="pre">/mnt</span></code> directory and the target is upposed to mount the
destination filesystems there.</p>
<p>This is usually called automatically for the user by the likes of
<a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-func docutils literal notranslate"><span class="pre">deploy_image()</span></code></a> and others.</p>
<p>It will create a tunnel from the server to the target’s port where
the rsync daemon is listening. A client can then connect to the
server’s port to stream data over the rsync protocol. The server
address and port will be stored in the <em>target</em>’s keywords
<em>rsync_port</em> and <em>rsync_server</em> and thus can be accessed with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">target</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;rsync_server&#39;</span><span class="p">],</span> <span class="n">target</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;rsync_port&#39;</span><span class="p">]</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ic</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – interconnect (network) to which
the target is connected.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.pos.extension.rsync">
<code class="descname">rsync</code><span class="sig-paren">(</span><em>src=None</em>, <em>dst=None</em>, <em>persistent_name=None</em>, <em>persistent_dir='/persistent.tcf.d'</em>, <em>path_append='/.'</em>, <em>rsync_extra=''</em>, <em>skip_local=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.rsync" title="Permalink to this definition">¶</a></dt>
<dd><p>rsync data from the local machine to a target</p>
<p>The local machine is the machine executing the test script (where
<em>tcf run</em> was called).</p>
<p>This function will first rsync data to a location in the target
(persistent storage <code class="docutils literal notranslate"><span class="pre">/persistent.tcd.d</span></code>) that will not be
overriden when flashing images. Then it will rsync it from there
to the final location.</p>
<p>Note this cache directory can accumulate and grow too big;
<a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-func docutils literal notranslate"><span class="pre">target.pos.deploy_image</span></code></a> will cap it to a top size
by removing the oldest files.</p>
<p>This allows the content to be cached in between testcase execution
that reimages the target. Thus, the first run, the whole source
tree is transferred to the persistent area, but subsequent runs
will already find it there even when if the OS image has been
reflashed (as the reflashing will not touch the persistent
area). Of course this assumes the previous executions didn’t wipe
the persistent area or the whole disk was not corrupted.</p>
<p>This function can be used, for example, when wanting to deploy
extra data to the target when using <a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-func docutils literal notranslate"><span class="pre">deploy_image()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">interconnect</span><span class="p">(</span><span class="s2">&quot;ipv4_addr&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;pos_capable&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="nd">@staticmethod</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">_deploy_mygittree</span><span class="p">(</span><span class="n">_ic</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">_kws</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">tcfl</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">rsync</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/somegittree.git&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                       <span class="n">dst</span> <span class="o">=</span> <span class="s1">&#39;/opt/somegittree.git&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">deploy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ic</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">deploy_image</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">ic</span><span class="p">,</span> <span class="s2">&quot;fedora::29&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">extra_deploy_fns</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deploy_mygittree</span> <span class="p">])</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
</pre></div>
</div>
<p>In this example, the user has a cloned git tree in
<code class="docutils literal notranslate"><span class="pre">~/somegittree.git</span></code> that has to be flashed to the target into
<code class="docutils literal notranslate"><span class="pre">/opt/somegittree.git</span></code> after ensuring the root file system is
flashed with <em>Fedora 29</em>. <a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-func docutils literal notranslate"><span class="pre">deploy_image()</span></code></a> will start the rsync
server and then call <em>_deploy_mygittree()</em>  which will use
<a class="reference internal" href="#tcfl.pos.extension.rsync" title="tcfl.pos.extension.rsync"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target.pos.rsync</span></code></a> to rsync from the user’s
machine to the target’s persistent location (in
<code class="docutils literal notranslate"><span class="pre">/mnt/persistent.tcf.d/somegittree.git</span></code>) and from there to the
final location of <code class="docutils literal notranslate"><span class="pre">/mnt/opt/somegittree.git</span></code>. When the system
boots it will be of course in <code class="docutils literal notranslate"><span class="pre">/opt/somegittree.git</span></code></p>
<p>Because <a class="reference internal" href="#tcfl.pos.extension.rsyncd_start" title="tcfl.pos.extension.rsyncd_start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target.pos.rsyncd_start</span></code></a>
has been called already, we have now these keywords available
that allows to know where to connect to.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;rsync_server&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;rsync_port&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>as setup by calling <a class="reference internal" href="#tcfl.pos.extension.rsyncd_start" title="tcfl.pos.extension.rsyncd_start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target.pos.rsyncd_start</span></code></a> on the target. Functions such as
<a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target.pos.deploy_image</span></code></a> do this for
you.</p>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>src</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) source tree/file in the local machine
to be copied to the target’s persistent area. If not specified,
nothing is copied to the persistent area.</li>
<li><strong>dst</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) destination tree/file in the target
machine; if specified, the file is copied from the persistent
area to the final destination. If not specified,
nothing is copied from the persistent area to the final
destination.</li>
<li><strong>persistent_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name for the file/tree in
the persistent area; defaults to the basename of the source file
specification.</li>
<li><strong>persistent_dir</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name for the persistent
area in the target, defaults to <a class="reference internal" href="#tcfl.pos.persistent_tcf_d" title="tcfl.pos.persistent_tcf_d"><code class="xref py py-data docutils literal notranslate"><span class="pre">persistent_tcf_d</span></code></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.pos.extension.rsync_np">
<code class="descname">rsync_np</code><span class="sig-paren">(</span><em>src</em>, <em>dst</em>, <em>option_delete=False</em>, <em>path_append='/.'</em>, <em>rsync_extra=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.rsync_np" title="Permalink to this definition">¶</a></dt>
<dd><p>rsync data from the local machine to a target</p>
<p>The local machine is the machine executing the test script (where
<em>tcf run</em> was called).</p>
<p>Unlike <a class="reference internal" href="#tcfl.pos.extension.rsync" title="tcfl.pos.extension.rsync"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rsync()</span></code></a>, this function will rsync data straight
from the local machine to the target’s final destination, but
without using the persistent storage <code class="docutils literal notranslate"><span class="pre">/persistent.tcd.d</span></code>.</p>
<p>This function can be used, for example, to flash a whole
distribution from the target–however, because that would be
very slow, <a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-meth docutils literal notranslate"><span class="pre">deploy_image()</span></code></a> is used to transfer a distro
as a seed from the server (faster) and then from the local
machine, just whatever changed (eg: some changes being tested
in some package):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">interconnect</span><span class="p">(</span><span class="s2">&quot;ipv4_addr&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;pos_capable&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">deploy_tree</span><span class="p">(</span><span class="n">_ic</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">_kws</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">rsync_np</span><span class="p">(</span><span class="s2">&quot;/SOME/DIR/my-fedora-29&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">deploy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ic</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">deploy_image</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">ic</span><span class="p">,</span> <span class="s2">&quot;fedora::29&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">extra_deploy_fns</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_tree</span> <span class="p">])</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
</pre></div>
</div>
<p>In this example, the target will be flashed to whatever fedora
29 is available in the server and then
<code class="docutils literal notranslate"><span class="pre">/SOME/DIR/my-fedora-29</span></code> will be rsynced on top.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>src</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) source tree/file in the local machine
to be copied to the target’s persistent area. If not specified,
nothing is copied to the persistent area.</li>
<li><strong>dst</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) destination tree/file in the target
machine; if specified, the file is copied from the persistent
area to the final destination. If not specified,
nothing is copied from the persistent area to the final
destination.</li>
<li><strong>option_delete</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) Add the <code class="docutils literal notranslate"><span class="pre">--delete</span></code>
option to delete anything in the target that is not present
in the source (%(default)s).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.pos.extension.rsyncd_stop">
<code class="descname">rsyncd_stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.rsyncd_stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop an <em>rsync</em> server on a target running Provisioning OS</p>
<p>A server was started with <a class="reference internal" href="#tcfl.pos.extension.rsyncd_start" title="tcfl.pos.extension.rsyncd_start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target.pos.rsyncd_start</span></code></a>; kill it gracefully.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.pos.extension.fsinfo_get_block">
<code class="descname">fsinfo_get_block</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.fsinfo_get_block" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.pos.extension.fsinfo_get_child">
<code class="descname">fsinfo_get_child</code><span class="sig-paren">(</span><em>child_name</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.fsinfo_get_child" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.pos.extension.fsinfo_get_child_by_partlabel">
<code class="descname">fsinfo_get_child_by_partlabel</code><span class="sig-paren">(</span><em>blkdev</em>, <em>partlabel</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.fsinfo_get_child_by_partlabel" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.pos.extension.fsinfo_read">
<code class="descname">fsinfo_read</code><span class="sig-paren">(</span><em>boot_partlabel=None</em>, <em>raise_on_not_found=True</em>, <em>timeout=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.fsinfo_read" title="Permalink to this definition">¶</a></dt>
<dd><p>Re-read the target’s partition tables, load the information</p>
<p>Internal API for POS drivers</p>
<p>This will load the partition table, ensuring the information
is loaded and that there is at least an entry in the partition
table for the boot partition of the device the trget’s
describes as POS boot device (target’s <em>pos_boot_dev</em>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>boot_partlabel</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) label of the partition
we need to be able to find while scanning; will retry a few
times up to a minute forcing a scan; defaults to nothing
(won’t look for it).</li>
<li><strong>raise_on_not_found</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional); raise a blocked
exception if the partition label is not found after
retrying; default <em>True</em>.</li>
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) seconds to wait for the
partition tables to be re-read; defaults to 30s (some HW
needs more than others and there is no way to make a good
determination) or whatever is specified in target
tag/property <span class="xref std std-ref">pos_partscan_timeout</span>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.pos.extension.rootfs_make_room_candidates">
<code class="descname">rootfs_make_room_candidates</code><em class="property"> = ['/mnt/tmp/', '/mnt/var/tmp/', '/mnt/var/log/', '/mnt/var/cache/', '/mnt/var/lib/systemd', '/mnt/var/lib/spool']</em><a class="headerlink" href="#tcfl.pos.extension.rootfs_make_room_candidates" title="Permalink to this definition">¶</a></dt>
<dd><p>List of directories to clean up when trying to make up space in
the root filesystem.</p>
<p>Before an image can be flashed, we need some space so rsync can
do its job. If there is not enough, we start cleaning
directories from files that can be easily ignored or we know
are going ot be wiped.</p>
<p>This list can be manipulated to fit the specific use case, for
example, from the deploy methods before calling
meth:<cite>deploy_image</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">rootfs_make_room_candidates</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;/mnt/opt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>to this we will add the cache locations from
data:<cite>cache_locations_per_distro</cite></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.pos.extension.cache_locations_per_distro">
<code class="descname">cache_locations_per_distro</code><em class="property"> = {'clear': ['/var/lib/swupd'], 'fedora': ['/var/lib/rpm'], 'rhel': ['/var/lib/rpm']}</em><a class="headerlink" href="#tcfl.pos.extension.cache_locations_per_distro" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of locations we cache for each distribution</p>
<p>keyed by the beginning of the distro name, this allows us to
respect the space where content has been previousloy downloaded, so
future executions don’t have to download it again. This can heavily
cut test setup time.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.pos.extension.deploy_image">
<code class="descname">deploy_image</code><span class="sig-paren">(</span><em>ic</em>, <em>image</em>, <em>boot_dev=None</em>, <em>root_part_dev=None</em>, <em>partitioning_fn=None</em>, <em>extra_deploy_fns=None</em>, <em>pos_prompt=None</em>, <em>timeout=60</em>, <em>timeout_sync=240</em>, <em>target_power_cycle_to_pos=None</em>, <em>boot_config=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.extension.deploy_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Deploy an image to a target using the Provisioning OS</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ic</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – interconnect off which we are booting the
Provisioning OS and to which <code class="docutils literal notranslate"><span class="pre">target</span></code> is connected.</li>
<li><strong>image</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>name of an image available in an rsync server
specified in the interconnect’s <code class="docutils literal notranslate"><span class="pre">pos_rsync_server</span></code> tag. Each
image is specified as <code class="docutils literal notranslate"><span class="pre">IMAGE:SPIN:VERSION:SUBVERSION:ARCH</span></code>, e.g:</p>
<ul>
<li>fedora:workstation:28::x86_64</li>
<li>clear:live:25550::x86_64</li>
<li>yocto:core-image-minimal:2.5.1::x86</li>
</ul>
<p>Note that you can specify a partial image name and the closest
match to it will be selected. From the previous example, asking
for <em>fedora</em> would auto select <em>fedora:workstation:28::x86_64</em>
assuming the target supports the <em>x86_64</em> target.</p>
</li>
<li><strong>boot_dev</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) which is the boot device to use,
where the boot loader needs to be installed in a boot
partition. e.g.: <code class="docutils literal notranslate"><span class="pre">sda</span></code> for <em>/dev/sda</em> or <code class="docutils literal notranslate"><span class="pre">mmcblk01</span></code> for
<em>/dev/mmcblk01</em>.</p>
<p>Defaults to the value of the <code class="docutils literal notranslate"><span class="pre">pos_boot_dev</span></code> tag.</p>
</li>
<li><strong>root_part_dev</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) which is the device to use
for the root partition. e.g: <code class="docutils literal notranslate"><span class="pre">mmcblk0p4</span></code> for
<em>/dev/mmcblk0p4</em> or <code class="docutils literal notranslate"><span class="pre">hda5</span></code> for <em>/dev/hda5</em>.</p>
<p>If not specified, the system will pick up one from all the
different root partitions that are available, trying to select
the one that has the most similar to what we are installing to
minimize the install time.</p>
</li>
<li><strong>extra_deploy_fns</strong> – <p>list of functions to call after the
image has been deployed. e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">deploy_linux_kernel</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">kws</span><span class="p">,</span> <span class="n">kernel_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
</pre></div>
</div>
<p>the function will be passed keywords which contain values found
out during this execution</p>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns str:</th><td class="field-body"><p class="first last">name of the image that was deployed (in case it was
guessed)</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>FIXME:</dt>
<dd><ul class="first last simple">
<li>increase in property bd.stats.client.sos_boot_failures and
bd.stats.client.sos_boot_count (to get a baseline)</li>
<li>tag bd.stats.last_reset to DATE</li>
</ul>
</dd>
</dl>
<p>Note: you might want the interconnect power cycled</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.pos.image_seed_match">
<code class="descclassname">tcfl.pos.</code><code class="descname">image_seed_match</code><span class="sig-paren">(</span><em>lp</em>, <em>goal</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.image_seed_match" title="Permalink to this definition">¶</a></dt>
<dd><p>Given two image/seed specifications, return the most similar one</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lp</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;part1&#39;</span><span class="p">:</span> <span class="s1">&#39;clear:live:25550::x86-64&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;part2&#39;</span><span class="p">:</span> <span class="s1">&#39;fedora:workstation:28::x86&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;part3&#39;</span><span class="p">:</span> <span class="s1">&#39;rtk::91&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;part4&#39;</span><span class="p">:</span> <span class="s1">&#39;rtk::90&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;part5&#39;</span><span class="p">:</span> <span class="s1">&#39;rtk::114&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_seed_match</span><span class="p">(</span><span class="n">lp</span><span class="p">,</span> <span class="s2">&quot;rtk::112&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="s1">&#39;part5&#39;</span><span class="p">,</span> <span class="mf">0.933333333333</span><span class="p">,</span> <span class="s1">&#39;rtk::114&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="tcfl.pos.deploy_tree">
<code class="descclassname">tcfl.pos.</code><code class="descname">deploy_tree</code><span class="sig-paren">(</span><em>_ic</em>, <em>target</em>, <em>_kws</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.deploy_tree" title="Permalink to this definition">¶</a></dt>
<dd><p>Rsync a local tree to the target after imaging</p>
<p>This is normally given to <a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-func docutils literal notranslate"><span class="pre">target.pos.deploy_image</span></code></a> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">deploy_tree_src</span> <span class="o">=</span> <span class="n">SOMELOCALLOCATION</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">deploy_image</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="n">IMAGENAME</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="n">extra_deploy_fns</span> <span class="o">=</span> <span class="p">[</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">deploy_linux_kernel</span> <span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="tcfl.pos.deploy_path">
<code class="descclassname">tcfl.pos.</code><code class="descname">deploy_path</code><span class="sig-paren">(</span><em>ic</em>, <em>target</em>, <em>_kws</em>, <em>cache=True</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.deploy_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Rsync a local tree to the target after imaging</p>
<p>This is normally given to <a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-func docutils literal notranslate"><span class="pre">target.pos.deploy_image</span></code></a> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">deploy_path_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;srcdir&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/collateral/movie.avi&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">deploy_path_dest</span> <span class="o">=</span> <span class="s2">&quot;/root&quot;</span>   <span class="c1"># optional,defaults to /</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">deploy_image</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="n">IMAGENAME</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="n">extra_deploy_fns</span> <span class="o">=</span> <span class="p">[</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">deploy_linux_kernel</span> <span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="tcfl.pos.tc_pos0_base">
<em class="property">class </em><code class="descclassname">tcfl.pos.</code><code class="descname">tc_pos0_base</code><span class="sig-paren">(</span><em>name</em>, <em>tc_file_path</em>, <em>origin</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.tc_pos0_base" title="Permalink to this definition">¶</a></dt>
<dd><p>A template for testcases that install an image in a target that
can be provisioned with Provisioning OS.</p>
<p>Unlike <a class="reference internal" href="#tcfl.pos.tc_pos_base" title="tcfl.pos.tc_pos_base"><code class="xref py py-class docutils literal notranslate"><span class="pre">tc_pos_base</span></code></a>, this class needs the targets being
declared and called <em>ic</em> and <em>target</em>, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tc</span><span class="o">.</span><span class="n">interconnect</span><span class="p">(</span><span class="s2">&quot;ipv4_addr&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s1">&#39;pos_capable&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">tc_pos0_base</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;echo Hello&#39;&#39; World&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Please refer to <a class="reference internal" href="#tcfl.pos.tc_pos_base" title="tcfl.pos.tc_pos_base"><code class="xref py py-class docutils literal notranslate"><span class="pre">tc_pos_base</span></code></a> for more information.</p>
<dl class="attribute">
<dt id="tcfl.pos.tc_pos0_base.image_requested">
<code class="descname">image_requested</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.pos.tc_pos0_base.image_requested" title="Permalink to this definition">¶</a></dt>
<dd><p>Image we want to install in the target</p>
<p>Note this can be specialized in a subclass such as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">tc_pos_base</span><span class="p">):</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">image_requested</span> <span class="o">=</span> <span class="s2">&quot;fedora:desktop:29&quot;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.pos.tc_pos0_base.image">
<code class="descname">image</code><em class="property"> = 'image-not-deployed'</em><a class="headerlink" href="#tcfl.pos.tc_pos0_base.image" title="Permalink to this definition">¶</a></dt>
<dd><p>Once the image was deployed, this will be set with the name of
the image that was selected.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.pos.tc_pos0_base.deploy_image_args">
<code class="descname">deploy_image_args</code><em class="property"> = {}</em><a class="headerlink" href="#tcfl.pos.tc_pos0_base.deploy_image_args" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.pos.tc_pos0_base.login_user">
<code class="descname">login_user</code><em class="property"> = 'root'</em><a class="headerlink" href="#tcfl.pos.tc_pos0_base.login_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Which user shall we login as</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.pos.tc_pos0_base.delay_login">
<code class="descname">delay_login</code><em class="property"> = 0</em><a class="headerlink" href="#tcfl.pos.tc_pos0_base.delay_login" title="Permalink to this definition">¶</a></dt>
<dd><p>How many seconds to delay before login in once the login prompt
is detected</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.pos.tc_pos0_base.deploy_50">
<code class="descname">deploy_50</code><span class="sig-paren">(</span><em>ic</em>, <em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.tc_pos0_base.deploy_50" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.pos.tc_pos0_base.start_50">
<code class="descname">start_50</code><span class="sig-paren">(</span><em>ic</em>, <em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.tc_pos0_base.start_50" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.pos.tc_pos0_base.teardown_50">
<code class="descname">teardown_50</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.tc_pos0_base.teardown_50" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.pos.tc_pos0_base.class_result">
<code class="descname">class_result</code><em class="property"> = 0 (0 0 0 0 0)</em><a class="headerlink" href="#tcfl.pos.tc_pos0_base.class_result" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.pos.tc_pos_base">
<em class="property">class </em><code class="descclassname">tcfl.pos.</code><code class="descname">tc_pos_base</code><span class="sig-paren">(</span><em>name</em>, <em>tc_file_path</em>, <em>origin</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.tc_pos_base" title="Permalink to this definition">¶</a></dt>
<dd><p>A template for testcases that install an image in a target that
can be provisioned with Provisioning OS.</p>
<p>This basic template deploys an image specified in the environment
variable <code class="docutils literal notranslate"><span class="pre">IMAGE</span></code> or in <em>self.requested_image</em>, power cycles into
it and waits for a prompt in the serial console.</p>
<p>This forcefully declares this testcase needs:</p>
<ul class="simple">
<li>a network that supports IPv4 (for provisioning over it)</li>
<li>a target that supports Provisioning OS</li>
</ul>
<p>if you want more control over said conditions, use
class:<cite>tc_pos0_base</cite>, for which the targets have to be
declared. Also, more knobs are available there.</p>
<p>To use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">tc_pos_base</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;echo Hello&#39;&#39; World&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>All the methods (deploy, start, teardown) defined in the class are
suffixed <code class="docutils literal notranslate"><span class="pre">_50</span></code>, so it is easy to do extra tasks before and
after.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">tc_pos_base</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">start_60</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ic</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>    <span class="c1"># we don&#39;t need the network after imaging</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;echo Hello&#39;&#39; World&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="tcfl.pos.tc_pos_base.class_result">
<code class="descname">class_result</code><em class="property"> = 0 (0 0 0 0 0)</em><a class="headerlink" href="#tcfl.pos.tc_pos_base.class_result" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.pos.cmdline_pos_capability_list">
<code class="descclassname">tcfl.pos.</code><code class="descname">cmdline_pos_capability_list</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.cmdline_pos_capability_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.pos.cmdline_setup">
<code class="descclassname">tcfl.pos.</code><code class="descname">cmdline_setup</code><span class="sig-paren">(</span><em>argsp</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos.cmdline_setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<span class="target" id="module-tcfl.pos_uefi"></span><div class="section" id="provisioning-os-bootloader-configuration-for-efi-systems">
<span id="pos-uefi"></span><h4>8.1.3.2. Provisioning OS: bootloader configuration for EFI systems<a class="headerlink" href="#provisioning-os-bootloader-configuration-for-efi-systems" title="Permalink to this headline">¶</a></h4>
<p>This module provides capabilities to configure the boot of a UEFI
system with the Provisioning OS.</p>
<p>One of the top level call is <a class="reference internal" href="#tcfl.pos_uefi.boot_config_multiroot" title="tcfl.pos_uefi.boot_config_multiroot"><code class="xref py py-func docutils literal notranslate"><span class="pre">boot_config_multiroot()</span></code></a> which is
called by <a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.pos.deploy_image</span></code></a> to configure the boot for a target
that just got an image deployed to it using the multiroot methodology.</p>
<dl class="function">
<dt id="tcfl.pos_uefi.boot_config_multiroot">
<code class="descclassname">tcfl.pos_uefi.</code><code class="descname">boot_config_multiroot</code><span class="sig-paren">(</span><em>target</em>, <em>boot_dev</em>, <em>image</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos_uefi.boot_config_multiroot" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure the target to boot using the multiroot</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.pos_uefi.boot_config_fix">
<code class="descclassname">tcfl.pos_uefi.</code><code class="descname">boot_config_fix</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos_uefi.boot_config_fix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<span class="target" id="module-tcfl.pos_multiroot"></span><div class="section" id="provisioning-os-partitioning-schema-for-multiple-root-fss-per-device">
<span id="pos-multiroot"></span><h4>8.1.3.3. Provisioning OS: partitioning schema for multiple root FSs per device<a class="headerlink" href="#provisioning-os-partitioning-schema-for-multiple-root-fss-per-device" title="Permalink to this headline">¶</a></h4>
<p>The Provisioning OS multiroot methodology partitions a system with
multiple root filesystems; different OSes are installed in each root
so it is fast to switch from one to another to run things in
automated fashion.</p>
<p>The key to the operation is that the server maintains a list of OS
images available to be rsynced to the target’s filesystem. rsync can
copy straight or transmit only the minimum set of needed changes.</p>
<p>This also speeds up deployment of an OS to the root filesystems, as by
picking a root filesystem that has already installed one similar to
the one to be deployed (eg: a workstation vs a server version), the
amount of data to be transfered is greatly reduced.</p>
<p>Like this, the following scenario sorted from more to less data
transfer (and thus slowest to fastest operation):</p>
<ul class="simple">
<li>can install on an empty root filesystem: in this case a full
installation is done</li>
<li>can refresh an existing root fileystem to the destination: some
things might be shared or the same and a partial transfer can be
done; this might be the case when:<ul>
<li>moving from a distro to another</li>
<li>moving from one version to another of the same distro</li>
<li>moving from one spin of one distro to another</li>
</ul>
</li>
<li>can update an existing root filesystem: in this case very little
change is done and we are just verifying nothing was unduly
modified.</li>
</ul>
<div class="section" id="partition-size-specification">
<span id="pos-multiroot-partsizes"></span><h5>8.1.3.3.1. Partition Size specification<a class="headerlink" href="#partition-size-specification" title="Permalink to this headline">¶</a></h5>
<p>To simplify setup of targets, a string such as <em>“1:4:10:50”</em> is given
to denote the sizes of the different partitions:</p>
<ul class="simple">
<li>1 GiB for /boot</li>
<li>4 GiB for swap</li>
<li>10 GiB for scratch (can be used for whatever the script wants, needs
to be formated/initialized before use)</li>
<li>50 GiB for multiple root partitions (until the disk size is exhausted)</li>
</ul>
<dl class="function">
<dt id="tcfl.pos_multiroot.mount_fs">
<code class="descclassname">tcfl.pos_multiroot.</code><code class="descname">mount_fs</code><span class="sig-paren">(</span><em>target</em>, <em>image</em>, <em>boot_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.pos_multiroot.mount_fs" title="Permalink to this definition">¶</a></dt>
<dd><p>Boots a root filesystem on /mnt</p>
<p>The partition used as a root filesystem is picked up based on the
image that is going to be installed; we look for one that has the
most similar image already installed and pick that.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">name of the root partition device</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
</div>
<div class="section" id="module-tcfl.target_ext_buttons">
<span id="other-target-interfaces"></span><h3>8.1.4. Other target interfaces<a class="headerlink" href="#module-tcfl.target_ext_buttons" title="Permalink to this headline">¶</a></h3>
<div class="section" id="press-and-release-buttons-in-the-target">
<h4>8.1.4.1. Press and release buttons in the target<a class="headerlink" href="#press-and-release-buttons-in-the-target" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="tcfl.target_ext_buttons.extension">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_buttons.</code><code class="descname">extension</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_buttons.extension" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> to manipulate buttons
connected to the target.</p>
<p>Buttons can be pressed, released or a sequence of them (eg: press
button1, release button2, wait 0.25s, press button 2, wait 1s
release button1).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">buttons</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="s1">&#39;button1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="s1">&#39;button2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">sequence</span><span class="p">([</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span> <span class="s1">&#39;button1&#39;</span><span class="p">,</span> <span class="s1">&#39;press&#39;</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span> <span class="s1">&#39;button2&#39;</span><span class="p">,</span> <span class="s1">&#39;release&#39;</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span> <span class="s1">&#39;wait 1&#39;</span><span class="p">,</span> <span class="mf">0.25</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span> <span class="s1">&#39;button2&#39;</span><span class="p">,</span> <span class="s1">&#39;press&#39;</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span> <span class="s1">&#39;wait 2&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span> <span class="s1">&#39;button1&#39;</span><span class="p">,</span> <span class="s1">&#39;release&#39;</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">])</span>
</pre></div>
</div>
<p>Note that for this interface to work, the target has to expose a
buttons interface and expose said buttons (list them). You can use
the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf button-list TARGETNAME
</pre></div>
</div>
<p>to find the buttons available to a targert and use
<code class="docutils literal notranslate"><span class="pre">button-press</span></code>, <code class="docutils literal notranslate"><span class="pre">button-release</span></code> and <code class="docutils literal notranslate"><span class="pre">button-click</span></code> to
manipulate from the command line.</p>
<dl class="method">
<dt id="tcfl.target_ext_buttons.extension.press">
<code class="descname">press</code><span class="sig-paren">(</span><em>button_name</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_buttons.extension.press" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_buttons.extension.release">
<code class="descname">release</code><span class="sig-paren">(</span><em>button_name</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_buttons.extension.release" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_buttons.extension.sequence">
<code class="descname">sequence</code><span class="sig-paren">(</span><em>sequence</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_buttons.extension.sequence" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_buttons.extension.click">
<code class="descname">click</code><span class="sig-paren">(</span><em>button_name</em>, <em>duration=0.25</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_buttons.extension.click" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_buttons.extension.double_click">
<code class="descname">double_click</code><span class="sig-paren">(</span><em>button_name</em>, <em>duration_click=0.25</em>, <em>duration_release=0.25</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_buttons.extension.double_click" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_buttons.extension.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_buttons.extension.list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<span class="target" id="module-tcfl.target_ext_capture"></span><div class="section" id="capture-snapshots-or-streams-of-target-data-such-as-screenshots-audio-video-network-etc">
<h4>8.1.4.2. Capture snapshots or streams of target data, such as screenshots, audio, video, network, etc<a class="headerlink" href="#capture-snapshots-or-streams-of-target-data-such-as-screenshots-audio-video-network-etc" title="Permalink to this headline">¶</a></h4>
<p>The capture interface allows to capture screenshots, audio and video
streams, network traffic, etc.</p>
<p>This provides an abstract interface to access it as well as means to
wait for things to be found when such captures, such as images on screenshots.</p>
<dl class="class">
<dt id="tcfl.target_ext_capture.extension">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_capture.</code><code class="descname">extension</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_capture.extension" title="Permalink to this definition">¶</a></dt>
<dd><p>When a target supports the <em>capture</em> interface, it’s
<em>tcfl.tc.target_c</em> object will expose <em>target.capture</em> where the
following calls can be made to capture data from it.</p>
<p>A streaming capturer will start capturing when <a class="reference internal" href="#tcfl.target_ext_capture.extension.start" title="tcfl.target_ext_capture.extension.start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">start()</span></code></a> is
called and stop when <a class="reference internal" href="#tcfl.target_ext_capture.extension.stop_and_get" title="tcfl.target_ext_capture.extension.stop_and_get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">stop_and_get()</span></code></a> is called, bringing the
capture file from the server to the machine executing <em>tcf run</em>.</p>
<p>A non streaming capturer just takes a snapshot when <a class="reference internal" href="#tcfl.target_ext_capture.extension.get" title="tcfl.target_ext_capture.extension.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a>
is called.</p>
<p>You can find available capturers with <a class="reference internal" href="#tcfl.target_ext_capture.extension.list" title="tcfl.target_ext_capture.extension.list"><code class="xref py py-meth docutils literal notranslate"><span class="pre">list()</span></code></a> or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf capture-list TARGETNAME
vnc0:ready
screen:ready
video1:not-capturing
video0:ready
</pre></div>
</div>
<p>a <em>ready</em> capturer is capable of taking screenshots only</p>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list TARGETNAME | grep capture:
  capture: vnc0 screen video1 video0
</pre></div>
</div>
<dl class="method">
<dt id="tcfl.target_ext_capture.extension.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>capturer</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_capture.extension.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start capturing the stream with capturer <em>capturer</em></p>
<p>(if this is not an streaming capturer, nothing happens)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s2">&quot;screen_stream&quot;</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>capturer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – capturer to use, as listed in the
target’s <em>capture</em></td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">dictionary of values passed by the server</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_capture.extension.stop_and_get">
<code class="descname">stop_and_get</code><span class="sig-paren">(</span><em>capturer</em>, <em>local_filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_capture.extension.stop_and_get" title="Permalink to this definition">¶</a></dt>
<dd><p>If this is a streaming capturer, stop streaming and return the
captured data or if no streaming, take a snapshot and return it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">stop_and_get</span><span class="p">(</span><span class="s2">&quot;screen_stream&quot;</span><span class="p">,</span> <span class="s2">&quot;file.avi&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;screen&quot;</span><span class="p">,</span> <span class="s2">&quot;file.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">network</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tcpdump&quot;</span><span class="p">,</span> <span class="s2">&quot;file.pcap&quot;</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>capturer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – capturer to use, as listed in the
target’s <em>capture</em></li>
<li><strong>local_filename</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – file to which to write the capture.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">dictionary of values passed by the server</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_capture.extension.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><em>capturer</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_capture.extension.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>If this is a streaming capturer, stop streaming and discard
the captured content.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="s2">&quot;screen_stream&quot;</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>capturer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – capturer to use, as listed in the
target’s <em>capture</em></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_capture.extension.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>capturer</em>, <em>local_filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_capture.extension.get" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the same <a class="reference internal" href="#tcfl.target_ext_capture.extension.stop_and_get" title="tcfl.target_ext_capture.extension.stop_and_get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">stop_and_get()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_capture.extension.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_capture.extension.list" title="Permalink to this definition">¶</a></dt>
<dd><p>List capturers available for this target.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">r</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s1">&#39;screen&#39;</span><span class="p">:</span> <span class="s1">&#39;ready&#39;</span><span class="p">,</span> <span class="s1">&#39;audio&#39;</span><span class="p">:</span> <span class="s1">&#39;not-capturing&#39;</span><span class="p">,</span> <span class="s1">&#39;screen_stream&#39;</span><span class="p">:</span> <span class="s1">&#39;capturing&#39;</span><span class="p">}</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dictionary of capturers and their state</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_capture.extension.image_on_screenshot">
<code class="descname">image_on_screenshot</code><span class="sig-paren">(</span><em>template_image_filename</em>, <em>capturer='screen'</em>, <em>in_area=None</em>, <em>merge_similar=0.7</em>, <em>min_width=30</em>, <em>min_height=30</em>, <em>poll_period=3</em>, <em>timeout=130</em>, <em>raise_on_timeout=&lt;class 'tcfl.tc.error_e'&gt;</em>, <em>raise_on_found=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_capture.extension.image_on_screenshot" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an object that finds an image/template in an
screenshot from the target.</p>
<p>This object is then given to <a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a> to
poll for screenshot until the image is detected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">target</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">image_on_screenshot</span><span class="p">(</span><span class="s1">&#39;icon1.png&#39;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">target</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">image_on_screenshot</span><span class="p">(</span><span class="s1">&#39;icon2.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>upon return, <em>r</em> is a dictionary with the detection
information for each icon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;icon1.png&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="mf">1.0</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span> <span class="mf">0.949</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.968</span><span class="p">,</span> <span class="mf">0.0312</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># relative (X0, Y0) to (X1, Y1)</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span> <span class="mi">972</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">992</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># absolute (X0, Y0) to (X1, Y1)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="mf">0.957</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span> <span class="mf">0.948</span><span class="p">,</span> <span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.969</span><span class="p">,</span> <span class="mf">0.031</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span> <span class="mi">971</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">992</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;icon2.png&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="mf">0.915</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span><span class="mf">0.948</span><span class="p">,</span> <span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.970</span><span class="p">,</span> <span class="mf">0.032</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span><span class="mi">971</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">993</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">}</span>
</pre></div>
</div>
<p>This detector’s return values for reach icon are a list of
squares where the template was found. On each entry we get a
list of:</p>
<ul class="simple">
<li>the scale of the template</li>
<li>a square in resolution-independent coordinates; (0,0) being
the top left corner, (1, 1) bottom right corner)</li>
<li>a square in the screen’s capture resolution; (0,0) being the
top left corner.</li>
</ul>
<p>the detector will also produce collateral in the form of
screenshots with annotations where the icons were found, named
as <em>report-[RUNID]:HASHID.NN[.LABEL].detected.png</em>, where <em>NN</em>
is a monotonically increasing number, read more for
<a class="reference internal" href="02-guides.html#tcf-run-runid"><span class="std std-ref">RUNID</span></a>, and ref:<cite>HASHID &lt;tc_id&gt;</cite>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>template_image_filename</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>name of the file that
contains the image that we will look for in the
screenshot. This can be in jpeg, png, gif and other
formats.</p>
<p>If the filename is relative, it is considered to
be relative to the file the contains the source file that
calls this function.</p>
</li>
<li><strong>capturer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional, default <em>screen</em>) where to capture
the screenshot from; this has to be a capture output that supports
screenshots in a graphical formatr (PNG, JPEG, etc), eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf capture-list nuc-01A
...
hdmi0_screenshot:snapshot:image/png:ready
screen:snapshot:image/png:ready
...
</pre></div>
</div>
<p>any of these two could be used; <em>screen</em> is taken as a default
that any target with graphic capture capabilities will provide
as a convention.</p>
</li>
<li><strong>in_area</strong> – <p>(optional) bounding box defining a square where
the image/template has to be found for it to be considered; it is
a very basic mask.</p>
<p>The format is <em>(X0, Y0, X1, Y1)</em>, where all numbers are floats
from 0 to 1. <em>(0, 0)</em> is the top left corner, <em>(1, 1)</em> the bottom
right corner. Eg:</p>
<ul>
<li><em>(0, 0,  0.5, 0.5)</em> the top left 1/4th of the screen</li>
<li><em>(0, 0.5, 1, 1)</em> the bottom half of the screen</li>
<li><em>(0.5, 0, 1, 1)</em> the right half of the screen</li>
<li><dl class="first docutils">
<dt><em>(0.95, 0, 1, 0.05)</em> a square with 5% side on the top right</dt>
<dd>corner of the screen</dd>
</dl>
</li>
</ul>
</li>
<li><strong>merge_similar</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – <p>(default 0.7) value from 0 to 1
that indicates how much we consider two detections similar
and we merge them into a single one.</p>
<p>0 means two detections don’t overlap at all, 1 means two
detections have to be exatly the same. 0.85 would mean that
the two detections overlap on 85% of the surface.</p>
</li>
<li><strong>min_width</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional, default 30) minimum width of
the template when scaling.</li>
<li><strong>min_height</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional, default 30) minimum height of
the template when scaling.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The rest of the arguments are described in
<a class="reference internal" href="#tcfl.tc.expectation_c" title="tcfl.tc.expectation_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.expectation_c</span></code></a>.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.target_ext_capture.cmdline_setup">
<code class="descclassname">tcfl.target_ext_capture.</code><code class="descname">cmdline_setup</code><span class="sig-paren">(</span><em>argsp</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_capture.cmdline_setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<span class="target" id="module-tcfl.target_ext_console"></span><div class="section" id="raw-access-to-the-target-s-serial-consoles">
<h4>8.1.4.3. Raw access to the target’s serial consoles<a class="headerlink" href="#raw-access-to-the-target-s-serial-consoles" title="Permalink to this headline">¶</a></h4>
<p>This exposes APIs to interface with the target’s serial consoles and
the hookups for accessing them form the command line.</p>
<dl class="class">
<dt id="tcfl.target_ext_console.expect_text_on_console_c">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_console.</code><code class="descname">expect_text_on_console_c</code><span class="sig-paren">(</span><em>text_or_regex</em>, <em>console=None</em>, <em>poll_period=0.25</em>, <em>timeout=30</em>, <em>previous_max=4096</em>, <em>raise_on_timeout=&lt;class 'tcfl.tc.failed_e'&gt;</em>, <em>raise_on_found=None</em>, <em>name=None</em>, <em>target=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.expect_text_on_console_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Object that expects to find a string or regex in a target’s
serial console.</p>
<p>See parameter description in builder <code class="xref py py-meth docutils literal notranslate"><span class="pre">console.expect_text()</span></code>,
as this is meant to be used with the expecter engine,
<a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a>.</p>
<dl class="attribute">
<dt id="tcfl.target_ext_console.expect_text_on_console_c.console">
<code class="descname">console</code><a class="headerlink" href="#tcfl.target_ext_console.expect_text_on_console_c.console" title="Permalink to this definition">¶</a></dt>
<dd><p>Console this expectation is attached to</p>
<p>Note that if initialized with the default console, we’ll
always resolve which one is it–since it is needed to keep
track of where to store things.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.target_ext_console.expect_text_on_console_c.max_size">
<code class="descname">max_size</code><em class="property"> = 65536</em><a class="headerlink" href="#tcfl.target_ext_console.expect_text_on_console_c.max_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum amount of bytes to read on each read iteration in
<a class="reference internal" href="#tcfl.target_ext_console.expect_text_on_console_c.poll" title="tcfl.target_ext_console.expect_text_on_console_c.poll"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll()</span></code></a>; this is so that if a (broken) target is spewing
gigabytes of data, we don’t get stuck here just reading from it.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.expect_text_on_console_c.poll_context">
<code class="descname">poll_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.expect_text_on_console_c.poll_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a string that uniquely identifies the polling source for
this expectation so multiple expectations that are polling
from the same place don’t poll repeatedly.</p>
<p>For example, if we are looking for multiple image templates in
a screenshot, it does not make sense to take one screenshot
per image. It can take one screenshot and look for the images
in the same place.</p>
<p>Thus:</p>
<ul>
<li><p class="first">if we are polling from target with role <em>target.want_name</em>
from it’s screen capturer called <em>VGA</em>, our context becomes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">want_name</span><span class="p">,</span> <span class="s2">&quot;VGA&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>so it follows that for a generic expectation from a
screenshot capturer stored in <em>self.capturer</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">want_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">capturer</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">for a serial console, it would become:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">want_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">console_name</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.expect_text_on_console_c.poll">
<code class="descname">poll</code><span class="sig-paren">(</span><em>testcase</em>, <em>run_name</em>, <em>_buffers_poll</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.expect_text_on_console_c.poll" title="Permalink to this definition">¶</a></dt>
<dd><p>Poll a given expectation for new data from their data source</p>
<p>The expect engine will call this from
<a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a> periodically to get data where to
detect what we are expecting. This data could be serial
console output, video output, screenshots, network data,
anything.</p>
<p>The implementation of this interface will store the data
(append, replace, depending on the nature of it) in
<em>buffers_poll</em>.</p>
<p>For example, a serial console reader might read from the
serial console and append to a file; a screenshot capturer
might capture the screenshot and put it in a file and make the
file name available in <em>buffers_poll[‘filename’]</em>.</p>
<p>Note that when we are working with multiple expectations, if a
number of them share the same data source (as determined by
<a class="reference internal" href="#tcfl.target_ext_console.expect_text_on_console_c.poll_context" title="tcfl.target_ext_console.expect_text_on_console_c.poll_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll_context()</span></code></a>), only one poll per each will be done and
they will be expected to share the polled data stored in
<em>buffers_poll</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>testcase</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – testcase for which we are
polling.</li>
<li><strong>run_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of this run of
<a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a>–they are always different.</li>
<li><strong>buffers_poll</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary where we can store state
for this poll so it can be shared between calls. Detection
methods that use the same poling source (as given by
<a class="reference internal" href="#tcfl.target_ext_console.expect_text_on_console_c.poll_context" title="tcfl.target_ext_console.expect_text_on_console_c.poll_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll_context()</span></code></a>) will all be given the same storage
space.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.expect_text_on_console_c.detect">
<code class="descname">detect</code><span class="sig-paren">(</span><em>testcase</em>, <em>run_name</em>, <em>_buffers_poll</em>, <em>buffers</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.expect_text_on_console_c.detect" title="Permalink to this definition">¶</a></dt>
<dd><p>See <code class="xref py py-meth docutils literal notranslate"><span class="pre">expectation_c.detect()</span></code> for reference on the arguments</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dictionary of data describing the match, including
an interator over the console output</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.expect_text_on_console_c.on_timeout">
<code class="descname">on_timeout</code><span class="sig-paren">(</span><em>run_name</em>, <em>poll_context</em>, <em>ellapsed</em>, <em>timeout</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.expect_text_on_console_c.on_timeout" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an action when the expectation times out being found</p>
<p>Called by the innards of the expec engine when the expectation
times out; by default, raises a generic exception (as
specified during the expectation’s creation); can be overriden
to offer a more specific message, etc.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.expect_text_on_console_c.flush">
<code class="descname">flush</code><span class="sig-paren">(</span><em>testcase</em>, <em>run_name</em>, <em>buffers_poll</em>, <em>buffers</em>, <em>results</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.expect_text_on_console_c.flush" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate collateral for this expectation</p>
<p>This is called by <a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a> when all the
expectations are completed and can be used to for example, add
marks to an image indicating where a template or icon was
detected.</p>
<p>Note different expectations might be creating collateral from
the same source, on which case you need to pile on (eg: adding
multiple detectio marks to the same image)</p>
<p>Collateral files shall be generated with name
<a class="reference internal" href="#tcfl.tc.tc_c.report_file_prefix" title="tcfl.tc.tc_c.report_file_prefix"><code class="xref py py-data docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.report_file_prefix</span></code></a> such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">collateral_filename</span> <span class="o">=</span> <span class="n">testcase</span><span class="o">.</span><span class="n">report_file_prefix</span> <span class="o">+</span> <span class="s2">&quot;something&quot;</span>
</pre></div>
</div>
<p>will generate filename <cite>report-RUNID:HASHID.something</cite>; thus,
when multiple testcases are executed in parallel, they will
not override each other’s collateral.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>testcase</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – testcase for which we are
detecting.</li>
<li><strong>run_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of this run of
<a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a>–they are always different.</li>
<li><strong>buffers_poll</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary where the polled data has
is available. Note Detection methods that use the same
poling source (as given by <a class="reference internal" href="#tcfl.target_ext_console.expect_text_on_console_c.poll_context" title="tcfl.target_ext_console.expect_text_on_console_c.poll_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll_context()</span></code></a>) will all be
given the same storage space. as per <a class="reference internal" href="#tcfl.target_ext_console.expect_text_on_console_c.poll" title="tcfl.target_ext_console.expect_text_on_console_c.poll"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poll()</span></code></a> above.</li>
<li><strong>buffers</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary available exclusively to this
expectation object to keep data from run to run. This was
used by <a class="reference internal" href="#tcfl.target_ext_console.expect_text_on_console_c.detect" title="tcfl.target_ext_console.expect_text_on_console_c.detect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">detect()</span></code></a> to store data needed during the
detection process.</li>
<li><strong>results</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of results generated by
<a class="reference internal" href="#tcfl.target_ext_console.expect_text_on_console_c.detect" title="tcfl.target_ext_console.expect_text_on_console_c.detect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">detect()</span></code></a> as a result of the detection process.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.target_ext_console.extension">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_console.</code><code class="descname">extension</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> to run methods from the console
management interface to TTBD targets.</p>
<p>Use as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
<p>Consoles might be disabled (because for example, the targer has to
be on some network for them to be enabled; you can get console
specific parameters with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">setup_get</span><span class="p">()</span>
</pre></div>
</div>
<p>You can set them up (and these are implementation specific:)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">CONSOLENAME</span><span class="p">,</span> <span class="n">param1</span> <span class="o">=</span> <span class="n">val1</span><span class="p">,</span> <span class="n">param2</span> <span class="o">=</span> <span class="n">val2</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Once setup and ready to enable/disable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
</pre></div>
</div>
<p>You can set the default console with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">NAME</span>
</pre></div>
</div>
<p>A common pattern is for a system to boot up using a serial console
and once it is up, SSH is started and the default console is
switched to an SSH based console, faster and more reliable.</p>
<p>The targets are supposed to declare the following consoles:</p>
<ul class="simple">
<li><em>default</em>: the one we use by default</li>
<li><em>preferred</em> (optional): the one to switch for once done booting,
but might console-specific need setup (like SSH server starting,
etc)</li>
</ul>
<p>When the console is set to another default, the property
<em>console-default</em> will reflect that. It will be reset upon power-on.</p>
<dl class="attribute">
<dt id="tcfl.target_ext_console.extension.default">
<code class="descname">default</code><a class="headerlink" href="#tcfl.target_ext_console.extension.default" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the default console</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.select_preferred">
<code class="descname">select_preferred</code><span class="sig-paren">(</span><em>console=None</em>, <em>shell_setup=True</em>, <em>**console_setup_kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.select_preferred" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup, enable and switch as default to the preferred console</p>
<p>If the target declares a preferred console, then switching to
it after setting up whatever is needed (eg: SSH daemons in the
target, etc, paramters in the console) usually yields a faster
and more reliable console.</p>
<p>If there is no <em>preferred</em> console, then this doesn’t change
anything.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console name to make preferred;
default to whatever the target declares (by maybe exporting a
console called <em>preferred</em>).</li>
<li><strong>shell_setup</strong> – <p>(optional, default) setup the shell
up by disabling command line editing (makes it easier for
the automation) and set up hooks that will raise an
exception if a shell command fails.</p>
<p>By default calls target.shell.setup(); if <em>False</em>, nothing
will be called. No arguments are passed, the function needs
to operate on the default console.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The rest of the arguments are passed verbatim to
<a class="reference internal" href="#tcfl.target_ext_console.extension.setup" title="tcfl.target_ext_console.extension.setup"><code class="xref py py-func docutils literal notranslate"><span class="pre">target.console.setup</span></code></a> to setup the
console and are thus console specific.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.enable">
<code class="descname">enable</code><span class="sig-paren">(</span><em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable a console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to enable; if missing,
the default one.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.disable">
<code class="descname">disable</code><span class="sig-paren">(</span><em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable a console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to disable; if missing,
the default one.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.state">
<code class="descname">state</code><span class="sig-paren">(</span><em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.state" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the given console’s state</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to enable; if missing,
the default one</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><em>True</em> if enabled, <em>False</em> otherwise</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.setup">
<code class="descname">setup</code><span class="sig-paren">(</span><em>console</em>, <em>**parameters</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup console’s parameters</p>
<p>If no parameters are given, reset to defaults.</p>
<p>List of current parameters can be obtained with <a class="reference internal" href="#tcfl.target_ext_console.extension.setup_get" title="tcfl.target_ext_console.extension.setup_get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup_get()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.setup_get">
<code class="descname">setup_get</code><span class="sig-paren">(</span><em>console</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.setup_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary with current parameters.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.read">
<code class="descname">read</code><span class="sig-paren">(</span><em>console=None</em>, <em>offset=0</em>, <em>max_size=0</em>, <em>fd=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read data received on the target’s console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to read from</li>
<li><strong>offset</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) offset to read from (defaults to zero)</li>
<li><strong>fd</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) file descriptor to which to write
the output (in which case, it returns the bytes read).</li>
<li><strong>max_size</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) if <em>fd</em> is given, maximum
amount of data to read</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">data read (or if written to a file descriptor,
amount of bytes read)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.read_full">
<code class="descname">read_full</code><span class="sig-paren">(</span><em>console=None</em>, <em>offset=0</em>, <em>max_size=0</em>, <em>fd=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.read_full" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#tcfl.target_ext_console.extension.read" title="tcfl.target_ext_console.extension.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code></a>, reads data received on the target’s console
returning also the stream generation and offset at which to
read the next time to get new data.</p>
<p>Stream generation is a monotonically increasing number that
is incrased every time the target is power cycled.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to read from</li>
<li><strong>offset</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) offset to read from (defaults to
zero)</li>
<li><strong>fd</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) file descriptor to which to write
the output (in which case, it returns the bytes read).</li>
<li><strong>max_size</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) if <em>fd</em> is given, maximum
amount of data to read</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>tuple consisting of:
- stream generation
- stream size after reading
- data read (or if written to a file descriptor,</p>
<blockquote>
<div><p>amount of bytes read)</p>
</div></blockquote>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.size">
<code class="descname">size</code><span class="sig-paren">(</span><em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the amount of bytes so far read from the console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to read from</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>data</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write data to a console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> – data to write (string or bytes)</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to write to</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.capture_filename">
<code class="descname">capture_filename</code><span class="sig-paren">(</span><em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.capture_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the name of the file where this console is being captured to</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.text_capture_file">
<code class="descname">text_capture_file</code><span class="sig-paren">(</span><em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.text_capture_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a descriptor to the file where this console is being
captured to</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.text_poll_context">
<code class="descname">text_poll_context</code><span class="sig-paren">(</span><em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.text_poll_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the polling context that will be associated with a
target’s console.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console name or take default</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.text">
<code class="descname">text</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.text" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an object to expect a string or regex in this target’s
console. This can be fed to <a class="reference internal" href="#tcfl.tc.tc_c.expect" title="tcfl.tc.tc_c.expect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.expect()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;DONE.*$&quot;</span><span class="p">),</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>or for leaving it permanently installed as a hook to, eg,
raise an exception if a non-wanted string is found:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">testcase</span><span class="o">.</span><span class="n">expect_global_append</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;Kernel Panic&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">timeout</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">poll_period</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">raise_on_found</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">error_e</span><span class="p">(</span><span class="s2">&quot;kernel panicked&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>text_or_regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – string to find; this can also be a
regular expression.</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the target’s console from
which we are to read. Defaults to the default console.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>(other parameters are the same as described in
<a class="reference internal" href="#tcfl.tc.expectation_c" title="tcfl.tc.expectation_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.expectation_c</span></code></a>.)</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.capture_iterator">
<code class="descname">capture_iterator</code><span class="sig-paren">(</span><em>console</em>, <em>offset_from=0</em>, <em>offset_to=0</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.capture_iterator" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over the captured contents of the console</p>
<p><a class="reference internal" href="#tcfl.target_ext_console.expect_text_on_console_c.poll" title="tcfl.target_ext_console.expect_text_on_console_c.poll"><code class="xref py py-class docutils literal notranslate"><span class="pre">expect_text_on_console_c.poll</span></code></a> has created a file
where it has written all the contents read from the console;
this function is a generator that iterates over it, yielding
safe UTF-8 strings.</p>
<p>Note these are not reseteable, so to use in
attachments with multiple report drivers, use instead a
:meth:generator_factory.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of console on which to operate</li>
<li><strong>offset_from</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) offset where to start
(default from beginning)</li>
<li><strong>offset_to</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) offset where to finish
(default to end)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.extension.generator_factory">
<code class="descname">generator_factory</code><span class="sig-paren">(</span><em>console</em>, <em>offset_from=0</em>, <em>offset_to=0</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.extension.generator_factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a generator factory that creates iterators to dump
console’s received data</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of console on which to operate</li>
<li><strong>offset_from</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) offset where to start
(default from beginning)</li>
<li><strong>offset_to</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) offset where to finish
(default to end)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.target_ext_console.f_write_retry_eagain">
<code class="descclassname">tcfl.target_ext_console.</code><code class="descname">f_write_retry_eagain</code><span class="sig-paren">(</span><em>fd</em>, <em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.f_write_retry_eagain" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<span class="target" id="module-tcfl.target_ext_debug"></span><div class="section" id="access-target-s-debugging-capabilities">
<h4>8.1.4.4. Access target’s debugging capabilities<a class="headerlink" href="#access-target-s-debugging-capabilities" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="tcfl.target_ext_debug.extension">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_debug.</code><code class="descname">extension</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.extension" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> to run methods form the debug
<a class="reference internal" href="#module-ttbl.debug" title="ttbl.debug"><code class="xref py py-mod docutils literal notranslate"><span class="pre">interface</span></code></a> to targets.</p>
<p>Use as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">halt</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">reset_halt</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span>
</pre></div>
</div>
<p>etc …</p>
<dl class="method">
<dt id="tcfl.target_ext_debug.extension.list">
<code class="descname">list</code><span class="sig-paren">(</span><em>components=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.extension.list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a debugging information about each component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>components</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – (optional) list of subcomponents
for which to report the information (default all)</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns dict:</th><td class="field-body"><p class="first">dictionary keyed by components describing each
components debugging status and other information
information.</p>
<p class="last">If a component’s value is <em>None</em>, debugging is not started
for that component. Otherwise the dictionary will include
values keyed by string that are implementation specific,
with the common ones documented in
<a class="reference internal" href="#ttbl.debug.impl_c.debug_list" title="ttbl.debug.impl_c.debug_list"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ttbl.debug.impl_c.debug_list()</span></code></a>.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.extension.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>components=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.extension.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start debugging support on the target or individual components</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
<p>If called before powering on, the target will wait for the
debugger to connect before starting the kernel (when
possible).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>components</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – (optional) list of components
whose debugging support shall start (defaults to all)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.extension.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><em>components=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.extension.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop debugging support on the target</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>components</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – (optional) list of components
whose debugging support shall stop (defaults to all)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.extension.halt">
<code class="descname">halt</code><span class="sig-paren">(</span><em>components=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.extension.halt" title="Permalink to this definition">¶</a></dt>
<dd><p>Halt the target’s CPUs</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>components</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – (optional) list of components
where to operate (defaults to all)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.extension.reset">
<code class="descname">reset</code><span class="sig-paren">(</span><em>components=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.extension.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the target’s CPUs</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>components</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – (optional) list of components
where to operate (defaults to all)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.extension.reset_halt">
<code class="descname">reset_halt</code><span class="sig-paren">(</span><em>components=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.extension.reset_halt" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset and halt the target’s CPUs</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>components</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – (optional) list of components
where to operate (defaults to all)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.extension.resume">
<code class="descname">resume</code><span class="sig-paren">(</span><em>components=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.extension.resume" title="Permalink to this definition">¶</a></dt>
<dd><p>Resume the target’s CPUs</p>
<p>This is called to instruct the target to resume execution,
following any kind of breakpoint or stop that halted it.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>components</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – (optional) list of components
where to operate (defaults to all)</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-tcfl.target_ext_fastboot"></span><div class="section" id="flash-the-target-with-fastboot">
<h4>8.1.4.5. Flash the target with fastboot<a class="headerlink" href="#flash-the-target-with-fastboot" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="tcfl.target_ext_fastboot.extension">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_fastboot.</code><code class="descname">extension</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_fastboot.extension" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> to run fastboot commands
on the target via the server.</p>
<p>Use <a class="reference internal" href="#tcfl.target_ext_fastboot.extension.run" title="tcfl.target_ext_fastboot.extension.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">run()</span></code></a> to execute a command on the target:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">fastboot</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;flash_pos&quot;</span><span class="p">,</span> <span class="s2">&quot;partition_boot&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                    <span class="s2">&quot;/home/ttbd/partition_boot.pos.img&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>a target with the example configuration described in
<a class="reference internal" href="#ttbl.fastboot.interface" title="ttbl.fastboot.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.fastboot.interface</span></code></a> would run the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fastboot -s SERIAL flash partition_boot /home/ttbd/partition_boot.pos.img
</pre></div>
</div>
<p>on the target.</p>
<p>Note that which fastboot commands are allowed in the target is
meant to be severily restricted via target-specific configuration
to avoid compromising the system’s security without compromising
flexibility.</p>
<p>You can list allowed fastboot commands with (from the example above):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf fastboot-list TARGETNAME
flash: flash partition_boot ^(.+)$
flash_pos: flash_pos partition_boot /home/ttbd/partition_boot.pos.img
</pre></div>
</div>
<dl class="method">
<dt id="tcfl.target_ext_fastboot.extension.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>command_name</em>, <em>*args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_fastboot.extension.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_fastboot.extension.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_fastboot.extension.list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<span class="target" id="module-tcfl.target_ext_images"></span><div class="section" id="flash-the-target-with-jtags-and-other-mechanism">
<h4>8.1.4.6. Flash the target with JTAGs and other mechanism<a class="headerlink" href="#flash-the-target-with-jtags-and-other-mechanism" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="tcfl.target_ext_images.extension">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_images.</code><code class="descname">extension</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_images.extension" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> to run methods from the
image management interface to TTBD targets.</p>
<p>Use as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</pre></div>
</div>
<p>Presence of the <em>images</em> attribute in a target indicates imaging
is supported by it.</p>
<dl class="attribute">
<dt id="tcfl.target_ext_images.extension.retries">
<code class="descname">retries</code><em class="property"> = 4</em><a class="headerlink" href="#tcfl.target_ext_images.extension.retries" title="Permalink to this definition">¶</a></dt>
<dd><p>When a deployment fails, how many times can we retry before
failing</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.target_ext_images.extension.wait">
<code class="descname">wait</code><em class="property"> = 4</em><a class="headerlink" href="#tcfl.target_ext_images.extension.wait" title="Permalink to this definition">¶</a></dt>
<dd><p>When power cycling a target to retry a flashing operation, how
much many seconds do we wait before powering on</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_images.extension.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_images.extension.list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of image types that can be flashed in this target</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_images.extension.flash">
<code class="descname">flash</code><span class="sig-paren">(</span><em>images</em>, <em>upload=True</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_images.extension.flash" title="Permalink to this definition">¶</a></dt>
<dd><p>Flash images onto target</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">flash</span><span class="p">({</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel-86&quot;</span><span class="p">:</span> <span class="s2">&quot;/tmp/file.bin&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel-arc&quot;</span><span class="p">:</span> <span class="s2">&quot;/tmp/file2.bin&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">},</span> <span class="n">upload</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">flash</span><span class="p">({</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;vmlinuz&quot;</span><span class="p">:</span> <span class="s2">&quot;/tmp/vmlinuz&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;initrd&quot;</span><span class="p">:</span> <span class="s2">&quot;/tmp/initrd&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">},</span> <span class="n">upload</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>If <em>upload</em> is set to true, this function will first upload
the images to the server and then flash them.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>images</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>dictionary keyed by (str) image type of
things to flash in the target. e.g.:</p>
<p>The types if images supported are determined by the target’s
configuration and can be reported with <a class="reference internal" href="#tcfl.target_ext_images.extension.list" title="tcfl.target_ext_images.extension.list"><code class="xref py py-meth docutils literal notranslate"><span class="pre">list()</span></code></a> (or
command line <em>tcf images-list TARGETNAME</em>).</p>
</li>
<li><strong>upload</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) the image names are local files
that need to be uploaded first to the server (this function
will take care of that).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-tcfl.target_ext_ioc_flash_server_app"></span><div class="section" id="flash-the-target-with-ioc-flash-server-app">
<h4>8.1.4.7. Flash the target with <em>ioc_flash_server_app</em><a class="headerlink" href="#flash-the-target-with-ioc-flash-server-app" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="tcfl.target_ext_ioc_flash_server_app.extension">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_ioc_flash_server_app.</code><code class="descname">extension</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ioc_flash_server_app.extension" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> to the
<em>ioc_flash_server_app</em> command to a target on the server in a safe
way.</p>
<p>To configure this interface on a target, see
<a class="reference internal" href="#ttbl.ioc_flash_server_app.interface" title="ttbl.ioc_flash_server_app.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.ioc_flash_server_app.interface</span></code></a>.</p>
<dl class="method">
<dt id="tcfl.target_ext_ioc_flash_server_app.extension.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>mode</em>, <em>filename</em>, <em>generic_id=None</em>, <em>baudrate=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ioc_flash_server_app.extension.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the <em>ioc_flash_server_app</em> command on the target in the
server in a safe way.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>mode</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – mode to use, corresponds to <code class="docutils literal notranslate"><span class="pre">-MODE</span></code> in the
command line tool</li>
<li><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of file to flash (already uploader
to the USER repository in the server)</li>
<li><strong>generic_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – when the mode is <em>generic</em>, the <em>ID</em> to
use.</li>
<li><strong>baudrate</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-tcfl.target_ext_power"></span><div class="section" id="power-on-or-off-the-target-or-any-its-power-rail-components">
<h4>8.1.4.8. Power on or off the target or any its power rail components<a class="headerlink" href="#power-on-or-off-the-target-or-any-its-power-rail-components" title="Permalink to this headline">¶</a></h4>
<p>This module implements the client side API for controlling the power’s
target as well as the hooks to access these interfaces from the
command line.</p>
<dl class="class">
<dt id="tcfl.target_ext_power.extension">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_power.</code><code class="descname">extension</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.extension" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> to interact with the
server’s power control interface.</p>
<p>Use as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="tcfl.target_ext_power.extension.get">
<code class="descname">get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.extension.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a target’s power status, <em>True</em> if powered, <em>False</em>
otherwise.</p>
<p>A target is considered <em>on</em> when all of its power rail
components are on; fake power components report power state as
<em>None</em> and those are not taken into account.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_power.extension.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.extension.list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of a target’s power rail components and their status</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dictionary keyed by component number and their state
(<em>True</em> if powered, <em>False</em> if not, <em>None</em> if not
applicable, for fake power controls)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_power.extension.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>component=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.extension.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off a target or parts of its power rail</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of component to
power off, defaults to whole target’s power rail</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_power.extension.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>component=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.extension.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on a target or parts of its power rail</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of component to
power on, defaults to whole target’s power rail</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_power.extension.cycle">
<code class="descname">cycle</code><span class="sig-paren">(</span><em>wait=None</em>, <em>component=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.extension.cycle" title="Permalink to this definition">¶</a></dt>
<dd><p>Power cycle a target or one of its components</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>wait</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – (optional) seconds to wait before powering on</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of component to
power-cycle, defaults to whole target’s power rail</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_power.extension.reset">
<code class="descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.extension.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset a target</p>
<p>This interface is <strong>deprecated</strong>.</p>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-tcfl.target_ext_shell"></span><div class="section" id="run-commands-a-shell-available-on-a-target-s-serial-console">
<h4>8.1.4.9. Run commands a shell available on a target’s serial console<a class="headerlink" href="#run-commands-a-shell-available-on-a-target-s-serial-console" title="Permalink to this headline">¶</a></h4>
<p>Also allows basic file transmission over serial line.</p>
<div class="section" id="shell-prompts">
<h5>8.1.4.9.1. Shell prompts<a class="headerlink" href="#shell-prompts" title="Permalink to this headline">¶</a></h5>
<p>Waiting for a shell prompt is quite a harder problem that it seems to
be at the beginning.</p>
<p>Problems:</p>
<ul>
<li><p class="first">Background processes or (in the serial console, the kernel) printing
lines in the middle.</p>
<p>Even with line buffered output, when there are different CRLF
conventions, a misplaced newline or carriage return can break havoc.</p>
<p>As well, if a background process / kernel prints a message after the
prompt is printed, a <code class="docutils literal notranslate"><span class="pre">$</span></code> will no longer match. The <code class="docutils literal notranslate"><span class="pre">\Z</span></code> regex
operator cannot be used for the same reason.</p>
</li>
<li><p class="first">CRLF conventions make it harder to use the <code class="docutils literal notranslate"><span class="pre">^</span></code> and <code class="docutils literal notranslate"><span class="pre">$</span></code> regex
expression metacharacteds.</p>
</li>
<li><p class="first">ANSI sequences, human doesn’t see/notice them, but to the computer /
regular expression they are</p>
</li>
</ul>
<p>Thus, resorting to match a single line is the best bet; however, it is
almost impossible to guarantee that it is the last one as the multiple
formats of prompts could be matching other text.</p>
<dl class="data">
<dt id="tcfl.target_ext_shell.shell_prompts">
<code class="descclassname">tcfl.target_ext_shell.</code><code class="descname">shell_prompts</code><em class="property"> = ['[-/\\&#64;_~: \\x1b=;\\[0-9A-Za-z]+ [\\x1b=;\\[0-9A-Za-z]*[#\\$][\\x1b=;\\[0-9A-Za-z]* ', '[^&#64;]+&#64;.*[#\\$] ', '[^:]+:.*[#\\$&gt;]']</em><a class="headerlink" href="#tcfl.target_ext_shell.shell_prompts" title="Permalink to this definition">¶</a></dt>
<dd><p id="waiting-shell-prompts">What is in a shell prompt?</p>
</dd></dl>

<dl class="class">
<dt id="tcfl.target_ext_shell.shell">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_shell.</code><code class="descname">shell</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> for targets that support
some kind of shell (Linux, Windows) to run some common remote
commands without needing to worry about the details.</p>
<p>The target has to be set to boot into console prompt, so password
login has to be disabled.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">up</span><span class="p">()</span>
</pre></div>
</div>
<p>Waits for the shell to be up and ready; sets it up so that if an
error happens, it will print an error message and raise a block
exception. Note you can change what is expected as a <a class="reference internal" href="#tcfl.target_ext_shell.shell.shell_prompt_regex" title="tcfl.target_ext_shell.shell.shell_prompt_regex"><code class="xref py py-data docutils literal notranslate"><span class="pre">shell</span>
<span class="pre">prompt</span></code></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;some command&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Remove remote files (if the target supports it) with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">file_remove</span><span class="p">(</span><span class="s2">&quot;/tmp/filename&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Copy files to the target with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">file_copy_to</span><span class="p">(</span><span class="s2">&quot;local_file&quot;</span><span class="p">,</span> <span class="s2">&quot;/tmp/remote_file&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="tcfl.target_ext_shell.shell.shell_prompt_regex">
<code class="descname">shell_prompt_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#tcfl.target_ext_shell.shell.shell_prompt_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.target_ext_shell.shell.linux_shell_prompt_regex">
<code class="descname">linux_shell_prompt_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#tcfl.target_ext_shell.shell.linux_shell_prompt_regex" title="Permalink to this definition">¶</a></dt>
<dd><p>Deprecated, use <a class="reference internal" href="#tcfl.target_ext_shell.shell.shell_prompt_regex" title="tcfl.target_ext_shell.shell.shell_prompt_regex"><code class="xref py py-data docutils literal notranslate"><span class="pre">shell_prompt_regex</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_shell.shell.setup">
<code class="descname">setup</code><span class="sig-paren">(</span><em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup the shell for scripting operation</p>
<p>In the case of a bash shell, this:
- sets the prompt to something easer to latch on to
- disables command line editing
- traps errors in shell execution</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_shell.shell.up">
<code class="descname">up</code><span class="sig-paren">(</span><em>tempt=None</em>, <em>user=None</em>, <em>login_regex=&lt;_sre.SRE_Pattern object&gt;</em>, <em>delay_login=0</em>, <em>password=None</em>, <em>password_regex=&lt;_sre.SRE_Pattern object&gt;</em>, <em>shell_setup=True</em>, <em>timeout=None</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell.up" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for the shell in a console to be ready</p>
<p>Giving it ample time to boot, wait for a <a class="reference internal" href="#tcfl.target_ext_shell.shell.shell_prompt_regex" title="tcfl.target_ext_shell.shell.shell_prompt_regex"><code class="xref py py-data docutils literal notranslate"><span class="pre">shell</span> <span class="pre">prompt</span></code></a> and set up the shell so that if an
error happens, it will print an error message and raise a
block exception. Optionally login as a user and password.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">user</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;123456&#39;</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tempt</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) string to send before waiting for
the loging prompt (for example, to send a newline that
activates the login)</li>
<li><strong>user</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) if provided, it will wait for
<em>login_regex</em> before trying to login with this user name.</li>
<li><strong>password</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) if provided, and a password
prompt is found, send this password.</li>
<li><strong>login_regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) if provided (string
or compiled regex) and <em>user</em> is provided, it will wait for
this prompt before sending the username.</li>
<li><strong>password_regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) if provided (string
or compiled regex) and <em>password</em> is provided, it will wait for
this prompt before sending the password.</li>
<li><strong>delay_login</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) wait this many seconds
before sending the user name after finding the login prompt.</li>
<li><strong>shell_setup</strong> – <p>(optional, default) setup the shell
up by disabling command line editing (makes it easier for
the automation) and set up hooks that will raise an
exception if a shell command fails.</p>
<p>By default calls target.shell.setup(); if <em>False</em>, nothing
will be called. Arguments are passed:</p>
<ul>
<li><em>console = CONSOLENAME</em>: console where to operate; can be
<em>None</em> for the default console.</li>
</ul>
</li>
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – [optional] seconds to wait for the login
prompt to appear; defaults to 60s plus whatever the target
specifies in metadata <em>bios_boot_time</em>.</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>[optional] name of the console where to
operate; if <em>None</em> it will update the current default
console to whatever the server considers it shall be (the
console called <em>default</em>).</p>
<p>If a previous run set the default console to something else,
setting it to <em>None</em> will update it to what the server
considers shall be the default console (default console at
boot).</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.target_ext_shell.shell.crnl_regex">
<code class="descname">crnl_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#tcfl.target_ext_shell.shell.crnl_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_shell.shell.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>cmd=None</em>, <em>expect=None</em>, <em>prompt_regex=None</em>, <em>output=False</em>, <em>output_filter_crlf=True</em>, <em>timeout=None</em>, <em>trim=False</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs <em>some command</em> as a shell command and wait for the shell
prompt to show up.</p>
<p>If it fails, it will raise an exception. If you want to get
the error code or not have it raise exceptions on failure, you
will have to play shell-specific games, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;failing-command || true&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Files can be easily generated in <em>unix</em> targets with commands
such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">cat &gt; /etc/somefile &lt;&lt;EOF</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">these are the</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">file contents</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">that I want</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">EOF&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>or collecting the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;ls --color=never -1 /etc/&quot;</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">report_info</span><span class="p">(</span><span class="s2">&quot;file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;md5sum </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) command to run; if none, only the
expectations are waited for (if <em>expect</em> is not set, then
only the prompt is expected).</li>
<li><strong>expect</strong> – (optional) output to expect (string or
regex) before the shell prompt. This an also be a list of
things to expect (in the given order)</li>
<li><strong>prompt_regex</strong> – (optional) output to expect (string or
regex) as a shell prompt, which is always to be found at the
end. Defaults to the preconfigured shell prompt (NUMBER $).</li>
<li><strong>output</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional, default False) return the
output of the command to the console; note the output
includes the execution of the command itself.</li>
<li><strong>output_filter_crlf</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional, default True) if we
are returning output, filter out <code class="docutils literal notranslate"><span class="pre">\r\n</span></code> to whatever our CRLF
convention is.</li>
<li><strong>trim</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – if <code class="docutils literal notranslate"><span class="pre">output</span></code> is True, trim the command and
the prompt from the beginning and the end of the output
respectively (True)</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) on which console to run;
(defaults to <em>None</em>, the default console).</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) when reporting information about
this expectation, what origin shall it list, eg:</p>
<ul>
<li><em>None</em> (default) to get the current caller</li>
<li><em>commonl.origin_get(2)</em> also to get the current caller</li>
<li><em>commonl.origin_get(1)</em> also to get the current function</li>
</ul>
<p>or something as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;somefilename:43&quot;</span>
</pre></div>
</div>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns str:</th><td class="field-body"><p class="first">if <code class="docutils literal notranslate"><span class="pre">output</span></code> is true, a string with the output
of the command.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p>if <code class="docutils literal notranslate"><span class="pre">output_filter_crlf</span></code> is False, this output
will be <code class="docutils literal notranslate"><span class="pre">\r\n</span></code> terminated and it will be confusing because
regex won’t work right away. A quick, dirty, fix</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">output_filter_crlf</span></code> enabled replaces this output with</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">crlf</span><span class="p">)</span>
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_shell.shell.file_remove">
<code class="descname">file_remove</code><span class="sig-paren">(</span><em>remote_filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell.file_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a remote file (if the target supports it)</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_shell.shell.files_remove">
<code class="descname">files_remove</code><span class="sig-paren">(</span><em>*remote_filenames</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell.files_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a multiple remote files (if the target supports it)</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_shell.shell.file_copy_to">
<code class="descname">file_copy_to</code><span class="sig-paren">(</span><em>local_filename</em>, <em>remote_filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell.file_copy_to" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a file to the target via the console (if the target supports it)</p>
<p>Encodes the file to base64 and sends it via the console in chunks
of 64 bytes (some consoles are kinda…unreliable) to a file in
the target called /tmp/file.b64, which then we decode back to
normal.</p>
<p>Assumes the target has python3; permissions are not maintained</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">it is <em>slow</em>. The limits are not well defined; how
big a file can be sent/received will depend on local
and remote memory capacity, as things are read
hole. This could be optimized to stream instead of
just read all, but still sending a way big file over
a cheap ASCII protocol is not a good idea. Warned
you are.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_shell.shell.file_copy_from">
<code class="descname">file_copy_from</code><span class="sig-paren">(</span><em>local_filename</em>, <em>remote_filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell.file_copy_from" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a file to the target via the console (if the target supports it)</p>
<p>Encodes the file to base64 and sends it via the console in chunks
of 64 bytes (some consoles are kinda…unreliable) to a file in
the target called /tmp/file.b64, which then we decode back to
normal.</p>
<p>Assumes the target has python3; permissions are not maintained</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">it is <em>slow</em>. The limits are not well defined; how
big a file can be sent/received will depend on local
and remote memory capacity, as things are read
hole. This could be optimized to stream instead of
just read all, but still sending a way big file over
a cheap ASCII protocol is not a good idea. Warned
you are.</p>
</div>
</dd></dl>

</dd></dl>

</div>
</div>
<span class="target" id="module-tcfl.target_ext_ssh"></span><div class="section" id="run-commands-to-the-target-and-copy-files-back-and-forth-using-ssh">
<h4>8.1.4.10. Run commands to the target and copy files back and forth using SSH<a class="headerlink" href="#run-commands-to-the-target-and-copy-files-back-and-forth-using-ssh" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="tcfl.target_ext_ssh.ssh">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_ssh.</code><code class="descname">ssh</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> for targets that support
SSH to run remote commands via SSH or copy files around.</p>
<p>Currently the target the target has to be set to accept
passwordless login, either by:</p>
<ul>
<li><p class="first">disabling password for the target user (<strong>DANGEROUS!!</strong> use only
on isolated targets)</p>
<p>See <a class="reference internal" href="04-HOWTOs.html#linux-ssh-no-root-password"><span class="std std-ref">related how to disable password in images</span></a>.</p>
</li>
<li><p class="first">storing SSH identities in SSH agents (FIXME: not implemented
yet) and provisioning the keys via cloud-init or similar</p>
</li>
</ul>
<p>Use as (full usage example in
<a class="reference download internal" href="../_downloads/test_linux_ssh.py" download=""><code class="xref download docutils literal notranslate"><span class="pre">/usr/share/tcf/examples/test_linux_ssh.py</span></code></a>):</p>
<ol class="arabic">
<li><p class="first">As described in <a class="reference internal" href="#tcfl.target_ext_tunnel.tunnel" title="tcfl.target_ext_tunnel.tunnel"><code class="xref py py-class docutils literal notranslate"><span class="pre">IP</span> <span class="pre">tunnels</span></code></a>, upon which this extension
builds, this will only work with a target with IPv4/6
connectivity, which means there has to be an interconnect
powered on and reachable for the server and <a class="reference internal" href="#tcfl.tc.tc_c.targets_active" title="tcfl.tc.tc_c.targets_active"><code class="xref py py-func docutils literal notranslate"><span class="pre">kept</span> <span class="pre">active</span></code></a>, so the server doesn’t power it off.</p>
</li>
<li><p class="first">ensure the interconnect is powered on before powering on the
target; otherwise some targets won’t acquire an IP configuration
(as they will assume there is no interconnect); e.g.: on <em>start</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ic</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">linux_shell_prompt_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;root@.*# &#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">user</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="2">
<li><p class="first">indicate the tunneling system which IP address is to be
used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">ip_addr</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">addr_get</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="s2">&quot;ipv4&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Use SSH:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span>    <span class="n">exitcode</span><span class="p">,</span> <span class="n">_stdout</span><span class="p">,</span> <span class="n">_stderr</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;test -f file_that_should_exist&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;test -f file_that_should_exist&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">output</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;cat some_file&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">if</span> <span class="s1">&#39;what_im_looking_for&#39;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">do_something</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">copy_to</span><span class="p">(</span><span class="s2">&quot;somedir/local.file&quot;</span><span class="p">,</span> <span class="s2">&quot;remotedir&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="s2">&quot;someremotedir/file&quot;</span><span class="p">,</span> <span class="s2">&quot;localdir&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>FIXME: provide pointers to a private key to use</p>
<p>Troubleshooting:</p>
<ol class="loweralpha">
<li><p class="first">SSH fails to login; open the report file generated with <em>tcf
run</em>, look at the detailed error output:</p>
<ul>
<li><p class="first">returncode will show as 255: login error– do you have
credentials loaded? is the configuration in the target
allowing you to login as such user with no password? or do
you have the SSH keys configured?:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">E</span><span class="c1">#1   @local  eval errored: ssh command failed: echo hello</span>
<span class="n">E</span><span class="c1">#1   @local  ssh_cmd: /usr/bin/ssh -vp 5400 -q -o BatchMode yes -o StrictHostKeyChecking no root@jfsotc10.jf.intel.com -t echo hello</span>
<span class="o">...</span>
<span class="n">E</span><span class="c1">#1   @local  eval errored trace: error_e: (&#39;ssh command failed: echo hello&#39;, {&#39;ssh_cmd&#39;: &#39;/usr/bin/ssh -vp 5400 -q -o BatchMode yes -o StrictHostKeyChecking no root@jfsotc10.jf.intel.com -t echo hello&#39;, &#39;output&#39;: &#39;&#39;, &#39;cmd&#39;: [&#39;/usr/bin/ssh&#39;, &#39;-vp&#39;, &#39;5400&#39;, &#39;-q&#39;, &#39;-o&#39;, &#39;BatchMode yes&#39;, &#39;-o&#39;, &#39;StrictHostKeyChecking no&#39;, &#39;root@jfsotc10.jf.intel.com&#39;, &#39;-t&#39;, &#39;echo hello&#39;], &#39;returncode&#39;: 255})</span>
<span class="n">E</span><span class="c1">#1   @local  returncode: 255</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
<p>For seeing verbose SSH output to debug, append <code class="docutils literal notranslate"><span class="pre">-v</span></code> to
variable <em>_ssh_cmdline_options</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">_ssh_cmdline_options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="tcfl.target_ext_ssh.ssh.host">
<code class="descname">host</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.host" title="Permalink to this definition">¶</a></dt>
<dd><p>SSH destination host; this will be filled out automatically
with any IPv4 or IPv6 address the target declares, but can
be assigned to a new value if needed.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.target_ext_ssh.ssh.login">
<code class="descname">login</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.login" title="Permalink to this definition">¶</a></dt>
<dd><p>SSH login identity; default to root login, as otherwise it
would default to the login of the user running the daemon.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.target_ext_ssh.ssh.port">
<code class="descname">port</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.port" title="Permalink to this definition">¶</a></dt>
<dd><p>SSH port to use</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_ssh.ssh.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>cmd</em>, <em>nonzero_e=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a shell command over SSH, return exitcode and output</p>
<p>Similar to <a class="reference external" href="https://docs.python.org/2.7/library/subprocess.html#subprocess.call" title="(in Python v2.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">subprocess.call()</span></code></a>; note SSH is normally run
in verbose mode (unless <code class="docutils literal notranslate"><span class="pre">-q</span></code> has been set in
<em>_ssh_cmdline_options</em>, so the stderr will contain SSH
debug information.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>shell command to execute via SSH, substituting
any <code class="docutils literal notranslate"><span class="pre">%(KEYWORD)[ds]</span></code> field from the target’s keywords in
<a class="reference internal" href="#tcfl.tc.target_c.kws" title="tcfl.tc.target_c.kws"><code class="xref py py-attr docutils literal notranslate"><span class="pre">tcfl.tc.target_c.kws</span></code></a></p>
<p>See <a class="reference internal" href="04-HOWTOs.html#finding-testcase-metadata"><span class="std std-ref">how to find</span></a> which fields are available.</p>
</li>
<li><strong>nonzero_e</strong> (<a class="reference internal" href="#tcfl.tc.exception" title="tcfl.tc.exception"><em>tcfl.tc.exception</em></a>) – exception to raise in case of non
zero exit code.  Must be a subclass of <a class="reference internal" href="#tcfl.tc.exception" title="tcfl.tc.exception"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.exception</span></code></a>
(i.e.: <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.failed_e</span></code></a>,  <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.skip_e</span></code></a>, <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.blocked_e</span></code></a>) or
<em>None</em> (default) to not raise anything and just return the
exit code.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>tuple of <code class="docutils literal notranslate"><span class="pre">exitcode,</span> <span class="pre">stdout,</span> <span class="pre">stderr</span></code>, the two later
being two tempfile file descriptors containing the standard
output and standard error of running the command.</p>
<p>The stdout (or stderr) can be read with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_ssh.ssh.call">
<code class="descname">call</code><span class="sig-paren">(</span><em>cmd</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.call" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a shell command over SSH, returning the output</p>
<p>Please see <a class="reference internal" href="#tcfl.target_ext_ssh.ssh.run" title="tcfl.target_ext_ssh.ssh.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">run()</span></code></a> for argument description; the only
difference is this function raises an exception if the call fails.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_ssh.ssh.check_call">
<code class="descname">check_call</code><span class="sig-paren">(</span><em>cmd</em>, <em>nonzero_e=&lt;class 'tcfl.tc.error_e'&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.check_call" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a shell command over SSH, returning the output</p>
<p>Please see <a class="reference internal" href="#tcfl.target_ext_ssh.ssh.run" title="tcfl.target_ext_ssh.ssh.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">run()</span></code></a> for argument description; the only
difference is this function raises an exception if the call fails.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_ssh.ssh.check_output">
<code class="descname">check_output</code><span class="sig-paren">(</span><em>cmd</em>, <em>nonzero_e=&lt;class 'tcfl.tc.error_e'&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.check_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a shell command over SSH, returning the output</p>
<p>Please see <a class="reference internal" href="#tcfl.target_ext_ssh.ssh.run" title="tcfl.target_ext_ssh.ssh.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">run()</span></code></a> for argument description; the only
difference is this function returns the stdout only if the
call succeeds and raises an exception otherwise.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_ssh.ssh.copy_to">
<code class="descname">copy_to</code><span class="sig-paren">(</span><em>src</em>, <em>dst=''</em>, <em>recursive=False</em>, <em>nonzero_e=&lt;class 'tcfl.tc.error_e'&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.copy_to" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy a file or tree with <em>SCP</em> to the target from the client</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>src</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>local file or directory to copy</p>
<p>Note a relative path will be made relative to the location
of the testscript, see <a class="reference internal" href="#tcfl.tc.tc_c.relpath_to_abs" title="tcfl.tc.tc_c.relpath_to_abs"><code class="xref py py-func docutils literal notranslate"><span class="pre">testcase.relpath_to_abs</span></code></a>.</p>
</li>
<li><strong>dst</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) destination file or directoy
(defaults to root’s home directory)</li>
<li><strong>recursive</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) copy recursively (needed for
directories)</li>
<li><strong>nonzero_e</strong> (<a class="reference internal" href="#tcfl.tc.exception" title="tcfl.tc.exception"><em>tcfl.tc.exception</em></a>) – exception to raise in case of 
non zero exit code.  Must be a subclass of <a class="reference internal" href="#tcfl.tc.exception" title="tcfl.tc.exception"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.exception</span></code></a>
(i.e.: <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.failed_e</span></code></a>,  <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.skip_e</span></code></a>, <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.blocked_e</span></code></a>) or
<em>None</em> (default) to not raise anything and just return the
exit code.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_ssh.ssh.copy_from">
<code class="descname">copy_from</code><span class="sig-paren">(</span><em>src</em>, <em>dst='.'</em>, <em>recursive=False</em>, <em>nonzero_e=&lt;class 'tcfl.tc.error_e'&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.copy_from" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy a file or tree with <em>SCP</em> from the target to the client</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>src</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – remote file or directory to copy</li>
<li><strong>dst</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) destination file or directory
(defaults to current working directory)</li>
<li><strong>recursive</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) copy recursively (needed for
directories)</li>
<li><strong>nonzero_e</strong> (<a class="reference internal" href="#tcfl.tc.exception" title="tcfl.tc.exception"><em>tcfl.tc.exception</em></a>) – exception to raise in case of 
non zero exit code.  Must be a subclass of <a class="reference internal" href="#tcfl.tc.exception" title="tcfl.tc.exception"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.exception</span></code></a>
(i.e.: <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.failed_e</span></code></a>,  <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.skip_e</span></code></a>, <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.blocked_e</span></code></a>) or
<em>None</em> (default) to not raise anything and just return the
exit code.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-tcfl.target_ext_store"></span><div class="section" id="copy-files-from-and-to-the-server-s-user-storage-area">
<h4>8.1.4.11. Copy files from and to the server’s user storage area<a class="headerlink" href="#copy-files-from-and-to-the-server-s-user-storage-area" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="tcfl.target_ext_store.extension">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_store.</code><code class="descname">extension</code><span class="sig-paren">(</span><em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_store.extension" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> to run methods to manage
the files in the user’s storage area in the server.</p>
<p>Use as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">files</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">REMOTE</span><span class="p">,</span> <span class="n">LOCAL</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">dnload</span><span class="p">(</span><span class="n">REMOTE</span><span class="p">,</span> <span class="n">LOCAL</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">REMOTE</span><span class="p">)</span>
</pre></div>
</div>
<p>Note these files are, for example:</p>
<ul>
<li><p class="first">images for the server to flash into targets (usually handled with
the <a class="reference internal" href="#tcfl.target_ext_images.extension" title="tcfl.target_ext_images.extension"><code class="xref py py-class docutils literal notranslate"><span class="pre">images</span></code></a>)</p>
</li>
<li><p class="first">copying specific log files from the server (eg: downloading TCP
dump captures form <em>tcpdump</em> as done by the
<a class="reference internal" href="#conf_00_lib.vlan_pci" title="conf_00_lib.vlan_pci"><code class="xref py py-class docutils literal notranslate"><span class="pre">conf_00_lib.vlan_pci</span></code></a> network element).</p>
</li>
<li><p class="first">the storage area is commong to <em>all</em> targets of the server for
each user, thus multiple test cases running in parallel can
access it at the same time. Use the testcase’s hash to safely
namespace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tc_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;tc_hash&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">tc_hash</span> <span class="o">+</span> <span class="s2">&quot;-NAME&quot;</span><span class="p">,</span> <span class="n">LOCAL</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>Presence of the <em>store</em> attribute in a target indicates this
interface is supported.</p>
<dl class="method">
<dt id="tcfl.target_ext_store.extension.upload">
<code class="descname">upload</code><span class="sig-paren">(</span><em>remote</em>, <em>local</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_store.extension.upload" title="Permalink to this definition">¶</a></dt>
<dd><p>Upload a local file to the store</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>remote</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name in the server</li>
<li><strong>local</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – local file name</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_store.extension.dnload">
<code class="descname">dnload</code><span class="sig-paren">(</span><em>remote</em>, <em>local</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_store.extension.dnload" title="Permalink to this definition">¶</a></dt>
<dd><p>Download a remote file from the store to the local system</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>remote</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the file to download in the server</li>
<li><strong>local</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – local file name</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns int:</th><td class="field-body"><p class="first last">the amount of bytes downloaded</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_store.extension.delete">
<code class="descname">delete</code><span class="sig-paren">(</span><em>remote</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_store.extension.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete a remote file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>remote</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the file to remove from the server</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_store.extension.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_store.extension.list" title="Permalink to this definition">¶</a></dt>
<dd><p>List available files and their MD5 sums</p>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-tcfl.target_ext_things"></span><div class="section" id="plug-or-unplug-things-to-from-a-target">
<h4>8.1.4.12. Plug or unplug things to/from a target<a class="headerlink" href="#plug-or-unplug-things-to-from-a-target" title="Permalink to this headline">¶</a></h4>
<p>This module implements the client side API for controlling the things
that can be plugged/unplugged to/from a target.</p>
<dl class="class">
<dt id="tcfl.target_ext_things.extension">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_things.</code><code class="descname">extension</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_things.extension" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> to interact with the
server’s thing conrol interface</p>
<p>Use as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">things</span><span class="o">.</span><span class="n">plug</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">things</span><span class="o">.</span><span class="n">unplug</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">things</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">things</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="tcfl.target_ext_things.extension.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_things.extension.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>True</em> if <em>thing</em> is connected, <em>False</em> otherwise</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_things.extension.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_things.extension.list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of a target’s things and their state</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dictionary keyed by thing name number and their state
(<em>True</em> if plugged, <em>False</em> if not, <em>None</em> if the
target/thing are not acquired and thus state information is
not available.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_things.extension.plug">
<code class="descname">plug</code><span class="sig-paren">(</span><em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_things.extension.plug" title="Permalink to this definition">¶</a></dt>
<dd><p>Plug a thing into the target</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>thing</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the thing to plug</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_things.extension.unplug">
<code class="descname">unplug</code><span class="sig-paren">(</span><em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_things.extension.unplug" title="Permalink to this definition">¶</a></dt>
<dd><p>Unplug a thing from the target</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>thing</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the thing to unplug</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-tcfl.target_ext_tunnel"></span><div class="section" id="create-and-remove-network-tunnels-to-the-target-via-the-server">
<h4>8.1.4.13. Create and remove network tunnels to the target via the server<a class="headerlink" href="#create-and-remove-network-tunnels-to-the-target-via-the-server" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="tcfl.target_ext_tunnel.tunnel">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_tunnel.</code><code class="descname">tunnel</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.tunnel" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> to create IP tunnels to
targets with IP connectivity.</p>
<p>Use by indicating a default IP address to use for interconnect
<em>ic</em> or explicitly indicating it in the <a class="reference internal" href="#tcfl.target_ext_tunnel.tunnel.add" title="tcfl.target_ext_tunnel.tunnel.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">ip_addr</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">addr_get</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="s2">&quot;ipv4&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that for tunnels to work, the target has to be acquired and
IP has to be up on it, which might requires it to be connected to
some IP network (it can be a TCF interconnect or any other
network).</p>
<dl class="method">
<dt id="tcfl.target_ext_tunnel.tunnel.add">
<code class="descname">add</code><span class="sig-paren">(</span><em>port</em>, <em>ip_addr=None</em>, <em>protocol=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.tunnel.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup a TCP/UDP/SCTP v4 or v5 tunnel to the target</p>
<p>A local port of the given protocol in the server is forwarded
to the target’s port. Teardown with <a class="reference internal" href="#tcfl.target_ext_tunnel.tunnel.remove" title="tcfl.target_ext_tunnel.tunnel.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove()</span></code></a>.</p>
<p>If the tunnel already exists, it is not recreated, but the
port it uses is returned.</p>
<dl class="docutils">
<dt>Example: redirect target’s TCP4 port 3000 to a port in the server</dt>
<dd><p class="first">that provides <code class="docutils literal notranslate"><span class="pre">target</span></code> (target.kws[‘server’]).</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">server_port</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server_name</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">rtb</span><span class="o">.</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">hostname</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server_name</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">]</span>    <span class="c1"># alternatively</span>
</pre></div>
</div>
</dd>
</dl>
<p>Now connecting to <code class="docutils literal notranslate"><span class="pre">server_name:server_port</span></code> takes you to the
target’s port 3000.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – port to redirect to</li>
<li><strong>ip_addr</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) target’s IP address to use (it
must be listed on the targets’s tags <em>ipv4_address</em> or
<em>ipv6_address</em>).</li>
<li><strong>protocol</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) Protocol to tunnel:
{udp,sctp,tcp}[{4,6}] (defaults to TCP v4)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Returns int local_port:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first last">port in the server where to connect
to in order to access the target.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_tunnel.tunnel.remove">
<code class="descname">remove</code><span class="sig-paren">(</span><em>port</em>, <em>ip_addr=None</em>, <em>protocol=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.tunnel.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Teardown a TCP/UDP/SCTP v4 or v5 tunnel to the target
previously created with <a class="reference internal" href="#tcfl.target_ext_tunnel.tunnel.add" title="tcfl.target_ext_tunnel.tunnel.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – port to redirect to</li>
<li><strong>ip_addr</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) target’s IP address to use (it
must be listed on the targets’s tags <em>ipv4_address</em> or
<em>ipv6_address</em>).</li>
<li><strong>proto</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) Protocol to tunnel:
{udp,sctp,tcp}[{4,6}] (defaults to v4 and to TCP)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_tunnel.tunnel.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.tunnel.list" title="Permalink to this definition">¶</a></dt>
<dd><p>List existing IP tunnels</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of tuples::
(protocol, target-ip-address, target-port, server-port)</td>
</tr>
</tbody>
</table>
<p>Reminder that the server’s hostname can be obtained from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">rtb</span><span class="o">.</span><span class="n">parsed_hostname</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.target_ext_tunnel.cmdline_setup">
<code class="descclassname">tcfl.target_ext_tunnel.</code><code class="descname">cmdline_setup</code><span class="sig-paren">(</span><em>argsp</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.cmdline_setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>
<div class="section" id="module-tcfl.app">
<span id="tcf-run-application-builders"></span><h3>8.1.5. <em>TCF run</em> Application builders<a class="headerlink" href="#module-tcfl.app" title="Permalink to this headline">¶</a></h3>
<p>Application builder are a generic tool for building applications of
different types.</p>
<p>They all use the same interface to make it easy and fast for the test
case writer to specify what has to be built for which BSP of which
target with a very simple specification given to the
<a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.target()</span></code></a> decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="n">app_zephyr</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="s2">&quot;path/to/zephyr_app&quot;</span> <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>               <span class="n">app_sketch</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;arc&#39;</span><span class="p">:</span> <span class="s2">&quot;path/to/sketch&quot;</span> <span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">mytestcase</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
</pre></div>
</div>
<p>which allows the testcase developer to point the app builders to the
locations of the source code and on which BSPs of the targets it shall
run and have it deal with the details of inserting the right code to
build, deploy, setup and start the testcase.</p>
<p>This allows the testcase writer to focus on writing the test
application.</p>
<p>App builders:</p>
<ul class="simple">
<li>can be made once and reused multiple times</li>
<li>they are plugins to the testcase system</li>
<li>keep no state; they need to be able to gather everything
from the parameters passed (this is needed so they can be called from
multiple threads).</li>
<li>are always called <em>app_SOMETHING</em></li>
</ul>
<p>Note implementation details on <a class="reference internal" href="#tcfl.app.app_c" title="tcfl.app.app_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.app.app_c</span></code></a>; drivers can
be added with <a class="reference internal" href="#tcfl.app.driver_add" title="tcfl.app.driver_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.app.driver_add()</span></code></a>.</p>
<p>Currently available application buildrs for:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#tcfl.app_zephyr.app_zephyr" title="tcfl.app_zephyr.app_zephyr"><code class="xref py py-class docutils literal notranslate"><span class="pre">Zephyr</span> <span class="pre">OS</span> <span class="pre">apps</span></code></a></li>
<li><a class="reference internal" href="#tcfl.app_sketch.app_sketch" title="tcfl.app_sketch.app_sketch"><code class="xref py py-class docutils literal notranslate"><span class="pre">Arduino</span> <span class="pre">Sketches</span></code></a></li>
</ul>
</div></blockquote>
<dl class="function">
<dt id="tcfl.app.import_mp_pathos">
<code class="descclassname">tcfl.app.</code><code class="descname">import_mp_pathos</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.import_mp_pathos" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.import_mp_std">
<code class="descclassname">tcfl.app.</code><code class="descname">import_mp_std</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.import_mp_std" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.args_app_src_check">
<code class="descclassname">tcfl.app.</code><code class="descname">args_app_src_check</code><span class="sig-paren">(</span><em>app_name</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.args_app_src_check" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify the source specification for a given App Driver</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.app.driver_add">
<code class="descclassname">tcfl.app.</code><code class="descname">driver_add</code><span class="sig-paren">(</span><em>cls</em>, <em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.driver_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new driver for app building</p>
<p>Note the driver will be called as the class name; it is
recommended to call then <em>app_something</em>.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.app.driver_valid">
<code class="descclassname">tcfl.app.</code><code class="descname">driver_valid</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.driver_valid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.get_real_srcdir">
<code class="descclassname">tcfl.app.</code><code class="descname">get_real_srcdir</code><span class="sig-paren">(</span><em>origin_filename</em>, <em>_srcdir</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.get_real_srcdir" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the absolute version of _srcdir, which might be relative
which the file described by origin_file.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.app.configure">
<code class="descclassname">tcfl.app.</code><code class="descname">configure</code><span class="sig-paren">(</span><em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.configure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.build">
<code class="descclassname">tcfl.app.</code><code class="descname">build</code><span class="sig-paren">(</span><em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.build" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.deploy">
<code class="descclassname">tcfl.app.</code><code class="descname">deploy</code><span class="sig-paren">(</span><em>images</em>, <em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.deploy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.setup">
<code class="descclassname">tcfl.app.</code><code class="descname">setup</code><span class="sig-paren">(</span><em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.start">
<code class="descclassname">tcfl.app.</code><code class="descname">start</code><span class="sig-paren">(</span><em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.teardown">
<code class="descclassname">tcfl.app.</code><code class="descname">teardown</code><span class="sig-paren">(</span><em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.teardown" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.clean">
<code class="descclassname">tcfl.app.</code><code class="descname">clean</code><span class="sig-paren">(</span><em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="tcfl.app.app_c">
<em class="property">class </em><code class="descclassname">tcfl.app.</code><code class="descname">app_c</code><a class="headerlink" href="#tcfl.app.app_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Subclass this to create an App builder, provide implementations
only of what is needed.</p>
<p>The driver will be invoked by the test runner using the methods
<a class="reference internal" href="#tcfl.app.configure" title="tcfl.app.configure"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.app.configure()</span></code></a>, <a class="reference internal" href="#tcfl.app.build" title="tcfl.app.build"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.app.build()</span></code></a>,
<a class="reference internal" href="#tcfl.app.deploy" title="tcfl.app.deploy"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.app.deploy()</span></code></a>, <a class="reference internal" href="#tcfl.app.setup" title="tcfl.app.setup"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.app.setup()</span></code></a>,
<a class="reference internal" href="#tcfl.app.start" title="tcfl.app.start"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.app.start()</span></code></a>, <a class="reference internal" href="#tcfl.app.teardown" title="tcfl.app.teardown"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.app.teardown()</span></code></a>,
<a class="reference internal" href="#tcfl.app.clean" title="tcfl.app.clean"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.app.clean()</span></code></a>.</p>
<p>If your App builder does not need to implement any, then it is
enough with not specifying it in the class.</p>
<p><strong>Targets with multiple BSPs</strong></p>
<p>When the target contains multiple BSPs the App builders are
invoked for each BSP in the same order as they were declared with
the decorator <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.target()</span></code></a>. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="n">app_zephyr</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;arc&#39;</span><span class="p">:</span> <span class="s1">&#39;path/to/zephyr_code&#39;</span> <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="n">app_sketch</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="s1">&#39;path/to/arduino_code&#39;</span> <span class="p">})</span>
</pre></div>
</div>
<p>We are specifying that the <em>x86</em> BSP in the target has to run code
to be built with the Arduino IDE/compiler and the <em>arc</em> core will
run a Zephyr app, built with the Zephyr SDK.</p>
<p>If the target is being ran in a BSP model where one or more of the
BSPs are not used, the App builders are responsible for providing
stub information with <a class="reference internal" href="#tcfl.tc.target_c.stub_app_add" title="tcfl.tc.target_c.stub_app_add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.target_c.stub_app_add()</span></code></a>. As
well, if an app builder determines a BSP does not need to be
stubbed, it can also remove it from the target’s list with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">target</span><span class="o">.</span><span class="n">bsps_stub</span><span class="p">[</span><span class="n">BSPNAME</span><span class="p">]</span>
</pre></div>
</div>
<p>Note this removal is done at the specific target level, as each
target might have different models or needs.</p>
<p>Note you can use the dictionary <a class="reference internal" href="#tcfl.tc.tc_c.buffers" title="tcfl.tc.tc_c.buffers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.buffers()</span></code></a> to
store data to communicate amongst phases. This dictionary:</p>
<ul class="simple">
<li>will be cleaned in between evaluation runs</li>
<li>is not multi-threaded protected; take
<code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.buffers_lock()</span></code> if you need to access it
from different paralell execution methods
(setup/start/eval/test/teardown methods are <em>always</em> executed
serially).</li>
<li>take care not to <em>start</em> more than once; app builders are setup
to start a target only if there is not a field
<em>started-TARGETNAME</em> set to <em>True</em>.</li>
</ul>
<dl class="staticmethod">
<dt id="tcfl.app.app_c.configure">
<em class="property">static </em><code class="descname">configure</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.configure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app.app_c.build">
<em class="property">static </em><code class="descname">build</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.build" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app.app_c.deploy">
<em class="property">static </em><code class="descname">deploy</code><span class="sig-paren">(</span><em>images</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.deploy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app.app_c.setup">
<em class="property">static </em><code class="descname">setup</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app.app_c.start">
<em class="property">static </em><code class="descname">start</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app.app_c.teardown">
<em class="property">static </em><code class="descname">teardown</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.teardown" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app.app_c.clean">
<em class="property">static </em><code class="descname">clean</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.app.make_j_guess">
<code class="descclassname">tcfl.app.</code><code class="descname">make_j_guess</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.make_j_guess" title="Permalink to this definition">¶</a></dt>
<dd><p>How much paralellism?</p>
<p>In theoryt there is a make job server that can help throtle this,
but in practice this also influences how much virtual the build of a
bunch of TCs can do so…</p>
<p>So depending on how many jobs are already queued, decide how much
-j we want to give to make.</p>
</dd></dl>

<span class="target" id="module-tcfl.app_zephyr"></span><dl class="data">
<dt id="tcfl.app_zephyr.boot_delay">
<code class="descclassname">tcfl.app_zephyr.</code><code class="descname">boot_delay</code><em class="property"> = {}</em><a class="headerlink" href="#tcfl.app_zephyr.boot_delay" title="Permalink to this definition">¶</a></dt>
<dd><p>for each target type, an integer on how long we shall wait to
boot Zephyr</p>
</dd></dl>

<dl class="class">
<dt id="tcfl.app_zephyr.app_zephyr">
<em class="property">class </em><code class="descclassname">tcfl.app_zephyr.</code><code class="descname">app_zephyr</code><a class="headerlink" href="#tcfl.app_zephyr.app_zephyr" title="Permalink to this definition">¶</a></dt>
<dd><p>Support for configuring, building, deploying and evaluating a Zephyr-OS
application.</p>
<p>To setup:</p>
<blockquote>
<div><ul>
<li><p class="first">a toolchain capable of building Zephyr has to be installed in
the system and the corresponding environment variables
exported, such as:</p>
<ul class="simple">
<li><cite>ZEPHYR_SDK_INSTALL_DIR</cite> for the Zephyr SDK</li>
<li><cite>ISSM_INSTALLATION_PATH</cite> for the Intel ISSM toolchain</li>
<li><cite>ESPRESSIF_TOOLCHAIN_PATH</cite> for the Espress toolchain</li>
<li><cite>XTENSA_SDK</cite> for the Xtensa SDK</li>
</ul>
</li>
<li><p class="first">environment variables set:</p>
<ul class="simple">
<li><cite>ZEPHYR_TOOLCHAIN_VARIANT</cite> (<cite>ZEPHYR_GCC_VARIANT</cite> before
v1.11) pointing to the toolchain to use (<em>zephyr</em>, <em>issm</em>,
<em>espressif</em>, <em>xcc</em>, etc…)</li>
<li><cite>ZEPHYR_BASE</cite> pointing to the path where the Zephyr tree is located</li>
</ul>
<p>note these variables can be put in a <a class="reference internal" href="02-guides.html#tcf-configure-zephyr"><span class="std std-ref">TCF configuration
file</span></a> or they can also be specified as
options to <em>app_zephyr</em> (see below).</p>
</li>
</ul>
</div></blockquote>
<p>Usage:</p>
<ul>
<li><p class="first">Declare in a target <em>app_zephyr</em> and point to the source tree
and optionally, provide extra arguments to add to the Makefile
invocation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;zephyr_board&quot;</span><span class="p">,</span>
                <span class="n">app_zephyr</span> <span class="o">=</span> <span class="s1">&#39;path/to/app/source&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>If extra makefile arguments are needed, a tuple that starts with
the path and contains multiple strings can be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;zephyr_board&quot;</span><span class="p">,</span>
                <span class="n">app_zephyr</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;path/to/app/source&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ZEPHYR_TOOLCHAIN_VARIANT=zephyr&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ZEPHYR_BASE=some/path&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;OTHEREXTRAARGSTOZEPHYRMAKE&#39;</span><span class="p">))</span>
<span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>to build multiple BSPs of the same target:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;type == &#39;arduino101&#39;&quot;</span><span class="p">,</span>
                <span class="n">app_zephyr</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="s1">&#39;path/to/app/source/for/x86&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;ZEPHYR_TOOLCHAIN_VARIANT=zephyr&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;ZEPHYR_BASE=some/path&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;OTHEREXTRAARGSTOZEPHYRMAKE&#39;</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;arc&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="s1">&#39;path/to/app/source/for/arc&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;ZEPHYR_TOOLCHAIN_VARIANT=zephyr&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;ZEPHYR_BASE=some/path&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;OTHEREXTRAARGSTOZEPHYRMAKE&#39;</span>
                    <span class="p">)</span>
                <span class="p">})</span>
<span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>furthermore, common options can be specified in
<em>app_zephyr_options</em> (note this is just a string versus a
tuple), so the previous example can be simplified as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;type == &#39;arduino101&#39;&quot;</span><span class="p">,</span>
                <span class="n">app_zephyr</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="s1">&#39;path/to/app/source/for/x86&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;OTHER-X86-EXTRAS&#39;</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;arc&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="s1">&#39;path/to/app/source/for/arc&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;OTHER-ARC-EXTRAS&#39;</span>
                    <span class="p">)</span>
                <span class="p">},</span>
                <span class="n">app_zephyr_options</span> <span class="o">=</span> \
                  <span class="s1">&#39;ZEPHYR_TOOLCHAIN_VARIANT=zephyr&#39;</span> \
                  <span class="s1">&#39;ZEPHYR_BASE=some/path&#39;</span> \
                  <span class="s1">&#39;OTHER-COMMON-EXTRAS&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
</ul>
<p>The test creator can set the attributes (in the test class or in
the target object):</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">zephyr_filter</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">zephyr_filter_origin</span></code> (optional)</li>
</ul>
<p>to indicate a Zephyr Sanity Check style filter to apply before
building, to be able to skip a test case if a logical expression
on the Zephyr build configuration is not satisfied. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@tcfl.tc.target</span><span class="p">(</span><span class="s2">&quot;zephyr_board&quot;</span><span class="p">,</span> <span class="n">app_zephyr</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
    <span class="n">zephyr_filter</span> <span class="o">=</span> <span class="s2">&quot;CONFIG_VALUE_X == 2000 and CONFIG_SOMETHING != &#39;foo&#39;&quot;</span>
    <span class="n">zephyr_filter_origin</span> <span class="o">=</span> <span class="vm">__file__</span>
</pre></div>
</div>
<dl class="staticmethod">
<dt id="tcfl.app_zephyr.app_zephyr.configure">
<em class="property">static </em><code class="descname">configure</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.app_zephyr.configure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_zephyr.app_zephyr.build">
<em class="property">static </em><code class="descname">build</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.app_zephyr.build" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a Zephyr App whichever active BSP is active on a target</p>
</dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_zephyr.app_zephyr.deploy">
<em class="property">static </em><code class="descname">deploy</code><span class="sig-paren">(</span><em>images</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.app_zephyr.deploy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_zephyr.app_zephyr.setup">
<em class="property">static </em><code class="descname">setup</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.app_zephyr.setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_zephyr.app_zephyr.clean">
<em class="property">static </em><code class="descname">clean</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.app_zephyr.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.app_zephyr.zephyr">
<em class="property">class </em><code class="descclassname">tcfl.app_zephyr.</code><code class="descname">zephyr</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.zephyr" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a> to add Zephyr specific
APIs; this extension is activated <em>only</em> if any BSP in the target
is to be loaded with Zephyr.</p>
<dl class="staticmethod">
<dt id="tcfl.app_zephyr.zephyr.sdk_keys">
<em class="property">static </em><code class="descname">sdk_keys</code><span class="sig-paren">(</span><em>arch</em>, <em>variant</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.zephyr.sdk_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Figure out the architecture, calling convention and SDK
prefixes for this target’s current BSP.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.app_zephyr.zephyr.config_file_read">
<code class="descname">config_file_read</code><span class="sig-paren">(</span><em>name=None</em>, <em>bsp=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.zephyr.config_file_read" title="Permalink to this definition">¶</a></dt>
<dd><p>Open a config file and return its values as a dictionary</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the configuration file,
default to <em>%(zephyr_objdir)s/.config</em>.</li>
<li><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) BSP on which to operate; when the
target is configured for a <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a> which contains
multiple Zephyr BSPs, you will need to specify which one to
modify.</p>
<p>This parameter can be omitted if only one BSP is available
in the current BSP Model.</p>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">dictionary keyed by CONFIG_ name with its value.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.app_zephyr.zephyr.config_file_write">
<code class="descname">config_file_write</code><span class="sig-paren">(</span><em>name</em>, <em>data</em>, <em>bsp=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.zephyr.config_file_write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write an extra config file called <em>NAME</em>.conf in the Zephyr’s
App build directory.</p>
<p>Note this takes care to only write it if the data is new or
the file is unexistant, to avoid unnecesary rebuilds.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Name for the configuration file; this has to
be a valid filename; <em>.conf</em> will be added by the function.</li>
<li><strong>data</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>Data to include in the configuration file;
this is (currently) valid kconfig data, which are lines of
text with # acting as comment character; for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_UART_CONSOLE_ON_DEV_NAME</span><span class="o">=</span><span class="s2">&quot;UART_1&quot;</span>
</pre></div>
</div>
</li>
<li><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) BSP on which to operate; when the
target is configured for a <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a> which contains
multiple Zephyr BSPs, you will need to specify which one to
modify.</p>
<p>This parameter can be omitted if only one BSP is available
in the current BSP Model.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">something</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">zephyr</span><span class="o">.</span><span class="n">conf_file_write</span><span class="p">(</span><span class="s2">&quot;mytweaks&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                  <span class="s1">&#39;CONFIG_SOMEVAR=1</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="gp">&gt;&gt;&gt; </span>                                  <span class="s1">&#39;CONFIG_ANOTHER=&quot;VALUE&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tcfl.app_zephyr.zephyr.check_filter">
<code class="descname">check_filter</code><span class="sig-paren">(</span><em>_objdir</em>, <em>arch</em>, <em>board</em>, <em>_filter</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.zephyr.check_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>This is going to be called by the App Builder’s build function
to evaluate if we need to filter out a build of a testcase. In
any other case, it will be ignored.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>objdir</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the Zephyr’s object directory
where to find configuration files</li>
<li><strong>arch</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the architecture we are building</li>
<li><strong>board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Zephyr’s board we are building</li>
<li><strong>_filter</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Zephyr’s sanity Check style filter
expression</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – where does this come from?</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-tcfl.app_sketch"></span><dl class="class">
<dt id="tcfl.app_sketch.app_sketch">
<em class="property">class </em><code class="descclassname">tcfl.app_sketch.</code><code class="descname">app_sketch</code><a class="headerlink" href="#tcfl.app_sketch.app_sketch" title="Permalink to this definition">¶</a></dt>
<dd><p>Driver to build Arduino Sketch applications for flashing into
MCU’s BSPs.</p>
<p>Note the <a class="reference internal" href="02-guides.html#tcf-configure-sketch"><span class="std std-ref">setup instructions</span></a>.</p>
<dl class="staticmethod">
<dt id="tcfl.app_sketch.app_sketch.configure">
<em class="property">static </em><code class="descname">configure</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_sketch.app_sketch.configure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_sketch.app_sketch.build">
<em class="property">static </em><code class="descname">build</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_sketch.app_sketch.build" title="Permalink to this definition">¶</a></dt>
<dd><p>Build an Sketh App whichever active BSP is active on a target</p>
</dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_sketch.app_sketch.deploy">
<em class="property">static </em><code class="descname">deploy</code><span class="sig-paren">(</span><em>images</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_sketch.app_sketch.deploy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_sketch.app_sketch.clean">
<em class="property">static </em><code class="descname">clean</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_sketch.app_sketch.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-tcfl.app_manual"></span><dl class="class">
<dt id="tcfl.app_manual.app_manual">
<em class="property">class </em><code class="descclassname">tcfl.app_manual.</code><code class="descname">app_manual</code><a class="headerlink" href="#tcfl.app_manual.app_manual" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an App Builder that tells the system the testcase will
provide instructions to configure/build/deploy/eval/clean in the
testcase methods.</p>
<p>It is used when we are combining App Builders to build for some
BSPs with manual methods. Note it can also be used to manually
adding stubbing information with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">bsp_stub</span> <span class="ow">in</span> <span class="s1">&#39;BSP1&#39;</span><span class="p">,</span> <span class="s1">&#39;BSP2&#39;</span><span class="p">,</span> <span class="s1">&#39;BSP3&#39;</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">target</span><span class="o">.</span><span class="n">stub_app_add</span><span class="p">(</span><span class="n">bsp_stub</span><span class="p">,</span> <span class="n">app_manual</span><span class="p">,</span> <span class="s2">&quot;nothing&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="tcf-run-report-drivers">
<h3>8.1.6. <em>TCF run</em> report drivers<a class="headerlink" href="#tcf-run-report-drivers" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="02-guides.html#tcf-guide-report-driver"><span class="std std-ref">report reference</span></a>.</p>
</div>
</div>
<div class="section" id="module-tcfl.config">
<span id="tcf-client-configuration"></span><h2>8.2. <em>TCF</em> client configuration<a class="headerlink" href="#module-tcfl.config" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configuration-api-for-tcf">
<h3>8.2.1. Configuration API for <em>tcf</em><a class="headerlink" href="#configuration-api-for-tcf" title="Permalink to this headline">¶</a></h3>
<dl class="data">
<dt id="tcfl.config.path">
<code class="descclassname">tcfl.config.</code><code class="descname">path</code><em class="property"> = []</em><a class="headerlink" href="#tcfl.config.path" title="Permalink to this definition">¶</a></dt>
<dd><p>The list of paths where we find configuration information</p>
</dd></dl>

<dl class="data">
<dt id="tcfl.config.share_path">
<code class="descclassname">tcfl.config.</code><code class="descname">share_path</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.config.share_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Path where shared files are stored</p>
</dd></dl>

<dl class="data">
<dt id="tcfl.config.urls">
<code class="descclassname">tcfl.config.</code><code class="descname">urls</code><em class="property"> = []</em><a class="headerlink" href="#tcfl.config.urls" title="Permalink to this definition">¶</a></dt>
<dd><p>List of URLs to servers we are working with</p>
<p>each entry is a tuple of:</p>
<ul class="simple">
<li>URL (str): the location of the server</li>
<li>SSL verification (bool): if we are obeying SSL certificate verification</li>
<li>aka (str): short name for the server</li>
<li>ca_path (str): path to certificates</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="tcfl.config.url_add">
<code class="descclassname">tcfl.config.</code><code class="descname">url_add</code><span class="sig-paren">(</span><em>url</em>, <em>ssl_ignore=False</em>, <em>aka=None</em>, <em>ca_path=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.config.url_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a TTBD server</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – server’s URL (<code class="docutils literal notranslate"><span class="pre">http://SERVER:PORT</span></code>); it can be
<em>https</em>; port is most commonly <em>5000</em>.</li>
<li><strong>ssl_ignore</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – if True, skips verifying SSL certificates</li>
<li><strong>aka</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Short form for this server, to use in display messages</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.config.load">
<code class="descclassname">tcfl.config.</code><code class="descname">load</code><span class="sig-paren">(</span><em>config_path=None</em>, <em>config_files=None</em>, <em>state_path='~/.tcf'</em>, <em>ignore_ssl=True</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.config.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the TCF Library configuration</p>
<p>This is needed before you can access from your client program any
other module.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>config_path</strong> – list of strings containing UNIX-style
paths (DIR:DIR) to look for config files (conf_*.py) that will
be loaded in alphabetical order. An empty path clears the
current list.</li>
<li><strong>config_files</strong> – list of extra config files to load</li>
<li><strong>state_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) path where to store state</li>
<li><strong>ignore_ssl</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) wether to ignore SSL
verification or not (useful for self-signed certs)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="module-tcfl">
<span id="tcf-client-internals"></span><h2>8.3. <em>TCF</em> client internals<a class="headerlink" href="#module-tcfl" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="tcfl.msgid_c">
<em class="property">class </em><code class="descclassname">tcfl.</code><code class="descname">msgid_c</code><span class="sig-paren">(</span><em>s=None</em>, <em>s_encode=None</em>, <em>l=4</em>, <em>root=None</em>, <em>phase=None</em>, <em>depth=None</em>, <em>parent=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Accumulate data local to the current running thread.</p>
<p>This is used to generate a random ID (four chars) at the beginning
of the testcase run in a thread by instantiating a local object of
this class. As we call deeper into functions to do different
parts, we instantiate more objects that will add random characters
to said ID <em>just</em> for that call (as when the object created goes
out of scope, the ID is returned to what it was.</p>
<p>So thus, as the call chain gets deeper, the message IDs go:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abcd</span>
<span class="n">abcdef</span>
<span class="n">abcdefgh</span>
<span class="n">abcdefghij</span>
</pre></div>
</div>
<p>this allows for easy identification / lookup on a log file or
classification.</p>
<p>Note we also keep a depth (usefuly for increasing the verbosity of
log messages) and a phase, which we use it to set the phase in
which we are running, so log messages don’t have to specify it.</p>
<p>Note this is to be used as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">msgid_c</span><span class="p">(</span><span class="n">ARGS</span><span class="p">):</span>
  <span class="n">do</span> <span class="n">stuff</span><span class="o">...</span>
  <span class="n">msgid_c</span><span class="o">.</span><span class="n">ident</span><span class="p">()</span>
  <span class="n">msgid_c</span><span class="o">.</span><span class="n">phase</span><span class="p">()</span>
  <span class="n">msgid_c</span><span class="o">.</span><span class="n">depth</span><span class="p">()</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="tcfl.msgid_c.tls">
<code class="descname">tls</code><em class="property"> = &lt;thread._local object&gt;</em><a class="headerlink" href="#tcfl.msgid_c.tls" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.cls_init">
<em class="property">classmethod </em><code class="descname">cls_init</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.cls_init" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.encode">
<em class="property">classmethod </em><code class="descname">encode</code><span class="sig-paren">(</span><em>s</em>, <em>l</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.encode" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.generate">
<em class="property">classmethod </em><code class="descname">generate</code><span class="sig-paren">(</span><em>l=4</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.generate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.depth">
<em class="property">classmethod </em><code class="descname">depth</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.depth" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.phase">
<em class="property">classmethod </em><code class="descname">phase</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.phase" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.ident">
<em class="property">classmethod </em><code class="descname">ident</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.ident" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.current">
<em class="property">classmethod </em><code class="descname">current</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.current" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.parent">
<em class="property">classmethod </em><code class="descname">parent</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.parent" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.origin_get">
<code class="descclassname">tcfl.</code><code class="descname">origin_get</code><span class="sig-paren">(</span><em>depth=1</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.origin_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.origin_get_object">
<code class="descclassname">tcfl.</code><code class="descname">origin_get_object</code><span class="sig-paren">(</span><em>o</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.origin_get_object" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.origin_get_object_path">
<code class="descclassname">tcfl.</code><code class="descname">origin_get_object_path</code><span class="sig-paren">(</span><em>o</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.origin_get_object_path" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<span class="target" id="module-tcfl.expecter"></span><div class="section" id="expecting-things-that-have-to-happen">
<h3>8.3.1. Expecting things that have to happen<a class="headerlink" href="#expecting-things-that-have-to-happen" title="Permalink to this headline">¶</a></h3>
<p>This module implements an <em>expecter</em> object: something that is told to
expect things to happen, what to do when they happen (or not).</p>
<p>It is a combination of a poor man’s select() and Tk/Tcl Expect.</p>
<p>We cannot use select() or Tk/TCL Expect or Python’s PyExpect because:</p>
<ul class="simple">
<li>we need to listen to many things over HTTP connections and the
library is quite very simplistic in that sense, so there is maybe no
point on hooking up a pure event system.</li>
<li>we need to be able to listen to poll for data and evaluate it from
one or more sources (like serial port, sensor, network data,
whatever) in one or more targets all at the same time.</li>
<li>it is simple, and works quite well</li>
</ul>
<p>Any given testcase has an <cite>expecter</cite> object associated with it that
can be used to wait for a list of events to happen in one or more
targets. This allows, for example, to during the execution of a
testcase with multiple nodes, to always have pollers reading (eg)
their serial consoles and evaluators making sure no kernel panics are
happening in none while at the same time checking for the output that
should be coming from them.</p>
<p>The ‘expecter’ object can be also associated just to a single target
for a more simple interface when only access to one target is needed.</p>
<dl class="function">
<dt id="tcfl.expecter.console_mk_code">
<code class="descclassname">tcfl.expecter.</code><code class="descname">console_mk_code</code><span class="sig-paren">(</span><em>target</em>, <em>console</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.console_mk_code" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.expecter.console_mk_uid">
<code class="descclassname">tcfl.expecter.</code><code class="descname">console_mk_uid</code><span class="sig-paren">(</span><em>target</em>, <em>what</em>, <em>console</em>, <em>_timeout</em>, <em>result</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.console_mk_uid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.expecter.console_rx_eval">
<code class="descclassname">tcfl.expecter.</code><code class="descname">console_rx_eval</code><span class="sig-paren">(</span><em>expecter</em>, <em>target</em>, <em>regex</em>, <em>console=None</em>, <em>_timeout=None</em>, <em>result=None</em>, <em>uid=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.console_rx_eval" title="Permalink to this definition">¶</a></dt>
<dd><p>Check what came on a console and act on it</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>uid</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) identifier to use to store offset data</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.expecter.console_rx_flush">
<code class="descclassname">tcfl.expecter.</code><code class="descname">console_rx_flush</code><span class="sig-paren">(</span><em>expecter</em>, <em>target</em>, <em>console=None</em>, <em>truncate=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.console_rx_flush" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset all the console read markers to 0</p>
<p>When we (for example) power cycle, we start capturing from zero,
so we need to reset all the buffers of what we read.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.expecter.console_rx_poller">
<code class="descclassname">tcfl.expecter.</code><code class="descname">console_rx_poller</code><span class="sig-paren">(</span><em>expecter</em>, <em>target</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.console_rx_poller" title="Permalink to this definition">¶</a></dt>
<dd><p>Poll a console</p>
</dd></dl>

<dl class="class">
<dt id="tcfl.expecter.expecter_c">
<em class="property">class </em><code class="descclassname">tcfl.expecter.</code><code class="descname">expecter_c</code><span class="sig-paren">(</span><em>log</em>, <em>testcase</em>, <em>poll_period=0.25</em>, <em>timeout=30</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Object that is told to expect things to happen and what to do when
they happen (or</p>
<p>When calling <a class="reference internal" href="#tcfl.expecter.expecter_c.run" title="tcfl.expecter.expecter_c.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a>, a loop is called by that will run
repeatedly, waiting <a class="reference internal" href="#tcfl.expecter.expecter_c.poll_period" title="tcfl.expecter.expecter_c.poll_period"><code class="xref py py-data docutils literal notranslate"><span class="pre">poll_period</span></code></a> seconds in between
polling periods until a given <a class="reference internal" href="#tcfl.expecter.expecter_c.timeout" title="tcfl.expecter.expecter_c.timeout"><code class="xref py py-data docutils literal notranslate"><span class="pre">timeout</span></code></a> ellapses.</p>
<p>On each loop run, a bunch of functions are run. Functions are
added with <a class="reference internal" href="#tcfl.expecter.expecter_c.add" title="tcfl.expecter.expecter_c.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a> and removed with <a class="reference internal" href="#tcfl.expecter.expecter_c.remove" title="tcfl.expecter.expecter_c.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove()</span></code></a>.</p>
<p>Each function polls and stores data, evals said data or both. It
can then end the loop by raising an exception. It is also possible
that nothing of the interest happened and thus it won’t cause the
loop to end.  thus it will evaluate nothing. See <a class="reference internal" href="#tcfl.expecter.expecter_c.add" title="tcfl.expecter.expecter_c.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a>
for more details</p>
<p>Some of those functions can be considered ‘expectations’ that have
to pass for the full loop to be considered succesful. An boolean
to <a class="reference internal" href="#tcfl.expecter.expecter_c.add" title="tcfl.expecter.expecter_c.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a> clarifies that. All those ‘expectations’ have to
pass before the run can be considered succesful.</p>
<p>The loop will timeout if no evaluating function raises an exception to
get out of it and fail with a timeout.</p>
<p><strong>Rationale</strong></p>
<p>This allows to implement simple usages like waiting for something to
come off any console with a default</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">console</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>which also check for other things we know that can come from the OS in
a console, like abort strings, kernel panics or dumps for which new
know we should abort inmediately with an specific message.</p>
<p>FIXME:</p>
<p>it has to be easy to use and still providing things like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">console</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="kc">True</span> <span class="o">|</span> <span class="kc">False</span> <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">target</span><span class="o">.</span><span class="n">expecter</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">console_rx</span><span class="p">,</span> <span class="p">(</span><span class="n">STRING</span><span class="p">,</span> <span class="n">console</span><span class="p">),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="n">TIMEOUT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">raise</span> <span class="n">error</span><span class="o">/</span><span class="n">fail</span><span class="o">/</span><span class="n">block</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">on_rx</span><span class="p">(</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="k">raise</span> <span class="n">failure</span> <span class="n">function</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="tcfl.expecter.expecter_c.add">
<code class="descname">add</code><span class="sig-paren">(</span><em>has_to_pass</em>, <em>functor</em>, <em>arguments</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a function to the list of things to poll/evaluate</p>
<p>These functions shall either poll, evaluate or both:</p>
<ul class="simple">
<li>poll data and store it in the dictionary or anywhere else
where it can be accessed later. Use a unique key into the
dictorionary <code class="xref py py-data docutils literal notranslate"><span class="pre">buffers</span></code>.</li>
<li>evaluate some previously polled data or whichever system
condition and raise an exception to indicate what happened
(from the set <a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.pass_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.blocked_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.failed_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.skip_e</span></code></a>).</li>
</ul>
<p>Eval functions can check their own timeouts and raise an
exception to signal it (normally
<a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a>)</p>
<p>It is also possible that nothing of the interest of this
evaluation function happened and thus it will evaluate
nothing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>has_to_pass</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – In order to consider the whole expect
sequence a pass, this functor has to declare its evaluation
passes by returning anything but <cite>None</cite> or by raising
<a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.pass_e</span></code></a>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">to stop the <a class="reference internal" href="#tcfl.expecter.expecter_c.run" title="tcfl.expecter.expecter_c.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> loop, raise
<a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.pass_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.blocked_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.error_e</span></code></a> or
<a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.skip_e</span></code></a>.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">ignored</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.expecter.expecter_c.console_get_file">
<code class="descname">console_get_file</code><span class="sig-paren">(</span><em>target</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c.console_get_file" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">file descriptor for the file that contains the
currently read console.</td>
</tr>
</tbody>
</table>
<p>Note the pointer in this file descriptor shall not be modified
as it might be being used by expectations. If you need to read
from the file, dup it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f_existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tls</span><span class="o">.</span><span class="n">expecter</span><span class="o">.</span><span class="n">console_get_file</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">console_id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">f_existing</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tcfl.expecter.expecter_c.log">
<code class="descname">log</code><span class="sig-paren">(</span><em>msg</em>, <em>attachments=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c.log" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.expecter.expecter_c.poll_period">
<code class="descname">poll_period</code><a class="headerlink" href="#tcfl.expecter.expecter_c.poll_period" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.expecter.expecter_c.power_on_post">
<code class="descname">power_on_post</code><span class="sig-paren">(</span><em>target=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c.power_on_post" title="Permalink to this definition">¶</a></dt>
<dd><p>Reinitialize things that need flushing for a new power on</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.expecter.expecter_c.remove">
<code class="descname">remove</code><span class="sig-paren">(</span><em>functor</em>, <em>arguments</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c.remove" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.expecter.expecter_c.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the expectation loop on the testcase until all
expectations pass or the timeout is exceeded.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) maximum time to wait for all
expectations to be met (defaults to
<a class="reference internal" href="#tcfl.expecter.expecter_c.timeout" title="tcfl.expecter.expecter_c.timeout"><code class="xref py py-attr docutils literal notranslate"><span class="pre">tcfl.expecter.expecter_c.timeout</span></code></a>)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.expecter.expecter_c.timeout">
<code class="descname">timeout</code><a class="headerlink" href="#tcfl.expecter.expecter_c.timeout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<span class="target" id="module-tcfl.ttb_client"></span><div class="section" id="client-api-for-accessing-ttbd-s-rest-api">
<h3>8.3.2. Client API for accessing <em>ttbd</em>’s REST API<a class="headerlink" href="#client-api-for-accessing-ttbd-s-rest-api" title="Permalink to this headline">¶</a></h3>
<p>This API provides a way to access teh REST API exposed by the <em>ttbd</em>
daemon; it is divided in two main blocks:</p>
<blockquote>
<div><ul>
<li><p class="first"><a class="reference internal" href="#tcfl.ttb_client.rest_target_broker" title="tcfl.ttb_client.rest_target_broker"><code class="xref py py-class docutils literal notranslate"><span class="pre">rest_target_broker</span></code></a>: abstracts a remote <em>ttbd</em> server and
provides methods to run stuff on targets and and connect/disconnect
things on/from targets.</p>
</li>
<li><p class="first"><cite>rest_*()</cite> methods that take a namespace of arguments, lookup the
object target, map it to a remote server, execute the method and
then print the result to console.</p>
<p>This breakup is a wee arbitrary, it can use some cleanup</p>
</li>
</ul>
</div></blockquote>
<dl class="function">
<dt id="tcfl.ttb_client.import_mp_pathos">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">import_mp_pathos</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.import_mp_pathos" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.import_mp_std">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">import_mp_std</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.import_mp_std" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.tls_var">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">tls_var</code><span class="sig-paren">(</span><em>name</em>, <em>factory</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.tls_var" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="tcfl.ttb_client.rest_target_broker">
<em class="property">class </em><code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_broker</code><span class="sig-paren">(</span><em>state_path</em>, <em>url</em>, <em>ignore_ssl=False</em>, <em>aka=None</em>, <em>ca_path=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a proxy for a target broker, optionally loading state
(like cookies) previously saved.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>state_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Path prefix where to load state from</li>
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – URL for which we are loading state</li>
<li><strong>ignore_ssl</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – Ignore server’s SSL certificate
validation (use for self-signed certs).</li>
<li><strong>aka</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Short name for this server; defaults to the
hostname (sans domain) of the URL.</li>
<li><strong>ca_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Path to SSL certificate or chain-of-trust bundle</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">True if information was loaded for the URL, False otherwise</p>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="tcfl.ttb_client.rest_target_broker.projection">
<code class="descname">projection</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.projection" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.ttb_client.rest_target_broker.API_VERSION">
<code class="descname">API_VERSION</code><em class="property"> = 1</em><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.API_VERSION" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.ttb_client.rest_target_broker.API_PREFIX">
<code class="descname">API_PREFIX</code><em class="property"> = '/ttb-v1/'</em><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.API_PREFIX" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.ttb_client.rest_target_broker.rts_cache_flush">
<em class="property">classmethod </em><code class="descname">rts_cache_flush</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rts_cache_flush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.tb_state_trash">
<code class="descname">tb_state_trash</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.tb_state_trash" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.tb_state_save">
<code class="descname">tb_state_save</code><span class="sig-paren">(</span><em>filepath</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.tb_state_save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save cookies in <em>path</em> so they can be loaded by when the object is
created.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Filename where to save to</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.send_request">
<code class="descname">send_request</code><span class="sig-paren">(</span><em>method</em>, <em>url</em>, <em>data=None</em>, <em>json=None</em>, <em>files=None</em>, <em>stream=False</em>, <em>raw=False</em>, <em>timeout=480</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.send_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Send request to server using url and data, save the cookies
generated from request, search for issues on connection and
raise and exception or return the response object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – url to request</li>
<li><strong>data</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – args to send in the request. default None</li>
<li><strong>method</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – method used to request GET, POST and PUT. default PUT</li>
<li><strong>raise_error</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – if true, raise an error if something goes
wrong in the request. default True</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">response object</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="http://docs.python-requests.org/en/master/api/#requests.Response" title="(in Requests v2.19.1)">requests.Response</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.login">
<code class="descname">login</code><span class="sig-paren">(</span><em>email</em>, <em>password</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.login" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.logout">
<code class="descname">logout</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.logout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.validate_session">
<code class="descname">validate_session</code><span class="sig-paren">(</span><em>validate=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.validate_session" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_list">
<code class="descname">rest_tb_target_list</code><span class="sig-paren">(</span><em>all_targets=False</em>, <em>target_id=None</em>, <em>projection=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_list" title="Permalink to this definition">¶</a></dt>
<dd><p>List targets in this server</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>all_targets</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – If True, include also targets that are marked
as disabled.</li>
<li><strong>target_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Only get information for said target id</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_update">
<code class="descname">rest_tb_target_update</code><span class="sig-paren">(</span><em>target_id</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update information about a target</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>target_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – ID of the target to operate on</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">updated target tags</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_acquire">
<code class="descname">rest_tb_target_acquire</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em>, <em>force=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_acquire" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_active">
<code class="descname">rest_tb_target_active</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_active" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_release">
<code class="descname">rest_tb_target_release</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em>, <em>force=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_release" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_init">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_init</code><span class="sig-paren">(</span><em>path</em>, <em>url</em>, <em>ignore_ssl=False</em>, <em>aka=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize access to a remote target broker.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>state_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Path prefix where to load state from</li>
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – URL for which we are loading state</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">True if information was loaded for the URL, False otherwise</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_shutdown">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_shutdown</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>Shutdown REST API, saving state in <em>path</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Path to where to save state information</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_login">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_login</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_login" title="Permalink to this definition">¶</a></dt>
<dd><p>Login into remote servers.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/argparse.html#argparse.Namespace" title="(in Python v2.7)"><em>argparse.Namespace</em></a>) – login arguments like -q (quiet) or
userid.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if it can be logged into at least 1 remote server.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_logout">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_logout</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_logout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_print">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_print</code><span class="sig-paren">(</span><em>rt</em>, <em>verbosity=0</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_print" title="Permalink to this definition">¶</a></dt>
<dd><p>Print information about a REST target taking into account the
verbosity level from the logging module</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>rt</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – object describing the REST target to print</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_list_table">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_list_table</code><span class="sig-paren">(</span><em>targetl</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_list_table" title="Permalink to this definition">¶</a></dt>
<dd><p>List all the targets in a table format, appending * if powered
up, ! if owned.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.cmdline_list">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">cmdline_list</code><span class="sig-paren">(</span><em>spec_strings</em>, <em>do_all=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.cmdline_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of dictionaries representing targets that match the
specification strings</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>spec_strings</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – list of strings that put together
with a logical <em>and</em> bring the logical specification</li>
<li><strong>do_all</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) include also disabled targets
(defaults to <em>False</em>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_list">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_list</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_find_all">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_find_all</code><span class="sig-paren">(</span><em>all_targets=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_find_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Return descriptors for all the known remote targets</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>all_targets</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – Include or not disabled targets</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of remote target descriptors (each being a dictionary).</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_acquire">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_acquire</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_acquire" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/argparse.html#argparse.Namespace" title="(in Python v2.7)"><em>argparse.Namespace</em></a>) – object containing the processed
command line arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">dictionary of tags</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_release">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_release</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_release" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/argparse.html#argparse.Namespace" title="(in Python v2.7)"><em>argparse.Namespace</em></a>) – object containing the processed
command line arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<span class="target" id="module-tcfl.util"></span><dl class="function">
<dt id="tcfl.util.argp_setup">
<code class="descclassname">tcfl.util.</code><code class="descname">argp_setup</code><span class="sig-paren">(</span><em>arg_subparsers</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.util.argp_setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.util.healthcheck">
<code class="descclassname">tcfl.util.</code><code class="descname">healthcheck</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.util.healthcheck" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.util.healthcheck_power">
<code class="descclassname">tcfl.util.</code><code class="descname">healthcheck_power</code><span class="sig-paren">(</span><em>rtb</em>, <em>rt</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.util.healthcheck_power" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<span class="target" id="module-tcfl.tc_zephyr_sanity"></span><div class="section" id="zephyr-s-sanitycheck-testcase-ini-driver-for-testcase-integration">
<h3>8.3.3. Zephyr’s SanityCheck testcase.ini driver for testcase integration<a class="headerlink" href="#zephyr-s-sanitycheck-testcase-ini-driver-for-testcase-integration" title="Permalink to this headline">¶</a></h3>
<p>This implements a driver to run Zephyr’s Sanity Check testcases
(described with a testcase.ini file) without having to implement any
new descriptions. Details are explained in
<a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tc_zephyr_sanity_c</span></code></a>.</p>
<dl class="exception">
<dt id="tcfl.tc_zephyr_sanity.ConfigurationError">
<em class="property">exception </em><code class="descclassname">tcfl.tc_zephyr_sanity.</code><code class="descname">ConfigurationError</code><a class="headerlink" href="#tcfl.tc_zephyr_sanity.ConfigurationError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="tcfl.tc_zephyr_sanity.SanityConfigParser">
<em class="property">class </em><code class="descclassname">tcfl.tc_zephyr_sanity.</code><code class="descname">SanityConfigParser</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.SanityConfigParser" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to read architecture and test case .ini files with semantic
checking</p>
<p>This is only used for the old, .ini support</p>
<p>Instantiate a new SanityConfigParser object</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Source .ini file to read</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.SanityConfigParser.sections">
<code class="descname">sections</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.SanityConfigParser.sections" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the set of sections within the .ini file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a list of string section names</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.SanityConfigParser.get_section">
<code class="descname">get_section</code><span class="sig-paren">(</span><em>section</em>, <em>valid_keys</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.SanityConfigParser.get_section" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a dictionary representing the keys/values within a section</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>section</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – The section in the .ini file to retrieve data from</li>
<li><strong>valid_keys</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>A dictionary representing the intended
semantics for this section. Each key in this dictionary is
a key that could be specified, if a key is given in the
.ini file which isn’t in here, it will generate an
error. Each value in this dictionary is another dictionary
containing metadata:</p>
<blockquote>
<div>”default” - Default value if not given<dl class="docutils">
<dt>”type” - Data type to convert the text value to. Simple types</dt>
<dd>supported are “str”, “float”, “int”, “bool” which will get
converted to respective Python data types. “set” and “list”
may also be specified which will split the value by
whitespace (but keep the elements as strings). finally,
“list:&lt;type&gt;” and “set:&lt;type&gt;” may be given which will
perform a type conversion after splitting the value up.</dd>
<dt>”required” - If true, raise an error if not defined. If false</dt>
<dd>and “default” isn’t specified, a type conversion will be
done on an empty string</dd>
</dl>
</div></blockquote>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A dictionary containing the section key-value pairs with
type conversion and default values filled in per valid_keys</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc_zephyr_sanity.harness_c">
<em class="property">class </em><code class="descclassname">tcfl.tc_zephyr_sanity.</code><code class="descname">harness_c</code><a class="headerlink" href="#tcfl.tc_zephyr_sanity.harness_c" title="Permalink to this definition">¶</a></dt>
<dd><p>A test harness for a Zephyr test</p>
<p>In the Zephyr SanityCheck environment, a harness is a set of steps
to verify that a testcase did the right thing.</p>
<p>The default harness just verifies if <em>PROJECT EXECUTION FAILED</em> or
<em>PROJECT EXECUTION SUCCESFUL</em>  was printed (which is done in
<a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.eval_50" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.eval_50"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tc_zephyr_sanity_c.eval_50()</span></code></a>).</p>
<p>However, if a harness is specified in the testcase/sample YAML
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">harness</span><span class="p">:</span> <span class="n">HARNESSNAME</span>
<span class="n">harness_config</span><span class="p">:</span>
  <span class="n">field1</span><span class="p">:</span> <span class="n">value1</span>
  <span class="n">field2</span><span class="p">:</span> <span class="n">value2</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>then <em>tc_zephyr_sanity_c._dict_init()</em> will create a harness
object of class <em>_harness_HARNESSNAME_c</em> and set it to
<a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.harness" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.harness"><code class="xref py py-data docutils literal notranslate"><span class="pre">tc_zephyr_sanity_c.harness</span></code></a>. Then, during the evaluation
phase, we’ll run it in <a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.eval_50" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.eval_50"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tc_zephyr_sanity_c.eval_50()</span></code></a>.</p>
<p>The harness object has <a class="reference internal" href="#tcfl.tc_zephyr_sanity.harness_c.evaluate" title="tcfl.tc_zephyr_sanity.harness_c.evaluate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">evaluate()</span></code></a> which is called to
implement the harness on the testcase and target it is running
on.</p>
<p>For each type of harness, there is a class for it implementing the
details of it.</p>
<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.harness_c.evaluate">
<code class="descname">evaluate</code><span class="sig-paren">(</span><em>_testcase</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.harness_c.evaluate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c">
<em class="property">class </em><code class="descclassname">tcfl.tc_zephyr_sanity.</code><code class="descname">tc_zephyr_subsanity_c</code><span class="sig-paren">(</span><em>name</em>, <em>tc_file_path</em>, <em>origin</em>, <em>zephyr_name</em>, <em>parent</em>, <em>attachments=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Subtestcase of a Zephyr Sanity Check</p>
<p>A Zephyr Sanity Check testcase might be composed of one or more
subtestcases.</p>
<p>We run them all in a single shot using <a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tc_zephyr_sanity_c</span></code></a>
and when done, we parse the output
(tc_zephyr_sanity_c._subtestcases_grok) and for each subtestcase,
we create one of this sub testcase objects and queue it to be
executed in the same target where the main testcase was ran.</p>
<p>This is only a construct to ensure they are reported as separate
testcases. We already know if they passed or errored or failed, so
all we do is report as such.</p>
<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.configure_50">
<code class="descname">configure_50</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.configure_50" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.eval_50">
<code class="descname">eval_50</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.eval_50" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.clean">
<em class="property">static </em><code class="descname">clean</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.class_result">
<code class="descname">class_result</code><em class="property"> = 0 (0 0 0 0 0)</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.class_result" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c">
<em class="property">class </em><code class="descclassname">tcfl.tc_zephyr_sanity.</code><code class="descname">tc_zephyr_sanity_c</code><span class="sig-paren">(</span><em>name</em>, <em>tc_file_path</em>, <em>origin</em>, <em>zephyr_name</em>, <em>subcases</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Test case driver specific to Zephyr project testcases</p>
<p>This will generate test actions based on Zephyr project testcase.ini
files.</p>
<p>See Zephyr sanitycheck –help for details on the format on these
testcase configuration files. A single testcase.ini may specify
one or more test cases.</p>
<p>This rides on top of <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.tc_c</span></code></a> driver; tags are
translated, whitelist/excludes are translated to target selection
language and and a single target is declared (for cases that are
not unit tests).</p>
<p><a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_testcase()</span></code></a> looks for <code class="docutils literal notranslate"><span class="pre">testcase.ini</span></code> files, parses up
using <a class="reference internal" href="#tcfl.tc_zephyr_sanity.SanityConfigParser" title="tcfl.tc_zephyr_sanity.SanityConfigParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">SanityConfigParser</span></code></a> to load it up into memory and
calls <code class="docutils literal notranslate"><span class="pre">_dict_init()</span></code> to set values and generate the target
(when needed) and setup the App Zephyr builder.</p>
<p>This is how we map the different testcase.ini sections/concepts to
<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.tc_c</span></code></a> data:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">extra_args</span> <span class="pre">=</span> <span class="pre">VALUES</span></code>: handled as <code class="docutils literal notranslate"><span class="pre">app_zephyr_options</span></code>,
passed to the Zephyr App Builder.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">extra_configs</span> <span class="pre">=</span> <span class="pre">LIST</span></code>: list of extra configuration settings</p>
</li>
<li><p class="first">testcase source is assumed to be in the same directory as the
<code class="docutils literal notranslate"><span class="pre">testcase.ini</span></code> file. Passed to the Zephyr App Builder with
<code class="docutils literal notranslate"><span class="pre">app_zephyr</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">timeout</span> <span class="pre">=</span> <span class="pre">VALUE</span></code>: use to set the timeout in the testcase
expect loop.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">tags</span> <span class="pre">=</span> <span class="pre">TAGS</span></code>: added to the tags list, with an origin</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">skip</span></code>: skipped right away with an <a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tcfl.tc.skip_e</span></code></a> exception</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">slow</span></code>: coverted to tag</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">build_only</span></code>: added as <code class="docutils literal notranslate"><span class="pre">self.build_only</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">(arch,platform)_(whitelist,exclude)</span></code>: what testcase.ini calls
<cite>arch</cite> is a <cite>bsp</cite> in TCF parlance and <cite>platform</cite> maps to the
<cite>zerphyr_board</cite> parameter the Zephyr test targets export on their BSP
specific tags. Thus, our spec becomes something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bsp</span> <span class="o">==</span> <span class="s2">&quot;ARCH1&#39; or bsp == &quot;</span><span class="n">ARCH2</span><span class="s2">&quot; ) and not ( bsp == &quot;</span><span class="n">ARCH3</span><span class="s2">&quot; or bsp == &quot;</span><span class="n">ARCH4</span><span class="s2">&quot;)</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">arch_whitelist</span> <span class="pre">=</span> <span class="pre">ARCH1</span> <span class="pre">ARCH2</span></code> mapped to
<code class="docutils literal notranslate"><span class="pre">&#64;targets</span> <span class="pre">+=</span> <span class="pre">bsp:^(ARCH1|ARCH2)$</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">arch_exclude</span> <span class="pre">=</span> <span class="pre">ARCH1</span> <span class="pre">ARCH2</span></code> mapped to
<code class="docutils literal notranslate"><span class="pre">&#64;targets</span> <span class="pre">+=</span> <span class="pre">bsp:(?!^(ARCH1|ARCH2)$)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">platform_whitelist</span> <span class="pre">=</span> <span class="pre">PLAT1</span> <span class="pre">PLAT2</span></code> mapped to
<code class="docutils literal notranslate"><span class="pre">&#64;targets</span> <span class="pre">+=</span> <span class="pre">board:^(PLAT1|PLAT2)$</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">platform_exclude</span> <span class="pre">=</span> <span class="pre">PLAT1</span> <span class="pre">PLAT2</span></code> mapped to
<code class="docutils literal notranslate"><span class="pre">&#64;targets</span> <span class="pre">+=</span> <span class="pre">board:(?!^(PLAT1|PLAT2)$)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">config_whitelist</span></code> and <code class="docutils literal notranslate"><span class="pre">filter</span></code>: filled into the args
stored in the testcase as which then gets passed as part of
the kws[config_whitelist] dictionary… The build process then
calls the action_eval_skip() method to test if the TC has to
be skipped after creating the base config.</li>
</ul>
</li>
</ul>
<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.harness">
<code class="descname">harness</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.harness" title="Permalink to this definition">¶</a></dt>
<dd><p>Harness to run</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.subtestcases">
<code class="descname">subtestcases</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.subtestcases" title="Permalink to this definition">¶</a></dt>
<dd><p>Subtestcases that are identified as part of this (possibly)
a container testcase.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.unit_test_output">
<code class="descname">unit_test_output</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.unit_test_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Filename of the output of the unit test case; when we run a
unit testcase, the output does not come from the console
system, as it runs local, but from a local file.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.configure_00">
<code class="descname">configure_00</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.configure_00" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.patch_tags">
<code class="descname">patch_tags</code><em class="property"> = {}</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.patch_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of tags that we want to add to given test cases; the
key is the name of the testcase – if the testcase name <em>ends</em> with
the same value as in here, then the given list of boolean tags
will be patched as True; eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;dir1/subdir2/testcase.ini#testname&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;ignore_faults&#39;</span><span class="p">,</span> <span class="s1">&#39;slow&#39;</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>usually this will be setup in a
<code class="docutils literal notranslate"><span class="pre">{/etc/tc,~/.tcf.tcf}/conf_zephy.py</span></code> configuration file as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_zephyr_sanity</span><span class="o">.</span><span class="n">tc_zephyr_sanity_c</span><span class="o">.</span><span class="n">patch_tags</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;tests/legacy/kernel/test_static_idt/testcase.ini#test&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s1">&#39;ignore_faults&#39;</span>
  <span class="p">],</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.patch_hw_requires">
<code class="descname">patch_hw_requires</code><em class="property"> = {}</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.patch_hw_requires" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of <em>hw_requires</em> values that we want to add to given
test cases; the key is the name of the testcase – if the
testcase name <em>ends</em> with the same value as in here, then the
given list of <em>hw_requires</em> will be appended as requirements to
the target; eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;dir1/subdir2/testcase.ini#testname&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;fixture_1&#39;</span> <span class="p">],</span>
  <span class="s2">&quot;dir1/subdir2/testcase2.ini#testname&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;fixture_2&#39;</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>usually this will be setup in a
<code class="docutils literal notranslate"><span class="pre">{/etc/tc,~/.tcf.tcf}/conf_zephy.py</span></code> configuration file as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_zephyr_sanity</span><span class="o">.</span><span class="n">tc_zephyr_sanity_c</span><span class="o">.</span><span class="n">patch_hw_requires</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;dir1/subdir2/testcase.ini#testname&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;fixture_1&#39;</span> <span class="p">],</span>
  <span class="s2">&quot;dir1/subdir2/testcase2.ini#testname&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;fixture_2&#39;</span> <span class="p">],</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.schema_get_file">
<em class="property">classmethod </em><code class="descname">schema_get_file</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.schema_get_file" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.schema_get">
<em class="property">classmethod </em><code class="descname">schema_get</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.schema_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.build_00_tc_zephyr">
<code class="descname">build_00_tc_zephyr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.build_00_tc_zephyr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.build_unit_test">
<code class="descname">build_unit_test</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.build_unit_test" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a Zephyr Unit Test in the local machine</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.eval_50">
<code class="descname">eval_50</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.eval_50" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.data_harvest">
<em class="property">classmethod </em><code class="descname">data_harvest</code><span class="sig-paren">(</span><em>domain</em>, <em>name</em>, <em>regex</em>, <em>main_trigger_regex=None</em>, <em>trigger_regex=None</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.data_harvest" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure a data harverster</p>
<p>After a Zephyr sanity check is executed succesfully, the
output of each target is examined by the data harvesting
engine to extract data to store in the database with
<a class="reference internal" href="#tcfl.tc.reporter_c.report_data" title="tcfl.tc.reporter_c.report_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target.report_data</span></code></a>.</p>
<p>The harvester is a very simple state machine controlled by up
to three regular expressions whose objective is to extract a
value, that will be reported to the datase as a
domain/name/value triad.</p>
<p>A domain groups together multiple name/value pairs that are
related (for example, latency measurements).</p>
<p>Each line of output will be matched by each of the entries
registered with this function.</p>
<p>All arguments (except for <em>origin</em>) will expand ‘%(FIELD)s’
with values taken from the target’s keywords
(<a class="reference internal" href="#tcfl.tc.target_c.kws" title="tcfl.tc.target_c.kws"><code class="xref py py-data docutils literal notranslate"><span class="pre">tcfl.tc.target_c.kws</span></code></a>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>domain</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – to which domain this measurement applies
(eg: “Latency Benchmark %(type)s”);
It is recommended this is used to aggregate values to
different types of targets.</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the value  (eg: “context switch
(microseconds)”)</li>
<li><strong>regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – regular expression to match against each
line of the target’s output. A Python regex
‘(?P&lt;value&gt;SOMETHING)` has to be used to point to the value
that has to be extracted (eg: “context switch time
(?P&lt;value&gt;[0-9]+) usec”).</li>
<li><strong>main_trigger_regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) only look for
<em>regex</em> if this regex has already been found. This trigger
is then considered active for the rest of the output.
This is used to enable searching this if there is a banner
in the output that indicates that the measurements are about
to follow (eg: “Latency Benchmark starts here).</li>
<li><strong>trigger_regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) only look for
<em>regex</em> if this regex has already been found. However, once
<em>regex</em> is found, then this trigger is deactivated.
This is useful when the measurements are reported in two
lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">measuring</span> <span class="n">context</span> <span class="n">switch</span> <span class="n">like</span> <span class="n">this</span>
<span class="n">measurement</span> <span class="ow">is</span> <span class="n">X</span> <span class="n">usecs</span>
</pre></div>
</div>
<p>and thus the regex could catch multiple lines because
another measurement is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">measuring</span> <span class="n">context</span> <span class="n">switch</span> <span class="n">like</span> <span class="n">that</span>
<span class="n">measurement</span> <span class="ow">is</span> <span class="n">X</span> <span class="n">usecs</span>
</pre></div>
</div>
<p>the regex <cite>measurement is (?P&lt;value&gt;[0-9]) usecs</cite> would
catch both, but by giving it a <em>trigger_regex</em> of <cite>measuring
context switch like this</cite>, then it will catch only the
first, as once it is found, the trigger is removed.</p>
</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) where this values are coming
from; if not specified, it will be the call site for the
function.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.subtc_results_valid">
<code class="descname">subtc_results_valid</code><em class="property"> = ('PASS', 'FAIL', 'SKIP')</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.subtc_results_valid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.subtc_regex">
<code class="descname">subtc_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.subtc_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.teardown_subtestcases">
<code class="descname">teardown_subtestcases</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.teardown_subtestcases" title="Permalink to this definition">¶</a></dt>
<dd><p>Given the output of the testcases, parse subtestcases for each target</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.teardown">
<code class="descname">teardown</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.teardown" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.clean">
<code class="descname">clean</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.filename_regex">
<code class="descname">filename_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.filename_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.filename_yaml_regex">
<code class="descname">filename_yaml_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.filename_yaml_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase">
<em class="property">classmethod </em><code class="descname">is_testcase</code><span class="sig-paren">(</span><em>path</em>, <em>_from_path</em>, <em>tc_name</em>, <em>subcases_cmdline</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine if a given file describes one or more testcases and
crete them</p>
<p>TCF’s test case discovery engine calls this method for each
file that could describe one or more testcases. It will
iterate over all the files and paths passed on the command
line files and directories, find files and call this function
to enquire on each.</p>
<p>This function’s responsibility is then to look at the contents
of the file and create one or more objects of type
<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.tc_c</span></code></a> which represent the testcases to be
executed, returning them in a list.</p>
<p>When creating <a class="reference internal" href="glossary.html#term-testcase-driver"><span class="xref std std-term">testcase driver</span></a>, the driver has to
create its own version of this function. The default
implementation recognizes python files called <em>test_*.py</em> that
contain one or more classes that subclass <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.tc_c</span></code></a>.</p>
<p>See examples of drivers in:</p>
<ul class="simple">
<li><a class="reference internal" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase" title="tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase()</span></code></a></li>
<li><a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase()</span></code></a></li>
<li><a class="reference internal" href="04-HOWTOs.html#module-examples.test_ptest_runner" title="examples.test_ptest_runner"><code class="xref py py-meth docutils literal notranslate"><span class="pre">examples.test_ptest_runner()</span></code></a> (<a class="reference internal" href="glossary.html#term-impromptu-testcase-driver"><span class="xref std std-term">impromptu
testcase driver</span></a>)</li>
</ul>
<p>note drivers need to be registered with
<a class="reference internal" href="#tcfl.tc.tc_c.driver_add" title="tcfl.tc.tc_c.driver_add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.driver_add()</span></code></a>; on the other hand, a Python
<a class="reference internal" href="glossary.html#term-impromptu-testcase-driver"><span class="xref std std-term">impromptu testcase driver</span></a> needs no registration, but
the test class has to be called <em>_driver</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – path and filename of the file that has to be
examined; this is always a regular file (or symlink to it).</li>
<li><strong>from_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>source command line argument this file
was found on; e.g.: if <em>path</em> is <em>dir1/subdir/file</em>, and the
user ran:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf run somefile dir1/ dir2/
</pre></div>
</div>
<p><em>tcf run</em> found this under the second argument and thus:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">from_path</span> <span class="o">=</span> <span class="s2">&quot;dir1&quot;</span>
</pre></div>
</div>
</li>
<li><strong>tc_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – testcase name the core has determine based
on the path and subcases specified on the command line; the
driver can override it, but it is recommended it is kept.</li>
<li><strong>subcases_cmdline</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – <p>list of subcases the user
has specified in the command line; e.g.: for:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf run test_something.py#sub1#sub2
</pre></div>
</div>
<p>this would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">subcases_cmdline</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;sub1&#39;</span><span class="p">,</span> <span class="s1">&#39;sub2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of testcases found in <em>path</em>, empty if none
found or file not recognized / supported.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.class_result">
<code class="descname">class_result</code><em class="property"> = 0 (0 0 0 0 0)</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.class_result" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<span class="target" id="module-tcfl.tc_clear_bbt"></span><p>Driver to run Clear Linux BBT test suite</p>
<p>The main TCF testcase scanner walks files looking for automation
scripts / testcase scripts and will call
<a class="reference internal" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase" title="tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tc_clear_bbt_c.is_testcase()</span></code></a> for each <code class="docutils literal notranslate"><span class="pre">*.t</span></code> files on a
directory. The driver will generate one testcase per directory which
will execute all the <code class="docutils literal notranslate"><span class="pre">.t</span></code> in there and then execute all the <code class="docutils literal notranslate"><span class="pre">.t</span></code>
in the any-bundle subdirectory.</p>
<p>The testcases created are instances of <a class="reference internal" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c" title="tcfl.tc_clear_bbt.tc_clear_bbt_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tc_clear_bbt_c</span></code></a>; this
class will allocate one interconnect/network and one
<a class="reference internal" href="03-server-setup.html#pos-setup"><span class="std std-ref">*pos_capable*</span></a> target. In said target it will
install Clear OS (from an image server in the interconnect) during the
<em>deploy</em> phase.</p>
<p>Once then installation is done, it will install any required bundles
and execute all the <code class="docutils literal notranslate"><span class="pre">.t</span></code> files in the directory followed by all the
<code class="docutils literal notranslate"><span class="pre">.t</span></code> in the <em>any-bundle</em> top level directory.</p>
<p>The output of each <code class="docutils literal notranslate"><span class="pre">.t</span></code> execution is parsed with
<a class="reference internal" href="#tcfl.tc_clear_bbt.tap_parse_output" title="tcfl.tc_clear_bbt.tap_parse_output"><code class="xref py py-func docutils literal notranslate"><span class="pre">tap_parse_output()</span></code></a> to generate for each a subcase (an instance
of <a class="reference internal" href="#tcfl.tc.subtc_c" title="tcfl.tc.subtc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">subcases</span></code></a>) which will report the
individual result of that subcase execution.</p>
<p><strong>Setup steps</strong></p>
<p>To improve the deployment of the BBT tree, a copy can be kept in the
server’s rsync image area for initial seeding; to setup, execute in
the server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir -p /home/ttbd/images/misc
$ git clone URL/bbt.git /home/ttbd/images/misc/bbt.git
</pre></div>
</div>
<dl class="function">
<dt id="tcfl.tc_clear_bbt.tap_parse_output">
<code class="descclassname">tcfl.tc_clear_bbt.</code><code class="descname">tap_parse_output</code><span class="sig-paren">(</span><em>output</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_clear_bbt.tap_parse_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse <a class="reference external" href="https://testanything.org/tap-version-13-specification.html">TAP</a>
into a dictionary</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>output</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – TAP formatted output</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">dictionary keyed by test subject containing a dictionary
of key/values:
- lines: list of line numbers in the output where data was found
- plan_count: test case number according to the TAP plan
- result: result of the testcase (ok or not ok)
- directive: if any directive was found, the text for it
- output: output specific to this testcase</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="data">
<dt id="tcfl.tc_clear_bbt.ignore_ts">
<code class="descclassname">tcfl.tc_clear_bbt.</code><code class="descname">ignore_ts</code><em class="property"> = []</em><a class="headerlink" href="#tcfl.tc_clear_bbt.ignore_ts" title="Permalink to this definition">¶</a></dt>
<dd><p>Ignore t files</p>
<p>List of individual .t files to ignore, since we can’t filter
those on the command line; this can be done  in a <a class="reference internal" href="04-HOWTOs.html#tcf-client-configuration"><span class="std std-ref">config file</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_clear_bbt</span><span class="o">.</span><span class="n">ignore_ts</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;bundles/XYZ/somefile.t&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;bundles/ABC/someother.t&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;.*/any#somefile.sometestcase&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">]</span>
</pre></div>
</div>
<p>or from the command line, byt setting the BBT_IGNORE_TS
environment variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export BBT_IGNORE_TS=&quot;bundles/XYZ/somefile.t #bundles/ABC/someother.t .*/any#somefile.sometestcase&quot;
$ tcf run bbt.git/bundles/XYZ bbt.git/bundles/ABC
</pre></div>
</div>
<p>Note all entries will be compiled as Python regular expressions
that have to match from the beginning. A whole .t file can be
excluded with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;bundles/XYZ/somefile.t&#39;</span>
</pre></div>
</div>
<p>where as a particular testcase in said file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;bundles/XYZ/somefile.subcasename&#39;</span>
</pre></div>
</div>
<p>note those subcases still will be executed (there is no way for the
<em>bats</em> tool to be told to ignore) but their results will be ignored.</p>
</dd></dl>

<dl class="data">
<dt id="tcfl.tc_clear_bbt.bundle_run_timeouts">
<code class="descclassname">tcfl.tc_clear_bbt.</code><code class="descname">bundle_run_timeouts</code><em class="property"> = {'bat-R-extras-R-library_parallel.t': 480, 'bat-desktop-kde-apps-gui.t': 800, 'bat-desktop-kde-gui.t': 800, 'bat-mixer.t': 3000, 'bat-os-testsuite-phoronix.t': 600, 'bat-os-utils-gui-dev-pkgconfig-compile.t': 400, 'bat-perl-basic-perl-use_parallel.t': 1800, 'bat-perl-extras-perl-use_parallel.t': 20000, 'bat-xfce4-desktop-bin-help.t': 800, 'bat-xfce4-desktop-gui.t': 800, 'kvm-host': 480, 'os-clr-on-clr': 640, 'perl-basic': 480, 'perl-extras': 12000, 'quick-perms.t': 3000, 'telemetrics': 480, 'xfce4-desktop': 800}</em><a class="headerlink" href="#tcfl.tc_clear_bbt.bundle_run_timeouts" title="Permalink to this definition">¶</a></dt>
<dd><p>How long to wait for the BBT run to take?</p>
<p>Each test case might take longer or shorter to run, but there is no
good way to tell. Thus we hardcode some by bundle name or by .t
name.</p>
<p>More settings can be added from configuration by adding to any
<a class="reference internal" href="04-HOWTOs.html#tcf-client-configuration"><span class="std std-ref">TCF configuration file</span></a> entries
such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_clear_bbt</span><span class="o">.</span><span class="n">bundle_run_timeouts</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">456</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_clear_bbt</span><span class="o">.</span><span class="n">bundle_run_timeouts</span><span class="p">[</span><span class="s1">&#39;NAME2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_clear_bbt</span><span class="o">.</span><span class="n">bundle_run_timeouts</span><span class="p">[</span><span class="s1">&#39;NAME3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="tcfl.tc_clear_bbt.bundle_run_pre_sh">
<code class="descclassname">tcfl.tc_clear_bbt.</code><code class="descname">bundle_run_pre_sh</code><em class="property"> = {'bat-perl-basic-perl-use.t': ['export PERL_CANARY_STABILITY_NOPROMPT=1']}</em><a class="headerlink" href="#tcfl.tc_clear_bbt.bundle_run_pre_sh" title="Permalink to this definition">¶</a></dt>
<dd><p>Commands to execute before running bats on each .t file (key by .t
file name or bundle-under-test name).</p>
<p>Note these will be executed in the bundle directory and templated
with <code class="docutils literal notranslate"><span class="pre">STR</span> <span class="pre">%</span> <span class="pre">testcase.kws</span></code>.</p>
</dd></dl>

<dl class="data">
<dt id="tcfl.tc_clear_bbt.bundle_path_map">
<code class="descclassname">tcfl.tc_clear_bbt.</code><code class="descname">bundle_path_map</code><em class="property"> = [(&lt;_sre.SRE_Pattern object&gt;, '\\g&lt;1&gt;')]</em><a class="headerlink" href="#tcfl.tc_clear_bbt.bundle_path_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Map bundle path names</p>
<p>Ugly case here; this is a bad hack to work around another one.</p>
<p>In some testcases, the <em>.t</em> file is an actuall shell script that
does some setup and then executes a real <em>.t</em> file, which has been
detected with different name while we scanned for subcases.</p>
<p>So this allows us to map what we detect (the regex) to what bats is
then reported when running that hack (the replacement).</p>
<p>Confusing.</p>
</dd></dl>

<dl class="data">
<dt id="tcfl.tc_clear_bbt.bundle_t_map">
<code class="descclassname">tcfl.tc_clear_bbt.</code><code class="descname">bundle_t_map</code><em class="property"> = {'bat-dev-tooling.t.autospec_nano': 'build-package.autospec_nano'}</em><a class="headerlink" href="#tcfl.tc_clear_bbt.bundle_t_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Sometime this works in conjunction with <a class="reference internal" href="#tcfl.tc_clear_bbt.bundle_path_map" title="tcfl.tc_clear_bbt.bundle_path_map"><code class="xref py py-data docutils literal notranslate"><span class="pre">bundle_path_map</span></code></a>
above, when a .t file is actually calling another one (maybe in
another directory, then you need an entry in
<a class="reference internal" href="#tcfl.tc_clear_bbt.bundle_path_map" title="tcfl.tc_clear_bbt.bundle_path_map"><code class="xref py py-data docutils literal notranslate"><span class="pre">bundle_path_map</span></code></a>) to rename the directory to match the entry
of this one.</p>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<p>In the hardcoded example, <em>bat-dev-tooling.t</em> is just doing
something to prep and then exec’ing bats to run
<em>t/build-package.t</em>.</p>
<p class="last">So we need to map the directory <em>t</em> out and also rename the
entry from <em>build-package.t/something</em> that would be found from
scanning the output to what is expected from scanning the
testcases in disk.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c">
<em class="property">class </em><code class="descclassname">tcfl.tc_clear_bbt.</code><code class="descname">tc_clear_bbt_c</code><span class="sig-paren">(</span><em>path</em>, <em>t_file_path</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Driver to load Clear Linux BBT test cases</p>
<p>A BBT test case is specified in <cite>bats
&lt;https://github.com/sstephenson/bats&gt;_</cite> format in a <code class="docutils literal notranslate"><span class="pre">FILENAME.t</span></code></p>
<p>This driver gets called by the core testcase scanning system
through the entry point <a class="reference internal" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase" title="tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_testcase()</span></code></a>–in quite a simplistic
way, if it detects the file is  <code class="docutils literal notranslate"><span class="pre">FILENAME.t</span></code>, it decides it is
valid and creates a class instance off the file path.</p>
<p>The class instance serves as a testcase script that will:</p>
<ul>
<li><p class="first">in the deployment phase (deploy method):</p>
<ol class="arabic">
<li><p class="first">Request a Clear Linux image to be installed in the target
system using the provisioning OS.</p>
</li>
<li><p class="first">Deploy the BBT tree to the target’s <code class="docutils literal notranslate"><span class="pre">/opt/bbt.git</span></code> so
testcases have all the dependencies they need to run
(at this point we assume the git tree is available).</p>
<p>Assumes the BBT tree has an specific layout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DIR</span><span class="o">/</span><span class="n">SUBDIR</span><span class="o">/</span><span class="n">SUBSUBDIR</span><span class="p">[</span><span class="o">/...</span><span class="p">]</span><span class="o">/</span><span class="n">NAME</span><span class="o">/*.</span><span class="n">t</span>
<span class="nb">any</span><span class="o">-</span><span class="n">bundles</span><span class="o">/*.</span><span class="n">t</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p class="first">on the start phase:</p>
<ol class="arabic simple">
<li>power cycle the target machine to boot and login into Clear</li>
<li>install the <em>software-testing</em> bundle and any others
specified in an optional ‘requirements’ file. Maybe use a
mirror for <em>swupd</em>.</li>
</ol>
</li>
<li><p class="first">on the evaluation phase:</p>
<ol class="arabic simple">
<li>run <em>bats</em> on the <code class="docutils literal notranslate"><span class="pre">FILENAME.t</span></code> which we have copied to
<code class="docutils literal notranslate"><span class="pre">/opt/bbt.git</span></code>.</li>
<li><a class="reference internal" href="#tcfl.tc_clear_bbt.tap_parse_output" title="tcfl.tc_clear_bbt.tap_parse_output"><code class="xref py py-func docutils literal notranslate"><span class="pre">parse</span> <span class="pre">the</span> <span class="pre">output</span></code></a> into subcases to
report their results individually using
<a class="reference internal" href="#tcfl.tc.subtc_c" title="tcfl.tc.subtc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.subtc_c</span></code></a></li>
</ol>
</li>
</ul>
<dl class="attribute">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.capture_boot_video_source">
<code class="descname">capture_boot_video_source</code><em class="property"> = 'screen_stream'</em><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.capture_boot_video_source" title="Permalink to this definition">¶</a></dt>
<dd><p>Shall we capture a boot video if possible?</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.configure_00_set_relpath_set">
<code class="descname">configure_00_set_relpath_set</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.configure_00_set_relpath_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.image">
<code class="descname">image</code><em class="property"> = 'clear'</em><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.image" title="Permalink to this definition">¶</a></dt>
<dd><p>Specification of image to install</p>
<p>default to whatever is configured on the environment (if any)
for quick setup; otherwise it can be configured in a TCF
configuration file by adding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_clear_bbt</span><span class="o">.</span><span class="n">tc_clear_bbt_c</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="s2">&quot;clear::24800&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.swupd_url">
<code class="descname">swupd_url</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.swupd_url" title="Permalink to this definition">¶</a></dt>
<dd><p>swupd mirror to use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_clear_bbt</span><span class="o">.</span><span class="n">tc_clear_bbt_c</span><span class="o">.</span><span class="n">swupd_url</span> <span class="o">=</span> \
<span class="gp">&gt;&gt;&gt; </span>     <span class="s2">&quot;http://someupdateserver.com/update/&quot;</span>
</pre></div>
</div>
<p>Note this can use keywords exported by the interconnect, eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_clear_bbt</span><span class="o">.</span><span class="n">tc_clear_bbt_c</span><span class="o">.</span><span class="n">swupd_url</span> <span class="o">=</span> \
<span class="gp">&gt;&gt;&gt; </span>     <span class="s2">&quot;http://</span><span class="si">%(MYFIELD)s</span><span class="s2">/update/&quot;</span>
</pre></div>
</div>
<p>where:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list -vv nwa | grep MYFIELD
  MYFIELD: someupdateserver.com
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.image_tree">
<code class="descname">image_tree</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.image_tree" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.swupd_debug">
<code class="descname">swupd_debug</code><em class="property"> = False</em><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.swupd_debug" title="Permalink to this definition">¶</a></dt>
<dd><p>Do we add debug output to swupd?</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.mapping">
<code class="descname">mapping</code><em class="property"> = {'not ok': 1 (0 0 1 0 0), 'ok': 1 (1 0 0 0 0), 'skip': 1 (0 0 0 0 1), 'todo': 1 (0 1 0 0 0)}</em><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.mapping" title="Permalink to this definition">¶</a></dt>
<dd><p>Mapping from TAPS output to TCF conditions</p>
<p>This can be adjusted globally for all testcases or per testcase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_clear_bbt</span><span class="o">.</span><span class="n">tc_clear_bbt_c</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;skip&#39;</span><span class="p">]</span> \
<span class="gp">&gt;&gt;&gt; </span>     <span class="o">=</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">result_c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>      <span class="c1"># pass</span>
</pre></div>
</div>
<p>or for an specific testcase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcobject</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BLCK&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.boot_mgr_disable">
<code class="descname">boot_mgr_disable</code><em class="property"> = False</em><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.boot_mgr_disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable efibootmgr and clr-boot-manager</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.fix_time">
<code class="descname">fix_time</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.fix_time" title="Permalink to this definition">¶</a></dt>
<dd><p>if environ SWUPD_FIX_TIME is defined, set the target’s time to
the client’s time</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.deploy">
<code class="descname">deploy</code><span class="sig-paren">(</span><em>ic</em>, <em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.deploy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>ic</em>, <em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.eval">
<code class="descname">eval</code><span class="sig-paren">(</span><em>ic</em>, <em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.eval" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.teardown_50">
<code class="descname">teardown_50</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.teardown_50" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.clean">
<em class="property">static </em><code class="descname">clean</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.ignore_stress">
<code class="descname">ignore_stress</code><em class="property"> = True</em><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.ignore_stress" title="Permalink to this definition">¶</a></dt>
<dd><p>(bool) ignores stress testcases</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.paths">
<code class="descname">paths</code><em class="property"> = {}</em><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.paths" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.filename_regex">
<code class="descname">filename_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.filename_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase">
<em class="property">classmethod </em><code class="descname">is_testcase</code><span class="sig-paren">(</span><em>path</em>, <em>_from_path</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine if a given file describes one or more testcases and
crete them</p>
<p>TCF’s test case discovery engine calls this method for each
file that could describe one or more testcases. It will
iterate over all the files and paths passed on the command
line files and directories, find files and call this function
to enquire on each.</p>
<p>This function’s responsibility is then to look at the contents
of the file and create one or more objects of type
<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.tc_c</span></code></a> which represent the testcases to be
executed, returning them in a list.</p>
<p>When creating <a class="reference internal" href="glossary.html#term-testcase-driver"><span class="xref std std-term">testcase driver</span></a>, the driver has to
create its own version of this function. The default
implementation recognizes python files called <em>test_*.py</em> that
contain one or more classes that subclass <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.tc_c</span></code></a>.</p>
<p>See examples of drivers in:</p>
<ul class="simple">
<li><a class="reference internal" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase" title="tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc_clear_bbt.tc_clear_bbt_c.is_testcase()</span></code></a></li>
<li><a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase()</span></code></a></li>
<li><a class="reference internal" href="04-HOWTOs.html#module-examples.test_ptest_runner" title="examples.test_ptest_runner"><code class="xref py py-meth docutils literal notranslate"><span class="pre">examples.test_ptest_runner()</span></code></a> (<a class="reference internal" href="glossary.html#term-impromptu-testcase-driver"><span class="xref std std-term">impromptu
testcase driver</span></a>)</li>
</ul>
<p>note drivers need to be registered with
<a class="reference internal" href="#tcfl.tc.tc_c.driver_add" title="tcfl.tc.tc_c.driver_add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tcfl.tc.tc_c.driver_add()</span></code></a>; on the other hand, a Python
<a class="reference internal" href="glossary.html#term-impromptu-testcase-driver"><span class="xref std std-term">impromptu testcase driver</span></a> needs no registration, but
the test class has to be called <em>_driver</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – path and filename of the file that has to be
examined; this is always a regular file (or symlink to it).</li>
<li><strong>from_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>source command line argument this file
was found on; e.g.: if <em>path</em> is <em>dir1/subdir/file</em>, and the
user ran:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf run somefile dir1/ dir2/
</pre></div>
</div>
<p><em>tcf run</em> found this under the second argument and thus:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">from_path</span> <span class="o">=</span> <span class="s2">&quot;dir1&quot;</span>
</pre></div>
</div>
</li>
<li><strong>tc_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – testcase name the core has determine based
on the path and subcases specified on the command line; the
driver can override it, but it is recommended it is kept.</li>
<li><strong>subcases_cmdline</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – <p>list of subcases the user
has specified in the command line; e.g.: for:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf run test_something.py#sub1#sub2
</pre></div>
</div>
<p>this would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">subcases_cmdline</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;sub1&#39;</span><span class="p">,</span> <span class="s1">&#39;sub2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of testcases found in <em>path</em>, empty if none
found or file not recognized / supported.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_clear_bbt.tc_clear_bbt_c.class_result">
<code class="descname">class_result</code><em class="property"> = 0 (0 0 0 0 0)</em><a class="headerlink" href="#tcfl.tc_clear_bbt.tc_clear_bbt_c.class_result" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="target-metadata">
<h2>8.4. Target metadata<a class="headerlink" href="#target-metadata" title="Permalink to this headline">¶</a></h2>
<p>Each target has associated a list of metadata, some of them common to
all targets, some of them driver or target type specific that you can
get on the command line with <code class="docutils literal notranslate"><span class="pre">tcf</span> <span class="pre">list</span> <span class="pre">-vvv</span> <span class="pre">TARGETNAME</span></code> or in a test
script in the dictionary <a class="reference internal" href="#tcfl.tc.target_c.rt" title="tcfl.tc.target_c.rt"><code class="xref py py-data docutils literal notranslate"><span class="pre">tcfl.tc.target_c.rt</span></code></a> (for Remote
Target), or more generally in the keywor dictionary
<a class="reference internal" href="#tcfl.tc.target_c.kws" title="tcfl.tc.target_c.kws"><code class="xref py py-data docutils literal notranslate"><span class="pre">tcfl.tc.target_c.kws</span></code></a>.</p>
<p>Metada is specified:</p>
<ul>
<li><p class="first">in the server’s read only configuration by setting tags to the
target during creation of the <a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.test_target</span></code></a> object, by
passing a dictionary to <a class="reference internal" href="#ttbl.config.target_add" title="ttbl.config.target_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">ttbl.config.target_add()</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">tt</span><span class="o">.</span><span class="n">tt_serial</span><span class="p">(</span><span class="o">....</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;linux&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;pos_capable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;pos_boot_interconnect&#39;</span><span class="p">:</span> <span class="s2">&quot;nwb&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;pos_boot_dev&#39;</span><span class="p">:</span> <span class="s2">&quot;sda&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;pos_partsizes&#39;</span><span class="p">:</span> <span class="s2">&quot;1:20:50:15&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;linux_serial_console_default&#39;</span><span class="p">:</span> <span class="s1">&#39;ttyUSB0&#39;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;Intel NUC5i5425OU&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>or by calling <a class="reference internal" href="#ttbl.test_target.tags_update" title="ttbl.test_target.tags_update"><code class="xref py py-func docutils literal notranslate"><span class="pre">ttbl.test_target.tags_update()</span></code></a> on an already
created target</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;nwb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tags_update</span><span class="p">({</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;mac_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;00:50:b6:27:4b:77&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">})</span>
</pre></div>
</div>
</li>
<li><p class="first">during runtime, from the client with <em>tcf
property-set</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf property-set TARGETNAME PROPERTY VALUE
</pre></div>
</div>
<p>or calling <a class="reference internal" href="#tcfl.tc.target_c.property_set" title="tcfl.tc.target_c.property_set"><code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.tc.target_c.property_set()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">property_set</span><span class="p">(</span><span class="s2">&quot;PROPERTY&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUE&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="common-metadata">
<h3>8.4.1. Common metadata<a class="headerlink" href="#common-metadata" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><em>bios_boot_time</em> (int): approx time in seconds the system takes to
boot before it can be half useful (like BIOS can interact, etc).</p>
<p>Considered as zero if missing.</p>
</li>
<li><p class="first"><em>id</em> (str): name of the target</p>
</li>
<li><p class="first"><em>fullid</em> (str): Full name of the target that includes the server’s
short name (<em>AKA</em>); <em>SERVERAKA/ID</em>.</p>
</li>
<li><p class="first"><em>TARGETNAME</em> (bool) True</p>
</li>
<li><p class="first"><em>bsp_models</em> (list of str): ways in which the BSPs in a target
(described in the <em>bsps</em> dictionary) can be used.</p>
<p>If a target has more than one BSP, how can they be combined? e.g:</p>
<ul class="simple">
<li>BSP1</li>
<li>BSP2</li>
<li>BSP1+2</li>
<li>BSP1+3</li>
</ul>
<p>would describe that in a target with three BSPs, 1 and 2 can be used
individually or the target can operate using 1+2 or 1+3 together
(but not 3+2 or 1+2+3).</p>
</li>
<li><p class="first"><em>bsps</em> (dictionary of dictionaries keyed by BSP name): describes
each BSP the target contains</p>
<p>A target that is capable of computing (eg: an MCU board vs let’s
say, a toaster) would describe a BSP; each BSP dictionary contains
the following keys:</p>
<ul class="simple">
<li><em>cmdline</em> (str): [QEMU driver] command line used to boot a QEMU
target</li>
<li><em>zephyr_board</em> (str): [Zephyr capable targets] identifier to use
for building Zephyr OS applications for this board as the <em>BOARD</em>
parameter to the Zephyr build process.</li>
<li><em>zephyr_kernelname</em> (str): [Zephyr capable targets] name of the
file to use as Zephyr image resulting from the Zephyr OS build
process.</li>
<li><em>sketch_fqbn</em> (str): [Sketch capable targets] identifier to use
for building Arduino applications for this board.</li>
<li><em>sketch_kernelname</em> (str): [Sketch capable targets] name of the
file to use as image resulting from the Sketch build process.</li>
</ul>
</li>
<li><p class="first"><em>disabled</em> (bool): True if the target is disabled, False otherwise.</p>
</li>
<li><p class="first"><em>fixture_XYZ</em> (bool): when present and True, the target exposes
feature (or a test fixture) named XYZ</p>
</li>
<li><p class="first"><em>interconnects</em> (dictionary of dictionaries keyed by interconnect
name):</p>
<p>When a target belongs to an interconnect, there will be an entry
here naming the interconnect. Note the interconnect might be in
another server, not necessarily in the same server as the target is.</p>
<p>Each interconnect might have the following (or other fields) with
address assignments, etc:</p>
<ul class="simple">
<li><em>bt_addr</em> (str): Bluetooth Address (48bits HH:HH:HH:HH:HH:HH,
where HH are two hex digits) that will be assigned to this target
in this interconnect (when describing a Bluetooth interconnect)</li>
<li><em>mac_addr</em> (str): Ethernet Address (48bits HH:HH:HH:HH:HH:HH,
where HH are two hex digits) that will be assigned to this target
in this interconnect (when describing ethernet or similar
interconnects)</li>
<li><em>ipv4_addr</em> (str): IPv4 Address (32bits, <em>DDD.DDD.DDD.DDD</em>, where
<em>DDD</em> are decimal integers 0-255) that will be assigned to this
target in this interconnect</li>
<li><em>ipv4_prefix_len</em> (int): length in bits of the network portion of
the IPv4 address</li>
<li><em>ipv6_addr</em> (str): IPv6 Address (128bits, standard ipv6 colon
format) that will be assigned to this target in this interconnect</li>
<li><em>ipv4_prefix_len</em> (int): length in bits of the network portion of
the IPv6 address</li>
</ul>
</li>
<li><p class="first"><em>idle_poweroff</em> (int): seconds the target will be idle before the
system will automatically power it off (if 0, it will never be
powered off).</p>
</li>
<li><p class="first"><em>interfaces</em> (list of str): list of interface names</p>
</li>
<li><p class="first"><em>interfaces_names</em> (str): list of interface names as a single string
separated by spaces</p>
</li>
<li><p class="first"><em>mutex</em> (str): who is the current owner of the target</p>
</li>
<li><p class="first"><em>owner</em> (str): who is the current owner of the target</p>
</li>
<li><p class="first"><em>path</em> (str): path where the target state is maintained</p>
</li>
<li><p class="first"><em>things</em> (list of str): list of names of targets that can be
plugged/unplugged to/from this target.</p>
</li>
<li><p class="first"><em>type</em> (str): type of the target</p>
</li>
</ul>
</div>
<div class="section" id="interface-specific-metadata">
<h3>8.4.2. Interface specific metadata<a class="headerlink" href="#interface-specific-metadata" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><em>consoles</em> (list of str): [console interface] names of serial
consoles supported by the target</li>
<li><em>debug-BSP-gdb-tcp-port</em> (int): [debug interface] TCF port on which
to reach a GDB remote stub for the given BSP (depending on target
capability).</li>
<li><em>images-TYPE-QUALIFIER</em> (str): [imaging interface] File name of
image that was flashed of a given type and qualifier; eg
<em>images-kernel-arc</em> with a value of
<em>/var/cache/ttbd-production/USERNAME/somefile.elf</em> was an image
flashed as a kernel for architecture ARC).</li>
<li><em>openocd.path</em> (str): [imaging interface] path of the OpenOCD
implementation being used</li>
<li><em>openocd.pid</em> (unsigned): [imaging interface] PID of the OpenOCD
process driving this target</li>
<li><em>openocd.port</em> (unsigned): [imaging interface] Base TCP port where
we can connect to the OpenOCD process driving this target</li>
<li><em>powered</em> (bool): [power control interface] True if the target is
powered up, False otherwise.</li>
<li><em>power_state</em> (bool): [power control interface] ‘on’ if the target
is powered up, ‘off’ otherwise. (FIXME: this has to be unified with
<em>powered</em>)</li>
</ul>
</div>
<div class="section" id="driver-targe-type-specific-metadata">
<h3>8.4.3. Driver / targe type specific metadata<a class="headerlink" href="#driver-targe-type-specific-metadata" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><em>hard_recover_rest_time</em> (unsigned): [ttbl.tt.tt_flasher driver,
OpenOCD targets] time the target has to be kept off when
power-cycling to recover after a failed reset, reset halt or reset
after power-cycle when flashing.</p>
<p>When the flasher (usually OpenOCD) cannot make the target comply,
the driver will power cycle it to try to get it to a well known
state.</p>
</li>
<li><p class="first"><em>linux</em> (bool): True if this is a target that runs linux</p>
</li>
<li><p class="first"><em>quark_se_stub</em> (bool): FIXME: DEPRECATED</p>
</li>
<li><p class="first"><em>qemu_bios_image</em> (str): [QEMU driver] file name used for the
target’s BIOS (depending on configuration)</p>
</li>
<li><p class="first"><em>qemu_ro_image</em> (str): [QEMU driver] file name used for the target’s
read-only image (depending on configuration)</p>
</li>
<li><p class="first"><em>qemu-image-kernel-ARCH</em> (str): [QEMU driver] file used as a kernel to
boot a QEMU target (depending on configuration)</p>
</li>
<li><p class="first"><em>qemu-cmdline-ARCH</em> (str): [QEMU driver] command line used to launch
the QEMU process implementing the target (depending on configuration)</p>
</li>
<li><p class="first"><em>ifname</em> (str): [QEMU driver / SLIP] interface created to hookup the
SLIP networking tun/tap into the vlan to connect to external
networks or other VMs [FIXME: make internal]</p>
</li>
<li><p class="first"><em>slow_flash_factor</em> (int): [[ttbl.tt.tt_flasher driver, OpenOCD
targets] amount to scale up the timeout to flash into an OpenOCD
capable target. Some targets have a slower flashing interface and
need more time.</p>
</li>
<li><p class="first"><em>tunslip-ARCH-pid</em> (int): [QEMU driver] PID of the process
implementing tunslip for a QEMU target.</p>
</li>
<li><p class="first"><em>ram_megs</em> (int): Megs of RAM supported by the target</p>
</li>
<li><p class="first"><em>ssh_client</em> (bool): True if the target supports SSH</p>
</li>
</ul>
</div>
<div class="section" id="provisioning-os-specific-metadata">
<h3>8.4.4. Provisioning OS specific metadata<a class="headerlink" href="#provisioning-os-specific-metadata" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><em>linux_serial_console_default</em>: which device <strong>the target</strong> sees as
the system’s serial console connected to TCF’s first console.</p>
<p>If <em>DEVICE</em> (eg: ttyS0) is given, Linux will be booted with the
argument <em>console=DEVICE,115200</em>.</p>
</li>
<li><p class="first"><em>linux_options_append</em>: string describing options to append to a
Linux kernel boot command line.</p>
</li>
</ul>
<ul id="pos-capable">
<li><p class="first"><em>pos_capable</em>: dictionary describing a target as able to boot into a
Provisioning OS to perform target provisioning.</p>
<p>Keys are the same as described in <a class="reference internal" href="#tcfl.pos.capability_fns" title="tcfl.pos.capability_fns"><code class="xref py py-data docutils literal notranslate"><span class="pre">tcfl.pos.capability_fns</span></code></a>
(e.g: <em>boot_to_pos</em>, <em>boot_config</em>, etc)</p>
<p>Values are only one of each of each second level keys in the
<a class="reference internal" href="#tcfl.pos.capability_fns" title="tcfl.pos.capability_fns"><code class="xref py py-data docutils literal notranslate"><span class="pre">tcfl.pos.capability_fns</span></code></a> dictionary (e.g.: <em>pxe</em>, <em>uefi</em>…).</p>
<p>This indicates the system which different methodologies have to be
used for the target to get into Provisioning OS mode, configure
bootloader, etc.</p>
</li>
</ul>
<ul id="pos-http-url-prefix">
<li><p class="first"><em>pos_http_url_prefix</em>: string describing the prefix to send for
loading a Provisoning OS kernel/initramfs. See <a class="reference internal" href="04-HOWTOs.html#pos-boot-http-tftp"><span class="std std-ref">here</span></a>.</p>
<p>Python’s <code class="docutils literal notranslate"><span class="pre">%(NAME)s</span></code> codes can be used to substitute values from
the target’s tags or the interconnect’s.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pos_http_url_prefix</span> <span class="o">=</span> <span class="s2">&quot;http://192.168.97.1/ttbd-pos/</span><span class="si">%(bsp)s</span><span class="s2">/&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">bsp</span></code> is common to use as the images for an architecture won’t
work for another. <code class="docutils literal notranslate"><span class="pre">bsp</span></code> is taken from the target’s tag <code class="docutils literal notranslate"><span class="pre">bsp</span></code>. If
not present, the first BSP (in alphabetical order) declared in the
target tags <code class="docutils literal notranslate"><span class="pre">bsps</span></code> will be used.</p>
</li>
</ul>
<ul id="pos-image">
<li><p class="first"><em>pos_image</em>: string describing the image used to boot the target in
POS mode; defaults to <em>tcf-live</em>.</p>
<p>For each image, in the server, <a class="reference internal" href="#ttbl.dhcp.pos_cmdline_opts" title="ttbl.dhcp.pos_cmdline_opts"><code class="xref py py-data docutils literal notranslate"><span class="pre">ttbl.dhcp.pos_cmdline_opts</span></code></a>
describes the kernel options to append to the kernel image, which is
expected to be found in <em>http://:data:`POS_HTTP_URL_PREFIX
&lt;pos_http_url_prefix&gt;`/vmlinuz-POS_IMAGE</em></p>
</li>
</ul>
<ul id="pos-partscan-timeout">
<li><p class="first"><em>pos_partscan_timeout</em>: maximum number of seconds we wait for a
partition table scan to show information about the partition table
before we consider it is really empty (some HW takes a long time).</p>
<p>This is used in <code class="xref py py-func docutils literal notranslate"><span class="pre">tcfl.pos.fsinfo_read</span></code>.</p>
</li>
</ul>
<ul id="pos-reinitialize">
<li><p class="first"><em>pos_reinitialize</em>: when set to any value, the client provisioning
code understands the boot drive for the target has to be
repartitioned and reformated before provisioning:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf property-set TARGET pos_reinitialize True
$ tcf run -t TARGETs &lt;something that deploys&gt;
</pre></div>
</div>
</li>
</ul>
<ul id="uefi-boot-manager-ipv4-regex">
<li><p class="first"><em>uefi_boot_manager_ipv4_regex</em>: allows specifying a Python regular
expression that describes the format/name of the UEFI boot entry
that will PXE boot off the network. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;PC-43j&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tags_update</span><span class="p">({</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;uefi_boot_manager_ipv4_regex&#39;</span><span class="p">:</span> <span class="s1">&#39;UEFI Network&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">})</span>
</pre></div>
</div>
<p>Function (tcfl.pos_uefi._efibootmgr_setup()* can use this if the
defaults do not work <a class="reference internal" href="#tcfl.pos.extension.deploy_image" title="tcfl.pos.extension.deploy_image"><code class="xref py py-func docutils literal notranslate"><span class="pre">target.pos.deploy_image()</span></code></a> reports:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Cannot</span> <span class="n">find</span> <span class="n">IPv4</span> <span class="n">boot</span> <span class="n">entry</span><span class="p">,</span> <span class="n">enable</span> <span class="n">manually</span>
</pre></div>
</div>
<p>even after the PXE boot entry has been enabled manually.</p>
<p>Note this will be compiled into a Python regex.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="ttbd-http-api">
<h2>8.5. <em>ttbd</em> HTTP API<a class="headerlink" href="#ttbd-http-api" title="Permalink to this headline">¶</a></h2>
<p id="ttbd-api-http">The HTTP API exported by <em>ttbd</em> is a very basic REST model which is
goint to at some point be coverted to <em>odata</em> or JSON-RPC.</p>
<p>FIXME: this document is work in progress</p>
<p>It is recommended to access the server using the Python API as defined
in <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tcfl.tc.target_c</span></code></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">target_c</span><span class="o">.</span><span class="n">create_from_cmdline_args</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;TARGETNAME&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
</pre></div>
</div>
<p>If raw HTTP access is needed, it is a good way to double check if
things are being done right to run the <em>tcf</em> client with <em>–debug</em>,
since it will print the HTTP requests done, to cross check:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf --debug login USERNAME
...
I ttb_client.rest_login():679: https://localhost:5004: checking for a valid session
Login to https://localhost:5004 as USERNAME
Password:
D ttb_client.send_request():275: send_request: PUT https://localhost:5004/ttb-v1/login
D connectionpool._new_conn():813: Starting new HTTPS connection (1): localhost:5004
send: &#39;PUT /ttb-v1/login HTTP/1.1\r\n
Host: localhost:5004\r\n
Connection: keep-alive\r\n
Accept-Encoding: gzip, deflate\r\n
Accept: */*\r\n
User-Agent: python-requests/2.20.0\r\n
Cookie: remember_token=USERNAME|e72e83d4ae70d6ef484da8cec6fa1c4d93833327dabda9566bb12091038cfbe982f7ec3b1d269ae6316969489e546bf797ce564c8daef89f13451505ae5b5a37; session=.eJxNj0-LgzAUxL_K8s5S2rRehL0sacVDXlAs8nKRbutu_inFKhJLv_tmb70NMwzzmye0P2P30JBN49wl0JobZE_4-IYMJD-maK8rNuUO-ZfHWkRNQXJvlC13ZB1Dro2sBRNWOcULJnmR4uqYaJSWuQiqLw9oK68sMVmfvGwo9mgvetqiPe5VUy6KUxB5pZHREvcWsVZG9UVKVsdN70TkEA0dMD9vY6ZlTYvkkcueF-xPTtW_n_BKwNy6YTJT2FzmSbdTuHeQDbP3b8n_OzDDxQVIYH50Y_vmvP4Ax1dagQ.ENlzCw.jIg8VhRQADhEZiyNtCh2A6HRFsk\r\n
Content-Length: 60\r\n
Content-Type: application/x-www-form-urlencoded\r\n
\r\n
password=PASSWORD&amp;email=USERNAME&#39;
reply: &#39;HTTP/1.1 200 OK\r\n&#39;
header: Vary: Cookie
header: Set-Cookie: remember_token=&quot;USERNAME|1efa96aafcf99f21c105d8323d161d205fa8bd1e7aa2ed3fcab38daba7f0c748280941d478ed4e3fc9b4e5f6606d35abad1e23666ee56b55be6adb560f8748e9&quot;; Expires=Fri, 20-Dec-2019 21:03:40 GMT; Path=/
header: Set-Cookie: session=.eJyNjz1rwzAYhP9KeefUJEq8GAqlKDEeJGHjYKTFOIkafdkJjoyRQ_571a1jt4Pnjrt7Qvs9yoeCzI-TXEGrL5A94e0EGTC8T6k5L7QpNxR_OVqTqHlg2Glhyg03FlGsNKsJIkZYgQvEcJHSxSLSCMVyEkRf7qipnDAcsfrgWMNjjm9Jz9fU7LeiKWeBeSB5pSjic-ybyVJp0RcpNyp2OkviDtLwHc2P68gUq_nMcNxljjPtD1bU1w94rUBf5OC1D0k3edX6cJeQDZNzf8jvO9BDZ0Nyl6Nc3q-3YemcXD714KVLzrceVjA95Nj-x_r6AYOEbek.ENmCrA.JjU3Fqwtw2jvYjbJCJCKYMyR1Gs; HttpOnly; Path=/
header: Content-Length: 92
header: Content-Type: application/json
header: Server: TornadoServer/5.0.2
...
</pre></div>
</div>
<p>Arguments are encoded as HTTP form fields; for non escalar arguments,
the values are JSON encoded.</p>
<p>Authentication is done via cookies, which also include the username,
stored in <code class="docutils literal notranslate"><span class="pre">~/.tcf/cookies-SERVERNAME.pickle</span></code>, which can be loaded in
python with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">cPickle</span><span class="o">,</span> <span class="nn">requests</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cookie</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/home/USER/.tcf/cookies-httpsservername000.pickle&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>and then this can be used to make a request to, for example, the
console interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://servername:5000/ttb-v1/targets/r14s40/console/read&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="n">verify</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="s2">&quot;sol0_ssh&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="n">cookies</span> <span class="o">=</span> <span class="n">cookie</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">text</span>
</pre></div>
</div>
<div class="section" id="basic-target-interface">
<h3>8.5.1. Basic target interface<a class="headerlink" href="#basic-target-interface" title="Permalink to this headline">¶</a></h3>
<p>Common arguments:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">ticket</span></code>: ticket under which the current owner is holding the
target; this is string unique identifier, same as used to aquire:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf login username
$ tcf -t BLAHBLAH acquire TARGETNAME
</pre></div>
</div>
<p>means <em>TARGETNAME</em> is now acquired by <em>username:BLAHBLAH</em> since the
ticket is <em>BLAHBLAH</em>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">component</span></code>: for interfaces that understand multiple
implementations or multiplex to multiple components (eg: <em>power</em>,
<em>console</em>, <em>images</em>) this is a string that indicates to which
instance to direct the request.</p>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">FIXME: this document is work in progress, to get more info for the
time being, <code class="docutils literal notranslate"><span class="pre">tcf.git/ttbd</span></code> unpacks most of these calls (as per
the <code class="docutils literal notranslate"><span class="pre">&#64;app.route</span></code> decorator); needed arguments can be extracted by
look at what is obtained with <em>flask.request.form.get()</em></p>
</div>
<p>Endpoints:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/login</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/logout</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/validate_session</span></code> <em>GET</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets</span></code> <em>GET</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/</span></code> <em>GET</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/acquire</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/active</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/release</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/enable</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/disable</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/property_set</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/property_get</span></code> <em>GET</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/ip_tunnel</span></code> <em>POST</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/ip_tunnel</span></code> <em>DELETE</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/ip_tunnel</span></code> <em>GET</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/files/FILENAME</span></code> <em>POST</em> upload a file to user’s storage</li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/files/FILENAME</span></code> <em>GET</em> download a file from the user’s
storage</li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/files/FILENAME</span></code> <em>DELETE</em> delete a file from the user’s
storage</li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/files</span></code> <em>GET</em> list files in the user’s storage</li>
</ul>
</div>
<div class="section" id="general-interface-access">
<h3>8.5.2. General interface access<a class="headerlink" href="#general-interface-access" title="Permalink to this headline">¶</a></h3>
<p>Functionality to manipulate / access targets is implemented by
separate unrelated and available at the endpoints
<code class="docutils literal notranslate"><span class="pre">/ttb/v1/TARGETNAME/INTERFACENAME/METHODNAME</span></code> (with PUT, GET, POST,
DELETE depending ont he operation).</p>
<p>Note different targets might implement different interfaces, and thus
not all of them are always avaialble. Interfaces supported by a target
are available by listing the target’s metadata (with
<code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets[/TARGETNAME]</span></code>) and looking for the value of the
<em>interfaces</em> field.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">FIXME: this document is work in progress, to get more info for the
time being, <code class="docutils literal notranslate"><span class="pre">tcf.git/ttbd/ttbl/*.py</span></code> implements these interfaces
by instantiating a <a class="reference internal" href="#ttbl.tt_interface" title="ttbl.tt_interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.tt_interface</span></code></a> and implementing
calls to <code class="docutils literal notranslate"><span class="pre">METHOD_NAME</span></code> where method is <em>put</em>, <em>post</em>, <em>get</em> or
<em>delete</em>. The dictionary <em>args</em> passed is a dictionary with the
arguments passed in the HTTP call.</p>
</div>
<div class="section" id="power">
<h4>8.5.2.1. Power<a class="headerlink" href="#power" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/power/off</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/power/on</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/power/cycle</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/power/get</span></code> <em>GET</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/power/list</span></code> <em>GET</em></li>
</ul>
</div>
<div class="section" id="console">
<h4>8.5.2.2. Console<a class="headerlink" href="#console" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/console/setup</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/console/list</span></code> <em>GET</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/console/enable</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/console/disable</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/console/state</span></code> <em>GET</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/console/size</span></code> <em>GET</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/console/read</span></code> <em>GET</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/console/write</span></code> <em>PUT</em></li>
</ul>
</div>
<div class="section" id="capture">
<h4>8.5.2.3. Capture<a class="headerlink" href="#capture" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/capture/start</span></code> <em>POST</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/capture/stop_and_get</span></code> <em>POST</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/capture/list</span></code> <em>GET</em></li>
</ul>
</div>
<div class="section" id="buttons">
<h4>8.5.2.4. Buttons<a class="headerlink" href="#buttons" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/buttons/sequence</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/buttons/list</span></code> <em>GET</em></li>
</ul>
</div>
<div class="section" id="fastboot">
<h4>8.5.2.5. Fastboot<a class="headerlink" href="#fastboot" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/fastboot/run</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/fastboot/list</span></code> <em>GET</em></li>
</ul>
</div>
<div class="section" id="images">
<h4>8.5.2.6. Images<a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/images/flash</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/images/list</span></code> <em>GET</em></li>
</ul>
</div>
<div class="section" id="ioc-flash-server-app">
<h4>8.5.2.7. IOC_flash_server_app<a class="headerlink" href="#ioc-flash-server-app" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/ioc_flash_server_app/run</span></code> <em>GET</em></li>
</ul>
</div>
<div class="section" id="things">
<h4>8.5.2.8. Things<a class="headerlink" href="#things" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/things/list</span></code> <em>GET</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/things/get</span></code> <em>GET</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/things/plug</span></code> <em>PUT</em></li>
<li><code class="docutils literal notranslate"><span class="pre">/ttb/v1/targets/TARGETNAME/things/unplug</span></code> <em>PUT</em></li>
</ul>
</div>
</div>
<div class="section" id="examples">
<h3>8.5.3. Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<div class="section" id="example-listing-targets-over-http">
<h4>8.5.3.1. Example: listing targets over HTTP<a class="headerlink" href="#example-listing-targets-over-http" title="Permalink to this headline">¶</a></h4>
<p>What the command line tool would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list -vv
</pre></div>
</div>
<p>anything that has an &#64; sign is being used actively by TCF another -v
will get you the same JSON that either of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ wget --no-check-certificate https://SERVERNAME:5000/ttb-v1/targets
$ curl -k https://SERVERNAME:5000/ttb-v1/targets/
</pre></div>
</div>
<p>will return; in JSON, you can tell a target is idle if <em>owner</em> is
None or missing; if it has a value, it is the user ID of whoever has
it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="o">...</span>
    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;r14s40&#39;</span><span class="p">,</span>
    <span class="o">....</span>
    <span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>now:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf login USERNAME
Password: &lt;....&gt;
$ tcf acquire r14s40
$ tcf list -vvv r14s40
{ ...
  &#39;id&#39;: u&#39;r14s40&#39;,
  ...
  &#39;owner&#39;: u&#39;USERNAME&#39;,
  ...
}
</pre></div>
</div>
<p>In Python:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://SERVERNAME:5000/ttb-v1/targets&quot;</span><span class="p">,</span> <span class="n">verify</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="example-reading-the-console-s-from-http">
<h4>8.5.3.2. Example: Reading the console(s) from HTTP<a class="headerlink" href="#example-reading-the-console-s-from-http" title="Permalink to this headline">¶</a></h4>
<p>You can see which consoles are available with either or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf acquire r14s40
$ tcf console-list r14s40
$ tcf list -vvv r14s40 | grep consoles
</pre></div>
</div>
<p>You can continuously read with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf console-read --follow r14s40
</pre></div>
</div>
<p>in Python, HTTP I do like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">cPickle</span><span class="o">,</span> <span class="nn">requests</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cookie</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/home/user/.tcf/cookies-httpsSERVERNAME5000.pickle&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://SERVERNAME:5000/ttb-v1/targets/r14s40/console/read&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">verify</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="s2">&quot;sol0_ssh&quot;</span><span class="p">),</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">cookie</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">text</span>
</pre></div>
</div>
<p>So you put this in a loop, which is what <em>tcf console-read –follow</em>
does in (<code class="docutils literal notranslate"><span class="pre">tcf.git/tcfl/target_ext_console.py:_cmdline_console_read</span></code>)</p>
</div>
</div>
</div>
<div class="section" id="module-conf_00_lib">
<span id="ttbd-configuration-api-for-targets"></span><h2>8.6. <em>ttbd</em> Configuration API for targets<a class="headerlink" href="#module-conf_00_lib" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="conf_00_lib.vlan_pci">
<em class="property">class </em><code class="descclassname">conf_00_lib.</code><code class="descname">vlan_pci</code><a class="headerlink" href="#conf_00_lib.vlan_pci" title="Permalink to this definition">¶</a></dt>
<dd><p>Power controller to implement networks on the server side.</p>
<p>Supports:</p>
<ul>
<li><p class="first">connecting the server to a physical net physical networks with
physical devices (normal or VLAN networks)</p>
</li>
<li><p class="first">creating internal virtual networks with <cite>macvtap
http://virt.kernelnewbies.org/MacVTap</cite> so VMs running in the
host can get into said networks.</p>
<p>When a physical device is also present, it is used as the upper
device (instead of a bridge) so traffic can flow from physical
targets to the virtual machines in the network.</p>
</li>
<li><p class="first"><em>tcpdump</em> capture of network traffic</p>
</li>
</ul>
<p>This behaves as a power control implementation that when turned:</p>
<ul class="simple">
<li>on: sets up the interfaces, brings them up, start capturing</li>
<li>off: stops all the network devices, making communication impossible.</li>
</ul>
<p><strong>Capturing with tcpdump</strong></p>
<p>Can be enabled setting the target’s property <em>tcpdump</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf property-set TARGETNAME tcpdump FILENAME
</pre></div>
</div>
<p>this will have the target dump all traffic capture to a file
called <em>FILENAME</em> in the daemon file storage area for the user who
owns the target. The file can then be recovered with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf store-download FILENAME
</pre></div>
</div>
<p><em>FILENAME</em> must be a valid file name, with no directory
components.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Note this requires the property <em>tcpdump</em> being
registered in the configuration with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">test_target</span><span class="o">.</span><span class="n">properties_user</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tcpdump&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">so normal users can set/unset it.</p>
</div>
<p>Example configuration (see <a class="reference internal" href="03-server-setup.html#bp-naming-networks"><span class="std std-ref">naming networks</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">test_target</span><span class="p">(</span><span class="s2">&quot;nwa&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="n">vlan_pci</span><span class="p">()))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">interconnect_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv4_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.97.1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv4_prefix_len&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv6_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;fc00::61:1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv6_prefix_len&#39;</span><span class="p">:</span> <span class="mi">112</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;mac_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;02:61:00:00:00:01:&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">})</span>
</pre></div>
</div>
<p>Now QEMU targets (for example), can declare they are part of this
network and upon start, create a tap interface for themselves:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ip link add link _bnwa name tnwaTARGET type macvtap mode bridge
$ ip link set tnwaTARGET address 02:01:00:00:00:IC_INDEX up
</pre></div>
</div>
<p>which then is given to QEMU as an open file descriptor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">net</span> <span class="n">nic</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="n">virtio</span><span class="p">,</span><span class="n">macaddr</span><span class="o">=</span><span class="mi">02</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="n">IC_INDEX</span>
<span class="o">-</span><span class="n">net</span> <span class="n">tap</span><span class="p">,</span><span class="n">fd</span><span class="o">=</span><span class="n">FD</span>
</pre></div>
</div>
<p>(targets implemented by
<a class="reference internal" href="#conf_00_lib_pos.target_qemu_pos_add" title="conf_00_lib_pos.target_qemu_pos_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pos.target_qemu_pos_add()</span></code></a> and
<a class="reference internal" href="#conf_00_lib_mcu.target_qemu_zephyr_add" title="conf_00_lib_mcu.target_qemu_zephyr_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_mcu.target_qemu_zephyr_add()</span></code></a> with VMs
implement this behaviour).</p>
<p>Notes:</p>
<ul class="simple">
<li>keep target names short, as they will be used to generate
network interface names and those are limited in size (usually to
about 12 chars?), eg tnwaTARGET comes from <em>nwa</em> being the
name of the network target/interconnect, TARGET being the target
connected to said interconnect.</li>
<li>IC_INDEX: is the index of the TARGET in the interconnect/network;
it is recommended, for simplicty to make them match with the mac
address, IP address and target name, so for example:<ul>
<li>targetname: pc-04</li>
<li>ic_index: 04</li>
<li>ipv4_addr: 192.168.1.4</li>
<li>ipv6_addr: fc00::1:4</li>
<li>mac_addr: 02:01:00:00:00:04</li>
</ul>
</li>
</ul>
<p>If a tag named <em>mac_addr</em> is given, containing the MAC address
of a physical interface in the system, then it will be taken over
as the point of connection to external targets. Connectivity from
any virtual machine in this network will be extended to said
network interface, effectively connecting the physical and virtual
targets.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>DISABLE Network Manager’s (or any other network
manager) control of this interface, otherwise it will
interfere with it and network will not operate.</p>
<p class="last">Follow <a class="reference internal" href="04-HOWTOs.html#howto-nm-disable-control"><span class="std std-ref">these steps</span></a></p>
</div>
<p>System setup:</p>
<ul>
<li><dl class="first docutils">
<dt><em>ttbd</em> must be ran with CAP_NET_ADMIN so it can create network</dt>
<dd><p class="first">interfaces. For that, either add to systemd’s
<code class="docutils literal notranslate"><span class="pre">/etc/systemd/system/ttbd&#64;.service</span></code>:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CapabilityBoundingSet</span> <span class="o">=</span> <span class="n">CAP_NET_ADMIN</span>
<span class="n">AmbientCapabilities</span> <span class="o">=</span> <span class="n">CAP_NET_ADMIN</span>
</pre></div>
</div>
</dd>
</dl>
<p>or as root, give ttbd the capability:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># setcap cap_net_admin+pie /usr/bin/ttbd</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>udev</em>’s <em>/etc/udev/rules.d/ttbd-vlan</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;macvtap&quot;</span><span class="p">,</span> <span class="n">ACTION</span> <span class="o">==</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="n">DEVNAME</span> <span class="o">==</span> <span class="s2">&quot;/dev/tap*&quot;</span><span class="p">,</span>             <span class="n">GROUP</span> <span class="o">=</span> <span class="s2">&quot;ttbd&quot;</span><span class="p">,</span> <span class="n">MODE</span> <span class="o">=</span> <span class="s2">&quot;0660&quot;</span>
</pre></div>
</div>
<p>This is needed so the tap devices can be accessed by user
<em>ttbd</em>, which is the user that runs the daemon.</p>
<p>Remember to reload <em>udev</em>’s configuration with <cite>udevadm control
–reload-rules</cite>.</p>
<p>This is already taken care by the RPM installation.</p>
</li>
</ul>
<p><strong>Fixture setup</strong></p>
<ul>
<li><p class="first">Select a network interface to use (it can be a USB or PCI
interface); find out it’s MAC address with <em>ip link show</em>.</p>
</li>
<li><p class="first">add the tag <em>mac_addr</em> with said address to the tags of the
target object that represents the network to which which said
interface is to be connected; for example, for a network called
<em>nwc</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">test_target</span><span class="p">(</span><span class="s2">&quot;nwa&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="n">vlan_pci</span><span class="p">()))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">interconnect_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv4_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.97.1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv4_prefix_len&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv6_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;fc00::61:1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv6_prefix_len&#39;</span><span class="p">:</span> <span class="mi">112</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;mac_addr&#39;</span><span class="p">:</span> <span class="s2">&quot;a0:ce:c8:00:18:73&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">})</span>
</pre></div>
</div>
<p>or for an existing network (such as the configuration’s default
<em>nwa</em>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># eth dongle mac 00:e0:4c:36:40:b8 is assigned to NWA</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;nwa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tags_update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">mac_addr</span> <span class="o">=</span> <span class="s1">&#39;00:e0:4c:36:40:b8&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Furthermore, default networks <em>nwa</em>, <em>nwb</em> and <em>nwc</em> are defined
to have a power control rail (versus an individual power
controller), so it is possible to add another power controller
to, for example, power on or off a network switch:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;nwa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pc_impl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://USER:PASSWORD@sp5/8&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This creates a power controller to switch on or off plug #8 on
a Digital Loggers Web Power Switch named <em>sp5</em> and makes it part
of the <em>nwa</em> power control rail. Thus, when powered on, it will
bring the network up up and also turn on the network switch.</p>
</li>
<li><p class="first">add the tag <em>vlan</em> to also be a member of an ethernet VLAN
network (requires also a <em>mac_addr</em>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">test_target</span><span class="p">(</span><span class="s2">&quot;nwa&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="n">vlan_pci</span><span class="p">()))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">interconnect_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv4_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.97.1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv4_prefix_len&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv6_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;fc00::61:1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv6_prefix_len&#39;</span><span class="p">:</span> <span class="mi">112</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;mac_addr&#39;</span><span class="p">:</span> <span class="s2">&quot;a0:ce:c8:00:18:73&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;vlan&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">})</span>
</pre></div>
</div>
<p>in this case, all packets in the interface described by MAC addr
<em>a0:ce:c8:00:18:73</em> with tag <em>30</em>.</p>
</li>
<li><p class="first">lastly, for each target connected to that network, update it’s
tags to indicate it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;TARGETNAME-NN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tags_update</span><span class="p">(</span>
    <span class="p">{</span>
      <span class="s1">&#39;ipv4_addr&#39;</span><span class="p">:</span> <span class="s2">&quot;192.168.10.30&quot;</span><span class="p">,</span>
      <span class="s1">&#39;ipv4_prefix_len&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
      <span class="s1">&#39;ipv6_addr&#39;</span><span class="p">:</span> <span class="s2">&quot;fc00::10:30&quot;</span><span class="p">,</span>
      <span class="s1">&#39;ipv4_prefix_len&#39;</span><span class="p">:</span> <span class="mi">112</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">ic</span> <span class="o">=</span> <span class="s1">&#39;nwc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>By convention, the server is .1, the QEMU Linux virtual machines
are set from .2 to .10 and the QEMU Zephyr virtual machines from
.30 to .45. Physical targets are set to start at 100.</p>
<p>Note the networks for targets and infrastructure <a class="reference internal" href="05-RFAQs.html#separated-networks"><span class="std std-ref">have to be
kept separated</span></a>.</p>
<dl class="method">
<dt id="conf_00_lib.vlan_pci.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.vlan_pci.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="conf_00_lib.vlan_pci.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.vlan_pci.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#conf_00_lib.vlan_pci.on" title="conf_00_lib.vlan_pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="conf_00_lib.vlan_pci.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.vlan_pci.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#conf_00_lib.vlan_pci.on" title="conf_00_lib.vlan_pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-conf_00_lib_capture"></span><div class="section" id="configuration-api-for-capturing-audio-and-video">
<span id="conf-00-lib-capture"></span><h3>8.6.1. Configuration API for capturing audio and video<a class="headerlink" href="#configuration-api-for-capturing-audio-and-video" title="Permalink to this headline">¶</a></h3>
<p>These capture objects are meant to be fed to the capture interface
declaration of a target in the server, for example, in any server
configuration file you could have added a target and then a capture
interface can be added with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;TARGETNAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
    <span class="s2">&quot;capture&quot;</span><span class="p">,</span>
    <span class="n">ttbl</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="s2">&quot;hdmi0_screenshot&quot;</span><span class="p">,</span>
        <span class="n">screen_stream</span> <span class="o">=</span> <span class="s2">&quot;hdmi0_vstream&quot;</span><span class="p">,</span>
        <span class="n">audio_stream</span> <span class="o">=</span> <span class="s2">&quot;front_astream&quot;</span><span class="p">,</span>
        <span class="n">front_astream</span> <span class="o">=</span> <span class="n">capture_front_astream_vtop_0c76_161e</span><span class="p">,</span>
        <span class="n">hdmi0_screenshot</span> <span class="o">=</span> <span class="n">capture_screenshot_ffmpeg_v4l</span><span class="p">,</span>
        <span class="n">hdmi0_vstream</span> <span class="o">=</span> <span class="n">capture_vstream_ffmpeg_v4l</span><span class="p">,</span>
        <span class="n">hdmi0_astream</span> <span class="o">=</span> <span class="n">capture_astream_ffmpeg_v4l</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This assumes we have connected and configured:</p>
<ul class="simple">
<li>an HDMI grabber to the target’s HDMI0 output (see <a class="reference internal" href="#conf_00_lib_capture.capture_screenshot_ffmpeg_v4l" title="conf_00_lib_capture.capture_screenshot_ffmpeg_v4l"><code class="xref py py-data docutils literal notranslate"><span class="pre">setup</span>
<span class="pre">instructions</span></code></a>)</li>
<li>an audio grabber to the front audio output (see <a class="reference internal" href="#conf_00_lib_capture.capture_front_astream_vtop_0c76_161e" title="conf_00_lib_capture.capture_front_astream_vtop_0c76_161e"><code class="xref py py-data docutils literal notranslate"><span class="pre">setup</span>
<span class="pre">instructions</span></code></a>).</li>
</ul>
<p>to create multiple capture capabilityies (video and sound streams, and
screenshots) with specific names for the ouputs and aliases)</p>
<p>Note the audio capturers are many times HW specific because they
expose different audio controls that have to be set or queried.</p>
<dl class="data">
<dt id="conf_00_lib_capture.capture_screenshot_ffmpeg_v4l">
<code class="descclassname">conf_00_lib_capture.</code><code class="descname">capture_screenshot_ffmpeg_v4l</code><em class="property"> = &lt;ttbl.capture.generic_snapshot object&gt;</em><a class="headerlink" href="#conf_00_lib_capture.capture_screenshot_ffmpeg_v4l" title="Permalink to this definition">¶</a></dt>
<dd><p>A capturer to take screenshots from a v4l device using ffmpeg</p>
<p>Note the fields are target’s tags and others specified in
<a class="reference internal" href="#ttbl.capture.generic_snapshot" title="ttbl.capture.generic_snapshot"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.capture.generic_snapshot</span></code></a> and
<a class="reference internal" href="#ttbl.capture.generic_stream" title="ttbl.capture.generic_stream"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.capture.generic_stream</span></code></a>.</p>
<p>To use:</p>
<blockquote>
<div><ul>
<li><p class="first">define a target</p>
</li>
<li><p class="first">physically connect the capture interface to it and to the
server</p>
</li>
<li><p class="first">Create a <em>udev</em> configuration so the capture device exposes
itself as <em>/dev/video-TARGETNAME-INDEX</em>.</p>
<p>This requires creating a <em>udev</em> configuration so that the v4l
device gets recognized and an alias created, which can be
accomplished by dropping a udev rule in <em>/etc/udev/rules.d</em> such
as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;video4linux&quot;</span><span class="p">,</span> <span class="n">ACTION</span> <span class="o">==</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> \
    <span class="n">KERNEL</span><span class="o">==</span><span class="s2">&quot;video*&quot;</span><span class="p">,</span> \
    <span class="n">ENV</span><span class="p">{</span><span class="n">ID_SERIAL_SHORT</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;SOMESERIALNUMBER&quot;</span><span class="p">,</span> \
    <span class="n">SYMLINK</span> <span class="o">+=</span> <span class="s2">&quot;video-nuc-01A-$attr</span><span class="si">{index}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>note some USB devices don’t offer a serial number, then you
can use a device path, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ENV</span><span class="p">{</span><span class="n">ID_PATH</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;pci-0000:00:14.0-usb-0:2.1:1.0&quot;</span><span class="p">,</span> \
</pre></div>
</div>
<p>this is shall be a last resort, as then moving cables to
different USB ports will change the paths and you will have to
reconfigure.</p>
<p>See <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">methods to find device information</span></a></p>
</li>
<li><p class="first">add the configuration snippet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">TARGETNAME</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
    <span class="s2">&quot;capture&quot;</span><span class="p">,</span>
    <span class="n">ttbl</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="s2">&quot;hdmi0_screenshot&quot;</span><span class="p">,</span>
        <span class="n">screen_stream</span> <span class="o">=</span> <span class="s2">&quot;hdmi0_vstream&quot;</span><span class="p">,</span>
        <span class="n">hdmi0_screenshot</span> <span class="o">=</span> <span class="n">capture_screenshot_ffmpeg_v4l</span><span class="p">,</span>
        <span class="n">hdmi0_vstream</span> <span class="o">=</span> <span class="n">capture_vstream_ffmpeg_v4l</span><span class="p">,</span>
    <span class="p">))</span>
</pre></div>
</div>
<p>Note in this case we have used an</p>
</li>
</ul>
</div></blockquote>
<p>This has tested with with:</p>
<ul>
<li><p class="first"><a class="reference external" href="https://www.agptek.com/AGPTEK-USB-3-0-HDMI-HD-Video-Capture-1089-212-1.html">https://www.agptek.com/AGPTEK-USB-3-0-HDMI-HD-Video-Capture-1089-212-1.html</a></p>
<p>Which shows in USB as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span><span class="o">-</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">4</span>       <span class="mi">1</span><span class="n">bcf</span><span class="p">:</span><span class="mi">2</span><span class="n">c99</span> <span class="n">ef</span>  <span class="mf">3.10</span> <span class="mi">5000</span><span class="n">MBit</span><span class="o">/</span><span class="n">s</span> <span class="mi">512</span><span class="n">mA</span> <span class="mi">4</span><span class="n">IFs</span> <span class="p">(</span><span class="n">VXIS</span> <span class="n">Inc</span> <span class="n">ezcap</span> <span class="n">U3</span> <span class="n">capture</span><span class="p">)</span>
  <span class="mi">3</span><span class="o">-</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">4</span><span class="p">:</span><span class="mf">1.2</span>   <span class="p">(</span><span class="n">IF</span><span class="p">)</span> <span class="mi">01</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span> <span class="mi">0</span><span class="n">EPs</span> <span class="p">(</span><span class="n">Audio</span><span class="p">:</span><span class="n">Control</span> <span class="n">Device</span><span class="p">)</span> <span class="n">snd</span><span class="o">-</span><span class="n">usb</span><span class="o">-</span><span class="n">audio</span> <span class="n">sound</span><span class="o">/</span><span class="n">card5</span>
  <span class="mi">3</span><span class="o">-</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">4</span><span class="p">:</span><span class="mf">1.0</span>   <span class="p">(</span><span class="n">IF</span><span class="p">)</span> <span class="mi">0</span><span class="n">e</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span> <span class="mi">1</span><span class="n">EP</span>  <span class="p">(</span><span class="n">Video</span><span class="p">:</span><span class="n">Video</span> <span class="n">Control</span><span class="p">)</span> <span class="n">uvcvideo</span> <span class="n">video4linux</span><span class="o">/</span><span class="n">video5</span> <span class="n">video4linux</span><span class="o">/</span><span class="n">video4</span> <span class="nb">input</span><span class="o">/</span><span class="n">input15</span>
  <span class="mi">3</span><span class="o">-</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">4</span><span class="p">:</span><span class="mf">1.3</span>   <span class="p">(</span><span class="n">IF</span><span class="p">)</span> <span class="mi">01</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">00</span> <span class="mi">0</span><span class="n">EPs</span> <span class="p">(</span><span class="n">Audio</span><span class="p">:</span><span class="n">Streaming</span><span class="p">)</span> <span class="n">snd</span><span class="o">-</span><span class="n">usb</span><span class="o">-</span><span class="n">audio</span>
  <span class="mi">3</span><span class="o">-</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">4</span><span class="p">:</span><span class="mf">1.1</span>   <span class="p">(</span><span class="n">IF</span><span class="p">)</span> <span class="mi">0</span><span class="n">e</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">00</span> <span class="mi">1</span><span class="n">EP</span>  <span class="p">(</span><span class="n">Video</span><span class="p">:</span><span class="n">Video</span> <span class="n">Streaming</span><span class="p">)</span> <span class="n">uvcvideo</span>
</pre></div>
</div>
<p>Note this also can be used to capture video  of the HDMI stream
using capture_vstream_ffmpeg_v4l and audio played over HDMI via
an exposed ALSA interface (see capture_astream_ffmpeg_v4l below).</p>
</li>
</ul>
</dd></dl>

<dl class="data">
<dt id="conf_00_lib_capture.capture_screenshot_vnc">
<code class="descclassname">conf_00_lib_capture.</code><code class="descname">capture_screenshot_vnc</code><em class="property"> = &lt;ttbl.capture.generic_snapshot object&gt;</em><a class="headerlink" href="#conf_00_lib_capture.capture_screenshot_vnc" title="Permalink to this definition">¶</a></dt>
<dd><p>A capturer to take screenshots from VNC</p>
<p>Note the fields are target’s tags and others specified in
<a class="reference internal" href="#ttbl.capture.generic_snapshot" title="ttbl.capture.generic_snapshot"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.capture.generic_snapshot</span></code></a> and
<a class="reference internal" href="#ttbl.capture.generic_stream" title="ttbl.capture.generic_stream"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.capture.generic_stream</span></code></a>.</p>
</dd></dl>

<dl class="data">
<dt id="conf_00_lib_capture.capture_vstream_ffmpeg_v4l">
<code class="descclassname">conf_00_lib_capture.</code><code class="descname">capture_vstream_ffmpeg_v4l</code><em class="property"> = &lt;ttbl.capture.generic_stream object&gt;</em><a class="headerlink" href="#conf_00_lib_capture.capture_vstream_ffmpeg_v4l" title="Permalink to this definition">¶</a></dt>
<dd><p>Capture video off a v4l device using ffmpeg</p>
<p>See capture_screenshot_ffmpeg_v4l for setup instructions, as they
are common.</p>
</dd></dl>

<dl class="data">
<dt id="conf_00_lib_capture.capture_astream_ffmpeg_v4l">
<code class="descclassname">conf_00_lib_capture.</code><code class="descname">capture_astream_ffmpeg_v4l</code><em class="property"> = &lt;ttbl.capture.generic_stream object&gt;</em><a class="headerlink" href="#conf_00_lib_capture.capture_astream_ffmpeg_v4l" title="Permalink to this definition">¶</a></dt>
<dd><p>Capture audio off an Alsa device using ffmpeg</p>
<p>See capture_screenshot_ffmpeg_v4l for setup instructions, as they
are similar.</p>
<p>Note the udev setup instructions for Alsa devices are slightly
different; instead of <em>SYMLINKS</em> we have to set <em>ATTR{id}</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;sound&quot;</span><span class="p">,</span> <span class="n">ACTION</span> <span class="o">==</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> \
  <span class="n">ENV</span><span class="p">{</span><span class="n">ID_PATH</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;pci-0000:00:14.0-usb-0:2.1:1.2&quot;</span><span class="p">,</span> \
  <span class="n">ATTR</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span> <span class="o">=</span> <span class="s2">&quot;TARGETNAME&quot;</span>
</pre></div>
</div>
<p>Once this configuration is completed, udev is reloaded (<em>sudo
udevadm control –reload-rules</em>) and the
device is triggered (with <em>udevadm trigger /dev/snd/controlCX</em> or
the machine restarted), <em>/proc/asound</em> should contain a symlink to
the actual card:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls /proc/asound/ -l
total 0
dr-xr-xr-x. 3 root root 0 Jun 21 21:52 card0
dr-xr-xr-x. 7 root root 0 Jun 21 21:52 card4
..
lrwxrwxrwx. 1 root root 5 Jun 21 21:52 TARGETNAME -&gt; card4
...
</pre></div>
</div>
<p>Device information for Alsa devices (Card 0, Card 1, etc…) can be
found with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ udevadm info /dev/snd/controlC0
P: /devices/pci0000:00/0000:00:1f.3/sound/card0/controlC0
N: snd/controlC0
S: snd/by-path/pci-0000:00:1f.3
E: DEVLINKS=/dev/snd/by-path/pci-0000:00:1f.3
E: DEVNAME=/dev/snd/controlC0
E: DEVPATH=/devices/pci0000:00/0000:00:1f.3/sound/card0/controlC0
E: ID_PATH=pci-0000:00:1f.3
E: ID_PATH_TAG=pci-0000_00_1f_3
E: MAJOR=116
E: MINOR=11
E: SUBSYSTEM=sound
E: TAGS=:uaccess:
E: USEC_INITIALIZED=30391111
</pre></div>
</div>
<p>As indicated in capture_screenshot_ffmpeg_v4l, using
<em>ENV{ID_SERIAL_SHORT}</em> is preferred if available.</p>
</dd></dl>

<dl class="data">
<dt id="conf_00_lib_capture.capture_agptek_hdmi_astream">
<code class="descclassname">conf_00_lib_capture.</code><code class="descname">capture_agptek_hdmi_astream</code><em class="property"> = &lt;ttbl.capture.generic_stream object&gt;</em><a class="headerlink" href="#conf_00_lib_capture.capture_agptek_hdmi_astream" title="Permalink to this definition">¶</a></dt>
<dd><p>Capture HDMI Audio from an AGPTEK USB 3.0 HDMI HD Video Capture</p>
<ul class="simple">
<li><a class="reference external" href="https://www.agptek.com/AGPTEK-USB-3-0-HDMI-HD-Video-Capture-1089-212-1.html">https://www.agptek.com/AGPTEK-USB-3-0-HDMI-HD-Video-Capture-1089-212-1.html</a></li>
</ul>
<p>We can’t use a generic ALSA capturer because there seem to be
glitches in the device</p>
</dd></dl>

<dl class="data">
<dt id="conf_00_lib_capture.capture_front_astream_vtop_0c76_161e">
<code class="descclassname">conf_00_lib_capture.</code><code class="descname">capture_front_astream_vtop_0c76_161e</code><em class="property"> = &lt;ttbl.capture.generic_stream object&gt;</em><a class="headerlink" href="#conf_00_lib_capture.capture_front_astream_vtop_0c76_161e" title="Permalink to this definition">¶</a></dt>
<dd><p>Capture audio with the USB capturer VTOP/JMTEK 0c76:161e</p>
<p><a class="reference external" href="https://www.amazon.com/Digital-Audio-Capture-Windows-10-11/dp/B019T9KS04">https://www.amazon.com/Digital-Audio-Capture-Windows-10-11/dp/B019T9KS04</a></p>
<p>This is for capturing audio on the audio grabber connected to the
main builtin sound output of the target (usually identified as
<em>front</em> by the Linux driver subsystem), which UDEV has configured
to be called TARGETNAME-front:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;sound&quot;</span><span class="p">,</span> <span class="n">ACTION</span> <span class="o">==</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> \
  <span class="n">ENV</span><span class="p">{</span><span class="n">ID_PATH</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;pci-0000:00:14.0-usb-0:2.3.1:1.0&quot;</span><span class="p">,</span> \
  <span class="n">ATTR</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span> <span class="o">=</span> <span class="s2">&quot;TARGETNAME-front&quot;</span>
</pre></div>
</div>
</dd></dl>

</div>
<span class="target" id="module-conf_00_lib_mcu"></span><div class="section" id="configuration-api-for-mcus-used-with-the-zephyr-os-and-others">
<span id="conf-00-lib-mcu"></span><h3>8.6.2. Configuration API for MCUs used with the Zephyr OS and others<a class="headerlink" href="#configuration-api-for-mcus-used-with-the-zephyr-os-and-others" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="conf_00_lib_mcu.arduino101_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">arduino101_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>fs2_serial=None</em>, <em>serial_port=None</em>, <em>ykush_url=None</em>, <em>ykush_serial=None</em>, <em>variant=None</em>, <em>openocd_path='/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/bin/openocd'</em>, <em>openocd_scripts='/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/share/openocd/scripts'</em>, <em>debug=False</em>, <em>build_only=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.arduino101_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an Arduino 101 for the fixture described below</strong></p>
<p>This Arduino101 fixture includes a Flyswatter2 JTAG which allows
flashing, debugging and a YKUSH power switch for power control.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">arduino101_add</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;arduino101-NN&quot;</span><span class="p">,</span>
  <span class="n">fs2_serial</span> <span class="o">=</span> <span class="s2">&quot;arduino101-NN-fs2&quot;</span><span class="p">,</span>
  <span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-arduino101-NN&quot;</span><span class="p">,</span>
  <span class="n">ykush_url</span> <span class="o">=</span> <span class="s2">&quot;http://USER:PASSWORD@HOST/SOCKET&quot;</span><span class="p">,</span>
  <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/arduino101-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>fs2_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the FlySwatter2 (defaults
to <em>TARGETNAME-fs2</em></li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port  (defaults to
<code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>)</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub.</li>
<li><strong>ykush_url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) URL for the DLWPS7 power controller
to the YKUSH. If <em>None</em>, the YKUSH is considered always on. See
<a class="reference internal" href="#conf_00_lib_pdu.dlwps7_add" title="conf_00_lib_pdu.dlwps7_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.dlwps7_add()</span></code></a>.</p>
<p>FIXME: take a PC object so something different than a DLWPS7 can be
used.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>To power on the target, first we power the YKUSH, then the
Flyswatter, then the serial port and then the board itself. And thus
we need to wait for each part to correctly show up in the system
after we power it up (or power off). Then the system starts OpenOCD
to connect it (via the JTAG) to the board.</p>
<p>Powering on/off the YKUSH is optional, but highly recommended.</p>
<p>See the <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a> for this complicated
setup.</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>an available port on a DLWPS7 power switch (optional)</li>
<li>a Yepkit YKUSH power-switching hub (see bill of materials in
<a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></li>
<li>an Arduino101 (note it must have original firmware; if you need
to reset it, follow <a class="reference internal" href="04-HOWTOs.html#a101-fw-upgrade"><span class="std std-ref">these instructions</span></a>).</li>
<li>a USB A-Male to B-female for power to the Arduino 101</li>
<li>a USB-to-TTL serial cable for the console (power)</li>
<li>three M/M jumper cables</li>
<li>A Flyswatter2 for flashing and debugging</li>
</ul>
<ol class="arabic simple" start="3">
<li>Flash a new serial number on the Flyswatter2 following the
<a class="reference internal" href="04-HOWTOs.html#fs2-serial-update"><span class="std std-ref">instructions</span></a>.</li>
</ol>
<ul class="simple">
<li>a USB A-Male to B-female for connecting the Flyswatter to the YKush
(power and data)</li>
<li>An ARM-JTAG 20-10 adapter miniboard and flat ribbon cable
(<a class="reference external" href="https://www.olimex.com/Products/ARM/JTAG/ARM-JTAG-20-10/">https://www.olimex.com/Products/ARM/JTAG/ARM-JTAG-20-10/</a>) to
connect the JTAG to the Arduino101’s jtag port.</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the Arduino’s USB port to the YKUSH downstream port 3</li>
<li>Flyswatter2 JTAG:</li>
</ol>
<blockquote>
<div><ol class="loweralpha">
<li><p class="first">connect the USB port to the YKUSH downstream port 1</p>
</li>
<li><p class="first">flash a new serial number on the Flyswatter2 following the
<a class="reference internal" href="04-HOWTOs.html#fs2-serial-update"><span class="std std-ref">instructions</span></a>.</p>
<p>This is needed to distinguish multiple Flyswatter2 JTAGs
connected in the same system, as they all come flashed with
the same number (<em>FS20000</em>).</p>
</li>
<li><p class="first">connect the ARM-JTAG 20-10 adapter cable to the FlySwatter2 and
to the Arduino101.</p>
<p>Note the flat ribbon cable has to be properly aligned; the
red cable indicates pin #1. The board connectors might have a
dot, a number <em>1</em> or some sort of marking indicating where
pin #1 is.</p>
<p>If your ribbon cable has no red cable, just choose one end as
one and align it on both boards to be pin #1.</p>
</li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>connect the USB-to-TTY serial adapter to the YKUSH downstream
port 2</li>
<li>connect the USB-to-TTY serial adapter to the Arduino 101 with the
M/M jumper cables:<ul>
<li>USB FTDI Black (ground) to Arduino101’s serial ground pin</li>
<li>USB FTDI White (RX) to the Arduino101’ TX</li>
<li>USB FTDI Green (TX) to Arduino101’s RX.</li>
<li>USB FTDI Red (power) is left open, it has 5V.</li>
</ul>
</li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>arduino101-NN</em> (where NN is a
number)</li>
<li>Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and run <em>dmesg</em>
for a quick find], see <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a>.</li>
<li>Configure <em>udev</em> to add a name for the serial device that
represents the USB-to-TTY dongle connected to the target so we can
easily find it at <code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>. Different options for
USB-to-TTY dongles <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">with</span></a> or <a class="reference internal" href="04-HOWTOs.html#usb-tty-sibling"><span class="std std-ref">without</span></a> a USB serial number.</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.a101_dfu_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">a101_dfu_add</code><span class="sig-paren">(</span><em>name</em>, <em>serial_number</em>, <em>ykush_serial</em>, <em>ykush_port_board</em>, <em>ykush_port_serial=None</em>, <em>serial_port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.a101_dfu_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an Arduino 101</strong></p>
<p>This is an Arduino101 fixture that uses an YKUSH hub for power
control, with or without a serial port (via external USB-to-TTY
serial adapter) and requires no JTAG, using DFU mode for
flashing. It allows flashing the BLE core.</p>
<p>Add to a server configuration file (eg:
<code class="docutils literal notranslate"><span class="pre">/etc/ttbd-production/conf_10_targets.py:</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a101_dfu_add</span><span class="p">(</span><span class="s2">&quot;a101-NN&quot;</span><span class="p">,</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span> <span class="s2">&quot;YKNNNNN&quot;</span><span class="p">,</span> <span class="n">PORTNUMBER</span><span class="p">,</span>
             <span class="p">[</span><span class="n">ykush_port_serial</span> <span class="o">=</span> <span class="n">PORTNUMBER2</span><span class="p">,]</span>
             <span class="p">[</span><span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-a101-NN&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/arduino101-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the Arduino 101</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub used for power control</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board is connected.</li>
<li><strong>ykush_port_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) number of the YKUSH
downstream port where the board’s serial port is connected. If
not specified, it will be considered there is no serial port.</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the serial port
(defaults to <code class="docutils literal notranslate"><span class="pre">/dev/tty-NAME</span></code>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>The Arduino 101 is powered via the USB connector. The Arduino 101
does not export a serial port over the USB connector–applications
loaded onto it might create a USB serial port, but this is not
necessarily so all the time.</p>
<p>Thus, for ease of use this fixture connects an optional external
USB-to-TTY dongle to the TX/RX/GND lines of the Arduino 101 that
allows a reliable serial console to be present.</p>
<p>When the serial dongle is in use, the power rail needs to first
power up the serial dongle and then the board.</p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p>This fixture uses <code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.tt.tt_dfu</span></code> to implement the target;
refer to it for implementation details.</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>two available ports on an YKUSH power switching hub (serial
<em>YKNNNNN</em>); only one if the serial console will not be used.</li>
<li>an Arduino 101 board</li>
<li>a USB A-Male to micro-B male cable (for board power)</li>
<li>(optional) a USB-to-TTY serial port dongle</li>
<li>(optional) three M/M jumper cables</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>(if not yet connected), connect the YKUSH to the server system
and to power as described in <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></li>
<li>connect the Arduino 101’s USB port to the YKUSH downstream port
<em>PORTNUMBER</em></li>
<li>(if a serial console will be connected) connect the USB-to-TTY
serial adapter to the YKUSH downstream port <em>PORTNUMBER2</em></li>
</ol>
<ol class="arabic simple" start="3">
<li>(if a serial console will be connected) connect the USB-to-TTY
serial adapter to the Arduino 101 with the M/M jumper cables:<ul>
<li>USB FTDI Black (ground) to Arduino 101’s serial ground pin
(fourth pin from the bottom)</li>
<li>USB FTDI White (RX) to the Arduino 101’s TX.</li>
<li>USB FTDI Green (TX) to Arduino 101’s RX.</li>
<li>USB FTDI Red (power) is left open, it has 5V.</li>
</ul>
</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic">
<li><p class="first">Choose a name for the target: <em>a101-NN</em> (where NN is a number)</p>
</li>
<li><p class="first">(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a>.</p>
</li>
<li><p class="first">Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a>.</p>
<p>Note these boards, when freshly plugged in, will only stay in
DFU mode for <em>five seconds</em> and then boot Zephyr (or whichever
OS they have), so the USB device will dissapear. You need to
run the lsusb or whichever command you are using quick (or
monitor the kernel output with <em>dmesg -w</em>).</p>
</li>
<li><p class="first">Configure <em>udev</em> to add a name for the serial device that
represents the USB-to-TTY dongle connected to the target so we can
easily find it at <code class="docutils literal notranslate"><span class="pre">/dev/tty-a101-NN</span></code>. Different options for
USB-to-TTY dongles <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">with</span></a> or <a class="reference internal" href="04-HOWTOs.html#usb-tty-sibling"><span class="std std-ref">without</span></a> a USB serial number.</p>
</li>
<li><p class="first">Add to the configuration file (eg:
<code class="docutils literal notranslate"><span class="pre">/etc/ttbd-production/conf_10_targets.py</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a101_dfu_add</span><span class="p">(</span><span class="s2">&quot;a101-NN&quot;</span><span class="p">,</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span> <span class="s2">&quot;YKNNNNN&quot;</span><span class="p">,</span> <span class="n">PORTNUMBER</span><span class="p">,</span>
             <span class="n">ykush_port_serial</span> <span class="o">=</span> <span class="n">PORTNUMBER2</span><span class="p">,</span>
             <span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-a101-NN&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.arduino2_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">arduino2_add</code><span class="sig-paren">(</span><em>name</em>, <em>usb_serial_number</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.arduino2_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an Arduino Due board for the fixture described below</strong></p>
<p>The Arduino Due an ARM-based development board. Includes a builtin
flasher that requires the bossac tool. Single wire is used for
flashing, serial console and power.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">arduino2_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;arduino2-NN&quot;</span><span class="p">,</span>
             <span class="n">usb_serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
             <span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-arduino2-NN&quot;</span><span class="p">,</span>
             <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
             <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/arduino2-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the board</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port (defaults to
/dev/tty-TARGETNAME).</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>an Arduino Due board</li>
<li>a USB A-Male to micro-B male cable (for board power, flashing
and console)</li>
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the Arduino Due’s OpenSDA (?) port with the USB A-male
to B-micro to YKUSH downstream port <em>N</em></li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>arduino2-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a>.</li>
<li>Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></li>
<li>Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.emsk_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">emsk_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>brick_url=None</em>, <em>ykush_serial=None</em>, <em>ykush_port=None</em>, <em>openocd_path='/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/bin/openocd'</em>, <em>openocd_scripts='/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/share/openocd/scripts'</em>, <em>debug=False</em>, <em>model=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.emsk_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure a Synposis EM Starter Kit (EMSK) board configured for a
EM* SOC architecture, with a power brick and a YKUSH USB port
providing power control.</p>
<p>The board includes a builting JTAG which allows flashing,
debugging; it only requires one upstream connection to a YKUSH
power-switching hub for power, serial console and JTAG.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">emsk_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;emsk-NN&quot;</span><span class="p">,</span>
         <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
         <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
         <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span>
         <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;emsk7d&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/emsk-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the board</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port (defaults to
/dev/tty-TARGETNAME).</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
<li><strong>brick_url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – URL for the power switch to which the EMSK’s
power brick is connected (this assumes for now you are using a
DLWPS7 for power, so the url witll be in the form
<a class="reference external" href="http://user:password&#64;hostname/port">http://user:password&#64;hostname/port</a>.</li>
<li><strong>model</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>SOC model configured in the board with the blue
DIP switches (from <em>emsk7d</em> [default], <em>emsk9d</em>, <em>emsk11d</em>).</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="19%" />
<col width="19%" />
<col width="19%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">DIP1</th>
<th class="head">DIP2</th>
<th class="head">DIP3</th>
<th class="head">DIP4</th>
<th class="head">Model</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>off</td>
<td>off</td>
<td>&#160;</td>
<td>&#160;</td>
<td>em7d</td>
</tr>
<tr class="row-odd"><td>on</td>
<td>off</td>
<td>&#160;</td>
<td>&#160;</td>
<td>em9d</td>
</tr>
<tr class="row-even"><td>off</td>
<td>on</td>
<td>&#160;</td>
<td>&#160;</td>
<td>em11d</td>
</tr>
</tbody>
</table>
<p>(<em>on</em> means DIP down, towards the board)</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>a EM Starter Kit board and its power brick</li>
<li>a USB A-Male to micro-B male cable (for board power, flashing
and console)</li>
<li>one available port on a switchable power hub</li>
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the EMSK’s micro USB port with the USB A-male
to B-micro to YKUSH downstream port <em>N</em></li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></li>
<li>Connect the power brick to the EMSK’s power barrel</li>
<li>Connect the power brick to the available power in the power switch</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>emsk-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a>.</li>
<li>Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></li>
<li>Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.esp32_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">esp32_add</code><span class="sig-paren">(</span><em>name</em>, <em>usb_serial_number=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>serial_port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.esp32_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an ESP-32 MCU board</strong></p>
<p>The ESP-32 is an Tensillica based MCU, implementing two Xtensa
CPUs. This fixture uses an YKUSH hub for power control with a
serial power over the USB cable which is also used to flash using
<code class="docutils literal notranslate"><span class="pre">esptool.py</span></code> from the ESP-IDF framework.</p>
<p>See instructions in <code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.tt.tt_esp32</span></code> to install and
configure prerequisites in the server.</p>
<p>Add to a server configuration file (eg:
<code class="docutils literal notranslate"><span class="pre">/etc/ttbd-production/conf_10_targets.py:</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">esp32_add</span><span class="p">(</span><span class="s2">&quot;esp32-NN&quot;</span><span class="p">,</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span> <span class="s2">&quot;YKNNNNN&quot;</span><span class="p">,</span> <span class="n">PORTNUMBER</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/esp32-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>usb_serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) USB serial number for the
<em>esp32</em>; defaults to same as the target</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub used for power control</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board is connected.</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the serial port
(defaults to <code class="docutils literal notranslate"><span class="pre">/dev/tty-NAME</span></code>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>The ESP32 offers the same USB connector for serial port and flashing.</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>one available port on an YKUSH power switching hub (serial
<em>YKNNNNN</em>)</li>
<li>an ESP32 board</li>
<li>a USB A-Male to micro-B male cable</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>(if not yet connected), connect the YKUSH to the server system
and to power as described in <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></li>
<li>connect the esp32’s USB port to the YKUSH downstream port
<em>PORTNUMBER</em></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic" start="0">
<li><p class="first">See instructions in <code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.tt.tt_esp32</span></code> to install and
configure prerequisites in the server.</p>
</li>
<li><p class="first">Choose a name for the target: <em>esp32-NN</em> (where NN is a number)</p>
</li>
<li><p class="first">(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a>.</p>
</li>
<li><p class="first">Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a>.</p>
<p>Note these boards usually have a serial number of <em>001</em>; it can
be updated easily to a unique serial number following
<a class="reference internal" href="04-HOWTOs.html#cp210x-serial-update"><span class="std std-ref">these steps</span></a>.</p>
</li>
<li><p class="first">Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</p>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.frdm_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">frdm_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/usr/bin/openocd'</em>, <em>openocd_scripts='/usr/share/openocd/scripts'</em>, <em>debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.frdm_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a FRDM board for the fixture described below</strong></p>
<p>The FRDM k64f is an ARM-based development board. Includes a builting
JTAG which allows flashing, debugging; it only requires one upstream
connection to a YKUSH power-switching hub for power, serial console
and JTAG.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frdm_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;frdm-NN&quot;</span><span class="p">,</span>
         <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
         <span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-frdm-NN&quot;</span><span class="p">,</span>
         <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
         <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/frdm-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the FRDM board</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port  [FIXME: default to
/dev/tty-TARGETNAME]</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>a FRDM k64f board</li>
<li>a USB A-Male to micro-B male cable (for board power, JTAG and console)</li>
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the FRDM’s OpenSDA port with the USB A-male to B-micro to
YKUSH downstream port <em>N</em></li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>frdm-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a>.</li>
<li>Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></li>
<li>Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Ugly magic here. The FRDMs sometimes boot into some bootloader
upload mode (with a different USB serial number) from which the
only way to get them out is by power-cycling it.</p>
<p>So the power rail for this thing is set with a Power Controller
object that does the power cycle itself (pc_board) and then
another that looks for a USB device with the right serial number
(serial_number). If it fails to find it, it executes an action
and waits for it to show up. The action is power cycling the USB
device with the pc_board power controller. Lastly, in the power
rail, we have the glue that opens the serial ports to the device
and the flasher object that start/stops OpenOCD.</p>
<p class="last">Yup, I dislike computers too.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.ma_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">ma_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/bin/openocd'</em>, <em>openocd_scripts='/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/share/openocd/scripts'</em>, <em>debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.ma_add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.mv_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">mv_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>fs2_serial=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>ykush_port_serial=None</em>, <em>openocd_path='/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/bin/openocd'</em>, <em>openocd_scripts='/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/share/openocd/scripts'</em>, <em>debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.mv_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a Quark D2000 for the fixture described below.</strong></p>
<p>The Quark D2000 development board includes a Flyswatter2 JTAG which allows
flashing, debugging; it requires two upstream connections to
a YKUSH power-switching hub for power and JTAG and another for serial
console.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mv_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mv-NN&quot;</span><span class="p">,</span>
       <span class="n">fs2_serial</span> <span class="o">=</span> <span class="s2">&quot;mv-NN-fs2&quot;</span><span class="p">,</span>
       <span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-mv-NN&quot;</span><span class="p">,</span>
       <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
       <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N1</span><span class="p">,</span>
       <span class="n">ykush_port_serial</span> <span class="o">=</span> <span class="n">N2</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/mv-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>fs2_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the FlySwatter2 (should
be <em>TARGETNAME-fs2</em> [FIXME: default to that]</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port  [FIXME: default to
/dev/tty-TARGETNAME]</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
<li><strong>ykush_port_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board’s serial port is connected.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>The Quark D2000 board comes with a builtin JTAG / Flyswatter, whose
port can be programmed. The serial port is externally provided via a
USB-to-TTY dongle.</p>
<p>However, because of this, to power the test target up the power rail
needs to first power up the serial dongle and then the board. There
is a delay until the internal JTAG device we can access it, thus we
need a delay before the system starts OpenOCD to connect it (via the
JTAG) to the board.</p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>two available ports on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
<li>a Quark D2000 reference board</li>
<li>a USB A-Male to micro-B male cable (for board power)</li>
<li>a USB-to-TTY serial port dongle</li>
<li>three M/M jumper cables</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the Quark D2000’s USB-ATP port with the USB A-male to
B-micro to YKUSH downstream port <em>N1</em> for powering the board</li>
<li>connect the USB-to-TTY serial adapter to the YKUSH downstream
port <em>N2</em></li>
<li>connect the USB-to-TTY serial adapter to the Quark D2000 with the
M/M jumper cables:<ul>
<li>USB FTDI Black (ground) to board’s serial ground pin</li>
<li>USB FTDI White (RX) to the board’s serial TX ping</li>
<li>USB FTDI Green (TX) to board’s serial RX pin</li>
<li>USB FTDI Red (power) is left open, it has 5V.</li>
</ul>
</li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>mv-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a>.</li>
<li>Flash a new serial number on the Flyswatter2 following the
<a class="reference internal" href="04-HOWTOs.html#fs2-serial-update"><span class="std std-ref">instructions</span></a>.</li>
<li>Configure <em>udev</em> to add a name for the serial device that
represents the USB-to-TTY dongle connected to the target so we can
easily find it at <code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>. Different options for
USB-to-TTY dongles <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">with</span></a> or <a class="reference internal" href="04-HOWTOs.html#usb-tty-sibling"><span class="std std-ref">without</span></a> a USB serial number.</li>
</ol>
<ol class="arabic simple" start="6">
<li>Ensure the board is flashed with the Quark D2000 ROM (as
described <a class="reference internal" href="04-HOWTOs.html#fw-update-d2000"><span class="std std-ref">here</span></a>).</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.nios2_max10_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">nios2_max10_add</code><span class="sig-paren">(</span><em>name</em>, <em>device_id</em>, <em>serial_port_serial_number</em>, <em>pc_board</em>, <em>serial_port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.nios2_max10_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an Altera MAX10 NIOS-II</strong></p>
<p>The <a class="reference external" href="https://www.altera.com/products/fpga/max-series/max-10/overview.html">Altera MAX10</a>
is used to implement a NIOS-II CPU; it has a serial port, JTAG for
flashing and power control.</p>
<p>The USB serial port is based on a FTDI chipset with a serial
number, so it requires no modification. However, the JTAG
connector has no serial number and can be addressed only path.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nios2_max10_add</span><span class="p">(</span><span class="s2">&quot;max10-NN&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CABLEID&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
                <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://admin:1234@HOST/PORT&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/max10-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>cableid</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>identification of the JTAG for the board; this
can be determined using the <em>jtagconfig</em> tool from the Quartus
Programming Tools; make sure only a single board is connected to
the system and powered on and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ jtagconfig
1) USB-BlasterII [2-2.1]
  031050DD   10M50DA(.|ES)/10M50DC
</pre></div>
</div>
<p>Note <em>USB-BlasterII [2-2.1]</em> is the cable ID for said board.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">this cable ID is path dependent. Moving any of the
USB cables (including the upstream hubs), including
changing the ports to which the cables are
connected, will change the <em>cableid</em> and will
require re-configuration.</p>
</div>
</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the serial port of
the MAX10 board.</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port  [defaults to
/dev/tty-TARGETNAME]</li>
<li><strong>pc</strong> (<a class="reference internal" href="#ttbl.power.impl_c" title="ttbl.power.impl_c"><em>ttbl.power.impl_c</em></a>) – power controller to switch
on/off the MAX10 board.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>Altera MAX10 reference board</li>
<li>Altera MAX10 power brick</li>
<li>a USB A-Male to mini-B male cable (for JTAG)</li>
<li>a USB A-Male to mini-B male cable (for UART)</li>
<li>an available power socket in a power controller like the <a class="reference internal" href="#ttbl.pc.dlwps7" title="ttbl.pc.dlwps7"><code class="xref py py-class docutils literal notranslate"><span class="pre">Digital</span>
<span class="pre">Loggers</span> <span class="pre">Web</span> <span class="pre">Power</span> <span class="pre">Switch</span></code></a></li>
<li>two USB ports leading to the server</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the power brick to the MAX10 board</li>
<li>connect the power plug to port N of the power controller
POWERCONTROLLER</li>
<li>connect a USB cable to the UART connector in the MAX10; connect
to the server</li>
<li>connect a USB cable to the JTAG connector in the MAX10; connect
to the server</li>
<li>ensure the DIP SW2 (back of board) are all OFF except for 3
that has to be on and that J7 (front of board next to coaxial
connectors) is open.</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic">
<li><p class="first">Ensure the system is setup for MAX10 boards:</p>
<ul class="simple">
<li>Setup <code class="xref py py-data docutils literal notranslate"><span class="pre">ttbl.tt.tt_max10.quartus_path</span></code></li>
<li>Setup <code class="xref py py-data docutils literal notranslate"><span class="pre">ttbl.tt.tt_max10.input_sof</span></code></li>
</ul>
</li>
<li><p class="first">Choose a name for the target: <em>max10-NN</em> (where NN is a number)</p>
</li>
<li><p class="first">Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>; e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;tty&quot;</span><span class="p">,</span> <span class="n">ENV</span><span class="p">{</span><span class="n">ID_SERIAL_SHORT</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;AC0054PT&quot;</span><span class="p">,</span>            <span class="n">SYMLINK</span> <span class="o">+=</span> <span class="s2">&quot;tty-max10-46&quot;</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.nrf5x_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">nrf5x_add</code><span class="sig-paren">(</span><em>name</em>, <em>serial_number</em>, <em>family</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/usr/bin/openocd'</em>, <em>openocd_scripts='/usr/share/openocd/scripts'</em>, <em>debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.nrf5x_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a NRF51 board for the fixture described below</strong></p>
<p>The NRF51 is an ARM M0-based development board. Includes a builting
JTAG which allows flashing, debugging; it only requires one upstream
connection to a YKUSH power-switching hub for power, serial console
and JTAG.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nrf5x_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;nrf51-NN&quot;</span><span class="p">,</span>
          <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
          <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
          <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/nrf51-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the board</li>
<li><strong>family</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Family of the board (<em>nrf51_blenano</em>,
<em>nrf51_pca10028</em>, <em>nrf52840_pca10056</em>, <em>nrf52_blenano2</em>,
<em>nrf52_pca10040</em>)</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the serial port, which
defaults to <code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>.</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>a nrf51 board</li>
<li>a USB A-Male to micro-B male cable (for board power, JTAG and console)</li>
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the FRDM’s USB port with the USB A-male to B-micro to
YKUSH downstream port <em>N</em></li>
<li>ensure the battery is disconnected</li>
</ol>
<ol class="arabic simple" start="2">
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>nrf51-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a>.</li>
<li>Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></li>
<li>Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.nucleo_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">nucleo_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/usr/bin/openocd'</em>, <em>openocd_scripts='/usr/share/openocd/scripts'</em>, <em>debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.nucleo_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an Nucleo F10 board</strong></p>
<p>This is a backwards compatiblity function, please use <a class="reference internal" href="#conf_00_lib_mcu.stm32_add" title="conf_00_lib_mcu.stm32_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">stm32_add()</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.quark_c1000_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">quark_c1000_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/bin/openocd'</em>, <em>openocd_scripts='/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/share/openocd/scripts'</em>, <em>debug=False</em>, <em>variant='qc10000_crb'</em>, <em>target_type='ma'</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.quark_c1000_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a Quark C1000 for the fixture described below</strong></p>
<p>The Quark C1000 development board has a built-in JTAG which allows
flashing, debugging, thus it only requires an upstream connection
to a YKUSH power-switching hub for power, serial console and JTAG.</p>
<p>This board has a USB serial number and should not require any
flashing of the USB descriptors for setup.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">quark_c1000_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;qc10000-NN&quot;</span><span class="p">,</span>
                <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
                <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
                <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/qc10000-NN
</pre></div>
</div>
<p>earlier versions of these boards can be added with the <em>ma_add()</em> and
<em>ah_add()</em> versions of this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the Quark C1000 board</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port  [FIXME: default to
/dev/tty-TARGETNAME]</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
<li><strong>variant</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – variant of ROM version and address map as
defined in (FIXME) flasher configuration.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
<li>a Quark C1000 reference board</li>
<li>a USB A-Male to micro-B male cable (for board power, JTAG and console)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the Quark C1000’s FTD_USB port with the USB A-male to
B-micro to YKUSH downstream port <em>N</em></li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic">
<li><p class="first">Choose a name for the target: <em>qc10000-NN</em> (where NN is a number)</p>
</li>
<li><p class="first">(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a>.</p>
</li>
<li><p class="first">Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></p>
</li>
<li><p class="first">Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</p>
<p>Note, <strong>however</strong> that these boards might present two serial
ports to the system, one of which later converts to another
interface. So in order to avoid configuration issues, the right
port has to be explicitly specified with <cite>ENV{ID_PATH} == “*:1.1”</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Force second interface, first is for JTAG/update</span>
<span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;tty&quot;</span><span class="p">,</span> <span class="n">ENV</span><span class="p">{</span><span class="n">ID_SERIAL_SHORT</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;IN0521621&quot;</span><span class="p">,</span>            <span class="n">ENV</span><span class="p">{</span><span class="n">ID_PATH</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;*:1.1&quot;</span><span class="p">,</span>            <span class="n">SYMLINK</span> <span class="o">+=</span> <span class="s2">&quot;tty-TARGETNAME&quot;</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="data">
<dt id="conf_00_lib_mcu.target_qemu_zephyr_desc">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">target_qemu_zephyr_desc</code><em class="property"> = {'arm': {'cmdline': ['/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/bin/qemu-system-arm', '-cpu', 'cortex-m3', '-machine', 'lm3s6965evb', '-nographic', '-vga', 'none'], 'zephyr_board': 'qemu_cortex_m3'}, 'nios2': {'cmdline': ['/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/bin/qemu-system-nios2', '-machine', 'altera_10m50_zephyr', '-nographic']}, 'riscv32': {'cmdline': ['/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/bin/qemu-system-riscv32', '-nographic', '-machine', 'sifive_e']}, 'x86': {'cmdline': ['/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/bin/qemu-system-i386', '-m', '8', '-cpu', 'qemu32,+nx,+pae', '-device', 'isa-debug-exit,iobase=0xf4,iosize=0x04', '-nographic', '-no-acpi']}, 'x86_64': {'cmdline': ['/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/bin/qemu-system-x86_64', '-nographic']}, 'xtensa': {'cmdline': ['/opt/zephyr-sdk-0.10.0/sysroots/x86_64-pokysdk-linux/usr/bin/qemu-system-xtensa', '-machine', 'sim', '-semihosting', '-nographic', '-cpu', 'sample_controller']}}</em><a class="headerlink" href="#conf_00_lib_mcu.target_qemu_zephyr_desc" title="Permalink to this definition">¶</a></dt>
<dd><p>QEMU Zephyr target descriptors</p>
<p>Dictionary describing the supported BSPs for QEMU targets and what
Zephyr board and commandline they map to.</p>
<p>The <em>key</em> is the TCF <em>BSP</em> which maps to the binary
<em>qemu-system-BSP</em>. If the field <em>zephyr_board</em> is present, it
refers to how that BSP is known to the Zephyr OS.</p>
<p>New entries can be added with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target_qemu_zephyr_desc</span><span class="p">[</span><span class="s1">&#39;NEWBSP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;/usr/bin/qemu-system-NEWBSP&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;arg1&#39;</span><span class="p">,</span> <span class="s1">&#39;arg2&#39;</span><span class="p">,</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">zephyr_board</span> <span class="o">=</span> <span class="s1">&#39;NEWBSPZEPHYRNAME&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.target_qemu_zephyr_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">target_qemu_zephyr_add</code><span class="sig-paren">(</span><em>name</em>, <em>bsp=None</em>, <em>zephyr_board=None</em>, <em>target_type=None</em>, <em>nw_name=None</em>, <em>cmdline=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.target_qemu_zephyr_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a QEMU target that can run the <a class="reference external" href="http://zephyrproject.org">Zephyr OS</a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – target’s <a class="reference internal" href="03-server-setup.html#bp-naming-targets"><span class="std std-ref">name</span></a>.</li>
<li><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – what architecture the target shall implement;
shall be available in <a class="reference internal" href="#conf_00_lib_mcu.target_qemu_zephyr_desc" title="conf_00_lib_mcu.target_qemu_zephyr_desc"><code class="xref py py-data docutils literal notranslate"><span class="pre">target_qemu_zephyr_desc</span></code></a>.</li>
<li><strong>zephyr_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) type of this target’s BSP for
the Zephyr OS; defaults to whatever <a class="reference internal" href="#conf_00_lib_mcu.target_qemu_zephyr_desc" title="conf_00_lib_mcu.target_qemu_zephyr_desc"><code class="xref py py-data docutils literal notranslate"><span class="pre">target_qemu_zephyr_desc</span></code></a>
declares or <em>BSP</em> if none.</li>
<li><strong>target_type</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) what type the target shall
declare; defaults to <em>qz-BSP</em>.</li>
<li><strong>nw_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) name of network/interconnect to
which the target is connected. Note that the configuration code
shall manually configure the network metadata as this serves
only to ensure a TAP device is created before the QEMU daemon is
started. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">target_qemu_zephyr_add</span><span class="p">(</span><span class="s2">&quot;qzx86-36a&quot;</span><span class="p">,</span> <span class="s1">&#39;x86&#39;</span><span class="p">,</span> <span class="n">nw_name</span> <span class="o">=</span> <span class="s2">&quot;nwa&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">nw_indexes</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index</span> <span class="o">=</span> <span class="mi">36</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">add_to_interconnect</span><span class="p">(</span>           <span class="c1"># Add target to the interconnect</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;nwa&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mac_addr</span> <span class="o">=</span> <span class="s2">&quot;02:</span><span class="si">%02x</span><span class="s2">:00:00:</span><span class="si">%02x</span><span class="s2">:</span><span class="si">%02x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ipv4_addr</span> <span class="o">=</span> <span class="s1">&#39;192.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ipv4_prefix_len</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ipv6_addr</span> <span class="o">=</span> <span class="s1">&#39;fc00::</span><span class="si">%02x</span><span class="s1">:</span><span class="si">%02x</span><span class="s1">:</span><span class="si">%02x</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ipv6_prefix_len</span> <span class="o">=</span> <span class="mi">112</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><strong>target_type</strong> – (optional) what type the target shall
declare; defaults to <em>qz-BSP</em>.</li>
<li><strong>cmdline</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) command line to start this QEMU
virtual machine; defaults to whatever <a class="reference internal" href="#conf_00_lib_mcu.target_qemu_zephyr_desc" title="conf_00_lib_mcu.target_qemu_zephyr_desc"><code class="xref py py-data docutils literal notranslate"><span class="pre">target_qemu_zephyr_desc</span></code></a>
declares.</p>
<p>Normally you <em>do not need</em> to set this; see
<a class="reference internal" href="#ttbl.qemu.pc" title="ttbl.qemu.pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.qemu.pc</span></code></a> for details on the command line
specification if you think you do.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.sam_xplained_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">sam_xplained_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/usr/bin/openocd'</em>, <em>openocd_scripts='/usr/share/openocd/scripts'</em>, <em>debug=False</em>, <em>target_type='sam_e70_xplained'</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.sam_xplained_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a SAM E70/V71 boards for the fixture described below</strong></p>
<p>The SAM E70/V71 xplained is an ARM-based development
board. Includes a builtin JTAG which allows flashing, debugging;
it only requires one upstream connection to a YKUSH
power-switching hub for power, serial console and JTAG.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sam_xplained_add</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;sam-e70-NN&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
    <span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-same70-NN&quot;</span><span class="p">,</span>
    <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
    <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span>
    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;sam_e70_xplained&quot;</span><span class="p">)</span> <span class="c1"># or sam_v71_xplained</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/sam-e70-NN
local/sam-v71-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the SAM board</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the serial port (defaults to
<code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>)</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub where it is connected to
for power control.</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
<li><strong>target_type</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – the target type “sam_e70_xplained”
or “sam_v71_xplained”</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>a SAM E70 or V71 xplained board</li>
<li>a USB A-Male to micro-B male cable (for board power, JTAG and console)</li>
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic">
<li><p class="first">Ensure the SAM E70 is properly setup:</p>
<p>Using Atmel’s <em>SAM-BA</em> In-system programmer, change the boot
sequence and reset the board in case there is a bad image;
this utility can be also used to recover the board in case
it gets stuck.</p>
<ol class="upperalpha">
<li><p class="first">Download from <a class="reference external" href="http://www.atmel.com/tools/atmelsam-bain-systemprogrammer.aspx">Atmel’s website</a>
(registration needed) and install.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is <strong>not</strong> open source software</p>
</div>
</li>
<li><p class="first">Close the erase jumper <em>erase</em> (in SAMEv70 that’s J200 and
in SAMEv71 it is J202; in both cases, it is located above the
CPU when you rotate the board so you can read the CPU’s
labeling in a normal orientation).</p>
</li>
<li><p class="first">Connect the USB cable to the taget’s <em>target USB</em> port (the
one next to the Ethernet connector) and to a USB port that
is known to be powered on.</p>
<p>Ensure power is on by verifying the orange led lights on on
the Ethernet RJ-45 connector.</p>
</li>
<li><p class="first">Wait 10 seconds</p>
</li>
<li><p class="first">Open the erase jumper J202 to stop erasing</p>
</li>
<li><p class="first">Open <em>SAM-BA</em> 2.16</p>
<p>Note on Fedora 25 you need to run <em>sam-ba_64</em> from the
SAM-BA package.</p>
</li>
<li><p class="first">Select which serial port is that of the SAM e70 connected to
the system. Use <em>lsusb.py -ciu</em> to locate the <em>tty/ttyACM</em>
device assigned to your board:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lsusb.py -ciu
...
2-1      03eb:6124 02  2.00  480MBit/s 100mA 2IFs (Atmel Corp. at91sam SAMBA bootloader)
 2-1:1.0   (IF) 02:02:00 1EP  (Communications:Abstract (modem):None) cdc_acm tty/ttyACM2
 2-1:1.1   (IF) 0a:00:00 2EPs (CDC Data:) cdc_acm
...
</pre></div>
</div>
<p>(in this example <code class="docutils literal notranslate"><span class="pre">/dev/tty/ttyACM2</span></code>).</p>
</li>
<li><p class="first">Select board <em>at91same70-explained</em>, click connect.</p>
</li>
<li><p class="first">chose the flash tab and in the scripts
drop down menu, choose <em>boot from Flash (GPNVM1)</em> and then
<em>execute</em>.</p>
</li>
<li><p class="first">Exit <em>SAM-BA</em></p>
</li>
</ol>
</li>
<li><p class="first">connect the SAM E70/V71’s <em>Debug USB</em> port with the USB
A-male to B-micro to YKUSH downstream port <em>N</em></p>
</li>
<li><p class="first">connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></p>
</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>sam-e70-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a>.</li>
<li>Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></li>
<li>Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the board’s <em>serial number</em>.</li>
</ol>
</dd></dl>

<dl class="data">
<dt id="conf_00_lib_mcu.simics_zephyr_cmds">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">simics_zephyr_cmds</code><em class="property"> = '$disk_image = &quot;%(simics_hd0)s&quot;\n$cpu_class = &quot;pentium-pro&quot;\n$text_console = TRUE\nrun-command-file &quot;%%simics%%/targets/x86-440bx/x86-440bx-pci-system.include&quot;\ncreate-telnet-console-comp $system.serconsole %(simics_console_port)d\nconnect system.serconsole.serial cnt1 = system.motherboard.sio.com[0]\ninstantiate-components\nsystem.serconsole.con.capture-start &quot;%(simics_console)s&quot;\nc\n'</em><a class="headerlink" href="#conf_00_lib_mcu.simics_zephyr_cmds" title="Permalink to this definition">¶</a></dt>
<dd><p>Commmands to configure Simics to run a simulation for Zephyr by
default</p>
<p><code class="xref py py-data docutils literal notranslate"><span class="pre">Fields</span> <span class="pre">available</span></code> via string
formatting <code class="docutils literal notranslate"><span class="pre">%(FIELD)L</span></code></p>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.simics_zephyr_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">simics_zephyr_add</code><span class="sig-paren">(</span><em>name</em>, <em>simics_cmds='$disk_image = &quot;%(simics_hd0)s&quot;\n$cpu_class = &quot;pentium-pro&quot;\n$text_console = TRUE\nrun-command-file &quot;%%simics%%/targets/x86-440bx/x86-440bx-pci-system.include&quot;\ncreate-telnet-console-comp $system.serconsole %(simics_console_port)d\nconnect system.serconsole.serial cnt1 = system.motherboard.sio.com[0]\ninstantiate-components\nsystem.serconsole.con.capture-start &quot;%(simics_console)s&quot;\nc\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.simics_zephyr_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure a virtual Zephyr target running inside Simics</p>
<p>Simics is a platform simulator available from Wind River Systems;
it can be used to implement a virtual machine environment that
will be treated as a target.</p>
<p>Add to your configuration file
<code class="docutils literal notranslate"><span class="pre">/etc/ttbd-production/conf_10_targets.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">simics_zephyr_add</span><span class="p">(</span><span class="s2">&quot;szNN&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/szNN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target (<a class="reference internal" href="03-server-setup.html#bp-naming-targets"><span class="std std-ref">naming
best practices</span></a>).</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>A Simics invocation in a standalone workspace will be created by
the server to run for earch target when it is powered on. This
driver currently supports only booting an ELF target and console
output support (no console input or debugging). For more details,
see <code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.tt.simics</span></code>.</p>
<p>Note the default Simics settings for Zephyr are defined in
<a class="reference internal" href="#conf_00_lib_mcu.simics_zephyr_cmds" title="conf_00_lib_mcu.simics_zephyr_cmds"><code class="xref py py-data docutils literal notranslate"><span class="pre">simics_zephyr_cmds</span></code></a> and you can create target which use a
different Simics configuration by specifying it as a string in
parameter <em>simics_cmd</em>.</p>
<p><strong>Bill of materials</strong></p>
<ul>
<li><p class="first">Simics installed in your server machine</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.tt.simics</span></code> expects a global environment variable
SIMICS_BASE_PACKAGE defined to point to where Simics (and its
extension packages) have been installed; e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SIMICS_BASE_PACKAGE</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">simics</span><span class="o">/</span><span class="mf">5.0</span><span class="o">/</span><span class="n">simics</span><span class="o">-</span><span class="mf">5.0</span><span class="o">.</span><span class="mi">136</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.stm32_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">stm32_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/usr/bin/openocd'</em>, <em>openocd_scripts='/usr/share/openocd/scripts'</em>, <em>model=None</em>, <em>zephyr_board=None</em>, <em>debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.stm32_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an Nucleo/STM32 board</strong></p>
<p>The Nucleo / STM32 are ARM-based development board. Includes a
builting JTAG which allows flashing, debugging; it only requires
one upstream connection to a YKUSH power-switching hub for power,
serial console and JTAG.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stm32_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;stm32f746-67&quot;</span><span class="p">,</span>
          <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;066DFF575251717867114355&quot;</span><span class="p">,</span>
          <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YK23406&quot;</span><span class="p">,</span>
          <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
          <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;stm32f746&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/stm32f746-67
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the board</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the serial port
(defaults to /dev/tty-TARGETNAME).</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board is connected.</li>
<li><strong>openocd_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) path to where the OpenOCD
binary is installed (defaults to system’s).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Zephyr SDK 0.9.5’s version of OpenOCD is not able
to flash some of these boards.</p>
</div>
</li>
<li><strong>openocd_scripts</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) path to where the OpenOCD
scripts are installed (defaults to system’s).</li>
<li><strong>model</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>String which describes this model to the OpenOCD
configuration. This matches the model of the board in the
packaging. E.g:</p>
<ul>
<li>stm32f746</li>
<li>stm32f103</li>
</ul>
<p>see below for the mechanism to add more via configuration</p>
</li>
<li><strong>zephyr_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) string to configure as the
board model used for Zephyr builds. In most cases it will be
inferred automatically.</li>
<li><strong>debug</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) operate in debug mode (more verbose
log from OpenOCD) (defaults to false)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>one STM32* board</li>
<li>a USB A-Male to micro-B male cable (for board power, flashing
and console)</li>
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the STM32 micro USB port with the USB A-male
to B-micro to YKUSH downstream port <em>N</em></li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>stm32MODEL-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a>.</li>
<li>Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></li>
<li>Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</li>
<li>Add the configuration block described at the top of this
documentation and restart the server</li>
</ol>
<p><strong>Extending configuration for new models</strong></p>
<p>Models not supported by current configuration can be expanded by
adding a configuration block such as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ttbl.flasher</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">flasher</span><span class="o">.</span><span class="n">openocd_c</span><span class="o">.</span><span class="n">_addrmaps</span><span class="p">[</span><span class="s1">&#39;stm32f7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">arm</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">load_addr</span> <span class="o">=</span> <span class="mh">0x08000000</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">ttbl</span><span class="o">.</span><span class="n">flasher</span><span class="o">.</span><span class="n">openocd_c</span><span class="o">.</span><span class="n">_boards</span><span class="p">[</span><span class="s1">&#39;stm32f746&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">addrmap</span> <span class="o">=</span> <span class="s1">&#39;stm32f7&#39;</span><span class="p">,</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;arm&#39;</span> <span class="p">],</span>
    <span class="n">target_id_names</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;stm32f7x.cpu&#39;</span> <span class="p">},</span>
    <span class="n">write_command</span> <span class="o">=</span> <span class="s2">&quot;flash write_image erase </span><span class="si">%(file)s</span><span class="s2"> </span><span class="si">%(address)s</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">config</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;       #</span>
<span class="s2"># openocd.cfg configuration from zephyr.git/boards/arm/stm32f746g_disco/support/openocd.cfg</span>
<span class="s2">#</span>
<span class="s2">source [find board/stm32f7discovery.cfg]</span>

<span class="s2">$_TARGETNAME configure -event gdb-attach {</span>
<span class="s2"> echo &quot;Debugger attaching: halting execution&quot;</span>
<span class="s2"> reset halt</span>
<span class="s2"> gdb_breakpoint_override hard</span>
<span class="s2">}</span>

<span class="s2">$_TARGETNAME configure -event gdb-detach {</span>
<span class="s2"> echo &quot;Debugger detaching: resuming execution&quot;</span>
<span class="s2"> resume</span>
<span class="s2">}</span>

<span class="s2">&quot;&quot;&quot;</span>
<span class="p">)</span>

<span class="n">stm32_models</span><span class="p">[</span><span class="s1">&#39;stm32f746&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">zephyr</span> <span class="o">=</span> <span class="s2">&quot;stm32f746g_disco&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_mcu.tinytile_add">
<code class="descclassname">conf_00_lib_mcu.</code><code class="descname">tinytile_add</code><span class="sig-paren">(</span><em>name</em>, <em>usb_serial_number</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>ykush_port_serial=None</em>, <em>serial_port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_mcu.tinytile_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a tinyTILE for the fixture described below.</strong></p>
<p>The tinyTILE is a miniaturization of the Arduino/Genuino 101 (see
<a class="reference external" href="https://www.zephyrproject.org/doc/boards/x86/tinytile/doc/board.html">https://www.zephyrproject.org/doc/boards/x86/tinytile/doc/board.html</a>).</p>
<p>The fixture used by this configuration uses a YKUSH hub for power
switching, no debug/JTAG interface and allows for an
optional external serial port using an USB-to-TTY serial adapter.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tinytile_add</span><span class="p">(</span><span class="s2">&quot;ti-NN&quot;</span><span class="p">,</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span> <span class="s2">&quot;YKNNNNN&quot;</span><span class="p">,</span> <span class="n">PORTNUMBER</span><span class="p">,</span>
             <span class="p">[</span><span class="n">ykush_port_serial</span> <span class="o">=</span> <span class="n">N2</span><span class="p">,]</span>
             <span class="p">[</span><span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-NAME&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/ti-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>usb_serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the tinyTILE</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board is connected.</li>
<li><strong>ykush_port_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) number of the YKUSH
downstream port where the board’s serial port is connected.</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the serial port
(defaults to <code class="docutils literal notranslate"><span class="pre">/dev/tty-NAME</span></code>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>The tinyTILE is powered via the USB connector. The tinyTILE does
not export a serial port over the USB connector–applications
loaded onto it might create a USB serial port, but this is not
necessarily so all the time.</p>
<p>Thus, for ease of use this fixture connects an optional external
USB-to-TTY dongle to the TX/RX/GND lines of the tinyTILE that
allows a reliable serial console to be present. To allow for
proper MCU board reset, this serial port has to be also power
switched on the same YKUSH hub (to avoid ground derivations).</p>
<p>For the serial console output to be usableq, the Zephyr Apps
configuration has to be altered to change the console to said
UART. The client side needs to be aware of that (via
configuration, for example, to the Zephyr App Builder).</p>
<p>When the serial dongle is in use, the power rail needs to first
power up the serial dongle and then the board.</p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p>This fixture uses <code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.tt.tt_dfu</span></code> to implement the target;
refer to it for implementation details.</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>two available ports on an YKUSH power switching hub (serial
<em>YKNNNNN</em>); only one if the serial console will not be used.</li>
<li>a tinyTILE board</li>
<li>a USB A-Male to micro-B male cable (for board power)</li>
<li>a USB-to-TTY serial port dongle</li>
<li>three M/M jumper cables</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>(if not yet connected), connect the YKUSH to the server system
and to power as described in <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a></li>
<li>connect the Tiny Tile’s USB port to the YKUSH downstream port
N1</li>
<li>(if a serial console will be connected) connect the USB-to-TTY
serial adapter to the YKUSH downstream port N2</li>
</ol>
<ol class="arabic simple" start="3">
<li>(if a serial console will be connected) connect the USB-to-TTY
serial adapter to the Tiny Tile with the M/M jumper cables:<ul>
<li>USB FTDI Black (ground) to Tiny Tile’s serial ground pin
(fourth pin from the bottom)</li>
<li>USB FTDI White (RX) to the Tiny Tile’s TX.</li>
<li>USB FTDI Green (TX) to Tiny Tile’s RX.</li>
<li>USB FTDI Red (power) is left open, it has 5V.</li>
</ul>
</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic">
<li><p class="first">Choose a name for the target: <em>ti-NN</em> (where NN is a number)</p>
</li>
<li><p class="first">(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib_pdu.ykush_targets_add" title="conf_00_lib_pdu.ykush_targets_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pdu.ykush_targets_add()</span></code></a>.</p>
</li>
<li><p class="first">Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a>.</p>
<p>Note these boards, when freshly plugged in, will only stay in
DFU mode for <em>five seconds</em> and then boot Zephyr (or whichever
OS they have), so the USB device will dissapear. You need to
run the lsusb or whichever command you are using quick (or
monitor the kernel output with <em>dmesg -w</em>).</p>
</li>
<li><p class="first">Configure <em>udev</em> to add a name for the serial device that
represents the USB-to-TTY dongle connected to the target so we can
easily find it at <code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME</span></code>. Different options for
USB-to-TTY dongles <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">with</span></a> or <a class="reference internal" href="04-HOWTOs.html#usb-tty-sibling"><span class="std std-ref">without</span></a> a USB serial number.</p>
</li>
</ol>
</dd></dl>

</div>
<span class="target" id="module-conf_00_lib_pos"></span><p>TTBD configuration library to add targets that use Provisioning OS to
flash OS images
———————————————————————</p>
<dl class="function">
<dt id="conf_00_lib_pos.nw_indexes">
<code class="descclassname">conf_00_lib_pos.</code><code class="descname">nw_indexes</code><span class="sig-paren">(</span><em>nw_name</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_pos.nw_indexes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the network indexes that correspond to a one or two letter
network name.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>nw_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – a one or two letter network name in the set
<em>a-zA-Z</em>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">x, y, vlan_id; x and y are meant to be used for creating
IP addresses (IPv4 192.x.y.0/24, IPv6 fc00::x:y:0/112)<p>(yes, 192.x.y/0.24 with x != 168 is not private, but this is
supposed to be running inside a private network anyway, so you
won’t be able to route there).</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_pos.nw_pos_add">
<code class="descclassname">conf_00_lib_pos.</code><code class="descname">nw_pos_add</code><span class="sig-paren">(</span><em>nw_name</em>, <em>power_rail=None</em>, <em>mac_addr=None</em>, <em>vlan=None</em>, <em>ipv4_prefix_len=24</em>, <em>ipv6_prefix_len=112</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_pos.nw_pos_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds configuration for a network with <a class="reference internal" href="07-Architecture.html#provisioning-os"><span class="std std-ref">Provisioning OS</span></a> support.</p>
<p>This setups the network with the power rails needed for targets
that can boot Provisioning OS to deploy images to their hard
drives.</p>
<p>For example, to add <em>nwb</em>, <em>192.168.98.0/24</em> with the server on
<em>192.168.98.1</em> adding proxy port redirection from the isolated network
to that upstream the server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">nw_indexes</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">interconnect</span> <span class="o">=</span> <span class="n">nw_pos_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">mac_addr</span> <span class="o">=</span> <span class="s1">&#39;00:50:b6:27:4b:77&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">power_rail</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s1">&#39;http://admin:1234@sp7/4&#39;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="c1"># disable the proxy redirection, using tinyproxy</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="c1"># running on :8888</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="c1"># Mirrors of Clear and other stuff, see distro_mirrors below</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ttbl</span><span class="o">.</span><span class="n">socat</span><span class="o">.</span><span class="n">pci</span><span class="p">(</span><span class="s1">&#39;tcp&#39;</span><span class="p">,</span> <span class="s2">&quot;192.</span><span class="si">%d</span><span class="s2">.</span><span class="si">%d</span><span class="s2">.1&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mi">1080</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                       <span class="s1">&#39;linux-ftp.jf.intel.com&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ttbl</span><span class="o">.</span><span class="n">socat</span><span class="o">.</span><span class="n">pci</span><span class="p">(</span><span class="s1">&#39;tcp&#39;</span><span class="p">,</span> <span class="s2">&quot;192.</span><span class="si">%d</span><span class="s2">.</span><span class="si">%d</span><span class="s2">.1&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mi">1443</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                       <span class="s1">&#39;linux-ftp.jf.intel.com&#39;</span><span class="p">,</span> <span class="mi">443</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">])</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">interconnect</span><span class="o">.</span><span class="n">tags_update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># implemented by tinyproxy running in the server</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ftp_proxy</span> <span class="o">=</span> <span class="s2">&quot;http://192.</span><span class="si">%d</span><span class="s2">.</span><span class="si">%d</span><span class="s2">.1:8888&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">http_proxy</span> <span class="o">=</span> <span class="s2">&quot;http://192.</span><span class="si">%d</span><span class="s2">.</span><span class="si">%d</span><span class="s2">.1:8888&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">https_proxy</span> <span class="o">=</span> <span class="s2">&quot;http://192.</span><span class="si">%d</span><span class="s2">.</span><span class="si">%d</span><span class="s2">.1:8888&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
</pre></div>
</div>
<p>Note how first we calculate, from the network names the nibbles
we’ll use for IP addresses. This is only needed because we are
adding extras to the basic configuration.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>nw_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>network name, which must be one or two ASCII
letters, uppwer or lowercase; see <a class="reference internal" href="03-server-setup.html#bp-naming-networks"><span class="std std-ref">best naming practices</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">letter</span> <span class="o">=</span> <span class="s2">&quot;aD&quot;</span>
</pre></div>
</div>
<p>would yield a network called <em>nwAD</em>.</p>
</li>
<li><strong>mac_addr</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) if specified, this is connected to
the physical network adapter in the server with the given MAC
address in six 16-bit hex digits (<em>hh:hh:hh:hh:hh:hh</em>).</p>
<p>Note the TCF server will take over said interface, bring it up,
down, remove and add IP address etc, so it cannot be shared with
any interface being used for other things.</p>
</li>
<li><strong>vlan</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – <p>(optional) use Ethernet VLANs</p>
<ul>
<li>None: do not use vlans (default)</li>
<li>0: configure this network to use a VLAN on the physical
interface; the VLAN ID is calculated from the network
name.</li>
<li>N &gt; 0: the number is used as the VLAN ID.</li>
</ul>
</li>
<li><strong>power_rail</strong> (<em>list</em>) – <p>(optional) list of
<a class="reference internal" href="#ttbl.power.impl_c" title="ttbl.power.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.impl_c</span></code></a> objects that control power
to this network.</p>
<p>This can be used to power on/off switches, start daemons, etc
when the network is started:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">power_rail</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># power on the network switch plugged to PDU sp7, socket 4</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s1">&#39;http://admin:1234@sp7/4&#39;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># start two port redirectors to a proxy</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">socat</span><span class="o">.</span><span class="n">pci</span><span class="p">(</span><span class="s1">&#39;tcp&#39;</span><span class="p">,</span> <span class="s2">&quot;192.168.</span><span class="si">%d</span><span class="s2">.1&quot;</span> <span class="o">%</span> <span class="n">nw_idx</span><span class="p">,</span> <span class="mi">1080</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                   <span class="s1">&#39;proxy-host.domain&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">socat</span><span class="o">.</span><span class="n">pci</span><span class="p">(</span><span class="s1">&#39;tcp&#39;</span><span class="p">,</span> <span class="s2">&quot;192.168.</span><span class="si">%d</span><span class="s2">.1&quot;</span> <span class="o">%</span> <span class="n">nw_idx</span><span class="p">,</span> <span class="mi">1443</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                   <span class="s1">&#39;proxy-host.domain&#39;</span><span class="p">,</span> <span class="mi">443</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the interconect object added</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_pos.pos_target_name_split">
<code class="descclassname">conf_00_lib_pos.</code><code class="descname">pos_target_name_split</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_pos.pos_target_name_split" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="conf_00_lib_pos.target_pos_setup">
<code class="descclassname">conf_00_lib_pos.</code><code class="descname">target_pos_setup</code><span class="sig-paren">(</span><em>target</em>, <em>nw_name</em>, <em>pos_boot_dev</em>, <em>linux_serial_console_default</em>, <em>pos_nfs_server=None</em>, <em>pos_nfs_path=None</em>, <em>pos_rsync_server=None</em>, <em>boot_config=None</em>, <em>boot_config_fix=None</em>, <em>boot_to_normal=None</em>, <em>boot_to_pos=None</em>, <em>mount_fs=None</em>, <em>pos_http_url_prefix=None</em>, <em>pos_image=None</em>, <em>pos_partsizes=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_pos.target_pos_setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Given an existing target, add to it metadata used by the
Provisioning OS mechanism.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>nw_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the network target that provides
POS services to this target</li>
<li><strong>pos_boot_dev</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – which is the boot device to use,
where the boot loader needs to be installed in a boot
partition. e.g.: <code class="docutils literal notranslate"><span class="pre">sda</span></code> for <em>/dev/sda</em> or <code class="docutils literal notranslate"><span class="pre">mmcblk01</span></code> for
<em>/dev/mmcblk01</em>.</li>
<li><strong>linux_serial_console_default</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>which device <strong>the
target</strong> sees as the system’s serial console connected to TCF’s
boot console.</p>
<p>If <em>DEVICE</em> (eg: ttyS0) is given, Linux will be booted with the
argument <em>console=DEVICE,115200</em>.</p>
</li>
<li><strong>pos_nfs_server</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) IPv4 address of the NFS
server that provides the Provisioning OS root filesystem</p>
<p>e.g.: <em>192.168.0.6</em></p>
<p>Default is <em>None</em>, and thus taking from what the boot
interconnect declares in the same metadata.</p>
</li>
<li><strong>pos_nfs_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>path in the NFS server for the
Provisioning OS root filesystem.</p>
<p>Normally this is set from the information exported by the
network <em>nw_name</em>.</p>
<p>e.g.: <em>/home/ttbd/images/tcf-live/x86_64/</em>.</p>
<p>Default is <em>None</em>, and thus taking from what the boot
interconnect declares in the same metadata.</p>
</li>
<li><strong>pos_rsync_server</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) RSYNC URL where the
Provisioning OS images are available.</p>
<p>eg: <em>192.168.0.6::images</em></p>
<p>Default is <em>None</em>, and thus taking from what the boot
interconnect declares in the same metadata.</p>
</li>
<li><strong>boot_config</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) <a class="reference internal" href="#tcfl.pos.capability_fns" title="tcfl.pos.capability_fns"><code class="xref py py-data docutils literal notranslate"><span class="pre">capability</span></code></a> to configure the boot
loader.</p>
<p>e.g.: <a class="reference internal" href="#tcfl.pos_uefi.boot_config_multiroot" title="tcfl.pos_uefi.boot_config_multiroot"><code class="xref py py-func docutils literal notranslate"><span class="pre">*uefi*</span></code></a> (default)</p>
</li>
<li><strong>boot_config_fix</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) <a class="reference internal" href="#tcfl.pos.capability_fns" title="tcfl.pos.capability_fns"><code class="xref py py-data docutils literal notranslate"><span class="pre">capability</span></code></a> to fix the boot
loader configuration.</p>
<p>e.g.: <a class="reference internal" href="#tcfl.pos_uefi.boot_config_fix" title="tcfl.pos_uefi.boot_config_fix"><code class="xref py py-func docutils literal notranslate"><span class="pre">*uefi*</span></code></a> (default)</p>
</li>
<li><strong>boot_to_normal</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) <a class="reference internal" href="#tcfl.pos.capability_fns" title="tcfl.pos.capability_fns"><code class="xref py py-data docutils literal notranslate"><span class="pre">capability</span></code></a> to boot the system in normal (non
provisioning) mode</p>
<p>e.g.: <a class="reference internal" href="#tcfl.pos.target_power_cycle_to_normal_pxe" title="tcfl.pos.target_power_cycle_to_normal_pxe"><code class="xref py py-func docutils literal notranslate"><span class="pre">*pxe*</span></code></a> (default)</p>
</li>
<li><strong>boot_to_pos</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) <a class="reference internal" href="#tcfl.pos.capability_fns" title="tcfl.pos.capability_fns"><code class="xref py py-data docutils literal notranslate"><span class="pre">capability</span></code></a> to boot the system in provisioning
mode.</p>
<p>e.g.: <a class="reference internal" href="#tcfl.pos.target_power_cycle_to_pos_pxe" title="tcfl.pos.target_power_cycle_to_pos_pxe"><code class="xref py py-func docutils literal notranslate"><span class="pre">*pxe*</span></code></a> (default)</p>
</li>
<li><strong>mount_fs</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) <a class="reference internal" href="#tcfl.pos.capability_fns" title="tcfl.pos.capability_fns"><code class="xref py py-data docutils literal notranslate"><span class="pre">capability</span></code></a> to partition, select and mount the root
filesystem during provisioning mode</p>
<p>e.g.: <a class="reference internal" href="#module-tcfl.pos_multiroot" title="tcfl.pos_multiroot"><code class="xref py py-func docutils literal notranslate"><span class="pre">*multiroot*</span></code></a> (default)</p>
</li>
<li><strong>pos_http_url_prefix</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) prefix to give to the
kernel/initrd for booting over TFTP or HTTP. Note: you want a
trailing slash:</p>
<p>e.g.: <em>http://192.168.0.6/ttbd-pos/x86_64/</em> for HTTP boot</p>
<p>e.g.: <em>subdir</em> for TFTP boot from the <em>subdir</em> subdirectory</p>
<p>Default is <em>None</em>, and thus taking from what the boot
interconnect declares in the same metadata.</p>
</li>
<li><strong>pos_image</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) name of the Provisioning image to
use, which will be used for the kernel name, initrd name and NFS
root path:</p>
<ul>
<li>kernel: vmlinuz-POS-IMAGE</li>
<li>initrd: initrd-POS-IMAGE</li>
<li>root-path: POS-IMAGE/ARCHITECTURE</li>
</ul>
<p>e.g.: <em>tcf-live</em> (default)</p>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Part str pos_partsizes:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first">(optional) sizes of the different
partitions when using the <a class="reference internal" href="#pos-multiroot"><span class="std std-ref">multiroot</span></a>
system to manage the target’s disk; see
<a class="reference internal" href="#pos-multiroot-partsizes"><span class="std std-ref">Partition Size specification</span></a>.</p>
<p class="last">e.g.: <em>“1:10:30:20”</em> (default)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_pos.pos_target_add">
<code class="descclassname">conf_00_lib_pos.</code><code class="descname">pos_target_add</code><span class="sig-paren">(</span><em>name</em>, <em>mac_addr</em>, <em>power_rail</em>, <em>boot_disk</em>, <em>pos_partsizes</em>, <em>linux_serial_console</em>, <em>target_type=None</em>, <em>target_type_long=None</em>, <em>index=None</em>, <em>network=None</em>, <em>power_on_pre_hook=None</em>, <em>extra_tags=None</em>, <em>pos_nfs_server=None</em>, <em>pos_nfs_path=None</em>, <em>pos_rsync_server=None</em>, <em>boot_config=None</em>, <em>boot_config_fix=None</em>, <em>boot_to_normal=None</em>, <em>boot_to_pos=None</em>, <em>mount_fs=None</em>, <em>pos_http_url_prefix=None</em>, <em>pos_image=None</em>, <em>ipv4_prefix_len=24</em>, <em>ipv6_prefix_len=112</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_pos.pos_target_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a PC-class target that can be provisioned using Provisioning
OS.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>target’s name, following the convention
<a class="reference internal" href="03-server-setup.html#bp-naming-targets"><span class="std std-ref">*TYPE-NNNETWORK*</span></a>:</p>
<ul>
<li><em>TYPE</em> is the target’s short type that describes targets that
are generally the same</li>
<li><em>NN</em> is a number 2 to 255</li>
<li><em>NETWORK</em> is the name of the network it is connected to (the
network target is actuall called <em>nwNETWORK</em>), see <a class="reference internal" href="03-server-setup.html#bp-naming-networks"><span class="std std-ref">naming
*networks</span></a>.</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="s1">&#39;nuc5-02a&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;Intel NUC5i5U324&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><strong>mac_addr</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>MAC address for this target on its connection
to network <em>nwNETWORK</em>.</p>
<p>Can’t be the same as any other MAC address in the system or that
network. It shall be in the standard format of six hex digits
separated by colons:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="s1">&#39;nuc5-02a&#39;</span><span class="p">,</span> <span class="s1">&#39;c0:3f:d5:67:07:81&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><strong>power_rail</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>Power control instance
to power switch this target, eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="s1">&#39;nuc5-02a&#39;</span><span class="p">,</span> <span class="s1">&#39;c0:3f:d5:67:07:81&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>               <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://admin:1234@POWERSWITCHANEM/3&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>               <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>This can also be a list of these if multiple components need to
be powered on/off to power on/off the target.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="s1">&#39;nuc5-02a&#39;</span><span class="p">,</span> <span class="s1">&#39;c0:3f:d5:67:07:81&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>               <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>                   <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://admin:1234@POWERSWITCHANEM/3&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                   <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://admin:1234@POWERSWITCHANEM/4&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                   <span class="n">ttbl</span><span class="o">.</span><span class="n">ipmi</span><span class="o">.</span><span class="n">pci</span><span class="p">(</span><span class="s2">&quot;BMC_HOSTNAME&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>               <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>               <span class="o">...</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
</li>
<li><strong>power_rail</strong> – <p>Address of the <a class="reference internal" href="#ttbl.pc.dlwps7" title="ttbl.pc.dlwps7"><code class="xref py py-class docutils literal notranslate"><span class="pre">Digital</span> <span class="pre">Logger</span> <span class="pre">Web</span>
<span class="pre">Power</span> <span class="pre">Switch</span></code></a> in the form
<em>[USER:PASSWORD&#64;]HOSTNAME/PLUGNUMBER</em>.</p>
<p><strong>LEGACY</strong></p>
<p>eg: for a target <em>nuc5-02a</em> connected to plug #5 of a DLWPS7 PDU
named <em>sp10</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="s1">&#39;nuc5-02a&#39;</span><span class="p">,</span> <span class="n">power_rail_dlwps</span> <span class="o">=</span> <span class="s1">&#39;sp10/5&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Note there has to be at least one power spec given</p>
</li>
<li><strong>boot_disk</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>base name of the disk (as seen by Linux)
from which the device will boot to configure it as a boot loader
and install a root filesystem on it</p>
<p>eg for <em>nuc5-02a</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="s2">&quot;nuc5-2a&quot;</span><span class="p">,</span> <span class="n">MAC</span><span class="p">,</span> <span class="n">POWER</span><span class="p">,</span> <span class="s1">&#39;sda&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note <em>/dev/</em> is not needed.</p>
</li>
<li><strong>pos_partsizes</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>sizes of the partitions to create; this is a
list of four numbers with sizes in gigabytes for the boot, swap,
scratch and root partitions.</p>
<p>eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="s2">&quot;nuc5-2a&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">pos_partsizes</span> <span class="o">=</span> <span class="s2">&quot;1:4:10:5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>will create in this target a boot partition 1 GiB in size, then
a swap partition 4 GiB, a scratch partition 10 GiB and then
multiple root filesystem partitons of 5 GiB each (until the disk
is exhausted).</p>
</li>
<li><strong>linux_serial_console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>name of the device that Linux
sees when it boots as a serial console</p>
<p>eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="s2">&quot;nuc5-02a&quot;</span><span class="p">,</span> <span class="o">...</span> <span class="n">linux_serial_console</span> <span class="o">=</span> <span class="s2">&quot;ttyS0&quot;</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="s2">&quot;nuc6-03b&quot;</span><span class="p">,</span> <span class="o">...</span> <span class="n">linux_serial_console</span> <span class="o">=</span> <span class="s2">&quot;ttyUSB0&quot;</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Note <em>/dev/</em> is not needed and that this is the device the
<strong>target</strong> sees, not the server.</p>
</li>
<li><strong>target_type</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) override target’s type (guessed
from the name), which will be reported in the <em>type</em> target
metadata; eg, for <em>Intel NUC5i5</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="s2">&quot;nuc5-02a&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;Intel NUC5i5U324&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The HW usually has many different types that are extremely
similar; when such is the case, the <em>type</em> can be set to a
common prefix and the tag <em>type_long</em> then added to contain the
full type name (this helps simplifying the setup); see
<em>target_type_long</em> and <em>extra_tags</em> below.</p>
</li>
<li><strong>target_type_long</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) long version of the target
type (see above). Defaults to the same as <em>target_type</em></li>
<li><strong>index</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – <p>(optional) override the target’s index guessed
from the name with a (between 2 and 254); in the name it will be
formatted with at least two decimal digits.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="s2">&quot;nuc5-02a&quot;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, trget <em>nuc-02a</em> will be assigned a default IP
address of 192.168.97.3 instead of 192.168.97.2.</p>
</li>
<li><strong>network</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) override the network name guessed
from the target’s name.</p>
<p>This is one or two ASCII letters, uppwer or lowercase; see
<a class="reference internal" href="03-server-setup.html#bp-naming-networks"><span class="std std-ref">best naming practices</span></a>.</p>
<p>eg for <em>nuc5-02c</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="s2">&quot;nuc5-02c&quot;</span><span class="p">,</span> <span class="n">network</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>The network naming convention <em>nwa</em> of the example help keep
network names short, needed for internal interface name
limitation in Linux (for example). Note the IP addresses for nwX
are <em>192.168.ascii(X).0/24</em>; thus for <em>nuc5-02a</em> in the example,
it’s IP address will be <em>192.168.168.65.2</em>.</p>
<p>If the network were, for example, <em>Gk</em>, the IP address would be
<em>192.71.107.2</em> (71 being ASCII(G), 107 ASCII(k)).</p>
</li>
<li><strong>extra_tags</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>extra tags to add to the target for information</p>
<p>eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_target_add</span><span class="p">(</span><span class="n">name_prefix</span> <span class="o">=</span> <span class="s2">&quot;nuc5&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">fixture_usb_disk</span> <span class="o">=</span> <span class="s2">&quot;4289273ADF334&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">fixture_usb_disk</span> <span class="o">=</span> <span class="s2">&quot;4289273ADF334&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><strong>power_on_pre_hook</strong> – <p>(optional) function the server
calls before powering on the target so so it boots Provisioning
OS mode or normal mode.</p>
<p>This might be configuring the DHCP server to offer a TFTP file
or configuring the TFTP configuration file a bootloader will
pick, etc; for examples, look at:</p>
<ul>
<li><a class="reference internal" href="#ttbl.dhcp.power_on_pre_pos_setup" title="ttbl.dhcp.power_on_pre_pos_setup"><code class="xref py py-func docutils literal notranslate"><span class="pre">ttbl.dhcp.power_on_pre_pos_setup()</span></code></a></li>
<li><a class="reference internal" href="#ttbl.ipmi.pci.pre_power_pos_setup" title="ttbl.ipmi.pci.pre_power_pos_setup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ttbl.ipmi.pci.pre_power_pos_setup()</span></code></a></li>
<li><a class="reference internal" href="#ttbl.ipmi.pci_ipmitool.pre_power_pos_setup" title="ttbl.ipmi.pci_ipmitool.pre_power_pos_setup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ttbl.ipmi.pci_ipmitool.pre_power_pos_setup()</span></code></a></li>
</ul>
<p>Default is <a class="reference internal" href="#ttbl.dhcp.power_on_pre_pos_setup" title="ttbl.dhcp.power_on_pre_pos_setup"><code class="xref py py-func docutils literal notranslate"><span class="pre">ttbl.dhcp.power_on_pre_pos_setup()</span></code></a>.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>For other parameters possible to control the POS settings, please
look at <a class="reference internal" href="#conf_00_lib_pos.target_pos_setup" title="conf_00_lib_pos.target_pos_setup"><code class="xref py py-func docutils literal notranslate"><span class="pre">target_pos_setup()</span></code></a></p>
</dd></dl>

<dl class="data">
<dt id="conf_00_lib_pos.qemu_iftype_to_pos_boot_dev">
<code class="descclassname">conf_00_lib_pos.</code><code class="descname">qemu_iftype_to_pos_boot_dev</code><em class="property"> = {'ide': 'sda', 'scsi': 'sda', 'virtio': 'vda'}</em><a class="headerlink" href="#conf_00_lib_pos.qemu_iftype_to_pos_boot_dev" title="Permalink to this definition">¶</a></dt>
<dd><p>Map QEMU’s hard drive interfaces to how Provisioning OS sees them
as their boot device</p>
<p>Can be extended in configuration with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qemu_iftype_to_pos_boot_dev</span><span class="p">[</span><span class="s1">&#39;NEWIFTYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;xka1&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_pos.target_qemu_pos_add">
<code class="descclassname">conf_00_lib_pos.</code><code class="descname">target_qemu_pos_add</code><span class="sig-paren">(</span><em>target_name</em>, <em>nw_name</em>, <em>mac_addr</em>, <em>ipv4_addr</em>, <em>ipv6_addr</em>, <em>consoles=None</em>, <em>disk_size='30G'</em>, <em>mr_partsizes='1:2:2:10'</em>, <em>sd_iftype='ide'</em>, <em>extra_cmdline=''</em>, <em>ram_megs=2048</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_pos.target_qemu_pos_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a QEMU virtual machine capable of booting over Provisioning OS.</p>
<p>This target supports one or more serial consoles, a graphics
interface exported via VNC and a single hard drive using
<a class="reference internal" href="#ttbl.qemu.pc" title="ttbl.qemu.pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.qemu.pc</span></code></a> as backend.</p>
<p>Note this target uses a UEFI bios <em>and</em> defines UEFI storage
space; this is needed so the right boot order is maintained.</p>
<p>Add to a server configuration file <code class="docutils literal notranslate"><span class="pre">/etc/ttbd-*/conf_*.py</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">target_qemu_pos_add</span><span class="p">(</span><span class="s2">&quot;qu-05a&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="s2">&quot;nwa&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="n">mac_addr</span> <span class="o">=</span> <span class="s2">&quot;02:61:00:00:00:05&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="n">ipv4_addr</span> <span class="o">=</span> <span class="s2">&quot;192.168.95.5&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="n">ipv6_addr</span> <span class="o">=</span> <span class="s2">&quot;fc00::61x:05&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>See an example usage in <code class="xref py py-func docutils literal notranslate"><span class="pre">conf_06_default.nw_default_targets_add()</span></code>
to create default targets.</p>
<p>Extra paramenters can be added by using the <em>extra_cmdline</em>
arguments, such as for example, to add another drive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">extra_cmdline</span> <span class="o">=</span> <span class="s2">&quot;-drive file=</span><span class="si">%%</span><span class="s2">(path)s/hd-extra.qcow2,if=virtio,aio=threads&quot;</span>
</pre></div>
</div>
<p>Adding to other networks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">add_to_interconnect</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;nwb&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mac_addr</span> <span class="o">=</span> <span class="s2">&quot;02:62:00:00:00:05&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ipv4_addr</span> <span class="o">=</span> <span class="s2">&quot;192.168.98.5&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ipv6_addr</span> <span class="o">=</span> <span class="s2">&quot;fc00::62:05&quot;</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target to create</li>
<li><strong>nw_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the network to which this target will
be connected that provides Provisioning OS services.</li>
<li><strong>mac_addr</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>MAC address for this target (for QEMU usually
a fake one).</p>
<p>Will be given to the virtual device created and can’t be the
same as any other MAC address in the system or the networks. It
is recommended to be in the format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="mi">02</span><span class="p">:</span><span class="n">HX</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="n">HY</span>
</pre></div>
</div>
<p>where HX and HY are two hex digits; <em>02:…</em> is a valid ethernet
space.</p>
</li>
<li><strong>ipv4_addr</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – IPv4 Address (32bits, <em>DDD.DDD.DDD.DDD</em>, where
<em>DDD</em> are decimal integers 0-255) that will be assigned to this
target in the network.</li>
<li><strong>ipv6_addr</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – IPv6 Address (128bits, standard ipv6 colon
format) that will be assigned to this target in the network.</li>
<li><strong>consoles</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – <p>(optional) names of serial consoles to
create (defaults to just one, <em>ttyS0</em>). E.g:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">consoles</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;ttyS0&quot;</span><span class="p">,</span> <span class="s2">&quot;ttyS1&quot;</span><span class="p">,</span> <span class="s2">&quot;com3&quot;</span> <span class="p">]</span>
</pre></div>
</div>
<p>these names are used to create the internal QEMU name and how
the TCF daemon will refer to them as console names. In the
machine, they will be standard serial ports in that order.</p>
</li>
<li><strong>disk_size</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) size specification for the
target’s hard drive, as understood by QEMU’s qemu-img create
program. Defaults to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">disk_size</span> <span class="o">=</span> <span class="s2">&quot;30G&quot;</span>
</pre></div>
</div>
</li>
<li><strong>mr_partsizes</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) sizes of the different
partitions when using the <a class="reference internal" href="#pos-multiroot"><span class="std std-ref">multiroot</span></a>
system to manage the target’s disk; see
<a class="reference internal" href="#pos-multiroot-partsizes"><span class="std std-ref">Partition Size specification</span></a>.</p>
<p>e.g.: <em>“1:10:30:20”</em> (default)</p>
</li>
<li><strong>sd_iftype</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) interface to use for the disks
(defaults to <em>ide</em> as is the one most Linux distro support off
the bat). Available types are (per QEMU -drive option: ide,
scsi, sd, mtd, floppy, pflash, virtio)</li>
<li><strong>ram_megs</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) size of memory in megabytes
(defaults to 2048)</li>
<li><strong>extra_cmdline</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – a string with extra command line to add;
%(FIELD)s supported (target tags).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Notes</strong></p>
<ul>
<li><p class="first">The hardrive gets fully reinitialized every time the server is
restarted (the backend file gets wiped and re-created).</p>
<p>It is still possible to force a re-partitioning of the backend
by setting POS property <a class="reference internal" href="#pos-reinitialize"><span class="std std-ref">pos_reinitialize</span></a>.</p>
</li>
</ul>
</dd></dl>

<span class="target" id="module-conf_00_lib_pdu"></span><div class="section" id="configuration-api-for-pdus-and-other-power-switching-equipment">
<span id="conf-00-lib-pdu"></span><h3>8.6.3. Configuration API for PDUs and other power switching equipment<a class="headerlink" href="#configuration-api-for-pdus-and-other-power-switching-equipment" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="conf_00_lib_pdu.target_pdu_socket_add">
<code class="descclassname">conf_00_lib_pdu.</code><code class="descname">target_pdu_socket_add</code><span class="sig-paren">(</span><em>name</em>, <em>pc</em>, <em>tags=None</em>, <em>power=True</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_pdu.target_pdu_socket_add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="conf_00_lib_pdu.apc_pdu_add">
<code class="descclassname">conf_00_lib_pdu.</code><code class="descname">apc_pdu_add</code><span class="sig-paren">(</span><em>name</em>, <em>powered_on_start=None</em>, <em>hostname=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_pdu.apc_pdu_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add targets to control the individual sockets of an APC PDU power
switch.</p>
<p>The APC PDU needs to be setup and configured (refer to the
instructions in <a class="reference internal" href="#ttbl.apc.pci" title="ttbl.apc.pci"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.apc.pci</span></code></a>); this function exposes the
different targets for to expose the individual sockets for debug.</p>
<p>Add to a configuration file
<code class="docutils literal notranslate"><span class="pre">/etc/ttbd-production/conf_10_targets.py</span></code> (or similar):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">apc_pdu_add</span><span class="p">(</span><span class="s2">&quot;sp16&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>where <em>sp16</em> is the name (hostname of the PDU)</p>
<p>yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/sp16-1
local/sp16-2
local/sp16-3
...
local/sp16-24
</pre></div>
</div>
<p>for a 24 outlet PDU</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>powered_on_start</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) if <em>True</em>, turn on the
sockets when we call this function; defaults to <em>False</em>.</li>
<li><strong>hostname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) hostname or IP address of the APC
unit if different from the <em>name</em>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_pdu.dlwps7_add">
<code class="descclassname">conf_00_lib_pdu.</code><code class="descname">dlwps7_add</code><span class="sig-paren">(</span><em>hostname</em>, <em>powered_on_start=None</em>, <em>user='admin'</em>, <em>password='1234'</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_pdu.dlwps7_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add test targets to individually control each of a DLWPS7’s sockets</p>
<p>The DLWPS7 needs to be setup and configured; this function exposes
the different targets for to expose the individual sockets for debug.</p>
<p>Add to a configuration file
<code class="docutils literal notranslate"><span class="pre">/etc/ttbd-production/conf_10_targets.py</span></code> (or similar):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dlwps7_add</span><span class="p">(</span><span class="s2">&quot;sp6&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/sp6-1
local/sp6-2
local/sp6-3
local/sp6-4
local/sp6-5
local/sp6-6
local/sp6-7
local/sp6-8
</pre></div>
</div>
<p>Power controllers for targets can be implemented instantiating an
<a class="reference internal" href="#ttbl.pc.dlwps7" title="ttbl.pc.dlwps7"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.pc.dlwps7</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://admin:1234@spM/O&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>where <em>O</em> is the outlet number as it shows in the physical unit and
<em>spM</em> is the name of the power switch.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>hostname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Hostname of the switch</li>
<li><strong>user</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User name for HTTP Basic authentication</li>
<li><strong>password</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – password for HTTP Basic authentication</li>
<li><strong>powered_on_start</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – <p>what to do with the power on the
downstream ports:</p>
<ul>
<li><em>None</em>: leave them as they are</li>
<li><em>False</em>: power them off</li>
<li><em>True</em>: power them on</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>a DLWPS7 unit and power cable connected to power plug</li>
<li>a network cable</li>
<li>a connection to a network switch to which the server is also
connected (<em>nsN</em>)</li>
</ul>
<p><strong>Connecting the power switch</strong></p>
<ol class="arabic">
<li><p class="first">Ensure you have configured an class C <em>192.168.X.0/24</em>,
configured with static IP addresses, to which maybe only this
server has access to connect IP-controlled power
switches.</p>
<p>Follow <a class="reference internal" href="04-HOWTOs.html#internal-network"><span class="std std-ref">these instructions</span></a> to create a
network.</p>
<p>You might need a new Ethernet adaptor to connect to said
network (might be PCI, USB, etc).</p>
</li>
<li><p class="first">connect the power switch to said network</p>
</li>
<li><p class="first">assign a name to the power switch and add it along its IP
address in <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code>; convention is to call them <em>spY</em>,
where X is a number and <em>sp</em> stands for <em>Switch; Power</em>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">if your system uses proxies, you need to add <em>spY</em>
also to the <em>no_proxy</em> environment varible in
<code class="file docutils literal notranslate"><span class="pre">/etc/bashrc</span></code> to avoid the daemon trying to access the
power switch through the proxy, which will not work.</p>
</div>
</li>
<li><p class="first">with the names <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code>, refer to the switches by name
rather than by IP address.</p>
</li>
</ol>
<p><strong>Configuring the system</strong></p>
<ol class="arabic">
<li><p class="first">Choose a name for the power switch (<em>spM</em>), where <em>M</em> is a number</p>
</li>
<li><p class="first">The power switch starts with IP address <em>192.168.0.100</em>; it needs
to be changed to <em>192.168.X.M</em>:</p>
<ol class="loweralpha">
<li><p class="first">Connect to <em>nsN</em></p>
</li>
<li><p class="first">Ensure the server access to <em>192.168.0.100</em> by adding this
routing hack:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ifconfig nsN:2 192.168.0.0/24</span>
</pre></div>
</div>
</li>
<li><p class="first">With lynx or a web browser, from the server, access the
switch’s web control interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lynx http://192.168.0.100
</pre></div>
</div>
</li>
<li><p class="first">Enter the default user <em>admin</em>, password <em>1234</em>, select <em>ok</em>
and indicate <em>A</em> to always accept cookies</p>
</li>
<li><p class="first">Hit enter to refresh link redirecting to
<em>192.168.0.100/index.htm</em>, scroll down to <em>Setup</em>,
select. On all this steps, make sure to hit submit for each
individual change.</p>
<ol class="arabic">
<li><p class="first">Lookup setup of IP address, change to <em>192.168.N.M</em> (where <em>x</em>
matches <em>spM</em>), gateway <em>192.168.N.1</em>; hit the <em>submit</em> next to
it.</p>
</li>
<li><p class="first">Disable the security lockout in section <em>Delay</em></p>
<p>Set <em>Wrong password lockout</em> set to zero minutes</p>
</li>
<li><p class="first">Turn on setting power after power loss:</p>
<p><em>Power Loss Recovery Mode &gt; When recovering after power
loss</em> select <em>Turn all outlets on</em></p>
</li>
<li><p class="first">Extra steps needed for newer units
(<a class="reference external" href="https://dlidirect.com/products/new-pro-switch">https://dlidirect.com/products/new-pro-switch</a>)</p>
<p>The new refreshed unit looks the same, but has wifi
connectivity and pleny of new features, some of which
need tweaking; login to the setup page again and for each
of this, set the value/s and hit <em>submit</em> before going to
the next one:</p>
<ul>
<li><p class="first">Access setings (quite important, as this allows the
driver to access the same way for the previous
generation of the product too):</p>
<p>ENABLE: <em>allow legacy plaintext login methods</em></p>
<p>Note in (3) below it is explained why this is not a
security problem in this kind of deployments.</p>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<ol class="loweralpha" start="7">
<li><p class="first">remove the routing hack:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ifconfig nsN:2 down</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p class="first">The unit’s default admin username and password are kept per
original (admin, 1234):</p>
<ul class="simple">
<li>They are deployed in a dedicated network switch that is internal
to the server; none has access but the server users (targets run
on another switch).</li>
<li>they use HTTP Basic Auth, they might as well not use
authentication</li>
</ul>
</li>
<li><p class="first">Add an entry in <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code> for <em>spM</em> so we can refer to the
DLWPS7 by name instead of IP address:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">192.168</span><span class="o">.</span><span class="mf">4.</span><span class="n">X</span>    <span class="n">spM</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_pdu.raritan_emx_add">
<code class="descclassname">conf_00_lib_pdu.</code><code class="descname">raritan_emx_add</code><span class="sig-paren">(</span><em>url</em>, <em>outlets=8</em>, <em>targetname=None</em>, <em>https_verify=True</em>, <em>powered_on_start=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_pdu.raritan_emx_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add targets to control the individual outlets of a Raritan EMX PDU</p>
<p>This is usually a low level tool for administrators that allows to
control the outlets individually. Normal power control for targets
is implemented instantiating a power controller interface as
described in <a class="reference internal" href="#ttbl.raritan_emx.pci" title="ttbl.raritan_emx.pci"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.raritan_emx.pci</span></code></a>.</p>
<p>For example add to a <code class="docutils literal notranslate"><span class="pre">/etc/ttbd-production/conf_10_targets.py</span></code>
(or similar) configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">raritan_emx_add</span><span class="p">(</span><span class="s2">&quot;https://admin:1234@sp6&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/sp6-1
local/sp6-2
local/sp6-3
local/sp6-4
local/sp6-5
local/sp6-6
local/sp6-7
local/sp6-8
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>URL to access the PDU in the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="p">[</span><span class="n">USERNAME</span><span class="p">:</span><span class="n">PASSWORD</span><span class="o">@</span><span class="p">]</span><span class="n">HOSTNAME</span>
</pre></div>
</div>
<p>Note the login credentials are optional, but must be matching
whatever is configured in the PDU for HTTP basic
authentication and permissions to change outlet state.</p>
</li>
<li><strong>outlets</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – <p>number of outlets in the PDU (model specific)</p>
<p>FIXME: guess this from the unit directly using JSON-RPC</p>
</li>
<li><strong>targetname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) base name
to for the target’s; defaults to the hostname (eg: for
<em>https://mypdu.domain.com</em> it’d be <em>mypdu-1</em>, <em>mypdu-2</em>, etc).</li>
<li><strong>powered_on_start</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – <p>what to do with the power on the
downstream ports:</p>
<ul>
<li><em>None</em>: leave them as they are</li>
<li><em>False</em>: power them off</li>
<li><em>True</em>: power them on</li>
</ul>
</li>
<li><strong>https_verify</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional, default <em>True</em>) do or
do not HTTPS certificate verification.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Setup instructions</strong></p>
<p>Refer to <a class="reference internal" href="#raritan-emx-setup"><span class="std std-ref">ttbl.raritan_emx.pci</span></a>.</p>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_pdu.usbrly08b_targets_add">
<code class="descclassname">conf_00_lib_pdu.</code><code class="descname">usbrly08b_targets_add</code><span class="sig-paren">(</span><em>serial_number</em>, <em>target_name_prefix=None</em>, <em>power=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_pdu.usbrly08b_targets_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Set up individual power control targets for each relay of a
<a class="reference external" href="https://www.robot-electronics.co.uk/htm/usb_rly08btech.htm">Devantech USB-RLY08B</a></p>
<p>See below for configuration steps</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB Serial Number of the relay board
(<a class="reference internal" href="04-HOWTOs.html#usbrly08b-serial-number"><span class="std std-ref">finding</span></a>).</li>
<li><strong>target_name_prefix</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) Prefix for the target
names (which defaults to <em>usbrly08b-SERIALNUMBER-</em>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>A Devantech USB-RLY08B USB relay controller
(<a class="reference external" href="https://www.robot-electronics.co.uk/htm/usb_rly08btech.htm">https://www.robot-electronics.co.uk/htm/usb_rly08btech.htm</a>)</li>
<li>a USB A-Male to B-female to connect it to the server</li>
<li>an upstream USB A-female port to the server (in a hub or root hub)</li>
</ul>
<p><strong>Connecting the relay board to the system</strong></p>
<ol class="arabic simple">
<li>Connect the USB A-Male to the free server USB port</li>
<li>Connect the USB B-Male to the relay board</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a prefix name for the target (eg: <em>re00</em>) or let it be
the default (<em>usbrly08b-SERIALNUMBER</em>).</li>
<li>Find the relay board’s <a class="reference internal" href="04-HOWTOs.html#usbrly08b-serial-number"><span class="std std-ref">serial number</span></a> (<a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">more methods</span></a>)</li>
<li>Ensure the device node for the board is accessible by the user
or groups running the daemon. See
<a class="reference internal" href="#ttbl.usbrly08b.pc" title="ttbl.usbrly08b.pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.usbrly08b.pc</span></code></a> for details.</li>
</ol>
<ol class="arabic" start="3">
<li><p class="first">To create individual targets to control each individual relay,
add in a configuration file such as
<code class="docutils literal notranslate"><span class="pre">/etc/ttbd-production/conf_10_targets.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">usbrly08b_targets_add</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>which yields, after restarting the server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list -a
local/usbrly08b-00023456-01
local/usbrly08b-00023456-02
local/usbrly08b-00023456-03
local/usbrly08b-00023456-04
local/usbrly08b-00023456-05
local/usbrly08b-00023456-06
local/usbrly08b-00023456-07
</pre></div>
</div>
<p>To use the relays as power controllers on a power rail for
another target, create instances of
<a class="reference internal" href="#ttbl.usbrly08b.pc" title="ttbl.usbrly08b.pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.usbrly08b.pc</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">pc</span><span class="p">(</span><span class="s2">&quot;0023456&quot;</span><span class="p">,</span> <span class="n">RELAYNUMBER</span><span class="p">)</span>
</pre></div>
</div>
<p>where <em>RELAYNUMBER</em> is 1 - 8, which matches the number of the
relay etched on the board.</p>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib_pdu.ykush_targets_add">
<code class="descclassname">conf_00_lib_pdu.</code><code class="descname">ykush_targets_add</code><span class="sig-paren">(</span><em>ykush_serial</em>, <em>pc_url</em>, <em>powered_on_start=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib_pdu.ykush_targets_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Given the <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">serial number</span></a> for an YKUSH
hub connected to the system, set up a number of targets to
manually control it.</p>
<ul class="simple">
<li>(maybe) one target to control the whole hub</li>
<li>One target per port <em>YKNNNNN-1</em> to <em>YKNNNNN-3</em> to control the three
ports individually; this is used to debug powering up different
parts of a target.</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ykush_targets_add</span><span class="p">(</span><span class="s2">&quot;YK34567&quot;</span><span class="p">,</span> <span class="s2">&quot;http://USER:PASSWD@HOST/4&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>yields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list
local/YK34567
local/YK34567-1
local/YK34567-2
local/YK34567-3
</pre></div>
</div>
<p>To use then the YKUSH hubs as power controllers, create instances of
<a class="reference internal" href="#ttbl.pc_ykush.ykush" title="ttbl.pc_ykush.ykush"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.pc_ykush.ykush</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">pc_ykush</span><span class="o">.</span><span class="n">ykush</span><span class="p">(</span><span class="s2">&quot;YK34567&quot;</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
</pre></div>
</div>
<p>where <em>PORT</em> is 1, 2 or 3.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB Serial Number of the hub
(<a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">finding</span></a>).</li>
<li><strong>pc_url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>Power Control URL</p>
<ul>
<li>A DLPWS7 URL (<a class="reference internal" href="#ttbl.pc.dlwps7" title="ttbl.pc.dlwps7"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.pc.dlwps7</span></code></a>), if given, will create a
target <em>YKNNNNN</em> to power on or off the whole hub and wait for it
to connect to the system.</li>
<li>If None, no power control targets for the whole hub will be
created. It will just be expected the hub is connected permanently
to the system.</li>
</ul>
</li>
<li><strong>powered_on_start</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – <p>what to do with the power on the
downstream ports:</p>
<ul>
<li><em>None</em>: leave them as they are</li>
<li><em>False</em>: power them off</li>
<li><em>True</em>: power them on</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Bill of materials</strong></p>
<ul>
<li><p class="first">YKUSH hub and it’s <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">serial number</span></a></p>
<p>Note the hub itself has no serial number, but an internal device
connected to its downstream port number 4 does have the <em>YK34567</em>
serial number.</p>
</li>
<li><p class="first">a male to mini-B male cable for power</p>
</li>
<li><p class="first">a USB brick for power</p>
<ul class="simple">
<li>(optional) a DLWPS7 power switch to control the hub’s power</li>
<li>or an always-on connection to a power plug</li>
</ul>
</li>
<li><p class="first">a male to micro-B male cable for upstream USB connectivity</p>
</li>
<li><p class="first">an upstream USB B-female port to the server (in a hub or root hub)</p>
</li>
</ul>
<p>Note the <em>YKNNNNN</em> targets are always tagged <em>idle_poweroff = 0</em>
(so they are never automatically powered off) but not
<em>skip_cleanup</em>; the later would never release them when idle and
if a recovery fails somewhere, then none would be able to
re-acquire it to recover.</p>
</dd></dl>

</div>
</div>
<div class="section" id="module-ttbl.config">
<span id="ttbd-configuration-api"></span><h2>8.7. <em>ttbd</em> Configuration API<a class="headerlink" href="#module-ttbl.config" title="Permalink to this headline">¶</a></h2>
<p>Configuration API for <em>ttbd</em></p>
<dl class="data">
<dt id="ttbl.config.defaults_enabled">
<code class="descclassname">ttbl.config.</code><code class="descname">defaults_enabled</code><em class="property"> = True</em><a class="headerlink" href="#ttbl.config.defaults_enabled" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse defaults configuration blocks protected by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaults_enabled</span><span class="p">:</span>
</pre></div>
</div>
<p>This is done so that a sensible configuration can be shipped by
default that is easy to deactivate in a local configuration file.</p>
<p>This is important as the default configuration includes the
definition for three networks (<em>nwa</em>, <em>nwb</em> and <em>nwc</em>) that if
spread around multiple servers will lead the clients to think they
are the same network but spread around multiple servers, when they
are in truth different networks.</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.default_qemu_start">
<code class="descclassname">ttbl.config.</code><code class="descname">default_qemu_start</code><em class="property"> = 90</em><a class="headerlink" href="#ttbl.config.default_qemu_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Qemu target count start</p>
<p>By default, qemu targets we create by default get
assigned IP addresses in the 90 range, so we have plenty of space
before for others</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.processes">
<code class="descclassname">ttbl.config.</code><code class="descname">processes</code><em class="property"> = 20</em><a class="headerlink" href="#ttbl.config.processes" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of processes to start</p>
<p>How many servers shall be started, each being able to run a request
in parallel. Defaults to 20, but can be increased if HW is not
being very cooperative.</p>
<p>(this is currently a hack, we plan to switch to a server that can
spawn them more dynamically).</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.instance">
<code class="descclassname">ttbl.config.</code><code class="descname">instance</code><em class="property"> = ''</em><a class="headerlink" href="#ttbl.config.instance" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of the current <em>ttbd</em> instance</p>
<p>Multiple separate instances of the daemon can be started, each
named differently (or nothing).</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.instance_suffix">
<code class="descclassname">ttbl.config.</code><code class="descname">instance_suffix</code><em class="property"> = ''</em><a class="headerlink" href="#ttbl.config.instance_suffix" title="Permalink to this definition">¶</a></dt>
<dd><p>Filename suffix for the current <em>ttbd</em> instance</p>
<p>Per <a class="reference internal" href="#ttbl.config.instance" title="ttbl.config.instance"><code class="xref py py-data docutils literal notranslate"><span class="pre">instance</span></code></a>, this defines the string that is appended to
different configuration files/paths that have to be instance
specific but cannot be some sort of directory. Normally this is
<em>-INSTANCE</em> (unless INSTANCE is empty).</p>
</dd></dl>

<dl class="function">
<dt id="ttbl.config.target_add">
<code class="descclassname">ttbl.config.</code><code class="descname">target_add</code><span class="sig-paren">(</span><em>target</em>, <em>_id=None</em>, <em>tags=None</em>, <em>target_type=None</em>, <em>acquirer=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.config.target_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a target to the list of managed targets</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target to add</li>
<li><strong>tags</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – Dictionary of tags that apply to the target (all
tags are strings)</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target, by default taken from the target
object</li>
<li><strong>target_type</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – string describing type of the target; by
default it’s taken from the object’s type.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ttbl.config.interconnect_add">
<code class="descclassname">ttbl.config.</code><code class="descname">interconnect_add</code><span class="sig-paren">(</span><em>ic</em>, <em>_id=None</em>, <em>tags=None</em>, <em>ic_type=None</em>, <em>acquirer=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.config.interconnect_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a target interconnect</p>
<p>An interconnect is just another target that offers interconnection
services to other targets.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ic</strong> (<a class="reference internal" href="#ttbl.interconnect_c" title="ttbl.interconnect_c"><em>ttbl.interconnect_c</em></a>) – interconnect to add</li>
<li><strong>_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the interconnect, by default taken from
the object itself.</li>
<li><strong>_tags</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – Dictionary of tags that apply to the target (all
tags are strings)</li>
<li><strong>ic_type</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – string describing type of the interconnect; by
default it’s taken from the object’s type.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ttbl.config.add_authenticator">
<code class="descclassname">ttbl.config.</code><code class="descname">add_authenticator</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.config.add_authenticator" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an authentication methodology, eg:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>a</strong> (<a class="reference internal" href="#ttbl.authenticator_c" title="ttbl.authenticator_c"><em>ttbl.authenticator_c</em></a>) – authentication engine</td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">add_authentication</span><span class="p">(</span><span class="n">ttbl</span><span class="o">.</span><span class="n">ldap_auth</span><span class="o">.</span><span class="n">ldap_user_authenticator</span><span class="p">(</span><span class="s2">&quot;ldap://&quot;</span> <span class="o">...</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.target_max_idle">
<code class="descclassname">ttbl.config.</code><code class="descname">target_max_idle</code><em class="property"> = 30</em><a class="headerlink" href="#ttbl.config.target_max_idle" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum time a target is idle before it is powered off (seconds)</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.target_owned_max_idle">
<code class="descclassname">ttbl.config.</code><code class="descname">target_owned_max_idle</code><em class="property"> = 300</em><a class="headerlink" href="#ttbl.config.target_owned_max_idle" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum time an acquired target is idle before it is released (seconds)</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.cleanup_files_period">
<code class="descclassname">ttbl.config.</code><code class="descname">cleanup_files_period</code><em class="property"> = 60</em><a class="headerlink" href="#ttbl.config.cleanup_files_period" title="Permalink to this definition">¶</a></dt>
<dd><p>Time gap after which call the function to perform clean-up</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.cleanup_files_maxage">
<code class="descclassname">ttbl.config.</code><code class="descname">cleanup_files_maxage</code><em class="property"> = 86400</em><a class="headerlink" href="#ttbl.config.cleanup_files_maxage" title="Permalink to this definition">¶</a></dt>
<dd><p>Age of the file after which it will be deleted</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.tcp_port_range">
<code class="descclassname">ttbl.config.</code><code class="descname">tcp_port_range</code><em class="property"> = (1025, 65530)</em><a class="headerlink" href="#ttbl.config.tcp_port_range" title="Permalink to this definition">¶</a></dt>
<dd><p>Which TCP port range we can use</p>
<p>The server will take this into account when services that need port
allocation look for a port; this allows to open a certain range in a
firewall, for example.</p>
<p>Note you want normally this in a range that allows ports that fit
in some preallocated range (eg: VNC requires &gt;= 5900).</p>
</dd></dl>

</div>
<div class="section" id="module-ttbl">
<span id="ttbd-internals"></span><h2>8.8. <em>ttbd</em> internals<a class="headerlink" href="#module-ttbl" title="Permalink to this headline">¶</a></h2>
<p>Internal API for <em>ttbd</em></p>
<p>Note interfaces are added with <a class="reference internal" href="#ttbl.test_target.interface_add" title="ttbl.test_target.interface_add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_target.interface_add()</span></code></a>, not
by subclassing. See as examples <a class="reference internal" href="#ttbl.console.interface" title="ttbl.console.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.console.interface</span></code></a> or
<a class="reference internal" href="#ttbl.power.interface" title="ttbl.power.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.interface</span></code></a>.</p>
<dl class="exception">
<dt id="ttbl.test_target_e">
<em class="property">exception </em><code class="descclassname">ttbl.</code><code class="descname">test_target_e</code><a class="headerlink" href="#ttbl.test_target_e" title="Permalink to this definition">¶</a></dt>
<dd><p>A base for all operations regarding test targets.</p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.test_target_busy_e">
<em class="property">exception </em><code class="descclassname">ttbl.</code><code class="descname">test_target_busy_e</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_busy_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.test_target_not_acquired_e">
<em class="property">exception </em><code class="descclassname">ttbl.</code><code class="descname">test_target_not_acquired_e</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_not_acquired_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.test_target_release_denied_e">
<em class="property">exception </em><code class="descclassname">ttbl.</code><code class="descname">test_target_release_denied_e</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_release_denied_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.test_target_not_admin_e">
<em class="property">exception </em><code class="descclassname">ttbl.</code><code class="descname">test_target_not_admin_e</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_not_admin_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="ttbl.test_target_logadapter_c">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">test_target_logadapter_c</code><span class="sig-paren">(</span><em>logger</em>, <em>extra</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_logadapter_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Prefix to test target logging the name of the target and if
acquired, the current owner.</p>
<p>This is useful to correlate logs in server in client when
diagnosing issues.</p>
<p>Initialize the adapter with a logger and a dict-like object which
provides contextual information. This constructor signature allows
easy stacking of LoggerAdapters, if so desired.</p>
<p>You can effectively pass keyword arguments as shown in the
following example:</p>
<p>adapter = LoggerAdapter(someLogger, dict(p1=v1, p2=”v2”))</p>
<dl class="method">
<dt id="ttbl.test_target_logadapter_c.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>msg</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_logadapter_c.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the logging message and keyword arguments passed in to
a logging call to insert contextual information. You can either
manipulate the message itself, the keyword args or both. Return
the message and kwargs modified (or not) to suit your needs.</p>
<p>Normally, you’ll only need to override this one method in a
LoggerAdapter subclass for your specific needs.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ttbl.who_daemon">
<code class="descclassname">ttbl.</code><code class="descname">who_daemon</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.who_daemon" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the internal user for daemon operations</p>
</dd></dl>

<dl class="function">
<dt id="ttbl.who_split">
<code class="descclassname">ttbl.</code><code class="descname">who_split</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.who_split" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a tuple with target owner specification split in two parts, the
userid and the ticket. The ticket will be None if the orders
specification doesn’t contain it.</p>
</dd></dl>

<dl class="function">
<dt id="ttbl.who_create">
<code class="descclassname">ttbl.</code><code class="descname">who_create</code><span class="sig-paren">(</span><em>user_id</em>, <em>ticket=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.who_create" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a TTBD user descriptor from a user id name and a ticket</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params str user_id:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">user’s name / ID</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Params str ticket:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body">(optional) ticket for the reservation</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(str) user id descriptor</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="ttbl.acquirer_c">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">acquirer_c</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.acquirer_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Interface to resource acquisition managers/schedulers</p>
<p>A subclass of this is instantiated to manage the access to
resources that can be contended; when using the TCF remoting
mechanism that deals with targets connected to the current host,
for example, this is <a class="reference internal" href="#ttbl.symlink_acquirer_c" title="ttbl.symlink_acquirer_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.symlink_acquirer_c</span></code></a>.</p>
<p>This can however, use any other resource manager.</p>
<p>The operations in here can raise any exception, but mostly the
ones derived from <a class="reference internal" href="#ttbl.acquirer_c.exception" title="ttbl.acquirer_c.exception"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.acquirer_c.exception</span></code></a>:</p>
<ul class="simple">
<li><a class="reference internal" href="#ttbl.acquirer_c.timeout_e" title="ttbl.acquirer_c.timeout_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.acquirer_c.timeout_e</span></code></a></li>
<li><a class="reference internal" href="#ttbl.acquirer_c.busy_e" title="ttbl.acquirer_c.busy_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.acquirer_c.busy_e</span></code></a></li>
<li><a class="reference internal" href="#ttbl.acquirer_c.no_rights_e" title="ttbl.acquirer_c.no_rights_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.acquirer_c.no_rights_e</span></code></a></li>
<li><a class="reference internal" href="#ttbl.acquirer_c.cant_release_not_owner_e" title="ttbl.acquirer_c.cant_release_not_owner_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.acquirer_c.cant_release_not_owner_e</span></code></a></li>
<li><a class="reference internal" href="#ttbl.acquirer_c.cant_release_not_acquired_e" title="ttbl.acquirer_c.cant_release_not_acquired_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.acquirer_c.cant_release_not_acquired_e</span></code></a></li>
</ul>
<dl class="exception">
<dt id="ttbl.acquirer_c.exception">
<em class="property">exception </em><code class="descname">exception</code><a class="headerlink" href="#ttbl.acquirer_c.exception" title="Permalink to this definition">¶</a></dt>
<dd><p>General exception for acquisition system errors</p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.acquirer_c.timeout_e">
<em class="property">exception </em><code class="descname">timeout_e</code><a class="headerlink" href="#ttbl.acquirer_c.timeout_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Timeout acquiring</p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.acquirer_c.busy_e">
<em class="property">exception </em><code class="descname">busy_e</code><a class="headerlink" href="#ttbl.acquirer_c.busy_e" title="Permalink to this definition">¶</a></dt>
<dd><p>The resource is busy, can’t acquire</p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.acquirer_c.no_rights_e">
<em class="property">exception </em><code class="descname">no_rights_e</code><a class="headerlink" href="#ttbl.acquirer_c.no_rights_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Not enought rights to perform the operation</p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.acquirer_c.cant_release_not_owner_e">
<em class="property">exception </em><code class="descname">cant_release_not_owner_e</code><a class="headerlink" href="#ttbl.acquirer_c.cant_release_not_owner_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Cannot release since the resource is acquired by someone else</p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.acquirer_c.cant_release_not_acquired_e">
<em class="property">exception </em><code class="descname">cant_release_not_acquired_e</code><a class="headerlink" href="#ttbl.acquirer_c.cant_release_not_acquired_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Cannot release since the resource is not acquired</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.acquirer_c.acquire">
<code class="descname">acquire</code><span class="sig-paren">(</span><em>who</em>, <em>force</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.acquirer_c.acquire" title="Permalink to this definition">¶</a></dt>
<dd><p>Acquire the resource for the given user</p>
<p>The implementation is allowed to spin for a little while to
get it done, but in general this shall be a non-blocking
operation, return busy if not available.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – user name</li>
<li><strong>force</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – force the acquisition (overriding current
user); this assumes the user <em>who</em> has permissions to do so;
if not, raise an exception child of
<a class="reference internal" href="#ttbl.acquirer_c.exception" title="ttbl.acquirer_c.exception"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.acquirer_c.exception</span></code></a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><a class="reference internal" href="#ttbl.acquirer_c.busy_e" title="ttbl.acquirer_c.busy_e"><strong>busy_e</strong></a> – if the target is busy and could not be acquired</li>
<li><a class="reference internal" href="#ttbl.acquirer_c.timeout_e" title="ttbl.acquirer_c.timeout_e"><strong>acquirer_c.timeout_e</strong></a> – some sort of timeout happened</li>
<li><a class="reference internal" href="#ttbl.acquirer_c.no_rights_e" title="ttbl.acquirer_c.no_rights_e"><strong>no_rights_e</strong></a> – not enough privileges for the operation</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.acquirer_c.release">
<code class="descname">release</code><span class="sig-paren">(</span><em>who</em>, <em>force</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.acquirer_c.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release the resource from the given user</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – user name</li>
<li><strong>force</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – force the release (overriding current
user); this assumes the user <em>who</em> has permissions to do so;
if not, raise an exception child of
<a class="reference internal" href="#ttbl.acquirer_c.exception" title="ttbl.acquirer_c.exception"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.acquirer_c.exception</span></code></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.acquirer_c.get">
<code class="descname">get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.acquirer_c.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current resource owner</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.symlink_acquirer_c">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">symlink_acquirer_c</code><span class="sig-paren">(</span><em>target</em>, <em>wait_period=0.5</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.symlink_acquirer_c" title="Permalink to this definition">¶</a></dt>
<dd><p>The lamest file-system based mutex ever</p>
<p>This is a rentrant mutex implemented using symlinks (an atomic
operation under POSIX).</p>
<p>To create it, declare the location where it will be and a string
the <em>owner</em>. Then you can acquire() or release() it. If it is
already acquired, it can spin busy wait on it (if given a timeout)
or just fail. You can only release if you own it.</p>
<p>Why like this? We’ll have multiple processes doing this on behalf
of remote clients (so it makes no sense to track owner by PID. The
caller decides who gets to override and all APIs agree to use it
(as it is advisory).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The reentrancy of the lock assumes that the owner
will use a single thread of execution to operate under it.</p>
<p>Thus, the following scenario would fail and cause a race
condition:</p>
<blockquote>
<div><ul class="simple">
<li>Thread A: acquires as owner-A</li>
<li>Thread B: starts to acquire as owner-A</li>
<li>Thread A: releases as owner-A (now released)</li>
<li>Thread B: verifies it was acquired by owner-A so passes as
acquired</li>
<li>Thread B: MISTAKENLY assumes it owns the mutex when it is
released in reality</li>
</ul>
</div></blockquote>
<p class="last">So use a different owner for each thread of execution.</p>
</div>
<dl class="method">
<dt id="ttbl.symlink_acquirer_c.acquire">
<code class="descname">acquire</code><span class="sig-paren">(</span><em>who</em>, <em>force</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.symlink_acquirer_c.acquire" title="Permalink to this definition">¶</a></dt>
<dd><p>Acquire the mutex, blocking until acquired</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.symlink_acquirer_c.release">
<code class="descname">release</code><span class="sig-paren">(</span><em>who</em>, <em>force</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.symlink_acquirer_c.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release the resource from the given user</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – user name</li>
<li><strong>force</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – force the release (overriding current
user); this assumes the user <em>who</em> has permissions to do so;
if not, raise an exception child of
<a class="reference internal" href="#ttbl.acquirer_c.exception" title="ttbl.acquirer_c.exception"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.acquirer_c.exception</span></code></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.symlink_acquirer_c.get">
<code class="descname">get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.symlink_acquirer_c.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current resource owner</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt_interface_impl_c">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">tt_interface_impl_c</code><span class="sig-paren">(</span><em>name=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_interface_impl_c" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="ttbl.tt_interface_impl_c.upid">
<code class="descname">upid</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.tt_interface_impl_c.upid" title="Permalink to this definition">¶</a></dt>
<dd><p>Unique Physical IDentification</p>
<p>flat dictionary of keys to report HW information for
inventory purposes of whichever HW component is used to
implement this driver.</p>
<p>Normally set from the driver with a call to
<a class="reference internal" href="#ttbl.tt_interface_impl_c.upid_set" title="ttbl.tt_interface_impl_c.upid_set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">upid_set()</span></code></a>; howevr, after instantiation, more fields
can be added to a driver with information that can be
useful to locate a piece of HW. Eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">console_pc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">generic_c</span><span class="p">(</span><span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">interchunk_wait</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">console_pc</span><span class="o">.</span><span class="n">upid_set</span><span class="p">(</span><span class="s2">&quot;RS-232C over USB&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;RS33433E&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;USB port #4 front&quot;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_interface_impl_c.upid_set">
<code class="descname">upid_set</code><span class="sig-paren">(</span><em>name</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_interface_impl_c.upid_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set <a class="reference internal" href="#ttbl.tt_interface_impl_c.upid" title="ttbl.tt_interface_impl_c.upid"><code class="xref py py-data docutils literal notranslate"><span class="pre">upid</span></code></a> information in a single shot</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Name of the physical component that
implements this interface functionality</li>
<li><strong>kwargs</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – fields and values (strings) to report for
the physical component that implements this interface’s
functionality; it is important to specify here a unique
piece of information that will allow this component to be
reported separately in the instrumentation section of the
inventory. Eg: serial numbers or paths to unique devices.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">impl_object</span><span class="o">.</span><span class="n">upid_set</span><span class="p">(</span><span class="s2">&quot;ACME power controller&quot;</span><span class="p">,</span> <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;XJ323232&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is normally called from the <em>__init__()</em> function of a
component driver, that must inherit <a class="reference internal" href="#ttbl.tt_interface_impl_c" title="ttbl.tt_interface_impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">tt_interface_impl_c</span></code></a>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt_interface">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">tt_interface</code><a class="headerlink" href="#ttbl.tt_interface" title="Permalink to this definition">¶</a></dt>
<dd><p>A target specific interface</p>
<p>This class can be subclassed and then instanced to create a target
specific interface for implementing any kind of functionality. For
example, the <a class="reference internal" href="#ttbl.console.interface" title="ttbl.console.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">console</span></code></a>, in a
configuration file when the target is added:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">test_target</span><span class="p">(</span><span class="s2">&quot;TARGETNAME&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;console&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">serial0</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">serial_pc</span><span class="p">(</span><span class="s2">&quot;/dev/ttyS0&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">serial1</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">serial_pc</span><span class="p">(</span><span class="s2">&quot;/dev/ttyS1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;serial0&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>creates an instance of the <em>console</em> interface with access to two
console. The interface is then available over HTTP
<code class="docutils literal notranslate"><span class="pre">https://SERVER/ttb-vN/target/TARGETNAME/console/*</span></code></p>
<p>A common pattern for interfaces is to be composed of multiple
components, with a different implementation driver for each. For
that, a class named <em>impl_c</em> is created to define the base
interface that all the implementation drivers need to support.</p>
<p>To create methods that are served over the
<code class="docutils literal notranslate"><span class="pre">https://SERVER/ttb-vN/target/TARGETNAME/INTERFACENAME/*</span></code> url,
create methods in the subclass called <em>METHOD_NAME</em> with the
signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">METHOD_NAME</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">who</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">user_path</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">impl</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_impl_get</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">&quot;component&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">arg1</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;arg1&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">arg2</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;arg2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><em>METHOD</em> is <em>put</em>, <em>get</em>, <em>post</em> or <em>delete</em> (HTTP methods)</li>
<li><em>NAME</em> is the method name (eg: <em>set_state</em>)</li>
<li><em>target</em> is the target object this call is happening onto</li>
<li><em>who</em> is the (logged in) user making this call</li>
<li><em>args</em> is a dictionary of arguments passed by the client for the
HTTP call keyed by name (a string)</li>
<li><em>user_path</em> is a string describing the space in the filesystem
where files for this user are stored</li>
</ul>
<p>Return values:</p>
<blockquote>
<div><ul>
<li><p class="first">these methods can throw an exception on error (and an error code will
be sent to the client)</p>
</li>
<li><p class="first">a dictionary of keys and values to return to the client as JSON
(so JSON encodeable).</p>
<p>To stream a file as output, any other keys are ignored and the
following keys are interpreted, with special meaning</p>
<ul class="simple">
<li><em>stream_file</em>: (string) the named file will be streamed to the client</li>
<li><em>stream_offset</em>: (positive integer) the file <em>steam_file</em>
<a href="#id1"><span class="problematic" id="id2">*</span></a>will be streamed starting at the given offset.</li>
<li><em>stream-generation</em>: (positive monotonically increasing
integer) a number that describes the current iteration of
this file that might be reset [and thus bringing its apparent
size to the client to zero] upon certain operations (for
example, for serial console captures, when the target power
cycles, this number goes up and the capture size starts at
zero).</li>
</ul>
<p>An X-stream-gen-offset header will be returned to the client
with the string <em>GENERATION OFFSET</em>, where the current
generation of the stream as provided and the offset that was
used, possibly capped to the actual maximum offset are
returned.</p>
<p>This way the client can use OFFSET+Conten-Length to tell the
next offset to query.</p>
</li>
</ul>
</div></blockquote>
<p>When multiple components are used to implement the functionality
of an interface or to expose multiple instruments that
implement the functionality (such as in
<a class="reference internal" href="#ttbl.power.interface" title="ttbl.power.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.interface</span></code></a> or <a class="reference internal" href="#ttbl.console.interface" title="ttbl.console.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.console.interface</span></code></a>),
use methods:</p>
<ul class="simple">
<li><a class="reference internal" href="#ttbl.tt_interface.impls_set" title="ttbl.tt_interface.impls_set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">impls_set()</span></code></a></li>
</ul>
<p>See as an example the <a class="reference internal" href="#ttbl.debug.interface" title="ttbl.debug.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">debug</span></code></a> class.</p>
<dl class="attribute">
<dt id="ttbl.tt_interface.impls">
<code class="descname">impls</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.tt_interface.impls" title="Permalink to this definition">¶</a></dt>
<dd><p>List of components that implement this interface</p>
<p>(for interfaces that support multiple components only)</p>
<p>This has to be an ordered dict because the user might care about
order (eg: power rails need to be executed in the given order)</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.tt_interface.aliases">
<code class="descname">aliases</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.tt_interface.aliases" title="Permalink to this definition">¶</a></dt>
<dd><p>Map of names in <a class="reference internal" href="#ttbl.tt_interface.impls" title="ttbl.tt_interface.impls"><code class="xref py py-data docutils literal notranslate"><span class="pre">impls</span></code></a> that are actually an alias
and which entry they are aliasing.</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.tt_interface.cls">
<code class="descname">cls</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.tt_interface.cls" title="Permalink to this definition">¶</a></dt>
<dd><p>class the implementations to for this interface are based
on [set by the initial call to <a class="reference internal" href="#ttbl.tt_interface.impls_set" title="ttbl.tt_interface.impls_set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">impls_set()</span></code></a>]</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_interface.impl_add">
<code class="descname">impl_add</code><span class="sig-paren">(</span><em>name</em>, <em>impl</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_interface.impl_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Append a new implementation to the list of implementations
this interface supports.</p>
<p>This can be used after an interface has been declared, such
as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">test_target</span><span class="p">(</span><span class="s1">&#39;somename&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="o">*</span><span class="n">power_rail</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">impl_add</span><span class="p">(</span><span class="s1">&#39;newcomponent&#39;</span><span class="p">,</span> <span class="n">impl_object</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – implementation’s name</li>
<li><strong>impl</strong> – object that defines the implementation; this must
be an instance of the class <a class="reference internal" href="#ttbl.tt_interface.cls" title="ttbl.tt_interface.cls"><code class="xref py py-data docutils literal notranslate"><span class="pre">cls</span></code></a> (this gets set by the
first call to <a class="reference internal" href="#ttbl.tt_interface.impls_set" title="ttbl.tt_interface.impls_set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">impls_set()</span></code></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_interface.impls_set">
<code class="descname">impls_set</code><span class="sig-paren">(</span><em>impls</em>, <em>kwimpls</em>, <em>cls</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_interface.impls_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Record in <em>self.impls</em> a given set of implementations (or components)</p>
<p>This is only used for interfaces that support multiple components.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>impls</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – list of objects of type <em>cls</em> or of tuples
<em>(NAME, IMPL)</em> to serve as implementations for the
interface; when non named, they will be called <em>componentN</em></li>
<li><strong>impls</strong> – dictionary keyed by name of objects of type
<em>cls</em> to serve as implementatons for the interface.</li>
<li><strong>cls</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#type" title="(in Python v2.7)"><em>type</em></a>) – base class for the implementations (eg:
<a class="reference internal" href="#ttbl.console.impl_c" title="ttbl.console.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.console.impl_c</span></code></a>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This is meant to be used straight in the constructor of a
derivative of <a class="reference internal" href="#ttbl.tt_interface" title="ttbl.tt_interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.tt_interface</span></code></a> such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">my_base_impl_c</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">my_interface</span><span class="p">(</span><span class="n">ttbl</span><span class="o">.</span><span class="n">tt_interface</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">impls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwimpls</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ttbl</span><span class="o">.</span><span class="n">tt_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">impls_set</span><span class="p">(</span><span class="n">impls</span><span class="p">,</span> <span class="n">kwimplws</span><span class="p">,</span> <span class="n">my_base_implc_c</span><span class="p">)</span>
</pre></div>
</div>
<p>and it allows to specify the interface implementations in
multiple ways:</p>
<ul>
<li><p class="first">a sorted list of implementations (which will be given generic
component names such as <em>component0</em>, <em>component1</em>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;my&quot;</span><span class="p">,</span> <span class="n">my_interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">an_impl</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">another_impl</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>COMPONENTNAME = IMPLEMENTATION</em> (python initializers),
which allows to name the components (and keep the order
in Python 3 only):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;my&quot;</span><span class="p">,</span> <span class="n">my_interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">something</span> <span class="o">=</span> <span class="n">an_impl</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">someotherthing</span> <span class="o">=</span> <span class="n">another_impl</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first">a list of tuples <em>( COMPONENTNAME, IMPLEMENTATION )</em>, which
allow to name the implementations keeping the order (in Python 2):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;my&quot;</span><span class="p">,</span> <span class="n">my_interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span> <span class="n">something</span><span class="p">,</span> <span class="n">an_impl</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span> <span class="n">someotherthing</span><span class="p">,</span> <span class="n">another_impl</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">))</span>
</pre></div>
</div>
</li>
</ul>
<p>all forms can be combined; as well, if the implementation is
the name of an existing component, then it becomes an alias.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_interface.impl_get_by_name">
<code class="descname">impl_get_by_name</code><span class="sig-paren">(</span><em>arg</em>, <em>arg_name='component'</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_interface.impl_get_by_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an interface’s component implementation by name</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_interface.arg_impl_get">
<code class="descname">arg_impl_get</code><span class="sig-paren">(</span><em>args</em>, <em>arg_name</em>, <em>allow_missing=False</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_interface.arg_impl_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an interface’s component implementation by name</p>
<p>Given the arguments passed with an HTTP request
check if one called ARG_NAME is present, we want to get
args[ARG_NAME] and self.impl[ARG_NAME].</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the implementation in <em>self.impls</em> for the component
specified in the args</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_interface.args_impls_get">
<code class="descname">args_impls_get</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_interface.args_impls_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of components by name or all if none given</p>
<p>If no <em>component</em> argument is given, return the whole list of
component implementations, otherwise only the selected one.</p>
<p>(internal interface)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params dict args:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">dictionary of arguments keyed by argument
name</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a list of <em>(NAME, IMPL)</em> based on if we got an
instance to run on (only execute that one) or on all the
components</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="ttbl.tt_interface.assert_return_type">
<em class="property">static </em><code class="descname">assert_return_type</code><span class="sig-paren">(</span><em>val</em>, <em>expected_type</em>, <em>target</em>, <em>component</em>, <em>call</em>, <em>none_ok=False</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_interface.assert_return_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Assert a value generated from a target interface call driver
is of the right type and complain otherwise</p>
</dd></dl>

<dl class="staticmethod">
<dt id="ttbl.tt_interface.instrument_mkindex">
<em class="property">static </em><code class="descname">instrument_mkindex</code><span class="sig-paren">(</span><em>name</em>, <em>upid</em>, <em>kws</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_interface.instrument_mkindex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_interface.instrumentation_publish_component">
<code class="descname">instrumentation_publish_component</code><span class="sig-paren">(</span><em>target</em>, <em>iface_name</em>, <em>index</em>, <em>instrument_name</em>, <em>upid</em>, <em>components=None</em>, <em>kws=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_interface.instrumentation_publish_component" title="Permalink to this definition">¶</a></dt>
<dd><p>Publish in the target’s inventory information about the
instrumentations that implements the functionalities of the
components of this interface</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_interface.instrumentation_publish">
<code class="descname">instrumentation_publish</code><span class="sig-paren">(</span><em>target</em>, <em>iface_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_interface.instrumentation_publish" title="Permalink to this definition">¶</a></dt>
<dd><p>Publish in the target’s inventory information about the
instrumentations that implements the functionalities of the
components of this interface</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_interface.request_process">
<code class="descname">request_process</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>method</em>, <em>call</em>, <em>args</em>, <em>files</em>, <em>user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_interface.request_process" title="Permalink to this definition">¶</a></dt>
<dd><p>Process a request into this interface from a proxy / brokerage</p>
<p>When the ttbd daemon is exporting access to a target via any
interface (e.g: REST over Flask or D-Bus or whatever), this
implements a brige to pipe those requests in to this
interface.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>test_target</em></a>) – target upon which we are operating</li>
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – user who is making the request</li>
<li><strong>method</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – ‘POST’, ‘GET’, ‘DELETE’ or ‘PUT’ (mapping
to HTTP requests)</li>
<li><strong>call</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – interface’s operation to perform (it’d map to
the different methods the interface exposes)</li>
<li><strong>args</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of key/value with the arguments
to the call, some might be JSON encoded.</li>
<li><strong>files</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of key/value with the files
uploaded via forms</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>(<a class="reference external" href="https://flask.palletsprojects.com/en/1.1.x/api/#flask.Request.form">https://flask.palletsprojects.com/en/1.1.x/api/#flask.Request.form</a>)
:param str user_path: Path to where user files are located</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dictionary of results, call specific
e.g.:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;SOMETHING&quot;</span><span class="p">,</span>  <span class="c1"># convention for unified result</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;something&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">value</span> <span class="o">=</span> <span class="mi">43</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>For an example, see <a class="reference internal" href="#ttbl.buttons.interface" title="ttbl.buttons.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.buttons.interface</span></code></a>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.test_target">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">test_target</code><span class="sig-paren">(</span><em>_test_target__id</em>, <em>_tags=None</em>, <em>_type=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="ttbl.test_target.state_path">
<code class="descname">state_path</code><em class="property"> = '/var/run/ttbd'</em><a class="headerlink" href="#ttbl.test_target.state_path" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.files_path">
<code class="descname">files_path</code><em class="property"> = '__undefined__'</em><a class="headerlink" href="#ttbl.test_target.files_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Path where files are stored</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.properties_user">
<code class="descname">properties_user</code><em class="property"> = set(['pos_mode', 'tcpdump', 'pos_repartition', 'pos_reinitialize', &lt;_sre.SRE_Pattern object&gt;])</em><a class="headerlink" href="#ttbl.test_target.properties_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Properties that normal users (non-admins) can set when owning a
target and that will be reset when releasing a target (except
if listed in <a class="reference internal" href="#ttbl.test_target.properties_keep_on_release" title="ttbl.test_target.properties_keep_on_release"><code class="xref py py-data docutils literal notranslate"><span class="pre">properties_keep_on_release</span></code></a>)</p>
<p>Note this is a global variable that can be speciazed to each
class/target.</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.properties_keep_on_release">
<code class="descname">properties_keep_on_release</code><em class="property"> = set(['linux_options_append', &lt;_sre.SRE_Pattern object&gt;])</em><a class="headerlink" href="#ttbl.test_target.properties_keep_on_release" title="Permalink to this definition">¶</a></dt>
<dd><p>A test target base class</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.id">
<code class="descname">id</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.id" title="Permalink to this definition">¶</a></dt>
<dd><p>Target name/identifier</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.tags">
<code class="descname">tags</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.tags" title="Permalink to this definition">¶</a></dt>
<dd><p>Target’s tags</p>
<p>FIXME document more</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.thing_to">
<code class="descname">thing_to</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.thing_to" title="Permalink to this definition">¶</a></dt>
<dd><p>List of targets this target is a thing to; see
class:<cite>ttbl.things.interface</cite></p>
<p>FIXME: this needs to be moved to that interface</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.fsdb">
<code class="descname">fsdb</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.fsdb" title="Permalink to this definition">¶</a></dt>
<dd><p>filesystem database of target state; the multiple daemon
processes use this to store information that reflect’s the
target’s state.</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.kws">
<code class="descname">kws</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.kws" title="Permalink to this definition">¶</a></dt>
<dd><p>Keywords that can be used to substitute values in commands,
messages. Target’s tags are translated to keywords
here. <a class="reference internal" href="#ttbl.config.target_add" title="ttbl.config.target_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">ttbl.config.target_add()</span></code></a> will update this with
the final list of tags.</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.release_hooks">
<code class="descname">release_hooks</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.release_hooks" title="Permalink to this definition">¶</a></dt>
<dd><p>Functions to call when the target is released (things like
removing tunnels the user created, resetting debug state,
etc); this is meant to leave the target’s state pristine
so that it does not affect the next user that acquires it.
Each interface will add as needed, so it gets executed upon
<a class="reference internal" href="#ttbl.test_target.release" title="ttbl.test_target.release"><code class="xref py py-meth docutils literal notranslate"><span class="pre">release()</span></code></a>, under the owned lock.</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.interface_origin">
<code class="descname">interface_origin</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.interface_origin" title="Permalink to this definition">¶</a></dt>
<dd><p>Keep places where interfaces were registered from</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.power_on_pre_fns">
<code class="descname">power_on_pre_fns</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.power_on_pre_fns" title="Permalink to this definition">¶</a></dt>
<dd><p>Pre/post power on/off hooks</p>
<p>For historical reasons, these lists are here instead of on
the new power interface extension–at some point they will
be moved</p>
<p>FIXME: move to target.power.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.to_dict">
<code class="descname">to_dict</code><span class="sig-paren">(</span><em>projections=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.to_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all of the target’s data as a dictionary</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>projections</strong> (<em>list</em>) – <p>(optional) list of fields to include
(default: all).</p>
<p>Field names can use periods to dig into dictionaries.</p>
<p>Field names can match <code class="xref py py-mod docutils literal notranslate"><span class="pre">python.fnmatch</span></code> regular
expressions.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.type">
<code class="descname">type</code><a class="headerlink" href="#ttbl.test_target.type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.acquirer">
<code class="descname">acquirer</code><a class="headerlink" href="#ttbl.test_target.acquirer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.test_target.get_id">
<code class="descname">get_id</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.get_id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.test_target.add_to_interconnect">
<code class="descname">add_to_interconnect</code><span class="sig-paren">(</span><em>ic_id</em>, <em>ic_tags=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.add_to_interconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a target to an interconnect</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ic_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>name of the interconnect; might be present in
this server or another one.</p>
<p>If named <code class="docutils literal notranslate"><span class="pre">IC_ID#INSTANCE</span></code>, this is understood as this
target has multiple connections to the same interconnect
(via multiple physical or virtual network interfaces).</p>
<p>No instance name (no <code class="docutils literal notranslate"><span class="pre">#INSTANCE</span></code>) means the default,
primary connection.</p>
<p>Thus, a target that can instantiate multiple virtual
machines, for example, might want to declare them here if we
need to pre-determine and pre-assign those IP addresses.</p>
</li>
<li><strong>ic_tags</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – (optional) dictionary of tags describing the
tags for this target on this interconnect.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.tags_update">
<code class="descname">tags_update</code><span class="sig-paren">(</span><em>d=None</em>, <em>ic=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.tags_update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the tags assigned to a target</p>
<p>This will ensure the tags described in <em>d</em> are given to the
target and all the values associated to them updated (such as
interconnect descriptions, addresses, etc).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>d</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of tags</li>
<li><strong>ic</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – (optional) the dict d has to be used to only
update the data of the given interconnect</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>It can be used to add tags to a target after it is added to
the configuration, such as with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arduino101_add</span><span class="p">(</span><span class="s2">&quot;a101-03&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tclf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s2">&quot;a101-03&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tags_update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">val</span> <span class="o">=</span> <span class="mi">34</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.timestamp_get">
<code class="descname">timestamp_get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.timestamp_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.test_target.timestamp">
<code class="descname">timestamp</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.timestamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the timestamp on the target to record last activity tme</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.owner_get">
<code class="descname">owner_get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.owner_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return who the current owner of this target is</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">object describing the owner</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.acquire">
<code class="descname">acquire</code><span class="sig-paren">(</span><em>who</em>, <em>force</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.acquire" title="Permalink to this definition">¶</a></dt>
<dd><p>Assign the test target to user <em>who</em> unless it is already
taken by someone else.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User that is claiming the target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><a class="reference internal" href="#ttbl.test_target_busy_e" title="ttbl.test_target_busy_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">test_target_busy_e</span></code></a> if already taken</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.enable">
<code class="descname">enable</code><span class="sig-paren">(</span><em>who=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable the target (so it will be regularly used)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Deprecated</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.disable">
<code class="descname">disable</code><span class="sig-paren">(</span><em>who=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable the target (so it will not be regularly used)</p>
<p>It still can be used, but it will be filtered out by the
client regular listings.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Deprecated</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.property_set">
<code class="descname">property_set</code><span class="sig-paren">(</span><em>prop</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.property_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a target’s property</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>prop</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Property name</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Value for the property (None for deleting)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Due to the hierarchical aspect of the key property namespace,
if a property <em>a.b</em> is set, any property called <em>a.b.NAME</em>
will be cleared out.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.property_set_locked">
<code class="descname">property_set_locked</code><span class="sig-paren">(</span><em>who</em>, <em>prop</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.property_set_locked" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a target’s property (must be locked by the user)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User that is claiming the target</li>
<li><strong>prop</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Property name</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Value for the property (None for deleting)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.property_get">
<code class="descname">property_get</code><span class="sig-paren">(</span><em>prop</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.property_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a target’s property</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User that is claiming the target</li>
<li><strong>prop</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Property name</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.property_get_locked">
<code class="descname">property_get_locked</code><span class="sig-paren">(</span><em>who</em>, <em>prop</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.property_get_locked" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a target’s property</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User that is claiming the target</li>
<li><strong>prop</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Property name</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.property_is_user">
<code class="descname">property_is_user</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.property_is_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <em>True</em> if a property is considered a user property (no
admin rights are needed to set it or read it).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">bool</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.property_keep_value">
<code class="descname">property_keep_value</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.property_keep_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <em>True</em> if a user property’s value needs to be kept.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.release">
<code class="descname">release</code><span class="sig-paren">(</span><em>who</em>, <em>force</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release the ownership of this target.</p>
<p>If the target is not owned by anyone, it does nothing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User that is releasing the target (must be the owner)</li>
<li><strong>force</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – force release of a target owned by
someone else (requires admin privilege)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#ttbl.test_target_not_acquired_e" title="ttbl.test_target_not_acquired_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">test_target_not_acquired_e</span></code></a> if not taken</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.target_owned_and_locked">
<code class="descname">target_owned_and_locked</code><span class="sig-paren">(</span><em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.target_owned_and_locked" title="Permalink to this definition">¶</a></dt>
<dd><p>Ensure the target is locked and owned for an operation that
requires exclusivity</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>who</strong> – User that is calling the operation</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><a class="reference internal" href="#ttbl.test_target_not_acquired_e" title="ttbl.test_target_not_acquired_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">test_target_not_acquired_e</span></code></a> if the target is
not acquired by anyone, <a class="reference internal" href="#ttbl.test_target_busy_e" title="ttbl.test_target_busy_e"><code class="xref py py-class docutils literal notranslate"><span class="pre">test_target_busy_e</span></code></a> if the
target is owned by someone else.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.target_is_owned_and_locked">
<code class="descname">target_is_owned_and_locked</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.target_is_owned_and_locked" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns if a target is locked and owned for an operation that
requires exclusivity</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>who</strong> – User that is calling the operation</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if &#64;who owns the target or is admin, False
otherwise or if the target is not owned</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.interface_add">
<code class="descname">interface_add</code><span class="sig-paren">(</span><em>name</em>, <em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.interface_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds object as an interface to the target accessible as <code class="docutils literal notranslate"><span class="pre">self.name</span></code></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – interface name, must be not existing already
and a valid Python identifier as we’ll be calling functions
as <code class="docutils literal notranslate"><span class="pre">target.name.function()</span></code></li>
<li><strong>obj</strong> (<a class="reference internal" href="#ttbl.tt_interface" title="ttbl.tt_interface"><em>tt_interface</em></a>) – interface implementation, an instance
of <a class="reference internal" href="#ttbl.tt_interface" title="ttbl.tt_interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">tt_interface</span></code></a> which provides the details and
methods to call plus
<a class="reference internal" href="#ttbl.tt_interface.request_process" title="ttbl.tt_interface.request_process"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ttbl.tt_interface.request_process()</span></code></a> to handle calls
from proxy/brokerage layers.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.interconnect_c">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">interconnect_c</code><span class="sig-paren">(</span><em>_test_target__id</em>, <em>_tags=None</em>, <em>_type=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.interconnect_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Define an interconnect as a target that provides connectivity
services to other targets.</p>
</dd></dl>

<dl class="function">
<dt id="ttbl.open_close">
<code class="descclassname">ttbl.</code><code class="descname">open_close</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.open_close" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="ttbl.authenticator_c">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">authenticator_c</code><a class="headerlink" href="#ttbl.authenticator_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class that defines the interface for an authentication system</p>
<p>Upone calling the constructor, it defines a set of roles that will
be returned by the <a class="reference internal" href="#ttbl.authenticator_c.login" title="ttbl.authenticator_c.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">login()</span></code></a> if the tokens to be authenticated
are valid</p>
<dl class="staticmethod">
<dt id="ttbl.authenticator_c.login">
<em class="property">static </em><code class="descname">login</code><span class="sig-paren">(</span><em>token</em>, <em>password</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.authenticator_c.login" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate an authentication token exists and the password is valid.</p>
<p>If it is, extract whichever information from the
authentication system is needed to determine if the user
represented by the token is allowed to use the infrastructure
and which with category (as determined by the role mapping)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None if user is not allowed to log in, otherwise a
dictionary with user’s information:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">roles</span><span class="p">:</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">strings</span> <span class="n">describing</span> <span class="n">roles</span> <span class="n">the</span> <span class="n">user</span> <span class="n">has</span>
</pre></div>
</div>
<p>FIXME: left as a dictionary so we can add more information later</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="exception">
<dt id="ttbl.authenticator_c.error_e">
<em class="property">exception </em><code class="descname">error_e</code><a class="headerlink" href="#ttbl.authenticator_c.error_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.authenticator_c.unknown_user_e">
<em class="property">exception </em><code class="descname">unknown_user_e</code><a class="headerlink" href="#ttbl.authenticator_c.unknown_user_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.authenticator_c.invalid_credentials_e">
<em class="property">exception </em><code class="descname">invalid_credentials_e</code><a class="headerlink" href="#ttbl.authenticator_c.invalid_credentials_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="ttbl.daemon_pid_add">
<code class="descclassname">ttbl.</code><code class="descname">daemon_pid_add</code><span class="sig-paren">(</span><em>pid</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.daemon_pid_add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ttbl.daemon_pid_check">
<code class="descclassname">ttbl.</code><code class="descname">daemon_pid_check</code><span class="sig-paren">(</span><em>pid</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.daemon_pid_check" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ttbl.daemon_pid_rm">
<code class="descclassname">ttbl.</code><code class="descname">daemon_pid_rm</code><span class="sig-paren">(</span><em>pid</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.daemon_pid_rm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<span class="target" id="module-ttbl.fsdb"></span><dl class="class">
<dt id="ttbl.fsdb.fsdb">
<em class="property">class </em><code class="descclassname">ttbl.fsdb.</code><code class="descname">fsdb</code><span class="sig-paren">(</span><em>location</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fsdb.fsdb" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a veeeery simple file-system based ‘DB’, atomic access</p>
<ul class="simple">
<li>Atomic access is implemented by storing values in the target of
symlinks</li>
<li>the data stored is strings</li>
<li>the amount of data stored is thus limited (to 1k in OSX, 4k in
Linux/ext3, maybe others dep on the FS).</li>
</ul>
<p>Why? Because to create a symlink, there is only a system call
needed and is atomic. Same to read it. Thus, for small values, it
is very efficient.</p>
<p>NOTE: the key space is flat (no dictionaries) but we implement it
with naming, such as:</p>
<blockquote>
<div>l[‘a.b.c’] = 3</div></blockquote>
<p>is the equivalent to:</p>
<blockquote>
<div>l[‘a’][‘b’][‘c’] = 3</div></blockquote>
<p>it also makes it way faster and easier to filter for fields.</p>
<p>Initialize the database to be saved in the give location
directory</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>location</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Directory where the database will be kept</td>
</tr>
</tbody>
</table>
<dl class="exception">
<dt id="ttbl.fsdb.fsdb.exception">
<em class="property">exception </em><code class="descname">exception</code><a class="headerlink" href="#ttbl.fsdb.fsdb.exception" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.fsdb.fsdb.keys">
<code class="descname">keys</code><span class="sig-paren">(</span><em>pattern=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fsdb.fsdb.keys" title="Permalink to this definition">¶</a></dt>
<dd><p>List the fields/keys available in the database</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>pattern</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) pattern against the key names
must match, in the style of <a class="reference external" href="https://docs.python.org/2.7/library/fnmatch.html#module-fnmatch" title="(in Python v2.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fnmatch</span></code></a>. By default, all
keys are listed.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.fsdb.fsdb.get_as_slist">
<code class="descname">get_as_slist</code><span class="sig-paren">(</span><em>*patterns</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fsdb.fsdb.get_as_slist" title="Permalink to this definition">¶</a></dt>
<dd><p>List the fields/keys available in the database</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>patterns</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – (optional) list of patterns of fields
we must list in the style of <a class="reference external" href="https://docs.python.org/2.7/library/fnmatch.html#module-fnmatch" title="(in Python v2.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fnmatch</span></code></a>. By default, all
keys are listed.</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Returns list(str, obf):</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body">list of <em>(FLATKEY, VALUE)</em> sorted by
<em>FLATKEY</em> (so <em>a.b.c</em>, representing <em>[‘a’][‘b’][‘c’]</em> goes
after <em>a.b</em>, representing <em>[‘a’][‘b’]</em>).</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.fsdb.fsdb.get_as_dict">
<code class="descname">get_as_dict</code><span class="sig-paren">(</span><em>*patterns</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fsdb.fsdb.get_as_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>List the fields/keys and values available in the database</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>pattern</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) pattern against the key names
must match, in the style of <a class="reference external" href="https://docs.python.org/2.7/library/fnmatch.html#module-fnmatch" title="(in Python v2.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fnmatch</span></code></a>. By default, all
keys are listed.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns dict:</th><td class="field-body">return the keys and values</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.fsdb.fsdb.field_valid_regex">
<code class="descname">field_valid_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#ttbl.fsdb.fsdb.field_valid_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.fsdb.fsdb.set">
<code class="descname">set</code><span class="sig-paren">(</span><em>field</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fsdb.fsdb.set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a field in the database</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>field</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the field to set</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – value to stored; None to remove that field</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.fsdb.fsdb.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>field</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fsdb.fsdb.get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<div class="section" id="module-ttbl.user_control">
<span id="user-access-control-and-authentication"></span><h3>8.8.1. User access control and authentication<a class="headerlink" href="#module-ttbl.user_control" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="ttbl.user_control.User">
<em class="property">class </em><code class="descclassname">ttbl.user_control.</code><code class="descname">User</code><span class="sig-paren">(</span><em>userid</em>, <em>fail_if_new=False</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a database of users that are allowed to use this system</p>
<p>The information on this database is obtained from authentication
systems and just stored locally for caching–it’s mainly to set
roles for users.</p>
<dl class="attribute">
<dt id="ttbl.user_control.User.file_access_lock">
<code class="descname">file_access_lock</code><em class="property"> = &lt;thread.lock object&gt;</em><a class="headerlink" href="#ttbl.user_control.User.file_access_lock" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.user_control.User.user_not_existant_e">
<em class="property">exception </em><code class="descname">user_not_existant_e</code><a class="headerlink" href="#ttbl.user_control.User.user_not_existant_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Exception raised when information about a user cannot be
located</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.user_control.User.state_dir">
<code class="descname">state_dir</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.user_control.User.state_dir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="ttbl.user_control.User.is_authenticated">
<em class="property">static </em><code class="descname">is_authenticated</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.is_authenticated" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="ttbl.user_control.User.is_active">
<em class="property">static </em><code class="descname">is_active</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.is_active" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="ttbl.user_control.User.is_anonymous">
<em class="property">static </em><code class="descname">is_anonymous</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.is_anonymous" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.User.is_admin">
<code class="descname">is_admin</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.is_admin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.User.get_id">
<code class="descname">get_id</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.get_id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.User.set_role">
<code class="descname">set_role</code><span class="sig-paren">(</span><em>role</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.set_role" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.User.has_role">
<code class="descname">has_role</code><span class="sig-paren">(</span><em>role</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.has_role" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.User.save_data">
<code class="descname">save_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.save_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="ttbl.user_control.User.load_user">
<em class="property">static </em><code class="descname">load_user</code><span class="sig-paren">(</span><em>userid</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.load_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="ttbl.user_control.User.create_filename">
<em class="property">static </em><code class="descname">create_filename</code><span class="sig-paren">(</span><em>userid</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.create_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a safe filename based on the user ID</p>
</dd></dl>

<dl class="staticmethod">
<dt id="ttbl.user_control.User.search_user">
<em class="property">static </em><code class="descname">search_user</code><span class="sig-paren">(</span><em>userid</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.search_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.user_control.local_user">
<em class="property">class </em><code class="descclassname">ttbl.user_control.</code><code class="descname">local_user</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.local_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Define a local anonymous user that we can use to skip
authentication on certain situations (when the user starts the
daemon as such, for example).</p>
<p>See <a class="reference external" href="https://flask-login.readthedocs.org/en/latest/#anonymous-users">https://flask-login.readthedocs.org/en/latest/#anonymous-users</a> for
the Flask details.</p>
<dl class="method">
<dt id="ttbl.user_control.local_user.save_data">
<code class="descname">save_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.local_user.save_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.local_user.is_authenticated">
<code class="descname">is_authenticated</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.local_user.is_authenticated" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.local_user.is_anonymous">
<code class="descname">is_anonymous</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.local_user.is_anonymous" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.local_user.is_active">
<code class="descname">is_active</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.local_user.is_active" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.local_user.is_admin">
<code class="descname">is_admin</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.local_user.is_admin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.auth_ldap"></span><dl class="class">
<dt id="ttbl.auth_ldap.authenticator_ldap_c">
<em class="property">class </em><code class="descclassname">ttbl.auth_ldap.</code><code class="descname">authenticator_ldap_c</code><span class="sig-paren">(</span><em>url</em>, <em>roles=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_ldap.authenticator_ldap_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Use LDAP to authenticate users</p>
<p>To configure, create a config file that looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ttbl.auth_ldap</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add_authenticator</span><span class="p">(</span><span class="n">timo</span><span class="o">.</span><span class="n">auth_ldap</span><span class="o">.</span><span class="n">authenticator_ldap_c</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;ldap://URL:PORT&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">roles</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">....</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">roles</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="s1">&#39;role1&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;users&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;john&quot;</span><span class="p">,</span> <span class="s2">&quot;lamar&quot;</span><span class="p">,</span> <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;Occupants of building 3&quot;</span>  <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="s1">&#39;role2&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;users&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;anthony&quot;</span><span class="p">,</span> <span class="s2">&quot;mcclay&quot;</span> <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;Administrators&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="s2">&quot;Knights who say ni&quot;</span> <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">}))</span>
</pre></div>
</div>
<p>The <em>roles</em> dictionary determines <em>who gets to be an admin</em> or who gets
access to XYZ resources.</p>
<p>This will make that <em>john</em>, <em>lamar</em> and any user on the group
<em>Occupants of building 3</em> to have the role <em>role1</em>.</p>
<p>Likewise for <em>anthony</em>, <em>mcclay</em> and any user who is a member of
either the group <em>Administrators</em> or the group <em>Knights who say
ni</em>, they are given role <em>role2</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – URL of the LDAP server</li>
<li><strong>roles</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – map of roles to users and groups</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.auth_ldap.authenticator_ldap_c.login">
<code class="descname">login</code><span class="sig-paren">(</span><em>email</em>, <em>password</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_ldap.authenticator_ldap_c.login" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate a email|token/password combination and pull which roles it
has assigned</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">set listing the roles the token/password combination
has according to the configuration</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#set" title="(in Python v2.7)">set</a></td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.invalid_credentials_e if the
token/password is not valid</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.error_e if any kind of error
during the process happens</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.auth_ldap.ldap_map_c">
<em class="property">class </em><code class="descclassname">ttbl.auth_ldap.</code><code class="descname">ldap_map_c</code><span class="sig-paren">(</span><em>url</em>, <em>bind_username=None</em>, <em>bind_password=None</em>, <em>max_age=200</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_ldap.ldap_map_c" title="Permalink to this definition">¶</a></dt>
<dd><p>General LDAP mapper</p>
<p>This objects allows maps and caches entities in an LDAP database, to
speed up looking up of values from other values.</p>
<p>For example, to get the <em>displayName</em> based on the <em>sAMAccountName</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">account_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;Some User&quot;</span><span class="p">,</span> <span class="s1">&#39;displayName&#39;</span><span class="p">,</span> <span class="s1">&#39;sAMAccountName&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>looks up an LDAP entity that has <em>Some User</em> as field
<em>displayName</em> and returns it’s <em>sAMAccountName</em>.</p>
<p>This does the same, but caches the results so that the next
time it looks it up, it doesn’t need to hit LDAP:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">account_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup_cached</span><span class="p">(</span><span class="s2">&quot;Some User&quot;</span><span class="p">,</span> <span class="s1">&#39;displayName&#39;</span><span class="p">,</span> <span class="s1">&#39;sAMAccountName&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>this object caches the objects, as we assume LDAP behaves
mostly as a read-only database.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>URL of the LDAP server; in the form
<em>ldap[s]://[BIND_USERNAME[:BIND_PASSWORD]]&#64;HOST:PORT</em>.</p>
<p>The bind username and password can be specified in the
arguments below (eg: when either have a <em>&#64;</em> or <em>:</em> and they
follow the same rules for password discovery.</p>
</li>
<li><strong>bind_username</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) login for binding to
LDAP; might not be needed in all setups.</li>
<li><strong>bind_password</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) password to binding to
LDAP; migt not be needed in all setups.</p>
<p>Will be handled by <a class="reference internal" href="#commonl.password_get" title="commonl.password_get"><code class="xref py py-func docutils literal notranslate"><span class="pre">commonl.password_get()</span></code></a>, so
passwords such as:</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt><em>KEYRING</em> will ask the accounts keyring for the password</dt>
<dd>for service <em>url</em> for username <em>bind_username</em></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><em>KEYRING:SERVICE</em> will ask the accounts keyring for the password</dt>
<dd>for service <em>SERVICE</em> for username <em>bind_username</em></dd>
</dl>
</li>
<li><em>FILENAME:PATH</em> will read the password from filename <em>PATH</em>.</li>
</ul>
</div></blockquote>
<p>otherwise is considered a hardcoded password.</p>
</li>
<li><strong>max_age</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) number of seconds each cached
entry is to live. Once an entry is older than this, the LDAP
server is queried again for that entry.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="exception">
<dt id="ttbl.auth_ldap.ldap_map_c.error_e">
<em class="property">exception </em><code class="descname">error_e</code><a class="headerlink" href="#ttbl.auth_ldap.ldap_map_c.error_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.auth_ldap.ldap_map_c.invalid_credentials_e">
<em class="property">exception </em><code class="descname">invalid_credentials_e</code><a class="headerlink" href="#ttbl.auth_ldap.ldap_map_c.invalid_credentials_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.auth_ldap.ldap_map_c.max_age">
<code class="descname">max_age</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.auth_ldap.ldap_map_c.max_age" title="Permalink to this definition">¶</a></dt>
<dd><p>maximum number of seconds an entry will live in the cache
before it is considered old and refetched from the servers.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.auth_ldap.ldap_map_c.lookup">
<code class="descname">lookup</code><span class="sig-paren">(</span><em>what</em>, <em>field_lookup</em>, <em>field_report</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_ldap.ldap_map_c.lookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Lookup the first LDAP record whose field <em>field_lookup</em>
contains a value of <em>what</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the value of the field <em>field_record</em> for the
record found; <em>None</em> if not found or the record doesn’t have
the field.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.auth_ldap.ldap_map_c.lookup_cached">
<code class="descname">lookup_cached</code><span class="sig-paren">(</span><em>value</em>, <em>field_lookup</em>, <em>field_report</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_ldap.ldap_map_c.lookup_cached" title="Permalink to this definition">¶</a></dt>
<dd><p>Same operation as <a class="reference internal" href="#ttbl.auth_ldap.ldap_map_c.lookup" title="ttbl.auth_ldap.ldap_map_c.lookup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">lookup()</span></code></a>; however, it caches the
result, so if the last lookup is younger than <a class="reference internal" href="#ttbl.auth_ldap.ldap_map_c.max_age" title="ttbl.auth_ldap.ldap_map_c.max_age"><code class="xref py py-data docutils literal notranslate"><span class="pre">max_age</span></code></a>,
said result is used. Otherwise a new LDAP lookup is done and
the value cached.</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.auth_localdb"></span><dl class="class">
<dt id="ttbl.auth_localdb.authenticator_localdb_c">
<em class="property">class </em><code class="descclassname">ttbl.auth_localdb.</code><code class="descname">authenticator_localdb_c</code><span class="sig-paren">(</span><em>name</em>, <em>users</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_localdb.authenticator_localdb_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Use a simple DB to authenticate users</p>
<p>To configure, create a config file that looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ttbl.auth_localdb</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add_authenticator</span><span class="p">(</span><span class="n">ttbl</span><span class="o">.</span><span class="n">auth_localdb</span><span class="o">.</span><span class="n">authenticator_localdb_c</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;NAME&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="p">[</span><span class="s1">&#39;user1&#39;</span><span class="p">,</span> <span class="s1">&#39;password1&#39;</span><span class="p">,</span> <span class="s1">&#39;role1&#39;</span><span class="p">,</span> <span class="s1">&#39;role2&#39;</span><span class="p">,</span> <span class="s1">&#39;role3&#39;</span><span class="o">...</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="p">[</span><span class="s1">&#39;user2&#39;</span><span class="p">,</span> <span class="s1">&#39;password2&#39;</span><span class="p">,</span> <span class="s1">&#39;role1&#39;</span><span class="p">,</span> <span class="s1">&#39;role4&#39;</span><span class="p">,</span> <span class="s1">&#39;role3&#39;</span> <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="p">[</span><span class="s1">&#39;user3&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;role2&#39;</span><span class="p">,</span> <span class="s1">&#39;role3&#39;</span><span class="o">...</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="p">[</span><span class="s1">&#39;user4&#39;</span><span class="p">,</span> <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>     <span class="p">]))</span>
</pre></div>
</div>
<p>Each item in the users list is a list containing:</p>
<blockquote>
<div><ul class="simple">
<li>the user id (<em>userX</em>)</li>
<li>the password in plaintext (FIXME: add digests); if empty, then
the user has no password.</li>
<li>list of roles (<em>roleX</em>)</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – FIXME</li>
<li><strong>users</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – map of roles to users and groups</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.auth_localdb.authenticator_localdb_c.login">
<code class="descname">login</code><span class="sig-paren">(</span><em>email</em>, <em>password</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_localdb.authenticator_localdb_c.login" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate a email|token/password combination and pull which roles it
has assigned</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">set listing the roles the token/password combination
has according to the configuration</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#set" title="(in Python v2.7)">set</a></td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.invalid_credentials_e if the
token/password is not valid</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.error_e if any kind of error
during the process happens</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.auth_party"></span><dl class="class">
<dt id="ttbl.auth_party.authenticator_party_c">
<em class="property">class </em><code class="descclassname">ttbl.auth_party.</code><code class="descname">authenticator_party_c</code><span class="sig-paren">(</span><em>roles=None</em>, <em>local_addresses=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_party.authenticator_party_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Life is a party! Authenticator that allows anyone to log in and be
an admin.</p>
<p>To configure, create a config file that looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">timo.auth_party</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add_authenticator</span><span class="p">(</span><span class="n">timo</span><span class="o">.</span><span class="n">auth_party</span><span class="o">.</span><span class="n">authenticator_party_c</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="p">[</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;role3&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">local_addresses</span> <span class="o">=</span> <span class="p">[</span>  <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.0.2&#39;</span> <span class="p">]</span> <span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Where you list the roles that everyone will get all the time.</p>
<p>Normally you want this only for debugging or for local
instances. Note you can set a list of local addresses to match
against (strings or regular expressions) which will enforce that
only authentication from those addresses will just be allowed.</p>
<p>FIXME: check connections are coming only from localhost</p>
<dl class="method">
<dt id="ttbl.auth_party.authenticator_party_c.login">
<code class="descname">login</code><span class="sig-paren">(</span><em>email</em>, <em>password</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_party.authenticator_party_c.login" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate a email|token/password combination and pull which roles it
has assigned</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Kwargs:</th><td class="field-body">‘remote_addr’ set to a string describing the IP
address where the connection comes from.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">set listing the roles the token/password combination
has according to the configuration</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#set" title="(in Python v2.7)">set</a></td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.invalid_credentials_e if the
token/password is not valid</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.unknown_user_e if there are remote
addresses initialized and the request comes from a non-local
address.</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.error_e if any kind of error
during the process happens</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-ttbl.console">
<span id="console-management-interface"></span><h3>8.8.2. Console Management Interface<a class="headerlink" href="#module-ttbl.console" title="Permalink to this headline">¶</a></h3>
<div class="section" id="access-target-s-serial-consoles-bidirectional-channels">
<h4>8.8.2.1. Access target’s serial consoles / bidirectional channels<a class="headerlink" href="#access-target-s-serial-consoles-bidirectional-channels" title="Permalink to this headline">¶</a></h4>
<p>Implemented by <a class="reference internal" href="#ttbl.console.interface" title="ttbl.console.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.console.interface</span></code></a>.</p>
<dl class="class">
<dt id="ttbl.console.impl_c">
<em class="property">class </em><code class="descclassname">ttbl.console.</code><code class="descname">impl_c</code><span class="sig-paren">(</span><em>command_sequence=None</em>, <em>command_timeout=5</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.impl_c" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Implementation interface for a console driver</p>
<p>The target will list the available consoles in the targets’
<em>consoles</em> tag</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">param list command_sequence:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><p class="first">(optional) when the console is
enabled (from <a class="reference internal" href="#tcfl.target_ext_console.extension.enable" title="tcfl.target_ext_console.extension.enable"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target.console.enable</span></code></a> or when powering up
a target that also enables the console at the same time via
<a class="reference internal" href="#tcfl.target_ext_power.extension.on" title="tcfl.target_ext_power.extension.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target.power.on</span></code></a>),
run a sequence of send/expect commands.</p>
<p>This is commonly used when the serial line is part of a server
and a set of commands have to be typed before the serial
connection has to be established. For example, for some
Lantronix KVM serial servers, when accessing the console over
SSH we need to wait for the prompt and then issue a <em>connect
serial</em> command:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">serial0_pc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">ssh_pc</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;USER:PASSWORD@LANTRONIXHOSTNAME&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">command_sequence</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>          <span class="c1"># command prompt, &#39;CR[USERNAME@IP]&gt; &#39;... or not, so just</span>
<span class="gp">&gt;&gt;&gt; </span>          <span class="c1"># look for &#39;SOMETHING&gt; &#39;</span>
<span class="gp">&gt;&gt;&gt; </span>          <span class="c1"># ^ will not match because we are getting a CR</span>
<span class="gp">&gt;&gt;&gt; </span>          <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;[^&gt;]+&gt; &quot;</span><span class="p">)</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">(</span> <span class="s2">&quot;connect serial</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<dl class="docutils">
<dt>“,</dt>
<dd><blockquote class="first">
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span>          <span class="s2">&quot;To exit serial port connection, type &#39;ESC exit&#39;.&quot;</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">extra_opts</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="c1"># old, but that&#39;s what the Lantronix server has :/</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;KexAlgorithms&quot;</span><span class="p">:</span> <span class="s2">&quot;diffie-hellman-group1-sha1&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;Ciphers&quot;</span> <span class="p">:</span> <span class="s2">&quot;aes128-cbc,3des-cbc&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">})</span>
</pre></div>
</div>
<p>This is a list of tupples <em>( SEND, EXPECT )</em>; <em>SEND</em> is a string
sent over to the console (unless the empty string; then nothing
is sent).  <em>EXPECT</em> can be anything that can be fed to Python’s
Expect <a class="reference external" href="https://pexpect.readthedocs.io/en/stable/api/pexpect.html#pexpect.spawn.expect" title="(in Pexpect v4.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">expect</span></code></a> function:</p>
<ul class="simple">
<li>a string</li>
<li>a compiled regular expression</li>
<li>a list of such</li>
</ul>
<p>The timeout for each expectation is hardcoded to five seconds
(FIXME).</p>
<p>Note for this to work, the driver that uses this class must call
the <em>_command_sequence_run()</em> method from their
<a class="reference internal" href="#ttbl.console.impl_c.enable" title="ttbl.console.impl_c.enable"><code class="xref py py-meth docutils literal notranslate"><span class="pre">impl_c.enable()</span></code></a> methods.</p>
</div></blockquote>
<table class="last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">param int command_timeout:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">(optional) number of seconds to wait
for a response ot a command before declaring a timeout</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<dl class="exception">
<dt id="ttbl.console.impl_c.exception">
<em class="property">exception </em><code class="descname">exception</code><a class="headerlink" href="#ttbl.console.impl_c.exception" title="Permalink to this definition">¶</a></dt>
<dd><p>General console driver exception</p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.console.impl_c.timeout_e">
<em class="property">exception </em><code class="descname">timeout_e</code><a class="headerlink" href="#ttbl.console.impl_c.timeout_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Console enablement command sequence timed out</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.impl_c.enable">
<code class="descname">enable</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.impl_c.enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable a console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – console to enable</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.impl_c.disable">
<code class="descname">disable</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.impl_c.disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable a console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to disable; if missing,
the default one.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.impl_c.state">
<code class="descname">state</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.impl_c.state" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the given console’s state</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to enable; if missing,
the default one</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><em>True</em> if enabled, <em>False</em> otherwise</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.impl_c.setup">
<code class="descname">setup</code><span class="sig-paren">(</span><em>target</em>, <em>component</em>, <em>parameters</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.impl_c.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup console parameters (implementation specific)</p>
<p>Check <a class="reference internal" href="#ttbl.console.impl_c.read" title="ttbl.console.impl_c.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">impl_c.read()</span></code></a> for common parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>parameters</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of implementation specific
parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">nothing</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.impl_c.read">
<code class="descname">read</code><span class="sig-paren">(</span><em>target</em>, <em>component</em>, <em>offset</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.impl_c.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Return data read from the console since it started recording
from a given byte offset.</p>
<p>Check <a class="reference internal" href="#ttbl.console.impl_c.read" title="ttbl.console.impl_c.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">impl_c.read()</span></code></a> for common parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params int offset:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">offset from which to read</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">data dictionary of values to pass to the client; the
data is expected to be in a file which will be streamed to
the client.<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">stream_file</span> <span class="o">=</span> <span class="n">CAPTURE_FILE</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">stream_generation</span> <span class="o">=</span> <span class="n">MONOTONIC</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">stream_offset</span> <span class="o">=</span> <span class="n">OFFSET</span><span class="p">)</span>
</pre></div>
</div>
<p>this allows to support large amounts of data automatically;
the generation is a number that is monotonically increased,
for example, each time a power cycle happens. This is
basically when a new file is created.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.impl_c.size">
<code class="descname">size</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.impl_c.size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the amount of data currently read from the console.</p>
<p>Check <a class="reference internal" href="#ttbl.console.impl_c.read" title="ttbl.console.impl_c.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">impl_c.read()</span></code></a> for common parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">number of bytes read from the console since the last
power up.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.impl_c.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>target</em>, <em>component</em>, <em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.impl_c.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write bytes the the console</p>
<p>Check <a class="reference internal" href="#ttbl.console.impl_c.read" title="ttbl.console.impl_c.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">impl_c.read()</span></code></a> for common parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – string of bytes or data to write to the console</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.console.interface">
<em class="property">class </em><code class="descclassname">ttbl.console.</code><code class="descname">interface</code><span class="sig-paren">(</span><em>*impls</em>, <em>**kwimpls</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.interface" title="Permalink to this definition">¶</a></dt>
<dd><p>Interface to access the target’s consoles</p>
<p>An instance of this gets added as an object to the target object
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;qu05a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;console&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ttyS0</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">serial_device</span><span class="p">(</span><span class="s2">&quot;/dev/ttyS5&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ttyS1</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">generic</span><span class="p">(</span><span class="s2">&quot;ipmi-sol&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;ttyS0&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>Note how <em>default</em> has been made an alias of <em>ttyS0</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>impls</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>dictionary keyed by console name and which
values are instantiation of console drivers inheriting from
<a class="reference internal" href="#ttbl.console.impl_c" title="ttbl.console.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.console.impl_c</span></code></a> or names of other consoles (to
sever as aliases).</p>
<p>Names have to be valid python symbol names following the
following convention:</p>
<ul class="simple">
<li><em>serial*</em>  RS-232C compatible physical Serial port</li>
<li><em>sol*</em>     IPMI Serial-Over-Lan</li>
<li><em>ssh*</em>     SSH session (may require setup before enabling)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>A <em>default</em> console is set by declaring an alias as in the example
above; however, a preferred console</p>
<p>This interface:</p>
<ul class="simple">
<li>supports N &gt; 1 channels per target, of any type (serial,
network, etc)</li>
<li>allows raw traffic (not just pure ASCII), for example for serial
console escape sequences, etc</li>
<li>the client shall not need to be constantly reading to avoid
loosing data; the read path shall be (can be) implemented to
buffer everything since power on (by creating a power control
driver <a class="reference internal" href="#ttbl.power.impl_c" title="ttbl.power.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.impl_c</span></code></a> that records everything; see
<a class="reference internal" href="#ttbl.console.serial_pc" title="ttbl.console.serial_pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.console.serial_pc</span></code></a> for an example</li>
<li>allows setting general channel parameters</li>
</ul>
<dl class="method">
<dt id="ttbl.console.interface.get_setup">
<code class="descname">get_setup</code><span class="sig-paren">(</span><em>_target</em>, <em>_who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.interface.get_setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.console.interface.put_setup">
<code class="descname">put_setup</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.interface.put_setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.console.interface.get_list">
<code class="descname">get_list</code><span class="sig-paren">(</span><em>_target</em>, <em>_who</em>, <em>_args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.interface.get_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.console.interface.put_enable">
<code class="descname">put_enable</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.interface.put_enable" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.console.interface.put_disable">
<code class="descname">put_disable</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.interface.put_disable" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.console.interface.get_state">
<code class="descname">get_state</code><span class="sig-paren">(</span><em>target</em>, <em>_who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.interface.get_state" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.console.interface.get_read">
<code class="descname">get_read</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.interface.get_read" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.console.interface.get_size">
<code class="descname">get_size</code><span class="sig-paren">(</span><em>target</em>, <em>_who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.interface.get_size" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.console.interface.put_write">
<code class="descname">put_write</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.interface.put_write" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="ttbl.console.generation_set">
<code class="descclassname">ttbl.console.</code><code class="descname">generation_set</code><span class="sig-paren">(</span><em>target</em>, <em>console</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.generation_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="ttbl.console.generic_c">
<em class="property">class </em><code class="descclassname">ttbl.console.</code><code class="descname">generic_c</code><span class="sig-paren">(</span><em>chunk_size=0</em>, <em>interchunk_wait=0.2</em>, <em>command_sequence=None</em>, <em>escape_chars=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.generic_c" title="Permalink to this definition">¶</a></dt>
<dd><p>General base console implementation</p>
<p>This object will implement a base console driver that reads from a
file in the (the read file) and writes to a file (the write file)
in the local filesystem.</p>
<p>The read / write files are named
<code class="docutils literal notranslate"><span class="pre">console-CONSOLENAME.{read,write}</span></code> and are located in the
target’s state directory. Thus there is no need for state, since
the parameters are available in the call.</p>
<p>The idea is that another piece (normally a power control unit that
starts a background daemon) will be reading from the console in
the target system and dumping data to the read file. For writing,
the same piece takes whatever data is being provided and passes it
on, or it can be written directly.</p>
<p>See <a class="reference internal" href="#ttbl.console.serial_pc" title="ttbl.console.serial_pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">serial_pc</span></code></a> for an example of this model implemented
over a tranditional serial port and
<a class="reference internal" href="#ttbl.ipmi.sol_console_pc" title="ttbl.ipmi.sol_console_pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.ipmi.sol_console_pc</span></code></a> for implementing an IPMI
Serial-Over-Lan console. <a class="reference internal" href="#ttbl.console.ssh_pc" title="ttbl.console.ssh_pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssh_pc</span></code></a> for implementing a
console simulated over an SSH connection.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>chunk_size</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) when writing, break the writing
in chunks of this size and wait <em>interchunk_wait</em> in between
sending each chunk. By default is 0, which is disabled.</li>
<li><strong>interchunk_wait</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – (optional) if <em>chunk_size</em> is
enabled, time to wait in seconds in between each chunk.</li>
<li><strong>escape_chars</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>(optional) dictionary of escape
sequences for given characters to prefix in input stream.</p>
<p>If given, this is a dictionary of characters to strings, eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">escape_chars</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="s1">&#39;~&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">}</span>
</pre></div>
</div>
<p>in this case, when the input string to send to the device
contains a <em>x1b</em> (the ESC character), it will be prefixed with
another one. If it contains a <em>~</em>, it will be prefixed with a
backslash.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.console.generic_c.state">
<code class="descname">state</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.generic_c.state" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the given console’s state</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to enable; if missing,
the default one</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><em>True</em> if enabled, <em>False</em> otherwise</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.generic_c.read">
<code class="descname">read</code><span class="sig-paren">(</span><em>target</em>, <em>component</em>, <em>offset</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.generic_c.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Return data read from the console since it started recording
from a given byte offset.</p>
<p>Check <a class="reference internal" href="#ttbl.console.impl_c.read" title="ttbl.console.impl_c.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">impl_c.read()</span></code></a> for common parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params int offset:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">offset from which to read</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">data dictionary of values to pass to the client; the
data is expected to be in a file which will be streamed to
the client.<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">stream_file</span> <span class="o">=</span> <span class="n">CAPTURE_FILE</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">stream_generation</span> <span class="o">=</span> <span class="n">MONOTONIC</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">stream_offset</span> <span class="o">=</span> <span class="n">OFFSET</span><span class="p">)</span>
</pre></div>
</div>
<p>this allows to support large amounts of data automatically;
the generation is a number that is monotonically increased,
for example, each time a power cycle happens. This is
basically when a new file is created.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.generic_c.size">
<code class="descname">size</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.generic_c.size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the amount of data currently read from the console.</p>
<p>Check <a class="reference internal" href="#ttbl.console.impl_c.read" title="ttbl.console.impl_c.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">impl_c.read()</span></code></a> for common parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">number of bytes read from the console since the last
power up.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.generic_c.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>target</em>, <em>component</em>, <em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.generic_c.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write bytes the the console</p>
<p>Check <a class="reference internal" href="#ttbl.console.impl_c.read" title="ttbl.console.impl_c.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">impl_c.read()</span></code></a> for common parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – string of bytes or data to write to the console</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.console.serial_pc">
<em class="property">class </em><code class="descclassname">ttbl.console.</code><code class="descname">serial_pc</code><span class="sig-paren">(</span><em>serial_file_name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.serial_pc" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a serial port console and data recorder</p>
<p>This class implements two interfaces:</p>
<ul>
<li><p class="first">power interface: to start a serial port recorder in the
background as soon as the target is powered on. Anything read
form the serial port is written to the <em>console-NAME.read</em> file
and anything written to it is written to <em>console-NAME.write</em>
file, which is sent to the serial port.</p>
<p>The power interface is implemented by subclassing
<a class="reference internal" href="#ttbl.power.socat_pc" title="ttbl.power.socat_pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.socat_pc</span></code></a>, which starts <em>socat</em> as daemon to
serve as a data recorder and to pass data to the serial port
from the read file.</p>
</li>
<li><p class="first">console interface: interacts with the console interface by
exposing the data recorded in <em>console-NAME.read</em> file and
writing to the <em>console-NAME.write</em> file.</p>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params str serial_file_name:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><p class="first">(optional) name of the serial port
file, which can be templated with <em>%(FIELD)s</em> as per
class:<cite>ttbl.power.socat_pc</cite> (the low level implementation).</p>
<p class="last">By default, it uses <em>/dev/tty-TARGETNAME</em>, which makes it easier
to configure. The tty name linked to the target can be set with
<a class="reference internal" href="04-HOWTOs.html#usb-tty"><span class="std std-ref">udev</span></a>.</p>
</td>
</tr>
</tbody>
</table>
<p>For example, create a serial port recoder power control / console
driver and insert it into the power rail and the console of a
target:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">serial0_pc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">serial_pc</span><span class="p">(</span><span class="n">console_file_name</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;power&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">serial0_pc</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;console&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">serial0</span> <span class="o">=</span> <span class="n">serial0_pc</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;serial0&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="ttbl.console.serial_pc.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.serial_pc.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.serial_pc.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.serial_pc.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.console.serial_pc.on" title="ttbl.console.serial_pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.serial_pc.enable">
<code class="descname">enable</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.serial_pc.enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable a console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – console to enable</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.serial_pc.disable">
<code class="descname">disable</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.serial_pc.disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable a console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to disable; if missing,
the default one.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.console.ssh_pc">
<em class="property">class </em><code class="descclassname">ttbl.console.</code><code class="descname">ssh_pc</code><span class="sig-paren">(</span><em>hostname</em>, <em>port=22</em>, <em>chunk_size=0</em>, <em>interchunk_wait=0.1</em>, <em>extra_opts=None</em>, <em>command_sequence=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.ssh_pc" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a serial port over an SSH connection</p>
<p>This class implements two interfaces:</p>
<ul>
<li><p class="first">power interface: to start an SSH connection recorder in the
background as soon as the target is powered on.</p>
<p>The power interface is implemented by subclassing
<a class="reference internal" href="#ttbl.power.socat_pc" title="ttbl.power.socat_pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.socat_pc</span></code></a>, which starts <em>socat</em> as daemon to
serve as a data recorder and to pass data to the connection
from the read file.</p>
<p>Anything read form the SSH connection is written to the
<em>console-NAME.read</em> file and anything written to it is written
to <em>console-NAME.write</em> file, which is sent to the serial port.</p>
</li>
<li><p class="first">console interface: interacts with the console interface by
exposing the data recorded in <em>console-NAME.read</em> file and
writing to the <em>console-NAME.write</em> file.</p>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params str hostname:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><p class="first"><em>USER[:PASSWORD]&#64;HOSTNAME</em> for the SSH server</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) port to connect to (defaults to 22)</li>
<li><strong>exta_ports</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>(optional) dictionary of extra SSH options
and values to set in the SSH configuration (as described in
<em class="manpage">ssh_config(5)</em>.</p>
<p>Note they all have to be strings; e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">serial0_pc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">ssh_pc</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;USER:PASSWORD@HOSTNAME&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">extra_opts</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;Ciphers&quot;</span><span class="p">:</span> <span class="s2">&quot;aes128-cbc,3des-cbc&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;Compression&quot;</span><span class="p">:</span> <span class="s2">&quot;no&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">})</span>
</pre></div>
</div>
<p>Be careful what is changed, since it can break operation.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>See <a class="reference internal" href="#ttbl.console.generic_c" title="ttbl.console.generic_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">generic_c</span></code></a> for descriptions on <em>chunk_size</em> and
<em>interchunk_wait</em>, <a class="reference internal" href="#ttbl.console.impl_c" title="ttbl.console.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">impl_c</span></code></a> for <em>command_sequence</em>.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ssh0_pc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">ssh_pc</span><span class="p">(</span><span class="s2">&quot;USERNAME:PASSWORD@HOSTNAME&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;power&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ssh0_pc</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;console&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ssh0</span> <span class="o">=</span> <span class="n">ssh0_pc</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>FIXME:</dt>
<dd><ul class="first last simple">
<li>pass password via agent? file descriptor?</li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="ttbl.console.ssh_pc.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.ssh_pc.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.ssh_pc.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.ssh_pc.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.console.ssh_pc.on" title="ttbl.console.ssh_pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.ssh_pc.setup">
<code class="descname">setup</code><span class="sig-paren">(</span><em>target</em>, <em>component</em>, <em>parameters</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.ssh_pc.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup console parameters (implementation specific)</p>
<p>Check <a class="reference internal" href="#ttbl.console.impl_c.read" title="ttbl.console.impl_c.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">impl_c.read()</span></code></a> for common parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>parameters</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of implementation specific
parameters</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">nothing</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.ssh_pc.enable">
<code class="descname">enable</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.ssh_pc.enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable a console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – console to enable</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.console.ssh_pc.disable">
<code class="descname">disable</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.console.ssh_pc.disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable a console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to disable; if missing,
the default one.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="debugging-interface">
<h3>8.8.3. Debugging Interface<a class="headerlink" href="#debugging-interface" title="Permalink to this headline">¶</a></h3>
<dl class="attribute">
<dt id="ttbl.debug">
<code class="descclassname">ttbl.</code><code class="descname">debug</code><a class="headerlink" href="#ttbl.debug" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#module-ttbl.debug" title="ttbl.debug"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.debug</span></code></a></p>
</dd></dl>

</div>
<div class="section" id="module-ttbl.power">
<span id="power-control-interface"></span><h3>8.8.4. Power Control Interface<a class="headerlink" href="#module-ttbl.power" title="Permalink to this headline">¶</a></h3>
<div class="section" id="control-power-to-targets">
<h4>8.8.4.1. Control power to targets<a class="headerlink" href="#control-power-to-targets" title="Permalink to this headline">¶</a></h4>
<p>This interface provides means to power on/off targets and the invidual
components that compose the power rail of a target.</p>
<p>The interface is implemented by <a class="reference internal" href="#ttbl.power.interface" title="ttbl.power.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.interface</span></code></a> needs to
be attached to a target with <a class="reference internal" href="#ttbl.test_target.interface_add" title="ttbl.test_target.interface_add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ttbl.test_target.interface_add()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">NAME</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;INTERFACENAME&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">component0</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">component1</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
</pre></div>
</div>
<p>each component is an instance of a subclass of
<a class="reference internal" href="#ttbl.power.impl_c" title="ttbl.power.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.impl_c</span></code></a>, which implements the actual control over
the power unit, such as:</p>
<ul class="simple">
<li>PDU socket: <a class="reference internal" href="#ttbl.pc.dlwps7" title="ttbl.pc.dlwps7"><code class="xref py py-class docutils literal notranslate"><span class="pre">Digital</span> <span class="pre">Logger's</span> <span class="pre">Web</span> <span class="pre">Power</span> <span class="pre">Switch</span>
<span class="pre">7</span></code></a>, <a class="reference internal" href="#ttbl.pc_ykush.ykush" title="ttbl.pc_ykush.ykush"><code class="xref py py-class docutils literal notranslate"><span class="pre">YKush</span></code></a> power
switch hub, raritan EMX</li>
<li>relays: <a class="reference internal" href="#ttbl.usbrly08b.pc" title="ttbl.usbrly08b.pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">USB-RLY08b</span></code></a></li>
<li>control over IPMI: <a class="reference internal" href="#ttbl.ipmi.pci" title="ttbl.ipmi.pci"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.ipmi.pci</span></code></a></li>
</ul>
<p>Also power components are able to:</p>
<ul class="simple">
<li>start / stop daemons in the server (<em>socat</em>, <em>rsync</em>, <em>qemu</em>,
<em>openocd</em>…)</li>
<li><a class="reference internal" href="#ttbl.pc.delay" title="ttbl.pc.delay"><code class="xref py py-class docutils literal notranslate"><span class="pre">delay</span></code></a> the power on/off sequence</li>
<li>wait for some particular conditions to happen: a file
<a class="reference internal" href="#ttbl.pc.delay_til_file_gone" title="ttbl.pc.delay_til_file_gone"><code class="xref py py-class docutils literal notranslate"><span class="pre">dissapearing</span></code></a> or
<a class="reference internal" href="#ttbl.pc.delay_til_file_appears" title="ttbl.pc.delay_til_file_appears"><code class="xref py py-class docutils literal notranslate"><span class="pre">appearing</span></code></a>, a USB device is
<a class="reference internal" href="#ttbl.pc.delay_til_usb_device" title="ttbl.pc.delay_til_usb_device"><code class="xref py py-class docutils literal notranslate"><span class="pre">detected</span></code></a> in the system</li>
</ul>
<dl class="class">
<dt id="ttbl.power.impl_c">
<em class="property">class </em><code class="descclassname">ttbl.power.</code><code class="descname">impl_c</code><span class="sig-paren">(</span><em>paranoid=False</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.impl_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Implementation interface to drive a  power component</p>
<p>A power component is an individual entity that provides one of the
pieces of a power rail needed to power up a target.</p>
<p>It can be powered on, off and it’s state can be acquired.</p>
<p>A driver is made by subclassing this object, implementing the
<a class="reference internal" href="#ttbl.power.impl_c.on" title="ttbl.power.impl_c.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a>, <a class="reference internal" href="#ttbl.power.impl_c.off" title="ttbl.power.impl_c.off"><code class="xref py py-meth docutils literal notranslate"><span class="pre">off()</span></code></a> and <a class="reference internal" href="#ttbl.power.impl_c.get" title="ttbl.power.impl_c.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> methods and then adding
it to a power interface <a class="reference internal" href="#ttbl.power.interface" title="ttbl.power.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.interface</span></code></a> which is
then attached to a target.</p>
<p>Drivers implement the specifics to run the switches PDUs, relays,
etc</p>
<p>Note these are designed to be as stateless as possible; in most
cases all the state needed can be derived from the <em>target</em> and
<em>component</em> parameters passed to the methods.</p>
<p>Remember no information can be stored <em>self</em> or <em>target</em> as the
next call can come in another daemon implementing the same
target. For storage, use the target’s <em>fsdb</em> interface.</p>
<p><strong>ALL</strong> the methods have to be blocking, so the operation is
supposed to be completed and the status has to have been changed
by the time the call returns. If the operation cannot be trusted
to be blocking, set the <em>paranoid</em> parameter to <em>True</em> so the
power interface will confirm the change has re-happened and
enforce it again.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>paranoid</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – don’t trust the operation is really
blocking, as it should, so double check the state changed happen
and retry if not.</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="ttbl.power.impl_c.power_on_recovery">
<code class="descname">power_on_recovery</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.power.impl_c.power_on_recovery" title="Permalink to this definition">¶</a></dt>
<dd><p>If the power on fails, automatically retry it by powering
first off, then on again</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.power.impl_c.paranoid_get_samples">
<code class="descname">paranoid_get_samples</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.power.impl_c.paranoid_get_samples" title="Permalink to this definition">¶</a></dt>
<dd><p>for paranoid power getting, now many samples we need to get
that are the same for the value to be considered stable</p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.power.impl_c.retry_all_e">
<em class="property">exception </em><code class="descname">retry_all_e</code><span class="sig-paren">(</span><em>wait=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.impl_c.retry_all_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Exception raised when a power control implementation operation
wants the whole power-rail reinitialized</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.power.impl_c.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.impl_c.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.power.impl_c.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.impl_c.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.power.impl_c.on" title="ttbl.power.impl_c.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.power.impl_c.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.impl_c.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.power.impl_c.on" title="ttbl.power.impl_c.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.power.interface">
<em class="property">class </em><code class="descclassname">ttbl.power.</code><code class="descname">interface</code><span class="sig-paren">(</span><em>*impls</em>, <em>**kwimpls</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.interface" title="Permalink to this definition">¶</a></dt>
<dd><p>Power control interface</p>
<p>Implements an interface that allows to control the power to a
target, which can be a single switch or a whole power rail of
components that have to be powered on and off in an specific
sequence.</p>
<dl class="method">
<dt id="ttbl.power.interface.get_list">
<code class="descname">get_list</code><span class="sig-paren">(</span><em>target</em>, <em>_who</em>, <em>_args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.interface.get_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.power.interface.get_get">
<code class="descname">get_get</code><span class="sig-paren">(</span><em>target</em>, <em>_who</em>, <em>_args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.interface.get_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.power.interface.put_on">
<code class="descname">put_on</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.interface.put_on" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.power.interface.put_off">
<code class="descname">put_off</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.interface.put_off" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.power.interface.put_cycle">
<code class="descname">put_cycle</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.interface.put_cycle" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.power.interface.put_reset">
<code class="descname">put_reset</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.interface.put_reset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.power.fake_c">
<em class="property">class </em><code class="descclassname">ttbl.power.</code><code class="descname">fake_c</code><span class="sig-paren">(</span><em>paranoid=False</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.fake_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Fake power component which stores state in disk</p>
<p>Note this object doesn’t have to know much parameters on
initialization, which allows us to share implementations.</p>
<p>It can rely on the <em>target</em> and <em>component</em> parameters to
each method to derive where to act.</p>
<dl class="method">
<dt id="ttbl.power.fake_c.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.fake_c.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.power.fake_c.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.fake_c.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.power.fake_c.on" title="ttbl.power.fake_c.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.power.fake_c.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.fake_c.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.power.fake_c.on" title="ttbl.power.fake_c.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.power.daemon_c">
<em class="property">class </em><code class="descclassname">ttbl.power.</code><code class="descname">daemon_c</code><span class="sig-paren">(</span><em>cmdline</em>, <em>precheck_wait=0</em>, <em>env_add=None</em>, <em>kws=None</em>, <em>path=None</em>, <em>name=None</em>, <em>pidfile=None</em>, <em>mkpidfile=True</em>, <em>paranoid=False</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.daemon_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic power controller to start daemons in the server machine</p>
<p>FIXME: document</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>cmdline</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – <p>command line arguments to pass to
<a class="reference external" href="https://docs.python.org/2.7/library/subprocess.html#subprocess.check_output" title="(in Python v2.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">subprocess.check_output()</span></code></a>; this is a list of
strings, first being the path to the command, the rest being the
arguments.</p>
<p>All the entries in the list are templated with <em>%(FIELD)s</em>
expansion, where each field comes either from the <em>kws</em>
dictionary or the target’s metadata.</p>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="ttbl.power.daemon_c.kws">
<code class="descname">kws</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.power.daemon_c.kws" title="Permalink to this definition">¶</a></dt>
<dd><p>dictionary of keywords that can be use to template the
command line with <em>%(FIELD)S</em></p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.power.daemon_c.error_e">
<em class="property">exception </em><code class="descname">error_e</code><a class="headerlink" href="#ttbl.power.daemon_c.error_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.power.daemon_c.start_e">
<em class="property">exception </em><code class="descname">start_e</code><a class="headerlink" href="#ttbl.power.daemon_c.start_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.power.daemon_c.verify">
<code class="descname">verify</code><span class="sig-paren">(</span><em>target</em>, <em>component</em>, <em>cmdline_expanded</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.daemon_c.verify" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that verifies if the daemon has started or not</p>
<p>For example, checking if a file has been created, etc</p>
<p><strong>THIS MUST BE DEFINED</strong></p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cmdline_expanded</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pidfile</span> <span class="o">%</span> <span class="n">kws</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>True</em> if the daemon started, <em>False</em> otherwise</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.power.daemon_c.log_stderr">
<code class="descname">log_stderr</code><span class="sig-paren">(</span><em>target</em>, <em>component</em>, <em>stderrf=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.daemon_c.log_stderr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.power.daemon_c.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.daemon_c.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.power.daemon_c.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.daemon_c.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.power.daemon_c.on" title="ttbl.power.daemon_c.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.power.daemon_c.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.daemon_c.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.power.daemon_c.on" title="ttbl.power.daemon_c.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.power.socat_pc">
<em class="property">class </em><code class="descclassname">ttbl.power.</code><code class="descname">socat_pc</code><span class="sig-paren">(</span><em>address1</em>, <em>address2</em>, <em>env_add=None</em>, <em>precheck_wait=0.2</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.socat_pc" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic power component that starts/stops socat as daemon</p>
<p>This class is meant to be subclassed for an implementation passing
the actual addresses to use.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>address1</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – first address for socat; will be templated
with <em>%(FIELD)s</em> to the target’s keywords and anything added in
<a class="reference internal" href="#ttbl.power.daemon_c.kws" title="ttbl.power.daemon_c.kws"><code class="xref py py-data docutils literal notranslate"><span class="pre">daemon_c.kws</span></code></a>.</li>
<li><strong>address2</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – second address for socat; templated as
<em>address1</em></li>
<li><strong>env_add</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – variables to add to the environment when
running socat</li>
<li><strong>precheck_wait</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – seconds to wait once starting before
checking if the daemon is running; sometimes it dies after we
check, so it is good to give it a wait.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This object (or what is derived from it) can be passed to a power
interface for implementation, eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;TARGETNAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;power&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">socat_pc</span><span class="p">(</span><span class="n">ADDR1</span><span class="p">,</span> <span class="n">ADDR2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>Upon power up, the <em>socat</em> daemon will be started, with it’s
current directory set to the target’s state directory and a log
file called after the component (<em>NAME-socat.log</em>). When powering
off, the daemon is stopped.</p>
<p>Anything coming of the <em>ipmitool’s</em> <em>stderr</em> is sent to a file
called <em>NAME-socat.stderr</em>.</p>
<p>Specifying addresses is very specific to the usage that it is to
be done of it, but for example:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">PTY,link=console-%(component)s.write,rawer!!CREATE:console-%(component)s.read</span></code></p>
<p>creates a PTY which will pass whatever is written to
<code class="docutils literal notranslate"><span class="pre">console-COMPONENT.write</span></code> to the second address and whatever
is read from it to <code class="docutils literal notranslate"><span class="pre">console-COMPONENT.read</span></code> (!! serves like a
bifurcator).</p>
<p>Note you need to use <em>rawer</em> to ensure a clean pipe, otherwise
the PTY later might add rs.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">/dev/ttyS0,creat=0,rawer,b115200,parenb=0,cs8,bs1</span></code></p>
<p>opens a serial port and writes to it whatever is written to
<code class="docutils literal notranslate"><span class="pre">console-COMPONENT.write</span></code> and anything that is read from the
serial port will be appended to file <code class="docutils literal notranslate"><span class="pre">console-COMPONENT.read</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">EXEC:'/usr/bin/ipmitool</span> <span class="pre">-H</span> <span class="pre">HOSTNAME</span> <span class="pre">-U</span> <span class="pre">USERNAME</span> <span class="pre">-E</span> <span class="pre">-I</span> <span class="pre">lanplus</span> <span class="pre">sol</span> <span class="pre">activate',sighup,sigint,sigquit</span></code></p>
<p>runs the program <em>ipmitool</em>, writes to <em>stdin</em> whatever is
written to <em>console-COMPONENT.write</em> and whatever comes out of
<em>stdout</em> is written to <em>console-COMPONENT.read</em>.</p>
</li>
</ul>
<p>Be wary of adding options such <em>crnl</em> to remove extra CRs (r)
before the newline (n) when using to implement consoles. The
console channels are meant to be completely transparent.</p>
<p>For examples, look at <a class="reference internal" href="#ttbl.console.serial_pc" title="ttbl.console.serial_pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.console.serial_pc</span></code></a> and
<a class="reference internal" href="#ttbl.ipmi.sol_console_pc" title="ttbl.ipmi.sol_console_pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.ipmi.sol_console_pc</span></code></a>.</p>
<p>** Catchas and Tricks for debugging **</p>
<p>Sometimes it just dies and we are left wondering</p>
<ul>
<li><p class="first">prepend to <em>EXEC</em> <em>strace -fo /tmp/strace.log</em>, as in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EXEC</span><span class="p">:</span><span class="s1">&#39;strace -fo /tmp/strace.log COMMANDTHATDIES&#39;</span>
</pre></div>
</div>
<p>find information in server’s <code class="docutils literal notranslate"><span class="pre">/tmp/strace.log</span></code> when power
cycling or enable top level calling under strace; it gets
helpful.</p>
</li>
</ul>
<dl class="method">
<dt id="ttbl.power.socat_pc.verify">
<code class="descname">verify</code><span class="sig-paren">(</span><em>target</em>, <em>component</em>, <em>cmdline_expanded</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.power.socat_pc.verify" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that verifies if the daemon has started or not</p>
<p>For example, checking if a file has been created, etc</p>
<p><strong>THIS MUST BE DEFINED</strong></p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cmdline_expanded</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pidfile</span> <span class="o">%</span> <span class="n">kws</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>True</em> if the daemon started, <em>False</em> otherwise</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-ttbl.pc"></span><dl class="class">
<dt id="ttbl.pc.delay">
<em class="property">class </em><code class="descclassname">ttbl.pc.</code><code class="descname">delay</code><span class="sig-paren">(</span><em>on=0</em>, <em>off=0</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay" title="Permalink to this definition">¶</a></dt>
<dd><p>Introduce artificial delays when calling on/off/get to allow
targets to settle.</p>
<p>This is meant to be used in a stacked list of power
implementations given to a power control interface.</p>
<dl class="method">
<dt id="ttbl.pc.delay.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.pc.delay.on" title="ttbl.pc.delay.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.pc.delay.on" title="ttbl.pc.delay.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.pc.delay_til_file_gone">
<em class="property">class </em><code class="descclassname">ttbl.pc.</code><code class="descname">delay_til_file_gone</code><span class="sig-paren">(</span><em>poll_period=0.25</em>, <em>timeout=25</em>, <em>on=None</em>, <em>off=None</em>, <em>get=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_gone" title="Permalink to this definition">¶</a></dt>
<dd><p>Delay until a file dissapears.</p>
<p>This is meant to be used in a stacked list of power
implementations given to a power control interface.</p>
<dl class="method">
<dt id="ttbl.pc.delay_til_file_gone.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_gone.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_file_gone.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_gone.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.pc.delay_til_file_gone.on" title="ttbl.pc.delay_til_file_gone.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_file_gone.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_gone.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.pc.delay_til_file_gone.on" title="ttbl.pc.delay_til_file_gone.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.pc.delay_til_file_appears">
<em class="property">class </em><code class="descclassname">ttbl.pc.</code><code class="descname">delay_til_file_appears</code><span class="sig-paren">(</span><em>filename</em>, <em>poll_period=0.25</em>, <em>timeout=25</em>, <em>action=None</em>, <em>action_args=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_appears" title="Permalink to this definition">¶</a></dt>
<dd><p>Delay until a file appears.</p>
<p>This is meant to be used in a stacked list of power
implementations given to a power control interface.</p>
<dl class="method">
<dt id="ttbl.pc.delay_til_file_appears.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_appears.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_file_appears.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_appears.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.pc.delay_til_file_appears.on" title="ttbl.pc.delay_til_file_appears.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_file_appears.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_appears.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.pc.delay_til_file_appears.on" title="ttbl.pc.delay_til_file_appears.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.pc.delay_til_usb_device">
<em class="property">class </em><code class="descclassname">ttbl.pc.</code><code class="descname">delay_til_usb_device</code><span class="sig-paren">(</span><em>serial</em>, <em>when_powering_on=True</em>, <em>want_connected=True</em>, <em>poll_period=0.25</em>, <em>timeout=25</em>, <em>action=None</em>, <em>action_args=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_usb_device" title="Permalink to this definition">¶</a></dt>
<dd><p>Delay power-on until a USB device dis/appears.</p>
<p>This is meant to be used in a stacked list of power
implementations given to a power control interface.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Serial number of the USB device to monitor</li>
<li><strong>when_powering_on</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – Check when powering on if True
(default) or when powering off (if false)</li>
<li><strong>want_connected</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – when checking, we want the device to
be connected (True) or disconnected (False)</li>
<li><strong>action</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/collections.html#collections.Callable" title="(in Python v2.7)"><em>collections.Callable</em></a>) – action to execute when the
device is not found, before waiting. Note the first parameter
passed to the action is the target itself and then any other
parameter given in <code class="docutils literal notranslate"><span class="pre">action_args</span></code></li>
<li><strong>action_args</strong> – tuple of parameters to pass to <code class="docutils literal notranslate"><span class="pre">action</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="exception">
<dt id="ttbl.pc.delay_til_usb_device.not_found_e">
<em class="property">exception </em><code class="descname">not_found_e</code><a class="headerlink" href="#ttbl.pc.delay_til_usb_device.not_found_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Exception raised when a USB device is not found</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.pc.delay_til_usb_device.backend">
<code class="descname">backend</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.pc.delay_til_usb_device.backend" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_usb_device.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_usb_device.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_usb_device.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_usb_device.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.pc.delay_til_usb_device.on" title="ttbl.pc.delay_til_usb_device.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_usb_device.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_usb_device.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.pc.delay_til_usb_device.on" title="ttbl.pc.delay_til_usb_device.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.pc.dlwps7">
<em class="property">class </em><code class="descclassname">ttbl.pc.</code><code class="descname">dlwps7</code><span class="sig-paren">(</span><em>_url</em>, <em>reboot_wait_s=0.5</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.dlwps7" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a power control interface to the Digital Logger’s Web
Power Switch 7</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>_url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>URL describing the unit and outlet number, in
the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">USER</span><span class="p">:</span><span class="n">PASSWORD</span><span class="nd">@HOST</span><span class="p">:</span><span class="n">PORT</span><span class="o">/</span><span class="n">OUTLETNUMBER</span>
</pre></div>
</div>
<p>where <cite>USER</cite> and <cite>PASSWORD</cite> are valid accounts set in the
Digital Logger’s Web Power Switch 7 administration interface
with access to the <cite>OUTLETNUMBER</cite>.</p>
</li>
<li><strong>reboot_wait</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – Seconds to wait in when power cycling an
outlet from off to on (defaults to 0.5s) or after powering up.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Access language documented at <a class="reference external" href="http://www.digital-loggers.com/http.html">http://www.digital-loggers.com/http.html</a>.</p>
<p>If you get an error like:</p>
<blockquote>
<div>Exception: Cannot find ‘&lt;!– state=(?P&lt;state&gt;[0-9a-z][0-9a-z]) lock=[0-9a-z][0-9a-z] –&gt;’ in power switch response</div></blockquote>
<p>this might be that you are going through a proxy that is messing
up things. In some cases the proxy was messing up the
authentication and imposing javascript execution that made the
driver fail.</p>
<dl class="method">
<dt id="ttbl.pc.dlwps7.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.dlwps7.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc.dlwps7.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.dlwps7.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.pc.dlwps7.on" title="ttbl.pc.dlwps7.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.pc.dlwps7.state_regex">
<code class="descname">state_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#ttbl.pc.dlwps7.state_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.dlwps7.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.dlwps7.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the power status for the outlet</p>
<p>The unit returns the power state when querying the
<code class="docutils literal notranslate"><span class="pre">/index.htm</span></code> path…as a comment inside the HTML body of the
respose. <em>Chuckle</em></p>
<p>So we look for:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!-- state=XY lock=ANY --&gt;
</pre></div>
</div>
<p><em>XY</em> is the hex bitmap of states against the outlet
number. <em>ANY</em> is the hex lock bitmap (outlets that can’t
change).</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.ipmi"></span><div class="section" id="controlling-targets-via-ipmi">
<h4>8.8.4.2. Controlling targets via IPMI<a class="headerlink" href="#controlling-targets-via-ipmi" title="Permalink to this headline">¶</a></h4>
<p>This module implements multiple objects that can be used to control a
target’s power or serial console via IPMI.</p>
<dl class="class">
<dt id="ttbl.ipmi.pci">
<em class="property">class </em><code class="descclassname">ttbl.ipmi.</code><code class="descname">pci</code><span class="sig-paren">(</span><em>hostname</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pci" title="Permalink to this definition">¶</a></dt>
<dd><p>Power controller to turn on/off a server via IPMI</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>bmc_hostname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – host name or IP address of the BMC
controller for the host whose power is to be controller.</li>
<li><strong>user</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) username to use to login</li>
<li><strong>password</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) password to use to login</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This is normally used as part of a power rail setup, where an
example configuration in /etc/ttbd-production/conf_*.py that would
configure the power switching of a machine that also has a serial
port would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span> <span class="s2">&quot;BMC&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">ipmi</span><span class="o">.</span><span class="n">pci</span><span class="p">(</span><span class="s2">&quot;bmc_admin:secret@server1.internal.net&quot;</span><span class="p">)</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">putting BMCs on an open network is not a good idea;
it is recommended they are only exposed to an
<a class="reference internal" href="05-RFAQs.html#separated-networks"><span class="std std-ref">infrastructure network</span></a></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params str hostname:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><em>USER[:PASSWORD]&#64;HOSTNAME</em> of where the IPMI BMC is
located; see <a class="reference internal" href="#commonl.password_get" title="commonl.password_get"><code class="xref py py-func docutils literal notranslate"><span class="pre">commonl.password_get()</span></code></a> for things <em>PASSWORD</em>
can be to obtain the password from service providers.</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.ipmi.pci.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pci.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.ipmi.pci.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pci.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.ipmi.pci.on" title="ttbl.ipmi.pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.ipmi.pci.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pci.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.ipmi.pci.on" title="ttbl.ipmi.pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.ipmi.pci.pre_power_pos_setup">
<code class="descname">pre_power_pos_setup</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pci.pre_power_pos_setup" title="Permalink to this definition">¶</a></dt>
<dd><p>If target’s <em>pos_mode</em> is set to <em>pxe</em>, tell the BMC to boot
off the network.</p>
<p>This is meant to be use as a pre-power-on hook (see
<a class="reference internal" href="#ttbl.power.interface" title="ttbl.power.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.interface</span></code></a> and
<a class="reference internal" href="#ttbl.test_target.power_on_pre_fns" title="ttbl.test_target.power_on_pre_fns"><code class="xref py py-data docutils literal notranslate"><span class="pre">ttbl.test_target.power_on_pre_fns</span></code></a>).</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.ipmi.pci_ipmitool">
<em class="property">class </em><code class="descclassname">ttbl.ipmi.</code><code class="descname">pci_ipmitool</code><span class="sig-paren">(</span><em>hostname</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pci_ipmitool" title="Permalink to this definition">¶</a></dt>
<dd><p>Power controller to turn on/off a server via IPMI</p>
<p>Same as <a class="reference internal" href="#ttbl.ipmi.pci" title="ttbl.ipmi.pci"><code class="xref py py-class docutils literal notranslate"><span class="pre">pci</span></code></a>, but executing <em>ipmitool</em> in the shell
instead of using a Python library.</p>
<dl class="method">
<dt id="ttbl.ipmi.pci_ipmitool.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pci_ipmitool.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.ipmi.pci_ipmitool.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pci_ipmitool.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.ipmi.pci_ipmitool.on" title="ttbl.ipmi.pci_ipmitool.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.ipmi.pci_ipmitool.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pci_ipmitool.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.ipmi.pci_ipmitool.on" title="ttbl.ipmi.pci_ipmitool.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.ipmi.pci_ipmitool.pre_power_pos_setup">
<code class="descname">pre_power_pos_setup</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pci_ipmitool.pre_power_pos_setup" title="Permalink to this definition">¶</a></dt>
<dd><p>If target’s <em>pos_mode</em> is set to <em>pxe</em>, tell the BMC to boot
off the network.</p>
<p>This is meant to be use as a pre-power-on hook (see
<a class="reference internal" href="#ttbl.power.interface" title="ttbl.power.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.interface</span></code></a> and
<a class="reference internal" href="#ttbl.test_target.power_on_pre_fns" title="ttbl.test_target.power_on_pre_fns"><code class="xref py py-data docutils literal notranslate"><span class="pre">ttbl.test_target.power_on_pre_fns</span></code></a>).</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.ipmi.pos_mode_c">
<em class="property">class </em><code class="descclassname">ttbl.ipmi.</code><code class="descname">pos_mode_c</code><span class="sig-paren">(</span><em>hostname</em>, <em>timeout=2</em>, <em>retries=3</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pos_mode_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Power controller to redirect a machine’s boot to network upon ON</p>
<p>This can be used in the power rail of a machine that can be
provisioned with <a class="reference internal" href="07-Architecture.html#provisioning-os"><span class="std std-ref">Provisioning OS</span></a>, instead
of using pre power-on hooks (such as
<a class="reference internal" href="#ttbl.ipmi.pci_ipmitool.pre_power_pos_setup" title="ttbl.ipmi.pci_ipmitool.pre_power_pos_setup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pci_ipmitool.pre_power_pos_setup()</span></code></a>).</p>
<p>When the target is being powered on, this will be called, and
based if the value of the <em>pos_mode</em> property is <em>pxe</em>, the IPMI
protocol will be used to tell the BMC to order the target to boot
off the network with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipmitool chassis bootparam set bootflag force_pxe
</pre></div>
</div>
<p>otherwise, it’ll force to boot off the local disk with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipmitool chassis bootparam set bootflag force_disk
</pre></div>
</div>
<p>Note that for this to be succesful and remove the chance of race
conditions, this has to be previous to the component that powers
on the machine via the BMC.</p>
<dl class="method">
<dt id="ttbl.ipmi.pos_mode_c.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pos_mode_c.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.ipmi.pos_mode_c.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pos_mode_c.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.ipmi.pos_mode_c.on" title="ttbl.ipmi.pos_mode_c.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.ipmi.pos_mode_c.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.pos_mode_c.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.ipmi.pos_mode_c.on" title="ttbl.ipmi.pos_mode_c.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.ipmi.sol_console_pc">
<em class="property">class </em><code class="descclassname">ttbl.ipmi.</code><code class="descname">sol_console_pc</code><span class="sig-paren">(</span><em>hostname</em>, <em>precheck_wait=0.5</em>, <em>chunk_size=5</em>, <em>interchunk_wait=0.1</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.sol_console_pc" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a serial port over IPMI’s Serial-Over-Lan protocol</p>
<p>This class implements two interfaces:</p>
<ul>
<li><p class="first">power interface: to start an IPMI SoL recorder in the
background as soon as the target is powered on.</p>
<p>The power interface is implemented by subclassing
<a class="reference internal" href="#ttbl.power.socat_pc" title="ttbl.power.socat_pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.socat_pc</span></code></a>, which starts <em>socat</em> as daemon to
serve as a data recorder and to pass data to the serial port
from the read file. It is configured to to start <em>ipmitool</em> with
the <em>sol activate</em> arguments which leaves it fowarding traffic
back and forth.</p>
<p>Anything read form the serial port is written to the
<em>console-NAME.read</em> file and anything written to it is written
to <em>console-NAME.write</em> file, which is sent to the serial port.</p>
</li>
<li><p class="first">console interface: interacts with the console interface by
exposing the data recorded in <em>console-NAME.read</em> file and
writing to the <em>console-NAME.write</em> file.</p>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params str hostname:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><em>USER[:PASSWORD]&#64;HOSTNAME</em> of where the IPMI BMC is
located</td>
</tr>
</tbody>
</table>
<p>Look at <a class="reference internal" href="#ttbl.console.generic_c" title="ttbl.console.generic_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.console.generic_c</span></code></a> for a description of
<em>chunk_size</em> and <em>interchunk_wait</em>. This is in general needed when
whatever is behind SSH is not doing flow control and we want the
server to slow down sending things.</p>
<p>For example, create an IPMI recoder console driver and insert it
into the power rail (its interface as power control makes it be
called to start/stop recording when the target powers on/off) and
then it is also registered as the target’s console:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sol0_pc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">serial_pc</span><span class="p">(</span><span class="n">console_file_name</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;power&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">sol0_pc</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;console&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">sol0</span> <span class="o">=</span> <span class="n">sol0_pc</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;sol0&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="ttbl.ipmi.sol_console_pc.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.sol_console_pc.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.ipmi.sol_console_pc.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.sol_console_pc.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.ipmi.sol_console_pc.on" title="ttbl.ipmi.sol_console_pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.ipmi.sol_console_pc.enable">
<code class="descname">enable</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.sol_console_pc.enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable a console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – console to enable</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.ipmi.sol_console_pc.disable">
<code class="descname">disable</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.sol_console_pc.disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable a console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to disable; if missing,
the default one.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.ipmi.sol_ssh_console_pc">
<em class="property">class </em><code class="descclassname">ttbl.ipmi.</code><code class="descname">sol_ssh_console_pc</code><span class="sig-paren">(</span><em>hostname</em>, <em>ssh_port=22</em>, <em>chunk_size=5</em>, <em>interchunk_wait=0.1</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.sol_ssh_console_pc" title="Permalink to this definition">¶</a></dt>
<dd><p>IPMI SoL over SSH console</p>
<p>This augments <a class="reference internal" href="#ttbl.console.ssh_pc" title="ttbl.console.ssh_pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.console.ssh_pc</span></code></a> in that it will first
disable the SOL connection to avoid conflicts with other users.</p>
<p>This forces the input into the SSH channel to the BMC to be
chunked each five bytes with a 0.1 second delay in between. This
seems to gives most BMCs a breather re flow control.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params str hostname:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><em>USER[:PASSWORD]&#64;HOSTNAME</em> of where the IPMI BMC is
located</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.ipmi.sol_ssh_console_pc.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ipmi.sol_ssh_console_pc.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-ttbl.raritan_emx"></span><dl class="class">
<dt id="ttbl.raritan_emx.pci">
<em class="property">class </em><code class="descclassname">ttbl.raritan_emx.</code><code class="descname">pci</code><span class="sig-paren">(</span><em>url</em>, <em>outlet_number</em>, <em>https_verify=True</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.raritan_emx.pci" title="Permalink to this definition">¶</a></dt>
<dd><p>Power control interface for the Raritan EMX family of PDUs (eg: PX3-*)</p>
<p>Tested with a PX3-5190R with FW v3.3.10.5-43736</p>
<p>In any place in the TCF server configuration where a power control
implementation is needed and served by this PDU, thus insert:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ttbl.raritan_emx</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">ttbl</span><span class="o">.</span><span class="n">raritan_emx</span><span class="o">.</span><span class="n">pci</span><span class="p">(</span><span class="s1">&#39;https://USER:PASSWORD@HOSTNAME&#39;</span><span class="p">,</span> <span class="n">OUTLET</span><span class="c1">#)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>URL to access the PDU in the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="p">[</span><span class="n">USERNAME</span><span class="p">:</span><span class="n">PASSWORD</span><span class="o">@</span><span class="p">]</span><span class="n">HOSTNAME</span>
</pre></div>
</div>
<p>Note the login credentials are optional, but must be matching
whatever is configured in the PDU for HTTP basic
authentication and permissions to change outlet state.</p>
</li>
<li><strong>outlet</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the outlet in the PDU to control;
this is an integer 1-N (N varies depending on the PDU model)</li>
<li><strong>https_verify</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional, default <em>True</em>) do or
do not HTTPS certificate verification.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The RPC implementation is documented in
<a class="reference external" href="https://help.raritan.com/json-rpc/emx/v3.4.0">https://help.raritan.com/json-rpc/emx/v3.4.0</a>; while this driver
uses the Raritan SDK driver, probably this is overkill–we could
do the calls using JSON-RPC directly using jsonrpclib to avoid
having to install the SDK, which is not packaged for easy
redistribution and install.</p>
<p id="raritan-emx-setup"><strong>Bill of materials</strong></p>
<ul class="simple">
<li>a Raritan EMX-compatible PDU (such as the PX3)</li>
<li>a network cable</li>
<li>a connection to a network switch to which the server is also
connected (<em>nsN</em>) – ideally this shall be an infrastructure
network, isolated from a general use network and any test
networks.</li>
</ul>
<p><strong>System setup</strong></p>
<p>In the server</p>
<ol class="arabic">
<li><p class="first">Install the Raritan’s SDK (it is not available as a PIP
package) from <a class="reference external" href="https://www.raritan.com/support/product/emx">https://www.raritan.com/support/product/emx</a>
(EMX JSON-RPC SDK):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ wget http://cdn.raritan.com/download/EMX/version-3.5.0/EMX_JSON_RPC_SDK_3.5.0_45371.zip
$ unzip -x EMX_JSON_RPC_SDK_3.5.0_45371.zip
$ install -m 0755 -o root -g root -d /usr/local/lib/python2.7/site-packages/raritan
$ cp -a emx-json-rpc-sdk-030500-45371/emx-python-api/raritan/* /usr/local/lib/python2.7/site-packages/raritan
</pre></div>
</div>
</li>
<li><p class="first">As the Raritan SDK had to be installed manually away from PIP
or distro package management, ensurePython to looks into
<em>/usr/local/lib/python2.7/site-packages</em> for packages.</p>
<p>Add your server configuration in a
<em>/etc/ttbd-production/conf_00_paths.py</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;/usr/local/lib/python2.7/site-packages&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>so it is parsed before any configuration that tries to import
<a class="reference internal" href="#module-ttbl.raritan_emx" title="ttbl.raritan_emx"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ttbl.raritan_emx</span></code></a>.</p>
</li>
</ol>
<p><strong>Connecting the PDU</strong></p>
<ul class="simple">
<li>Connect the PDU to the network</li>
<li>Assign the right IP and ensure name resolution works; convention
is to use a short name <em>spN</em> (for Switch Power number <em>N</em>)</li>
<li>Configure a username/password with privilege to set the outlet
state</li>
<li>Configure the system to power up all outlets after power loss
(this is needed so the infrastructure can bring itself up
without intervention, as for example it is a good practice to
connect the servers to switched outlets so they can be remotely
controlled).</li>
</ul>
<dl class="method">
<dt id="ttbl.raritan_emx.pci.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>_target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.raritan_emx.pci.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.raritan_emx.pci.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>_target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.raritan_emx.pci.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.raritan_emx.pci.on" title="ttbl.raritan_emx.pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.raritan_emx.pci.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>_target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.raritan_emx.pci.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.raritan_emx.pci.on" title="ttbl.raritan_emx.pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.apc"></span><dl class="class">
<dt id="ttbl.apc.pci">
<em class="property">class </em><code class="descclassname">ttbl.apc.</code><code class="descname">pci</code><span class="sig-paren">(</span><em>hostname</em>, <em>outlet</em>, <em>oid=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.apc.pci" title="Permalink to this definition">¶</a></dt>
<dd><p>Power control driver for APC PDUs using SNMP</p>
<p>This is a very hackish implementation that attempts to reuqire the
least setup possible. It hardcodes the OIDs and MIBs because APC’s
MIBs are not publicly available and the setup
becomes…complicated (please contribute a better one if you can help)</p>
<p>To use in any place where a power control element is needed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ttbl.apc</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">apc</span><span class="o">.</span><span class="n">pci</span><span class="p">(</span><span class="s2">&quot;HOSTNAME&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>for doing power control on APC PDU <em>HOSTNAME</em> on outlet <em>4</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>hostname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – IP address or hostname of the PDU</li>
<li><strong>outlet</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – number of the outlet to control</li>
<li><strong>oid</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) Base SNMP OID for the unit. To find it,</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Tested with:</p>
<ul class="simple">
<li>AP7930</li>
</ul>
<p>References used:</p>
<ul class="simple">
<li><a class="reference external" href="https://tobinsramblings.wordpress.com/2011/05/03/snmp-tutorial-apc-pdus/">https://tobinsramblings.wordpress.com/2011/05/03/snmp-tutorial-apc-pdus/</a></li>
<li><a class="reference external" href="http://mibs.snmplabs.com/asn1/POWERNET-MIB">http://mibs.snmplabs.com/asn1/POWERNET-MIB</a></li>
<li><a class="reference external" href="https://www.apc.com/shop/us/en/products/POWERNET-MIB-V4-3-1/P-SFPMIB431">https://www.apc.com/shop/us/en/products/POWERNET-MIB-V4-3-1/P-SFPMIB431</a></li>
<li><a class="reference external" href="https://download.schneider-electric.com/files?p_enDocType=Firmware+-+Released&amp;p_Doc_Ref=APC_POWERNETMIB_431&amp;p_File_Name=powernet431.mib">https://download.schneider-electric.com/files?p_enDocType=Firmware+-+Released&amp;p_Doc_Ref=APC_POWERNETMIB_431&amp;p_File_Name=powernet431.mib</a></li>
</ul>
<p><strong>System setup</strong></p>
<ul>
<li><p class="first">configure an IP address (static, DHCP) to the APC PDU</p>
</li>
<li><p class="first">in the web configuration:</p>
<blockquote>
<div><ul class="simple">
<li>Administration &gt; Network &gt; SNMPv1 &gt; access: enable</li>
<li>Administration &gt; Network &gt; SNMPv1 &gt; access control: set the
community name <em>private</em> to <em>Access Type</em> <em>write +</em></li>
</ul>
</div></blockquote>
<p>This driver currently supports no port, username or passwords –
it is recommended to place these units in a private protected
network until such support is added.</p>
</li>
</ul>
<p><strong>Finding OIDs, etc</strong></p>
<p>FIXME: incomplete
This is only need in a system to find out numbers, not needed in
the servers:</p>
<ul>
<li><p class="first">Install the POWERNET-MIB:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir -p ~/.snmp/mibs/
$ wget http://mibs.snmplabs.com/asn1/POWERNET-MIB -O ~/.snmp/mibs/
$ echo mibs POWERNET-MIB &gt;&gt; ~/.snmp/snmp.conf
</pre></div>
</div>
</li>
</ul>
<p>Find OID for querying number of outlets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ snmptranslate -On POWERNET-MIB::sPDUOutletControlTableSize.0
.1.3.6.1.4.1.318.1.1.4.4.1.0
</pre></div>
</div>
<p>Find OID for controlling outlet #1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ snmptranslate -On POWERNET-MIB::sPDUOutletCtl.1
.1.3.6.1.4.1.318.1.1.4.4.2.1.3.1
</pre></div>
</div>
<dl class="attribute">
<dt id="ttbl.apc.pci.table_size">
<code class="descname">table_size</code><em class="property"> = [4, 1, 0]</em><a class="headerlink" href="#ttbl.apc.pci.table_size" title="Permalink to this definition">¶</a></dt>
<dd><p>MIB for the command to list the number of tablets</p>
<p>Obtained with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ snmptranslate -On POWERNET-MIB::sPDUOutletControlTableSize.0
.1.3.6.1.4.1.318.1.1.4.4.1.0
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.apc.pci.pdu_outlet_ctl_prefix">
<code class="descname">pdu_outlet_ctl_prefix</code><em class="property"> = [4, 2, 1, 3]</em><a class="headerlink" href="#ttbl.apc.pci.pdu_outlet_ctl_prefix" title="Permalink to this definition">¶</a></dt>
<dd><p>MIB for the command to control outlets</p>
<p>Obtained with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ snmptranslate -On POWERNET-MIB::sPDUOutletCtl.1
.1.3.6.1.4.1.318.1.1.4.4.2.1.3.1
</pre></div>
</div>
<p>the last digit is the outlet number, 1..N.</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.apc.pci.oid">
<code class="descname">oid</code><em class="property"> = [1, 3, 6, 1, 4, 1, 318, 1, 1, 4]</em><a class="headerlink" href="#ttbl.apc.pci.oid" title="Permalink to this definition">¶</a></dt>
<dd><p>Main OID for the APC PDU (this can be changed with the <em>oid</em>
parameter to the constructor)</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.apc.pci.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.apc.pci.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.apc.pci.on" title="ttbl.apc.pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.apc.pci.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.apc.pci.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.apc.pci.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.apc.pci.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.apc.pci.on" title="ttbl.apc.pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.pc_ykush"></span><dl class="class">
<dt id="ttbl.pc_ykush.ykush">
<em class="property">class </em><code class="descclassname">ttbl.pc_ykush.</code><code class="descname">ykush</code><span class="sig-paren">(</span><em>ykush_serial</em>, <em>port</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.ykush" title="Permalink to this definition">¶</a></dt>
<dd><p>A power control implementation using an YKUSH switchable hub
<a class="reference external" href="https://www.yepkit.com/products/ykush">https://www.yepkit.com/products/ykush</a></p>
<p>This is mainly devices that are USB powered and the ykush hub
is used to control the power to the ports.</p>
<p>Note this devices appears as a child connected to the YKUSH
hub, with vendor/device IDs 0x04d8:f2f7 (Microchip Technology)</p>
<p>You can find the right one with <cite>lsusb.py -ciu</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usb1</span>             <span class="mi">1</span><span class="n">d6b</span><span class="p">:</span><span class="mi">0002</span> <span class="mi">09</span>  <span class="mf">2.00</span>  <span class="mi">480</span><span class="n">MBit</span><span class="o">/</span><span class="n">s</span> <span class="mi">0</span><span class="n">mA</span> <span class="mi">1</span><span class="n">IF</span>  <span class="p">(</span><span class="n">Linux</span> <span class="mf">4.3</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="mf">300.</span><span class="n">fc23</span><span class="o">.</span><span class="n">x86_64</span> <span class="n">xhci</span><span class="o">-</span><span class="n">hcd</span> <span class="n">xHCI</span> <span class="n">Host</span> <span class="n">Controller</span> <span class="mi">0000</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">14.0</span><span class="p">)</span> <span class="n">hub</span>
 <span class="mi">1</span><span class="o">-</span><span class="mi">2</span>             <span class="mi">2001</span><span class="p">:</span><span class="n">f103</span> <span class="mi">09</span>  <span class="mf">2.00</span>  <span class="mi">480</span><span class="n">MBit</span><span class="o">/</span><span class="n">s</span> <span class="mi">0</span><span class="n">mA</span> <span class="mi">1</span><span class="n">IF</span>  <span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="n">Link</span> <span class="n">Corp</span><span class="o">.</span> <span class="n">DUB</span><span class="o">-</span><span class="n">H7</span> <span class="mi">7</span><span class="o">-</span><span class="n">port</span> <span class="n">USB</span> <span class="mf">2.0</span> <span class="n">hub</span><span class="p">)</span> <span class="n">hub</span>
  <span class="mi">1</span><span class="o">-</span><span class="mf">2.5</span>          <span class="mi">0424</span><span class="p">:</span><span class="mi">2514</span> <span class="mi">09</span>  <span class="mf">2.00</span>  <span class="mi">480</span><span class="n">MBit</span><span class="o">/</span><span class="n">s</span> <span class="mi">2</span><span class="n">mA</span> <span class="mi">1</span><span class="n">IF</span>  <span class="p">(</span><span class="n">Standard</span> <span class="n">Microsystems</span> <span class="n">Corp</span><span class="o">.</span> <span class="n">USB</span> <span class="mf">2.0</span> <span class="n">Hub</span><span class="p">)</span> <span class="n">hub</span>
   <span class="mi">1</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">4</span>       <span class="mi">04</span><span class="n">d8</span><span class="p">:</span><span class="n">f2f7</span> <span class="mi">00</span>  <span class="mf">2.00</span>   <span class="mi">12</span><span class="n">MBit</span><span class="o">/</span><span class="n">s</span> <span class="mi">100</span><span class="n">mA</span> <span class="mi">1</span><span class="n">IF</span>  <span class="p">(</span><span class="n">Yepkit</span> <span class="n">Lda</span><span class="o">.</span> <span class="n">YKUSH</span> <span class="n">YK20345</span><span class="p">)</span>
    <span class="mi">1</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">4</span><span class="p">:</span><span class="mf">1.0</span>   <span class="p">(</span><span class="n">IF</span><span class="p">)</span> <span class="mi">03</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="mi">2</span><span class="n">EPs</span> <span class="p">(</span><span class="n">Human</span> <span class="n">Interface</span> <span class="n">Device</span><span class="p">:</span><span class="n">No</span> <span class="n">Subclass</span><span class="p">:</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the <em>Yepkit Ltd, YK20345</em>; <em>YK20345</em> is the serial number.</p>
<p>To avoid permission issues:</p>
<ul>
<li><p class="first">choose a Unix group that the daemon will be running under</p>
</li>
<li><p class="first">add a UDEV rule to <code class="docutils literal notranslate"><span class="pre">/etc/udev/rules.d/90-tcf.rules</span></code> (or
other name):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># YKUSH power switch hubs</span>
<span class="n">SUBSYSTEM</span><span class="o">==</span><span class="s2">&quot;usb&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">idVendor</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;04d8&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">idProduct</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;f2f7&quot;</span><span class="p">,</span>               <span class="n">GROUP</span><span class="o">=</span><span class="s2">&quot;GROUPNAME&quot;</span><span class="p">,</span> <span class="n">MODE</span> <span class="o">=</span> <span class="s2">&quot;660&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">restart UDEV, replug your hubs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo udevadm control --reload-rules
</pre></div>
</div>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Serial number of the ykush’s control
device.</li>
<li><strong>port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – Port number in the hub (one-based)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="exception">
<dt id="ttbl.pc_ykush.ykush.notfound_e">
<em class="property">exception </em><code class="descname">notfound_e</code><a class="headerlink" href="#ttbl.pc_ykush.ykush.notfound_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.pc_ykush.ykush.backend">
<code class="descname">backend</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.pc_ykush.ykush.backend" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc_ykush.ykush.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.ykush.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc_ykush.ykush.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.ykush.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.pc_ykush.ykush.on" title="ttbl.pc_ykush.ykush.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc_ykush.ykush.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.ykush.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.pc_ykush.ykush.on" title="ttbl.pc_ykush.ykush.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc_ykush.ykush.plug">
<code class="descname">plug</code><span class="sig-paren">(</span><em>target</em>, <em>_thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.ykush.plug" title="Permalink to this definition">¶</a></dt>
<dd><p>Plug <em>thing</em> into <em>target</em></p>
<p>Caller owns both <em>target</em> and <em>thing</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to plug</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to plug into <em>target</em></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.pc_ykush.ykush.unplug">
<code class="descname">unplug</code><span class="sig-paren">(</span><em>target</em>, <em>_thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.ykush.unplug" title="Permalink to this definition">¶</a></dt>
<dd><p>Unplug <em>thing</em> from <em>target</em></p>
<p>Caller owns <em>target</em> (not <em>thing</em> necessarily)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to unplug from</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to unplug</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.usbrly08b"></span><dl class="class">
<dt id="ttbl.usbrly08b.rly08b">
<em class="property">class </em><code class="descclassname">ttbl.usbrly08b.</code><code class="descname">rly08b</code><span class="sig-paren">(</span><em>serial_number</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.rly08b" title="Permalink to this definition">¶</a></dt>
<dd><p>A power control implementation for the USB-RLY08B relay controller
<a class="reference external" href="https://www.robot-electronics.co.uk/htm/usb_rly08btech.htm">https://www.robot-electronics.co.uk/htm/usb_rly08btech.htm</a>.</p>
<p>This serves as base for other drivers to implement <a class="reference internal" href="#ttbl.usbrly08b.pc" title="ttbl.usbrly08b.pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">per</span>
<span class="pre">relay</span> <span class="pre">power</span> <span class="pre">controllers</span></code></a>, <a class="reference internal" href="#ttbl.usbrly08b.plugger" title="ttbl.usbrly08b.plugger"><code class="xref py py-class docutils literal notranslate"><span class="pre">USB</span> <span class="pre">pluggers</span> <span class="pre">as</span> <span class="pre">*thing*</span> <span class="pre">or</span>
<span class="pre">power</span> <span class="pre">controllers</span></code></a>.</p>
<p>This device offers eight relays for AC and DC. The relays being on
or off are controlled by a byte-oriented serial protocol over an
FTDI chip that shows as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lsusb.py -iu
...
1-1.1.1       04d8:ffee 02  2.00   12MBit/s 100mA 2IFs (Devantech Ltd. USB-RLY08 00023456)
   1-1.1.1:1.0   (IF) 02:02:01 1EP  (Communications:Abstract (modem):AT-commands (v.25ter)) cdc_acm tty/ttyACM0
   1-1.1.1:1.1   (IF) 0a:00:00 2EPs (CDC Data:) cdc_acm
...
</pre></div>
</div>
<p>Note the <em>00023456</em> is the serial number.</p>
<p>To avoid permission issues, it can either:</p>
<ul>
<li><p class="first">The default rules in most Linux platforms will make the
device node owned by group <em>dialout</em>, so make the daemon
have that supplementary GID.</p>
</li>
<li><p class="first">add a UDEV rule to <code class="docutils literal notranslate"><span class="pre">/etc/udev/rules.d/90-ttbd.rules</span></code> (or
other name):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;tty&quot;</span><span class="p">,</span> <span class="n">ENV</span><span class="p">{</span><span class="n">ID_SERIAL_SHORT</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;00023456&quot;</span><span class="p">,</span>           <span class="n">GROUP</span><span class="o">=</span><span class="s2">&quot;GROUPNAME&quot;</span><span class="p">,</span> <span class="n">MODE</span> <span class="o">=</span> <span class="s2">&quot;660&quot;</span>
</pre></div>
</div>
<p>restart <em>udev*</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo udevadm control --reload-rules
</pre></div>
</div>
<p>replug your hubs so the rule is set.</p>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Serial number of the relay’s control
device.</li>
<li><strong>relay</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the relay to control (1-8)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="exception">
<dt id="ttbl.usbrly08b.rly08b.not_found_e">
<em class="property">exception </em><code class="descname">not_found_e</code><a class="headerlink" href="#ttbl.usbrly08b.rly08b.not_found_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.usbrly08b.rly08b.backend">
<code class="descname">backend</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.usbrly08b.rly08b.backend" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.usbrly08b.pc">
<em class="property">class </em><code class="descclassname">ttbl.usbrly08b.</code><code class="descname">pc</code><span class="sig-paren">(</span><em>serial_number</em>, <em>relay</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.pc" title="Permalink to this definition">¶</a></dt>
<dd><p>Power control implementation that uses a relay to close/open a
circuit on on/off</p>
<dl class="method">
<dt id="ttbl.usbrly08b.pc.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.pc.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.pc.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.pc.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.usbrly08b.pc.on" title="ttbl.usbrly08b.pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.pc.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.pc.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.usbrly08b.pc.on" title="ttbl.usbrly08b.pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.usbrly08b.button_c">
<em class="property">class </em><code class="descclassname">ttbl.usbrly08b.</code><code class="descname">button_c</code><span class="sig-paren">(</span><em>serial_number</em>, <em>relay</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.button_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a button press by closing/opening a relay circuit</p>
<dl class="method">
<dt id="ttbl.usbrly08b.button_c.press">
<code class="descname">press</code><span class="sig-paren">(</span><em>target</em>, <em>button</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.button_c.press" title="Permalink to this definition">¶</a></dt>
<dd><p>Press a target’s button</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where the button is</li>
<li><strong>button</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of button</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.button_c.release">
<code class="descname">release</code><span class="sig-paren">(</span><em>target</em>, <em>button</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.button_c.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release a target’s button</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where the button is</li>
<li><strong>button</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of button</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.usbrly08b.plugger">
<em class="property">class </em><code class="descclassname">ttbl.usbrly08b.</code><code class="descname">plugger</code><span class="sig-paren">(</span><em>serial_number</em>, <em>bank</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.plugger" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a USB multiplexor/plugger that allows a DUT to be
plugged to Host B and to Host A when unplugged. It follows it can
work as a USB cutter if Host A is disconnected.</p>
<p>It also implements a power control implementation, so when powered
off, it plugs-to-Host-B and when powered on, it
plugs-to-host-A. Likewise, if Host B is disconnected, when off it
is effectively disconnected. This serves to for example, connect a
USB storage drive to a target that will be able to access it when
turned on and when off, it can be connected to another machine
that can, eg: use it to flash software.</p>
<p>This uses a <a class="reference internal" href="#ttbl.usbrly08b.rly08b" title="ttbl.usbrly08b.rly08b"><code class="xref py py-class docutils literal notranslate"><span class="pre">rly08b</span></code></a> relay bank to do the switching.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number of the USB-RLY8B
device used to control</li>
<li><strong>bank</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – bank of relays to use; bank 0 are relays 1-4,
bank 1 are relays 5-8. Note below for connection information.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>System setup details</strong></p>
<ul>
<li><p class="first">A USB connection is four cables: VCC (red), D+ (white), D-
(green), GND (black) plus a shielding wrapping it all.</p>
</li>
<li><p class="first">A relay has three terminals; NO, C and NC.
- ON means C and NC are connected
- OFF means C and NO are connected</p>
<dl class="docutils">
<dt>(it is recommended to label the cable connected to NO as</dt>
<dd><p class="first last">OFF/PLUGGED and the one to NC as ON/UNPLUGGED)</p>
</dd>
</dl>
</li>
<li><p class="first">We use the USB-RLY8B, which has eight individual relays, so we can
switch two devices between two USB hosts each.</p>
</li>
</ul>
<p>We connect the DUT’s cables and host cables as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="7%" />
<col width="26%" />
<col width="7%" />
<col width="26%" />
<col width="7%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DUT1</td>
<td>pin</td>
<td>Host A1/ON</td>
<td>pin</td>
<td>Host B1/OFF</td>
<td>pin</td>
</tr>
<tr class="row-even"><td>VCC (red)</td>
<td>1C</td>
<td>VCC (red)</td>
<td>1NO</td>
<td>VCC (red)</td>
<td>1NC</td>
</tr>
<tr class="row-odd"><td>D+  (white)</td>
<td>2C</td>
<td>D+  (white)</td>
<td>2NO</td>
<td>D+  (white)</td>
<td>2NC</td>
</tr>
<tr class="row-even"><td>D-  (green)</td>
<td>3C</td>
<td>D-  (green)</td>
<td>3NO</td>
<td>D-  (green)</td>
<td>3NC</td>
</tr>
<tr class="row-odd"><td>GND (black)</td>
<td>4C</td>
<td>GND (black)</td>
<td>4NO</td>
<td>GND (black)</td>
<td>4NC</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="7%" />
<col width="26%" />
<col width="7%" />
<col width="26%" />
<col width="7%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DUT2</td>
<td>pin</td>
<td>Host A2/ON</td>
<td>pin</td>
<td>Host B1/OFF</td>
<td>pin</td>
</tr>
<tr class="row-even"><td>VCC (red)</td>
<td>5C</td>
<td>VCC (red)</td>
<td>5NO</td>
<td>VCC (red)</td>
<td>5NC</td>
</tr>
<tr class="row-odd"><td>D+  (white)</td>
<td>6C</td>
<td>D+  (white)</td>
<td>6NO</td>
<td>D+  (white)</td>
<td>6NC</td>
</tr>
<tr class="row-even"><td>D-  (green)</td>
<td>7C</td>
<td>D-  (green)</td>
<td>7NO</td>
<td>D-  (green)</td>
<td>7NC</td>
</tr>
<tr class="row-odd"><td>GND (black)</td>
<td>8C</td>
<td>GND (black)</td>
<td>8NO</td>
<td>GND (black)</td>
<td>8NC</td>
</tr>
</tbody>
</table>
<p>For example, to switch an Arduino 101 between a NUC and the TTBD
server that flashes and controls it:</p>
<ul class="simple">
<li>DUT (C) is our Arduino 101,</li>
<li>Host B (NC) is another NUC machine in the TCF infrastructure</li>
<li>Host A (NO) is the TTBD server (via the YKUSH port)</li>
</ul>
<p>For a pure USB cutter (where we don’t need the connection to a
TTBD server on MCU boards that expose a separate debugging cable
for power and flashing), we’d connect the USB port like:</p>
<ul class="simple">
<li>DUT (C) is the MCU’s USB port</li>
<li>Host B (NC) is the NUC machine in the TCF infrastructure</li>
<li>Host A (NO) is left disconnected</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>switching <em>ONLY</em> the VCC and GND connections (always
leave D+ and D- connected the the Host A to avoid Host B
doing a data connection and only being used to supply
power) does not work.</p>
<p class="last">Host A still detects the power differential in D+ D- and
thought there was a device; tried to enable it, failed
and disabled the port.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We can’t turn them on or off at the same time because
the HW doesn’t allow to set a mask and we could override
settings for the other ports we are not controlling
here–another server process might be tweaking the other
ports.</p>
</div>
<p>** Configuration details **</p>
<p>Example:</p>
<blockquote>
<div><p>To connect a USB device from system A to system B, so power off
means connected to B, power-on connected to A, add to the
configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">inteface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>     <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">plugger</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
</pre></div>
</div>
<p>Thus to connect to system B:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf acquire devicename
$ tcf power-off devicename
</pre></div>
</div>
<p>Thus to connect to system A:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf power-on devicename
</pre></div>
</div>
</div></blockquote>
<p>Example:</p>
<blockquote>
<div><p>If system B is the ttbd server, then you can refine it to test
the USB device is connecting/disconnecting.</p>
<p>To connect a USB drive to a target before the target is powered
on (in this example, a NUC mini-PC with a USB drive connected
to boot off it, the configuration block would be as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># Ensure the dongle is / has been connected to the server</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay_til_usb_device</span><span class="p">(</span><span class="s2">&quot;7FA50D00FFFF00DD&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                 <span class="n">when_powering_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                 <span class="n">want_connected</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">plugger</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># Ensure the dongle disconnected from the server</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay_til_usb_device</span><span class="p">(</span><span class="s2">&quot;7FA50D00FFFF00DD&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                 <span class="n">when_powering_on</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                 <span class="n">want_connected</span> <span class="o">=</span> <span class="kc">False</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># power on the target</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://admin:1234@SPNAME/SPPORT&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># let it boot</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
</pre></div>
</div>
<p>Note that the serial number <em>7FA50D00FFFF00DD</em> is that of the
USB drive and <em>00023456</em> is the serial number of the USB-RLY8b
board which implements the switching (in this case we use bank 0
of relays, from 1 to 4).</p>
</div></blockquote>
<p>Example:</p>
<p>An Arduino 101 is connected to a NUC mini-PC as a USB device using
the <em>thing</em> interface that we can control from a script or command line:</p>
<p>In this case we create an <em>interconnect</em> that wraps all the
targets together (the Arduino 101, the NUC) to indicate they
operate together and the configuration block would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">interconnect_add</span><span class="p">(</span><span class="n">ttbl</span><span class="o">.</span><span class="n">test_target</span><span class="p">(</span><span class="s2">&quot;usb__nuc-02__a101-04&quot;</span><span class="p">),</span>
                            <span class="n">ic_type</span> <span class="o">=</span> <span class="s2">&quot;usb__host__device&quot;</span><span class="p">)</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;nuc-02&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_to_interconnect</span><span class="p">(</span><span class="s1">&#39;usb__nuc-02__a101-04&#39;</span><span class="p">)</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;a101-04&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_to_interconnect</span><span class="p">(</span><span class="s1">&#39;usb__nuc-02__a101-04&#39;</span><span class="p">)</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;nuc-02&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">thing_add</span><span class="p">(</span><span class="s1">&#39;a101-04&#39;</span><span class="p">,</span>
                                        <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">plugger</span><span class="p">(</span><span class="s2">&quot;00033085&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>Where <em>00033085</em> is the serial number for the USB-RLY8b which
implements the USB plugging/unplugging (in this case we use bank 1
of relays, from 5 to 8)</p>
<dl class="method">
<dt id="ttbl.usbrly08b.plugger.plug">
<code class="descname">plug</code><span class="sig-paren">(</span><em>target</em>, <em>_thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.plugger.plug" title="Permalink to this definition">¶</a></dt>
<dd><p>Plug <em>thing</em> into <em>target</em></p>
<p>Caller owns both <em>target</em> and <em>thing</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to plug</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to plug into <em>target</em></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.plugger.unplug">
<code class="descname">unplug</code><span class="sig-paren">(</span><em>target</em>, <em>_thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.plugger.unplug" title="Permalink to this definition">¶</a></dt>
<dd><p>Unplug <em>thing</em> from <em>target</em></p>
<p>Caller owns <em>target</em> (not <em>thing</em> necessarily)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to unplug from</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to unplug</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.plugger.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.plugger.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.plugger.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.plugger.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.usbrly08b.plugger.on" title="ttbl.usbrly08b.plugger.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.plugger.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>_thing=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.plugger.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to unplug from</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to unplug</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>True</em> if <em>thing</em> is connected to <em>target</em>, <em>False</em>
otherwise.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<p>Daemons that can be started in the server as part of a power rail:</p>
<span class="target" id="module-ttbl.dhcp"></span><div class="section" id="power-control-module-to-start-dhcp-daemon-when-a-network-is-powered-on">
<h4>8.8.4.3. Power control module to start DHCP daemon when a network is powered on<a class="headerlink" href="#power-control-module-to-start-dhcp-daemon-when-a-network-is-powered-on" title="Permalink to this headline">¶</a></h4>
<dl class="data">
<dt id="ttbl.dhcp.tftp_dir">
<code class="descclassname">ttbl.dhcp.</code><code class="descname">tftp_dir</code><em class="property"> = '/var/lib/tftpboot'</em><a class="headerlink" href="#ttbl.dhcp.tftp_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Directory where the TFTP tree is located</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.dhcp.syslinux_path">
<code class="descclassname">ttbl.dhcp.</code><code class="descname">syslinux_path</code><em class="property"> = '/usr/share/syslinux'</em><a class="headerlink" href="#ttbl.dhcp.syslinux_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Directory where the syslinux tree is located</p>
</dd></dl>

<dl class="function">
<dt id="ttbl.dhcp.template_rexpand">
<code class="descclassname">ttbl.dhcp.</code><code class="descname">template_rexpand</code><span class="sig-paren">(</span><em>text</em>, <em>kws</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.dhcp.template_rexpand" title="Permalink to this definition">¶</a></dt>
<dd><p>Expand Python keywords in a template repeatedly until none are
left.</p>
<p>if there are substitution fields in the config text,
replace them with the keywords; repeat until there are none left
(as some of the keywords might bring in new substitution keys).</p>
<p>Stop after ten iterations</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.dhcp.pxe_architectures">
<code class="descclassname">ttbl.dhcp.</code><code class="descname">pxe_architectures</code><em class="property"> = {'efi-bc': {'copy_files': ['/usr/share/syslinux/efi64/', '/home/ttbd/public_html/x86_64/vmlinuz-tcf-live', '/home/ttbd/public_html/x86_64/initramfs-tcf-live'], 'boot_filename': 'syslinux.efi', 'rfc_code': '00:07'}, 'efi-x86_64': {'copy_files': ['/usr/share/syslinux/efi64/', '/home/ttbd/public_html/x86_64/vmlinuz-tcf-live', '/home/ttbd/public_html/x86_64/initramfs-tcf-live'], 'boot_filename': 'syslinux.efi', 'rfc_code': '00:09'}, 'x86': {'copy_files': ['/usr/share/syslinux/lpxelinux.0', '/usr/share/syslinux/ldlinux.c32'], 'boot_filename': 'lpxelinux.0', 'rfc_code': '00:00'}}</em><a class="headerlink" href="#ttbl.dhcp.pxe_architectures" title="Permalink to this definition">¶</a></dt>
<dd><p>List of PXE architectures we support</p>
<p>This is a dictionary keyed by architecture name (ARCHNAME); the
value is a dictionary keyed by the following keywords</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">rfc_code</span></code> (str) a hex string in the format “HH:HH”,
documenting a PXE architecture as described in
https://datatracker.ietf.org/doc/rfc4578/?include_text=1 (section 2.1).</p>
<p>This is used directly for the ISC DHCP configuration of the
<em>option architecture-type</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Code</span>  <span class="n">Arch</span> <span class="n">Name</span>   <span class="n">Description</span>
<span class="o">-----</span> <span class="o">-----------</span> <span class="o">--------------------</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">x86</span>         <span class="n">Intel</span> <span class="n">x86PC</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">01</span>             <span class="n">NEC</span><span class="o">/</span><span class="n">PC98</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">02</span>             <span class="n">EFI</span> <span class="n">Itanium</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">03</span>             <span class="n">DEC</span> <span class="n">Alpha</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">04</span>             <span class="n">Arc</span> <span class="n">x86</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">05</span>             <span class="n">Intel</span> <span class="n">Lean</span> <span class="n">Client</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">06</span>             <span class="n">EFI</span> <span class="n">IA32</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">07</span> <span class="n">efi</span><span class="o">-</span><span class="n">bc</span>      <span class="n">EFI</span> <span class="n">BC</span>     <span class="p">(</span><span class="n">byte</span> <span class="n">code</span><span class="p">)</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">08</span>             <span class="n">EFI</span> <span class="n">Xscale</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span> <span class="n">efi</span><span class="o">-</span><span class="n">x86_64</span>  <span class="n">EFI</span> <span class="n">x86</span><span class="o">-</span><span class="mi">64</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">boot_filename</span></code> (str): name of the file sent over PXE to a
target when it asks what to boot. This will be converted to
TFTP path <code class="docutils literal notranslate"><span class="pre">/ttbd-INSTANCE/ARCHNAME/BOOT_FILENAME</span></code> which will be
requested by the target.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">copy_files</span></code> (list of str): list of files or directories that
have to copy/rsynced to <code class="docutils literal notranslate"><span class="pre">TFTPDIR/ttbd-INSTANCE/ARCHNAME</span></code>;
everything needed for the client to boot <code class="docutils literal notranslate"><span class="pre">BOOT_FILENAME</span></code> has to
be listed here for them to be copied and made available over TFTP.</p>
<p>This allows to patch this in runtime based on the site
configuration and Linux distribution</p>
</li>
</ul>
<p>The DHCP driver, when powered on, will create
<code class="docutils literal notranslate"><span class="pre">TFTPDIR/ttbd-INSTANCE/ARCHNAME</span></code>, rsync the files or trees in
<code class="docutils literal notranslate"><span class="pre">copy_files</span></code> to it and then symlink
<code class="docutils literal notranslate"><span class="pre">TFTPDIR/ttbd-INSTANCE/ARCHNAME/pxelinux.cfg</span></code> to
<code class="docutils literal notranslate"><span class="pre">TFTPDIR/ttbd-INSTANCE/pxelinux.cfg</span></code> (as the configurations are
common to all the architectures).</p>
<p>To extend in the system configuration, add to any server
configuration file in <code class="docutils literal notranslate"><span class="pre">/etc/ttbd-INSTANCE/conf_*.py</span></code>; for
example, to use another bootloader for eg, <code class="docutils literal notranslate"><span class="pre">x86</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ttbl.dhcp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">dhcp</span><span class="o">.</span><span class="n">pxe_architectures</span><span class="p">[</span><span class="s1">&#39;x86&#39;</span><span class="p">][</span><span class="s1">&#39;copy_files&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;/usr/local/share/syslinux/lpxelinux1.0`)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">dhcp</span><span class="o">.</span><span class="n">pxe_architectures</span><span class="p">[</span><span class="s1">&#39;x86&#39;</span><span class="p">][</span><span class="s1">&#39;boot_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lpxelinux1.0`</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="ttbl.dhcp.pci">
<em class="property">class </em><code class="descclassname">ttbl.dhcp.</code><code class="descname">pci</code><span class="sig-paren">(</span><em>if_addr</em>, <em>if_net</em>, <em>if_len</em>, <em>ip_addr_range_bottom</em>, <em>ip_addr_range_top</em>, <em>mac_ip_map=None</em>, <em>allow_unmapped=False</em>, <em>debug=False</em>, <em>ip_mode=4</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.dhcp.pci" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="ttbl.dhcp.pci.error_e">
<em class="property">exception </em><code class="descname">error_e</code><a class="headerlink" href="#ttbl.dhcp.pci.error_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.dhcp.pci.start_e">
<em class="property">exception </em><code class="descname">start_e</code><a class="headerlink" href="#ttbl.dhcp.pci.start_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.dhcp.pci.dhcpd_path">
<code class="descname">dhcpd_path</code><em class="property"> = '/usr/sbin/dhcpd'</em><a class="headerlink" href="#ttbl.dhcp.pci.dhcpd_path" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements a power control unit that can be made part
of a power rail for a network interconnect.</p>
<p>When turned on, it would starts DHCP to provide on
the network.</p>
<p>With a configuration such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ttbl.dhcp</span>

<span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;nwa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pc_impl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">ttbl</span><span class="o">.</span><span class="n">dhcp</span><span class="o">.</span><span class="n">pci</span><span class="p">(</span><span class="s2">&quot;fc00::61:1&quot;</span><span class="p">,</span> <span class="s2">&quot;fc00::61:0&quot;</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span>
                  <span class="s2">&quot;fc00::61:2&quot;</span><span class="p">,</span> <span class="s2">&quot;fc00::61:fe&quot;</span><span class="p">,</span> <span class="n">ip_mode</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>It would start a DHCP IPv6 server on fc00::61:1, network
fc0)::61:0/112 serving IPv6 address from :2 to :fe.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.dhcp.pci.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.dhcp.pci.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Start DHCPd servers on the network interface
described by <cite>target</cite></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.dhcp.pci.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.dhcp.pci.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.dhcp.pci.on" title="ttbl.dhcp.pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.dhcp.pci.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.dhcp.pci.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.dhcp.pci.on" title="ttbl.dhcp.pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="data">
<dt id="ttbl.dhcp.pos_cmdline_opts">
<code class="descclassname">ttbl.dhcp.</code><code class="descname">pos_cmdline_opts</code><em class="property"> = {'tcf-live': ['initrd=%(pos_http_url_prefix)sinitramfs-%(pos_image)s ', 'rd.live.image', 'selinux=0', 'audit=0', 'ip=dhcp', 'root=/dev/nfs', 'rd.luks=0', 'rd.lvm=0', 'rd.md=0', 'rd.dm=0', 'rd.multipath=0', 'ro', 'plymouth.enable=0 ', 'loglevel=2']}</em><a class="headerlink" href="#ttbl.dhcp.pos_cmdline_opts" title="Permalink to this definition">¶</a></dt>
<dd><p>List of string with Linux kernel command options to be passed by
the bootloader</p>
</dd></dl>

<dl class="function">
<dt id="ttbl.dhcp.power_on_pre_pos_setup">
<code class="descclassname">ttbl.dhcp.</code><code class="descname">power_on_pre_pos_setup</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.dhcp.power_on_pre_pos_setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Hook called before power on to setup TFTP to boot a target in Provisioning Mode</p>
<p>The DHCP server started by <a class="reference internal" href="#module-ttbl.dhcp" title="ttbl.dhcp"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ttbl.dhcp</span></code></a> is always configured
to direct a target to PXE boot <em>syslinux</em>; this will ask the TFTP
server for a config file for the mac address of the target.</p>
<p>This function is called before powering on the target to create
said configuration file; based on the value of the target’s
<em>pos_mode</em> property, a config file that boots the Provisioning OS
or that redirects to the local disk will be created.</p>
</dd></dl>

</div>
<span class="target" id="module-ttbl.qemu"></span><div class="section" id="drivers-to-create-targets-on-virtual-machine-using-qemu">
<h4>8.8.4.4. Drivers to create targets on virtual machine using QEMU<a class="headerlink" href="#drivers-to-create-targets-on-virtual-machine-using-qemu" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This deprecates all previous ttbl/tt_qemu*.py modules</p>
</div>
<p>These are all raw building block which requires extra
configuration. To create targets, use functions such as:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#conf_00_lib_pos.target_qemu_pos_add" title="conf_00_lib_pos.target_qemu_pos_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pos.target_qemu_pos_add()</span></code></a></li>
<li><a class="reference internal" href="#conf_00_lib_mcu.target_qemu_zephyr_add" title="conf_00_lib_mcu.target_qemu_zephyr_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_mcu.target_qemu_zephyr_add()</span></code></a></li>
</ul>
</div></blockquote>
<p>These drivers implement different objects needed to implement targets
that run as QEMU virtual machines:</p>
<ul class="simple">
<li><a class="reference internal" href="#ttbl.qemu.pc" title="ttbl.qemu.pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">pc</span></code></a>: a power rail controller to control a QEMU virtual
machine running as a daemon, providing interfaces for
starting/stopping, debugging, BIOS/kernel/initrd image flashing and
exposes serial consoles that an be interacted with the
<a class="reference internal" href="#ttbl.console.generic_c" title="ttbl.console.generic_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.console.generic_c</span></code></a> object.</li>
<li><a class="reference internal" href="#ttbl.qemu.qmp_c" title="ttbl.qemu.qmp_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">qmp_c</span></code></a>: an object to talk to QEMU’s control socket</li>
<li><a class="reference internal" href="#ttbl.qemu.plugger_c" title="ttbl.qemu.plugger_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">plugger_c</span></code></a>: an adaptor to plug physical USB devices to QEMU
targets with the <a class="reference internal" href="#module-ttbl.things" title="ttbl.things"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ttbl.things</span></code></a> interface</li>
<li><a class="reference internal" href="#ttbl.qemu.network_tap_pc" title="ttbl.qemu.network_tap_pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">network_tap_pc</span></code></a>: a power rail controller to setup tap
devices to a (virtual or physical) network device that represents a
network.</li>
</ul>
<dl class="class">
<dt id="ttbl.qemu.qmp_c">
<em class="property">class </em><code class="descclassname">ttbl.qemu.</code><code class="descname">qmp_c</code><span class="sig-paren">(</span><em>sockfile</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.qmp_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple handler for the Qemu Monitor Protocol that allows us to run
basic QMP commands and report on status.</p>
<dl class="exception">
<dt id="ttbl.qemu.qmp_c.exception">
<em class="property">exception </em><code class="descname">exception</code><a class="headerlink" href="#ttbl.qemu.qmp_c.exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Base QMP exception</p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.qemu.qmp_c.cant_connect_e">
<em class="property">exception </em><code class="descname">cant_connect_e</code><a class="headerlink" href="#ttbl.qemu.qmp_c.cant_connect_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Cannot connect to QMP socket; probably QEMU didn’t start</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.qmp_c.command">
<code class="descname">command</code><span class="sig-paren">(</span><em>command</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.qmp_c.command" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a QMP command, return response</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>command</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – command to send</li>
<li><strong>kwargs</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of key/value arguments to send
to the command</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">response code from QEMU</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.qemu.pc">
<em class="property">class </em><code class="descclassname">ttbl.qemu.</code><code class="descname">pc</code><span class="sig-paren">(</span><em>qemu_cmdline</em>, <em>nic_model='e1000'</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.pc" title="Permalink to this definition">¶</a></dt>
<dd><p>Manage QEMU instances exposing interfaces for TCF to control it</p>
<p>This object exposes:</p>
<ul class="simple">
<li>power control interface: to start / stop QEMU</li>
<li>images interface: to specify the kernel / initrd / BIOS images</li>
<li>debug interface: to manage the virtual CPUs, debug via GDB</li>
</ul>
<p>A target can be created and this object attached to the multiple
interfaces to expose said functionalities, like for example
(pseudo code):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">test_target</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qemu_pc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">qemu</span><span class="o">.</span><span class="n">pc</span><span class="p">([</span> <span class="s2">&quot;/usr/bin/qemu-system-x86_64&quot;</span><span class="p">,</span> <span class="o">...</span> <span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="n">qemu_pc</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="n">qemu_pc</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;images&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="n">qemu_pc</span><span class="p">))</span>
</pre></div>
</div>
<p>For a complete, functional example see
<a class="reference internal" href="#conf_00_lib_pos.target_qemu_pos_add" title="conf_00_lib_pos.target_qemu_pos_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pos.target_qemu_pos_add()</span></code></a> or
<a class="reference internal" href="#conf_00_lib_mcu.target_qemu_zephyr_add" title="conf_00_lib_mcu.target_qemu_zephyr_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_mcu.target_qemu_zephyr_add()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>qemu_cmdline</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – <p>command line to start QEMU,
specified as a list of <em>[ PATH, ARG1, ARG2, … ]</em>.</p>
<p>Don’t add <em>-daemonize</em>! This way the daemon is part of the process
tree and killed when we kill the parent process</p>
<p>Note this will be passed to <a class="reference internal" href="#ttbl.power.daemon_c" title="ttbl.power.daemon_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.daemon_c</span></code></a>, so
‘%(FIELD)s’ will be expanded with the tags and runtime
properties of the target.</p>
</li>
<li><strong>nic_model</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) Network Interface Card emulation
used to create a network interface.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>General design notes</strong></p>
<ul>
<li><p class="first">the driver will add command line to create a QMP access socket
(to control the instance and launch the VM stopped), a GDB
control socket and a PID file. Thus, don’t specify <em>-qmp</em>,
<em>-pidfile</em>, <em>-S</em> or <em>-gdb</em> on the command line.</p>
</li>
<li><p class="first">any command line is allowed as long as it doesn’t interfere with
those.</p>
</li>
<li><p class="first">as in all the TCF server code, these might be called from
different processes who share the same configuration; hence we
can’t rely on any runtime storage. Any runtime values that are
needed are kept on a filesystem database (<cite>self.fsdb</cite>).</p>
<p>We start the process with Python’s subprocess.Popen(), but then
it goes on background and if the parent dies, the main server
process will reap it (as prctl() has set with SIG_IGN on
SIGCHLD) and any subprocess of the main process might kill it
when power-off is called on it. <a class="reference internal" href="#ttbl.power.daemon_c" title="ttbl.power.daemon_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.power.daemon_c</span></code></a>
takes care of all that.</p>
</li>
</ul>
<p><strong>Firmware interface: What to load/run</strong></p>
<p>The <a class="reference internal" href="#ttbl.images.interface" title="ttbl.images.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">images</span></code></a> interface can be used
to direct QEMU to load BIOS/kernel/initrd images. Otherwise, it
will execute stuff off the disk (if the command line is set
correctly). This is done by setting the target properties:</p>
<ul class="simple">
<li><em>qemu-image-bios</em></li>
<li><em>qemu-image-kernel</em></li>
<li><em>qemu-image-initrd</em></li>
</ul>
<p>these can be set to the name of a file in the server’s namespace,
normally off the user storage area (FIXME: implement this limit in
the flash() interface, allow specifics for POS and such).</p>
<p>Additionally, <em>qemu-image-kernel-args</em> can be set to arguments to
the kernel.</p>
<p><strong>Serial consoles</strong></p>
<p>This driver doesn’t intervene on serial consoles (if wanted or
not). The way to create serial consoles is to add command line
such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;-chardev&quot;</span><span class="p">,</span> <span class="s2">&quot;socket,id=NAME,server,nowait,path=</span><span class="si">%%</span><span class="s2">(path)s/console-NAME.write,logfile=</span><span class="si">%%</span><span class="s2">(path)s/console-NAME.read&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;-serial&quot;</span><span class="p">,</span> <span class="s2">&quot;chardev:NAME&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">]</span>
</pre></div>
</div>
<p>which makes QEMU write anything received on such serial console on
file <em>STATEDIR/console-NAME.read</em> and send to the virtual machine
anything written to socket <em>STATEDIR/console-NAME.write</em> (where
<em>STATEDIR</em> is the target specific state directory).</p>
<p>From there, a <a class="reference internal" href="#ttbl.console.generic_c" title="ttbl.console.generic_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.console.generic_c</span></code></a> console interface
implementation can be added:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;console&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span> <span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">generic_c</span><span class="p">()</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>the console handling code in <a class="reference internal" href="#ttbl.console.generic_c" title="ttbl.console.generic_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.console.generic_c</span></code></a> knows
from <em>NAME</em> where the find the read/write files.</p>
<p><strong>Networking</strong></p>
<p>Most networking can rely on TCF creating a virtual network device
over a TAP device associated to each target and interconnect they
are connected to–look at <a class="reference internal" href="#ttbl.qemu.network_tap_pc" title="ttbl.qemu.network_tap_pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.qemu.network_tap_pc</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">test_target</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">add_to_interconnect</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;nwa&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mac_addr</span> <span class="o">=</span> <span class="s2">&quot;02:61:00:00:00:05&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ipv4_addr</span> <span class="o">=</span> <span class="s2">&quot;192.168.97.5&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ipv6_addr</span> <span class="o">=</span> <span class="s2">&quot;fc00::61:05&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qemu_pc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">qemu</span><span class="o">.</span><span class="n">pc</span><span class="p">([</span> <span class="s2">&quot;/usr/bin/qemu-system-x86_64&quot;</span><span class="p">,</span> <span class="o">...</span> <span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">(</span> <span class="s2">&quot;tuntap-nwa&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">qemu</span><span class="o">.</span><span class="n">network_tap_pc</span><span class="p">()</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">qemu_pc</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>the driver automatically adds the command line to add correspoding
network devices for each interconnect the target is a member of.</p>
<p>It is possible to do NAT or other networking setups; the command
line needs to be specified manually though.</p>
<dl class="method">
<dt id="ttbl.qemu.pc.flash">
<code class="descname">flash</code><span class="sig-paren">(</span><em>target</em>, <em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.pc.flash" title="Permalink to this definition">¶</a></dt>
<dd><p>Flash <em>images</em> onto <em>target</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to flash</li>
<li><strong>images</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary keyed by image type of the
files (in the servers’s filesystem) that have to be
flashed.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The implementation assumes, per configuration, that this
driver knows how to flash the images of the given type (hence
why it was configured) and shall abort if given an unknown
type.</p>
<p>If multiple images are given, they shall be (when possible)
flashed all at the same time.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.pc.verify">
<code class="descname">verify</code><span class="sig-paren">(</span><em>target</em>, <em>component</em>, <em>cmdline_expanded</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.pc.verify" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that verifies if the daemon has started or not</p>
<p>For example, checking if a file has been created, etc</p>
<p><strong>THIS MUST BE DEFINED</strong></p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cmdline_expanded</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pidfile</span> <span class="o">%</span> <span class="n">kws</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>True</em> if the daemon started, <em>False</em> otherwise</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.pc.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.pc.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.pc.debug_list">
<code class="descname">debug_list</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.pc.debug_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide debugging information about the component</p>
<p>Return <em>None</em> if not currently debugging in this component,
otherwise a dicionary keyed by string with information.</p>
<p>If the dictionary is empty, it is assumed that the debugging
is enabled but the target is off, so most services can’t be
accessed.</p>
<p>Known fields:</p>
<ul class="simple">
<li><em>GDB</em>: string describing the location of the GDB bridge
associated to this component in the format
PROTOCOL:ADDRESS:PORT (eg: tcp:some.host.name:4564); it
shall be possible to feed this directly to the <em>gdb target
remote</em> command.</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.pc.debug_start">
<code class="descname">debug_start</code><span class="sig-paren">(</span><em>target</em>, <em>components</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.pc.debug_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Put the components in debugging mode.</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to operate</li>
<li><strong>components</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – list of components on which to operate</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.pc.debug_stop">
<code class="descname">debug_stop</code><span class="sig-paren">(</span><em>target</em>, <em>components</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.pc.debug_stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Take the components out of debugging mode.</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to operate</li>
<li><strong>components</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – list of components on which to operate</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.pc.debug_halt">
<code class="descname">debug_halt</code><span class="sig-paren">(</span><em>target</em>, <em>_components</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.pc.debug_halt" title="Permalink to this definition">¶</a></dt>
<dd><p>Halt the components’ CPUs</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.pc.debug_resume">
<code class="descname">debug_resume</code><span class="sig-paren">(</span><em>target</em>, <em>_components</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.pc.debug_resume" title="Permalink to this definition">¶</a></dt>
<dd><p>Resume the components’ CPUs</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.pc.debug_reset">
<code class="descname">debug_reset</code><span class="sig-paren">(</span><em>target</em>, <em>_components</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.pc.debug_reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the components’ CPUs</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.qemu.plugger_c">
<em class="property">class </em><code class="descclassname">ttbl.qemu.</code><code class="descname">plugger_c</code><span class="sig-paren">(</span><em>name</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.plugger_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Adaptor class to plug host-platform USB devices to QEMU VMs</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – thing’s name</li>
<li><strong>kwargs</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>parameters for <a class="reference internal" href="#ttbl.qemu.qmp_c.command" title="ttbl.qemu.qmp_c.command"><code class="xref py py-meth docutils literal notranslate"><span class="pre">qmp_c.command()</span></code></a>’s
<cite>device_add</cite> method, which for example, could be:</p>
<ul>
<li>driver = “usb-host”</li>
<li>hostbus = BUSNUMBER</li>
<li>hostaddr = USBADDRESS</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Sadly, there is no way to tell  QEMU to hotplug a device by serial
number, so according to docs, the  only way to do it is hardcoding
the device and bus number.</p>
<p>eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">test_target</span><span class="p">(</span><span class="s2">&quot;drive_34&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span> <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;usb_disk&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;qu04a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;things&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">things</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">drive_34</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">qemu</span><span class="o">.</span><span class="n">plugger_c</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="s2">&quot;drive_34&quot;</span><span class="p">,</span> <span class="n">driver</span> <span class="o">=</span> <span class="s2">&quot;usb-host&quot;</span><span class="p">,</span> <span class="n">hostbus</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hostaddr</span> <span class="o">=</span> <span class="mi">67</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">usb_disk</span> <span class="o">=</span> <span class="s2">&quot;drive_34&quot;</span><span class="p">,</span>  <span class="c1"># alias for a101_04</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="ttbl.qemu.plugger_c.plug">
<code class="descname">plug</code><span class="sig-paren">(</span><em>target</em>, <em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.plugger_c.plug" title="Permalink to this definition">¶</a></dt>
<dd><p>Plug <em>thing</em> into <em>target</em></p>
<p>Caller owns both <em>target</em> and <em>thing</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to plug</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to plug into <em>target</em></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.plugger_c.unplug">
<code class="descname">unplug</code><span class="sig-paren">(</span><em>target</em>, <em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.plugger_c.unplug" title="Permalink to this definition">¶</a></dt>
<dd><p>Unplug <em>thing</em> from <em>target</em></p>
<p>Caller owns <em>target</em> (not <em>thing</em> necessarily)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to unplug from</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to unplug</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.plugger_c.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.plugger_c.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to unplug from</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to unplug</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>True</em> if <em>thing</em> is connected to <em>target</em>, <em>False</em>
otherwise.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.qemu.network_tap_pc">
<em class="property">class </em><code class="descclassname">ttbl.qemu.</code><code class="descname">network_tap_pc</code><a class="headerlink" href="#ttbl.qemu.network_tap_pc" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a tap device and attaches it to an interconnect’s network
device</p>
<p>A target declares connectivity to one or more interconnects; when
this object is instantiated as part of the power rail:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;power&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">(</span> <span class="s2">&quot;tuntap-nwka&quot;</span><span class="p">,</span> <span class="n">pc_network_tap</span><span class="p">()</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>because the component is called <em>tuntap-nwka</em>, the driver assumes
it needs to tap to the interconnect <em>nwka</em> because that’s where
the target is connected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf list -vv TARGETNAME | grep -i nwka
  interconnects.nwka.ipv4_addr: 192.168.120.101
  interconnects.nwka.ipv4_prefix_len: 24
  interconnects.nwka.ipv6_addr: fc00::a8:78:65
  interconnects.nwka.ipv6_prefix_len: 112
  interconnects.nwka.mac_addr: 94:c6:91:1c:9e:d9
</pre></div>
</div>
<p>Upon powering on the target, the <em>on()</em> method will create a
network interface and link it to the network interface that
represents the interconnect has created when powering on
(<a class="reference internal" href="#conf_00_lib.vlan_pci" title="conf_00_lib.vlan_pci"><code class="xref py py-class docutils literal notranslate"><span class="pre">conf_00_lib.vlan_pci</span></code></a>)–it will assign it in the TCF
server the IP addresses described above.</p>
<p>The name of the interface created is stored in a target property
called as the component (for our example, it will be a property
called <em>tuntap-nwka</em>) so that other components can use it:</p>
<ul>
<li><p class="first">For QEMU, for example, you need a command line such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">nic</span> <span class="n">tap</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="n">ETH_NIC_MODEL</span><span class="p">,</span><span class="n">script</span><span class="o">=</span><span class="n">no</span><span class="p">,</span><span class="n">downscript</span><span class="o">=</span><span class="n">no</span><span class="p">,</span><span class="n">ifname</span><span class="o">=</span><span class="n">IFNAME</span>
</pre></div>
</div>
<p>however, the <a class="reference internal" href="#ttbl.qemu.pc" title="ttbl.qemu.pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.qemu.pc</span></code></a> driver automatically
recognizes a <em>tuntap-NETWORKNAME</em> is there and inserts the
command line needed.</p>
</li>
</ul>
<p>When the target is powered off, this component will just remove
the interface.</p>
<dl class="method">
<dt id="ttbl.qemu.network_tap_pc.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.network_tap_pc.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.network_tap_pc.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.network_tap_pc.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.qemu.network_tap_pc.on" title="ttbl.qemu.network_tap_pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.qemu.network_tap_pc.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.qemu.network_tap_pc.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.qemu.network_tap_pc.on" title="ttbl.qemu.network_tap_pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-ttbl.openocd"></span><div class="section" id="interaction-with-jtags-and-similar-using-openocd">
<h4>8.8.4.5. Interaction with JTAGs and similar using OpenOCD<a class="headerlink" href="#interaction-with-jtags-and-similar-using-openocd" title="Permalink to this headline">¶</a></h4>
<p>This module provides the building block to debug many boards with
<a class="reference external" href="http://openocd.org/">OpenOCD</a>.</p>
<p>Class <a class="reference internal" href="#ttbl.openocd.pc" title="ttbl.openocd.pc"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.openocd.pc</span></code></a> is a power controller that when added
to a power rail, will start <em>OpenOCD</em> and then allow to use it to
perform debug operations and flashing on the target’s board.</p>
<dl class="data">
<dt id="ttbl.openocd.boards">
<code class="descclassname">ttbl.openocd.</code><code class="descname">boards</code><em class="property"> = {'': {'interface': None, 'config': '', 'board': '', 'addrmap': ''}, 'arduino_101': {'targets': ['x86', 'arc'], 'board': None, 'addrmap': 'quark_se_a101', 'interface': 'interface/ftdi/flyswatter2.cfg', 'config': '\ninterface ftdi\nftdi_serial &quot;%(serial_string)s&quot;\n# Always needed, or openocd fails -100\nftdi_vid_pid 0x0403 0x6010\nsource [find board/quark_se.cfg]\n\nquark_se.quark configure -event gdb-attach {\n        reset halt\n        gdb_breakpoint_override hard\n}\n\nquark_se.quark configure -event gdb-detach {\n        resume\n        shutdown\n}\n', 'reset_halt_command': 'reset; reset halt', 'hack_reset_after_power_on': True}, 'frdm_k64f': {'board': None, 'addrmap': 'frdm_k64f', 'interface': None, 'config': 'interface cmsis-dap\ncmsis_dap_serial %(serial_string)s\nsource [find target/k60.cfg]\n', 'targets': ['arm'], 'write_command': 'flash write_image erase %(file)s %(address)s', 'target_id_names': {0: 'k60.cpu'}}, 'galileo': {'config': '\ninterface ftdi\n# Always needed, or openocd fails -100\nftdi_vid_pid 0x0403 0x6010\nftdi_serial &quot;%(serial_string)s&quot;\nsource [find board/quark_x10xx_board.cfg]\n', 'targets': ['x86'], 'addrmap': 'quark_x1000'}, 'nrf51': {'board': None, 'addrmap': 'nrf5x', 'interface': None, 'config': 'source [find interface/jlink.cfg]\njlink serial %(serial_string)s\ntransport select swd\nset WORKAREASIZE 0\nsource [find target/nrf51.cfg]\n', 'targets': ['arm'], 'write_command': 'program %(file)s verify'}, 'nrf52': {'board': None, 'addrmap': 'nrf5x', 'interface': None, 'config': '\nsource [find interface/jlink.cfg]\njlink serial %(serial_string)s\ntransport select swd\nset WORKAREASIZE 0\nsource [find target/nrf51.cfg]\n', 'targets': ['arm'], 'write_command': 'program %(file)s verify'}, 'nrf52840': {'board': None, 'addrmap': 'nrf5x', 'interface': None, 'config': '\nsource [find interface/jlink.cfg]\njlink serial %(serial_string)s\ntransport select swd\nset WORKAREASIZE 0\nsource [find target/nrf51.cfg]\n', 'targets': ['arm'], 'write_command': 'program %(file)s verify'}, 'qc10000_crb': {'hack_reset_after_power_on': True, 'config': '\ninterface ftdi\nftdi_serial &quot;%(serial_string)s&quot;\n# Always needed, or openocd fails -100\nftdi_vid_pid 0x0403 0x6010\n\nftdi_channel        0\nftdi_layout_init    0x0010 0xffff\nftdi_layout_signal  nTRST -data 0x0100 -oe 0x0100\n\nsource [find board/quark_se.cfg]\n', 'targets': ['x86', 'arc'], 'addrmap': 'quark_se', 'reset_halt_command': 'reset; reset halt'}, 'quark_d2000_crb': {'config': '\ninterface ftdi\nftdi_serial &quot;%(serial_string)s&quot;\n# Always needed, or openocd fails -100\nftdi_vid_pid 0x0403 0x6014\nftdi_channel 0\n\nftdi_layout_init 0x0000 0x030b\nftdi_layout_signal nTRST -data 0x0100 -noe 0x0100\nftdi_layout_signal nSRST -data 0x0200 -oe 0x0200\n\n\n# default frequency but this can be adjusted at runtime\n#adapter_khz 1000\nadapter_khz 6000\n\nreset_config trst_only\n\nsource [find target/quark_d20xx.cfg]\n', 'targets': ['x86'], 'addrmap': 'quark_d2000_crb'}, 'quark_d2000_crb_v8': {'config': '\ninterface ftdi\nftdi_serial &quot;%(serial_string)s&quot;\n# Always needed, or openocd fails -100\nftdi_vid_pid 0x0403 0x6014\nftdi_channel 0\n\nftdi_layout_init 0x0000 0x030b\nftdi_layout_signal nTRST -data 0x0100 -noe 0x0100\nftdi_layout_signal nSRST -data 0x0200 -oe 0x0200\n\n\n# default frequency but this can be adjusted at runtime\n#adapter_khz 1000\nadapter_khz 6000\n\nreset_config trst_only\n\nsource [find target/quark_d2000.cfg]\n', 'targets': ['x86'], 'addrmap': 'quark_d2000_crb'}, 'quark_se_ctb': {'board': 'quark_se', 'addrmap': 'quark_se', 'interface': None, 'config': '\ninterface ftdi\nftdi_serial &quot;%(serial_string)s&quot;\n# Always needed, or openocd fails -100\nftdi_vid_pid 0x0403 0x6010\n\n# oe_n  0x0200\n# rst   0x0800\n\nftdi_channel        0\nftdi_layout_init    0x0000 0xffff\nftdi_layout_signal nTRST -data 0x0100 -oe 0x0100\n', 'targets': ['x86', 'arc'], 'hack_reset_after_power_on': True}, 'sam_e70_xplained': {'board': None, 'addrmap': 'sam_e70_xplained', 'interface': None, 'config': 'interface cmsis-dap\ncmsis_dap_serial %(serial_string)s\nsource [find target/atsamv.cfg]\n', 'targets': ['arm'], 'write_command': 'flash write_image erase %(file)s %(address)s', 'target_id_names': {0: 'atsame70q21.cpu'}}, 'sam_v71_xplained': {'board': None, 'addrmap': 'sam_v71_xplained', 'interface': None, 'config': 'interface cmsis-dap\ncmsis_dap_serial %(serial_string)s\nsource [find target/atsamv.cfg]\n', 'targets': ['arm'], 'write_command': 'flash write_image erase %(file)s %(address)s', 'target_id_names': {0: 'samv71.cpu'}}, 'snps_em_sk': {'board': None, 'addrmap': 'snps_em_sk', 'interface': None, 'config': 'interface ftdi\nftdi_serial &quot;%(serial_string)s&quot;\n# Always needed, or openocd fails -100\nftdi_vid_pid 0x0403 0x6014\nsource [find board/snps_em_sk.cfg]\n', 'targets': ['arc'], 'target_id_names': {0: 'arc-em.cpu'}}}</em><a class="headerlink" href="#ttbl.openocd.boards" title="Permalink to this definition">¶</a></dt>
<dd><p>Board description dictionary</p>
<p>This is a dictionary keyed by board / MCU name; when the
OpenOCD driver is loaded, it is given this name and the entry
is opened to get some operation values.</p>
<p>Each entry is another dictionary of key/value where key is a
string, value is whatever.</p>
<p>FIXME: many missing</p>
<ul class="simple">
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">hack_reset_halt_after_init</span></code></li>
</ul>
</dd></dl>

<dl class="class">
<dt id="ttbl.openocd.action_logadapter_c">
<em class="property">class </em><code class="descclassname">ttbl.openocd.</code><code class="descname">action_logadapter_c</code><span class="sig-paren">(</span><em>logger</em>, <em>extra</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.openocd.action_logadapter_c" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="ttbl.openocd.action_logadapter_c.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>msg</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.openocd.action_logadapter_c.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the logging message and keyword arguments passed in to
a logging call to insert contextual information. You can either
manipulate the message itself, the keyword args or both. Return
the message and kwargs modified (or not) to suit your needs.</p>
<p>Normally, you’ll only need to override this one method in a
LoggerAdapter subclass for your specific needs.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.openocd.pc">
<em class="property">class </em><code class="descclassname">ttbl.openocd.</code><code class="descname">pc</code><span class="sig-paren">(</span><em>serial</em>, <em>board</em>, <em>debug=False</em>, <em>openocd_path='/usr/bin/openocd'</em>, <em>openocd_scripts='/usr/share/openocd/scripts'</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.openocd.pc" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – serial number of the target board; this is
usually a USB serial number.</li>
<li><strong>board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the board we are connecting against;
this has to be defined in <a class="reference internal" href="#ttbl.openocd.boards" title="ttbl.openocd.boards"><code class="xref py py-data docutils literal notranslate"><span class="pre">boards</span></code></a> or
<code class="xref py py-data docutils literal notranslate"><span class="pre">board_synonyms</span></code>.</li>
<li><strong>debug</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) run OpenOCD in debugging mode,
printing extra information to the log (default <em>False</em>).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><em>target ID</em></p>
<p>OpenOCD will operate on targets (different to TCF’s targets);
these might one or more CPUs in the debugged system.  Each has an
ID, which by default is zero.</p>
<p><em>component to OpenOCD target mapping</em></p>
<p>Each component configured in the target addition maps to an
OpenOCD target in <em>boards[X][targets]</em>.</p>
<p><a href="#id3"><span class="problematic" id="id4">**</span></a>OLD OLD **</p>
<p>This is a flasher object that uses OpenOCD to provide flashing
and GDB server support.</p>
<p>The object starts an OpenOCD instance (that runs as a daemon)
– it does this behaving as a power-control implementation
that is plugged at the end of the power rail.</p>
<p>To execute commands, it connects to the daemon via TCL and
runs them using the <code class="docutils literal notranslate"><span class="pre">'capture</span> <span class="pre">&quot;OPENOCDCOMMAND&quot;'</span></code> TCL command
(FIXME: is there a better way?). The telnet port is open for
manual debugging (check your firewall! <strong>no passwords!</strong>); the GDB
ports are also available.</p>
<p>The class knows the configuration settings for different
boards (as given in the <cite>board_name</cite> parameter. It is also
possible to point it to specific OpenOCD paths when different
builds / versions need to be used.</p>
<p>Note how entry points from the flasher_c class all start with
underscore. Functions <code class="docutils literal notranslate"><span class="pre">__SOMETHING()</span></code> are those that have to be
called with a <code class="docutils literal notranslate"><span class="pre">_expect_mgr</span></code> context taken [see comments
on <code class="docutils literal notranslate"><span class="pre">__send_command</span></code> for the reason.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>board_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the board to use, to select
proper configuration parameters. Needs to be declared in
<em>ttbl.flasher.openocd_c._boards</em>.</td>
</tr>
</tbody>
</table>
<p>When starting OpenOCD, run a reset halt immediately after.
This is used when flashing, as we power cycle before to try
to have the target in a proper state–we want to avoid it
running any code that might alter the state again.</p>
<p>Now, this is used in combination with another setting,
board specific, that says if the reset has to be done or
not in method :meth:_power_on_do_openocd_verify().</p>
<p>But why? Because some Quark SE targets, when put in deep
sleep mode, OpenOCD is unable to reset halt them, returning
something like:</p>
<blockquote>
<div>&gt; reset halt
JTAG tap: quark_se.cltap tap/device found: 0x0e765013 (mfg: 0x009 (Intel), part: 0xe765, ver: 0x0)
Enabling arc core tap
JTAG tap: quark_se.arc-em enabled
Enabling quark core tap
JTAG tap: quark_se.quark enabled
target is still running!
target running, halt it first
quark_se_target_reset could not write memory
in procedure ‘reset’ called at file “command.c”, line 787</div></blockquote>
<p>So what we are trying to do, and it is a <em>horrible hack</em>,
is to hopefully catch the CPU before it gets into that
mode, and when it does, it bails out if it fails to reset
and restarts OpenOCD and maybe (maybe) it at some point
will get it.</p>
<p>Now, this is by NO MEANS a proper fix. The right fix would
be for OpenOCD to be able to reset in any circumstance
(which it doesn’t). An alternative would be to find some
kind of memory location OpenOCD can write to that will take
the CPU out of whichever state it gets stuck at which we
can run when we see that.</p>
<p>Zephyr’s sample samples/board/quark_se/power_mgr is very
good at making this happen.</p>
<dl class="attribute">
<dt id="ttbl.openocd.pc.hard_recover_rest_time">
<code class="descname">hard_recover_rest_time</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.openocd.pc.hard_recover_rest_time" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.openocd.pc.hack_reset_after_power_on">
<code class="descname">hack_reset_after_power_on</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.openocd.pc.hack_reset_after_power_on" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME:</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.openocd.pc.hack_reset_halt_after_init">
<code class="descname">hack_reset_halt_after_init</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.openocd.pc.hack_reset_halt_after_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Inmediately after running the OpenOCD initialization
sequence, reset halt the board.</p>
<p>This is meant to be used when we know we are power cycling
before flashing. The board will start running as soon as we
power it on, thus we ask OpenOCD to stop it inmediately
after initializing. There is still a big window of time on
which the board can get itself in a bad state by running
its own code.</p>
<p>(bool, default False)</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.openocd.pc.hack_reset_after_init">
<code class="descname">hack_reset_after_init</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.openocd.pc.hack_reset_after_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Inmediately after running the OpenOCD initialization
sequence, reset the board.</p>
<p>This is meant to be used for hacking some boards that don’t
start properly OpenOCD unless this is done.</p>
<p>(bool, default False)</p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.openocd.pc.error">
<em class="property">exception </em><code class="descname">error</code><a class="headerlink" href="#ttbl.openocd.pc.error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.openocd.pc.expect_connect_e">
<em class="property">exception </em><code class="descname">expect_connect_e</code><a class="headerlink" href="#ttbl.openocd.pc.expect_connect_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.openocd.pc.verify">
<code class="descname">verify</code><span class="sig-paren">(</span><em>target</em>, <em>component</em>, <em>cmdline_expanded</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.openocd.pc.verify" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that verifies if the daemon has started or not</p>
<p>For example, checking if a file has been created, etc</p>
<p><strong>THIS MUST BE DEFINED</strong></p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cmdline_expanded</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pidfile</span> <span class="o">%</span> <span class="n">kws</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>True</em> if the daemon started, <em>False</em> otherwise</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-ttbl.rsync"></span><div class="section" id="power-control-module-to-start-a-rsync-daemon-when-a-network-is-powered-on">
<h4>8.8.4.6. Power control module to start a rsync daemon when a network is powered-on<a class="headerlink" href="#power-control-module-to-start-a-rsync-daemon-when-a-network-is-powered-on" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="ttbl.rsync.pci">
<em class="property">class </em><code class="descclassname">ttbl.rsync.</code><code class="descname">pci</code><span class="sig-paren">(</span><em>address</em>, <em>share_name</em>, <em>share_path</em>, <em>port=873</em>, <em>uid=None</em>, <em>gid=None</em>, <em>read_only=True</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.rsync.pci" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="ttbl.rsync.pci.error_e">
<em class="property">exception </em><code class="descname">error_e</code><a class="headerlink" href="#ttbl.rsync.pci.error_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.rsync.pci.start_e">
<em class="property">exception </em><code class="descname">start_e</code><a class="headerlink" href="#ttbl.rsync.pci.start_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.rsync.pci.path">
<code class="descname">path</code><em class="property"> = '/usr/bin/rsync'</em><a class="headerlink" href="#ttbl.rsync.pci.path" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements a power control unit that starts an rsync
daemon to serve one path to a network.</p>
<p>Thus, when the associated target is powered on, the rsync daemon
is started; when off, rsync is killed.</p>
<p>E.g.: an interconnect gets an rsync server to share some files
that targets might use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">inteface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">rsync</span><span class="o">.</span><span class="n">pci</span><span class="p">(</span><span class="s2">&quot;192.168.43.1&quot;</span><span class="p">,</span> <span class="s1">&#39;images&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                   <span class="s1">&#39;/home/ttbd/images&#39;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">vlan_pci</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ttbl.rsync.pci.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.rsync.pci.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the daemon, generating first the config file</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.rsync.pci.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.rsync.pci.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.rsync.pci.on" title="ttbl.rsync.pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.rsync.pci.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.rsync.pci.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.rsync.pci.on" title="ttbl.rsync.pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-ttbl.socat"></span><div class="section" id="power-control-module-to-start-a-socat-daemon-when-a-network-is-powered-on">
<h4>8.8.4.7. Power control module to start a socat daemon when a network is powered-on<a class="headerlink" href="#power-control-module-to-start-a-socat-daemon-when-a-network-is-powered-on" title="Permalink to this headline">¶</a></h4>
<p>This socat daemon can provide tunneling services to allow targets to
access outside isolated test networks via the server.</p>
<dl class="class">
<dt id="ttbl.socat.pci">
<em class="property">class </em><code class="descclassname">ttbl.socat.</code><code class="descname">pci</code><span class="sig-paren">(</span><em>proto</em>, <em>local_addr</em>, <em>local_port</em>, <em>remote_addr</em>, <em>remote_port</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.socat.pci" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="ttbl.socat.pci.error_e">
<em class="property">exception </em><code class="descname">error_e</code><a class="headerlink" href="#ttbl.socat.pci.error_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.socat.pci.start_e">
<em class="property">exception </em><code class="descname">start_e</code><a class="headerlink" href="#ttbl.socat.pci.start_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.socat.pci.path">
<code class="descname">path</code><em class="property"> = '/usr/bin/socat'</em><a class="headerlink" href="#ttbl.socat.pci.path" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements a power control unit that can forward ports
in the server to other places in the network.</p>
<p>It can be used to provide for access point in the NUTs (Network
Under Tests) for the testcases to access.</p>
<p>For example, given a NUT represented by <code class="docutils literal notranslate"><span class="pre">NWTARGET</span></code> which has an
IPv4 address of 192.168.98.1 in the ttbd server, a port
redirection from port 8080 to an external proxy server
<em>proxy-host.in.network:8080</em> would be implemented as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">NWTARGET</span><span class="p">]</span><span class="o">.</span><span class="n">pc_impl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">socat</span><span class="o">.</span><span class="n">pci</span><span class="p">(</span><span class="s1">&#39;tcp&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                   <span class="s1">&#39;192.168.98.1&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                   <span class="s1">&#39;proxy-host.in.network&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
</pre></div>
</div>
<p>Then to facilitate the work of test scripts, it’d make sense to
export tags that explain where the proxy is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">NWTARGET</span><span class="p">]</span><span class="o">.</span><span class="n">tags_update</span><span class="p">({</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;ftp_proxy&#39;</span><span class="p">:</span> <span class="s1">&#39;http://192.168.98.1:8080&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;http_proxy&#39;</span><span class="p">:</span> <span class="s1">&#39;http://192.168.98.1:8080&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;https_proxy&#39;</span><span class="p">:</span> <span class="s1">&#39;http://192.168.98.1:8080&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ttbl.socat.pci.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.socat.pci.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.socat.pci.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.socat.pci.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.socat.pci.on" title="ttbl.socat.pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.socat.pci.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.socat.pci.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.socat.pci.on" title="ttbl.socat.pci.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-ttbl.buttons">
<span id="other-interfaces"></span><h3>8.8.5. Other interfaces<a class="headerlink" href="#module-ttbl.buttons" title="Permalink to this headline">¶</a></h3>
<div class="section" id="press-target-s-buttons">
<h4>8.8.5.1. Press target’s buttons<a class="headerlink" href="#press-target-s-buttons" title="Permalink to this headline">¶</a></h4>
<p>A target that has physical buttons that can be pressed can be
instrumented so they can be pressed/released. This interface provides
means to access said interface.</p>
<p>A target will offer the <a class="reference internal" href="#ttbl.buttons.interface" title="ttbl.buttons.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">interface</span></code></a> to
press each button, each of which is implemented by different instances
of <a class="reference internal" href="#ttbl.buttons.impl_c" title="ttbl.buttons.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.buttons.impl_c</span></code></a>.</p>
<dl class="class">
<dt id="ttbl.buttons.impl_c">
<em class="property">class </em><code class="descclassname">ttbl.buttons.</code><code class="descname">impl_c</code><a class="headerlink" href="#ttbl.buttons.impl_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Implementation interface for a button driver</p>
<p>A button can be pressed or it can be released; it’s current state
can be obtained.</p>
<dl class="method">
<dt id="ttbl.buttons.impl_c.press">
<code class="descname">press</code><span class="sig-paren">(</span><em>target</em>, <em>button</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.impl_c.press" title="Permalink to this definition">¶</a></dt>
<dd><p>Press a target’s button</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where the button is</li>
<li><strong>button</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of button</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.buttons.impl_c.release">
<code class="descname">release</code><span class="sig-paren">(</span><em>target</em>, <em>button</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.impl_c.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release a target’s button</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where the button is</li>
<li><strong>button</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of button</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.buttons.impl_c.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>button</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.impl_c.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a target’s button state</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where the button is</li>
<li><strong>button</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of button</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>True</em> if pressed, <em>False</em> otherwise.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.buttons.interface">
<em class="property">class </em><code class="descclassname">ttbl.buttons.</code><code class="descname">interface</code><span class="sig-paren">(</span><em>*impls</em>, <em>**kwimpls</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.interface" title="Permalink to this definition">¶</a></dt>
<dd><p>Buttons interface to the core target API</p>
<p>This provides access to all of the target’s buttons, independent
of their implementation, so they can be pressed, released or their
state queried.</p>
<p>An instance of this gets added as an object to the main target
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;android_tablet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;buttons&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">buttons</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">power</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">vol_up</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">vol_down</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>where in this case the buttons are implemented with an USB-RLY08B
relay board.</p>
<p>This for example, can be used to instrument the power, volume up
and volume down button of a tablet to control power switching. In
the case of most Android tablets, the power rail then becomes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">buttons</span><span class="o">.</span><span class="n">pci_buttons_released</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">[</span> <span class="s2">&quot;vol_up&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_down&quot;</span><span class="p">,</span> <span class="s2">&quot;power&quot;</span> <span class="p">]),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">buttons</span><span class="o">.</span><span class="n">pci_button_sequences</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">sequence_off</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span> <span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;press&#39;</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span> <span class="s1">&#39;vol_down&#39;</span><span class="p">,</span> <span class="s1">&#39;press&#39;</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span> <span class="s1">&#39;resetting&#39;</span><span class="p">,</span> <span class="mi">11</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span> <span class="s1">&#39;vol_down&#39;</span><span class="p">,</span> <span class="s1">&#39;release&#39;</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span> <span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;release&#39;</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">sequence_on</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span> <span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;press&#39;</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span> <span class="s1">&#39;powering&#39;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">(</span> <span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;release&#39;</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay_til_usb_device</span><span class="p">(</span><span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">adb</span><span class="o">.</span><span class="n">pci</span><span class="p">(</span><span class="mi">4036</span><span class="p">,</span> <span class="n">target_serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;android_tablet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;buttons&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">buttons</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">power</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">vol_up</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">vol_down</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>impls</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>dictionary keyed by button name and which
values are instantiation of button drivers inheriting from
<a class="reference internal" href="#ttbl.buttons.impl_c" title="ttbl.buttons.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.buttons.impl_c</span></code></a>.</p>
<p>Names have to be valid python symbol names.</p>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.buttons.interface.sequence">
<code class="descname">sequence</code><span class="sig-paren">(</span><em>target</em>, <em>sequence</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.interface.sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute a sequence of button actions on a target</p>
<p>The sequence argument has to be a list of pairs:</p>
<ul class="simple">
<li><em>( ‘press’, BUTTON-NAME)</em></li>
<li><em>( ‘release’, BUTTON-NAME)</em></li>
<li><em>( ‘wait’, NUMBER-OF-SECONDS)</em></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="ttbl.buttons.interface.put_sequence">
<code class="descname">put_sequence</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.interface.put_sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute a sequence of button actions on a target</p>
<p>The sequence argument has to be a list of pairs:</p>
<ul class="simple">
<li><em>( ‘press’, BUTTON-NAME)</em></li>
<li><em>( ‘release’, BUTTON-NAME)</em></li>
<li><em>( ‘wait’, NUMBER-OF-SECONDS)</em></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="ttbl.buttons.interface.get_list">
<code class="descname">get_list</code><span class="sig-paren">(</span><em>target</em>, <em>_who</em>, <em>_args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.interface.get_list" title="Permalink to this definition">¶</a></dt>
<dd><p>List buttons on a target and their state</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.buttons.button_click_pc">
<em class="property">class </em><code class="descclassname">ttbl.buttons.</code><code class="descname">button_click_pc</code><span class="sig-paren">(</span><em>button</em>, <em>time_on=5</em>, <em>time_off=20</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.button_click_pc" title="Permalink to this definition">¶</a></dt>
<dd><p>Power control implementation that clicks a button as a step to
power on or off something on a target.</p>
<dl class="method">
<dt id="ttbl.buttons.button_click_pc.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.button_click_pc.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.buttons.button_click_pc.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.button_click_pc.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.buttons.button_click_pc.on" title="ttbl.buttons.button_click_pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.buttons.button_click_pc.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.button_click_pc.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.buttons.button_click_pc.on" title="ttbl.buttons.button_click_pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.buttons.button_sequence_pc">
<em class="property">class </em><code class="descclassname">ttbl.buttons.</code><code class="descname">button_sequence_pc</code><span class="sig-paren">(</span><em>sequence_on=None</em>, <em>sequence_off=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.button_sequence_pc" title="Permalink to this definition">¶</a></dt>
<dd><p>Power control implementation that executest a button sequence on
power on, another on power off.</p>
<dl class="method">
<dt id="ttbl.buttons.button_sequence_pc.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.button_sequence_pc.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.buttons.button_sequence_pc.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.button_sequence_pc.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.buttons.button_sequence_pc.on" title="ttbl.buttons.button_sequence_pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.buttons.button_sequence_pc.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.button_sequence_pc.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.buttons.button_sequence_pc.on" title="ttbl.buttons.button_sequence_pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.buttons.buttons_released_pc">
<em class="property">class </em><code class="descclassname">ttbl.buttons.</code><code class="descname">buttons_released_pc</code><span class="sig-paren">(</span><em>button_list</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.buttons_released_pc" title="Permalink to this definition">¶</a></dt>
<dd><p>Power control implementation that ensures a list of buttons
are released (not pressed) before powering on a target.</p>
<dl class="method">
<dt id="ttbl.buttons.buttons_released_pc.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.buttons_released_pc.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on the component</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to act</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the power controller we are modifying</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.buttons.buttons_released_pc.off">
<code class="descname">off</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.buttons_released_pc.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off the component</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.buttons.buttons_released_pc.on" title="ttbl.buttons.buttons_released_pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="ttbl.buttons.buttons_released_pc.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>_component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.buttons.buttons_released_pc.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the component’s power state</p>
<p>Same parameters as <a class="reference internal" href="#ttbl.buttons.buttons_released_pc.on" title="ttbl.buttons.buttons_released_pc.on"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">power state:<ul class="simple">
<li><em>True</em>: powered on</li>
<li><em>False</em>: powered off</li>
<li><em>None</em>: this is a <em>fake</em> power unit, so it has no actual
power state</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-ttbl.capture"></span><div class="section" id="stream-and-snapshot-capture-interace">
<h4>8.8.5.2. Stream and snapshot capture interace<a class="headerlink" href="#stream-and-snapshot-capture-interace" title="Permalink to this headline">¶</a></h4>
<p>This module implements an interface to capture things in the server
and then return them to the client.</p>
<p>This can be used to, for example:</p>
<ul>
<li><p class="first">capture screenshots of a screen, by connecting the target’s output
to a framegrabber, for example:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.amazon.com/AGPTEK-Capture-Streaming-Recorder-Compatible/dp/B074863G59/ref=sr_1_2_sspa?keywords=MYPIN+HDMI+Game+Capture&amp;qid=1556209779&amp;s=electronics&amp;sr=1-2-spons&amp;psc=1">MYPIN HDMI Game Capture Card USB 3.0</a></li>
<li><a class="reference external" href="https://www.lenkeng.net/Index/detail/id/149">LKV373A</a></li>
</ul>
<p>…</p>
<p>and then running somethig such as ffmpeg on its output</p>
</li>
<li><p class="first">capture a video stream (with audio) when the controller can say when
to start and when to end</p>
</li>
<li><p class="first">capture network traffic with tcpdump</p>
</li>
</ul>
<dl class="class">
<dt id="ttbl.capture.impl_c">
<em class="property">class </em><code class="descclassname">ttbl.capture.</code><code class="descname">impl_c</code><span class="sig-paren">(</span><em>stream</em>, <em>mimetype</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.impl_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Implementation interface for a capture driver</p>
<p>The target will list the available capturers in the <em>capture</em> tag.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>stream</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – if this capturer is capable of streaming; an
streaming capturer has to be told to start and then stop and
return the capture as a file.</li>
<li><strong>mimetype</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – MIME type of the capture output, eg image/png</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.capture.impl_c.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>target</em>, <em>capturer</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.impl_c.start" title="Permalink to this definition">¶</a></dt>
<dd><p>If this is a streaming capturer, start capturing the stream</p>
<p>Usually starts a program that is active, capturing to a file
until the <a class="reference internal" href="#ttbl.capture.impl_c.stop_and_get" title="ttbl.capture.impl_c.stop_and_get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">stop_and_get()</span></code></a> method is called.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which we are capturing</li>
<li><strong>capturer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of this capturer</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">dictionary of values to pass to the client, usually
nothing</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.capture.impl_c.stop_and_get">
<code class="descname">stop_and_get</code><span class="sig-paren">(</span><em>target</em>, <em>capturer</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.impl_c.stop_and_get" title="Permalink to this definition">¶</a></dt>
<dd><p>If this is a streaming capturer, stop streaming and return the
captured data or take a snapshot and return it.</p>
<p>This stops the capture of the stream and return the file
or take a snapshot capture and return.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which we are capturing</li>
<li><strong>capturer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of this capturer</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>dictionary of values to pass to the client,
including the data; to stream a large file, include a member
in this dictionary called <em>stream_file</em> pointing to the
file’s path; eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">stream_file</span> <span class="o">=</span> <span class="n">CAPTURE_FILE</span><span class="p">)</span>
</pre></div>
</div>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.capture.interface">
<em class="property">class </em><code class="descclassname">ttbl.capture.</code><code class="descname">interface</code><span class="sig-paren">(</span><em>**impls</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.interface" title="Permalink to this definition">¶</a></dt>
<dd><p>Interface to capture something in the server related to a target</p>
<p>An instance of this gets added as an object to the target object
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;qu05a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;capture&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">vnc0</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">vnc</span><span class="p">(</span><span class="n">PORTNUMBER</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">vnc0_stream</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">vnc_stream</span><span class="p">(</span><span class="n">PORTNUMBER</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">hdmi0</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">ffmpeg</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">screen</span> <span class="o">=</span> <span class="s2">&quot;vnc0&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">screen_stream</span> <span class="o">=</span> <span class="s2">&quot;vnc0_stream&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>Note how <em>screen</em> has been made an alias of <em>vnc0</em> and
<em>screen_stream</em> an alias of <em>vnc0_stream</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>impls</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>dictionary keyed by capture name name and which
values are instantiation of capture drivers inheriting from
<a class="reference internal" href="#ttbl.capture.impl_c" title="ttbl.capture.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.capture.impl_c</span></code></a> or names of other capturers (to
sever as aliases).</p>
<p>Names have to be valid python symbol names.</p>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.capture.interface.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>who</em>, <em>target</em>, <em>capturer</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.interface.start" title="Permalink to this definition">¶</a></dt>
<dd><p>If this is a streaming capturer, start capturing the stream</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – user who owns the target</li>
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which we are capturing</li>
<li><strong>capturer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – capturer to use, as registered in
<a class="reference internal" href="#ttbl.capture.interface" title="ttbl.capture.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.capture.interface</span></code></a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">dictionary of values to pass to the client</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.capture.interface.stop_and_get">
<code class="descname">stop_and_get</code><span class="sig-paren">(</span><em>who</em>, <em>target</em>, <em>capturer</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.interface.stop_and_get" title="Permalink to this definition">¶</a></dt>
<dd><p>If this is a streaming capturer, stop streaming and return the
captured data or if no streaming, take a snapshot and return it.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – user who owns the target</li>
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which we are capturing</li>
<li><strong>capturer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – capturer to use, as registered in
<a class="reference internal" href="#ttbl.capture.interface" title="ttbl.capture.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.capture.interface</span></code></a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">dictionary of values to pass to the client</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.capture.interface.list">
<code class="descname">list</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.interface.list" title="Permalink to this definition">¶</a></dt>
<dd><p>List capturers available on a target</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which we are capturing</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.capture.interface.request_process">
<code class="descname">request_process</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>method</em>, <em>call</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.interface.request_process" title="Permalink to this definition">¶</a></dt>
<dd><p>Process a request into this interface from a proxy / brokerage</p>
<p>When the ttbd daemon is exporting access to a target via any
interface (e.g: REST over Flask or D-Bus or whatever), this
implements a brige to pipe those requests in to this
interface.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>test_target</em></a>) – target upon which we are operating</li>
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – user who is making the request</li>
<li><strong>method</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – ‘POST’, ‘GET’, ‘DELETE’ or ‘PUT’ (mapping
to HTTP requests)</li>
<li><strong>call</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – interface’s operation to perform (it’d map to
the different methods the interface exposes)</li>
<li><strong>args</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of key/value with the arguments
to the call, some might be JSON encoded.</li>
<li><strong>files</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of key/value with the files
uploaded via forms</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>(<a class="reference external" href="https://flask.palletsprojects.com/en/1.1.x/api/#flask.Request.form">https://flask.palletsprojects.com/en/1.1.x/api/#flask.Request.form</a>)
:param str user_path: Path to where user files are located</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dictionary of results, call specific
e.g.:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;SOMETHING&quot;</span><span class="p">,</span>  <span class="c1"># convention for unified result</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;something&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">value</span> <span class="o">=</span> <span class="mi">43</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>For an example, see <a class="reference internal" href="#ttbl.buttons.interface" title="ttbl.buttons.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.buttons.interface</span></code></a>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.capture.generic_snapshot">
<em class="property">class </em><code class="descclassname">ttbl.capture.</code><code class="descname">generic_snapshot</code><span class="sig-paren">(</span><em>name</em>, <em>cmdline</em>, <em>mimetype</em>, <em>pre_commands=None</em>, <em>extension=''</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.generic_snapshot" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a generic snaptshot capturer which can be used to invoke any
program that will do capture a snapshot.</p>
<p>For example, in a server configuration file, define a capturer
that will connect to VNC and take a screenshot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">capture_screenshot_vnc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">generic_snapshot</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;</span><span class="si">%(id)s</span><span class="s2"> VNC @localhost:</span><span class="si">%(vnc_port)s</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># need to make sure vnc_port is defined in the target&#39;s tags</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;gvnccapture -q localhost:</span><span class="si">%(vnc_port)s</span><span class="s2"> </span><span class="si">%(output_file_name)s</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">mimetype</span> <span class="o">=</span> <span class="s2">&quot;image/png&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>Then attach the capture interface to the target with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;TARGETNAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;capture&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">vnc0</span> <span class="o">=</span> <span class="n">capture_screenshot_vnc</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>Now the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf capture-get TARGETNAME vnc0 file.png
</pre></div>
</div>
<p>will download to <code class="docutils literal notranslate"><span class="pre">file.png</span></code> a capture of the target’s screen via
VNC.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>name for error messages from this capturer.</p>
<p>E.g.: <cite>%(id)s HDMI</cite></p>
</li>
<li><strong>cmdline</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>commandline to invoke the capturing the
snapshot.</p>
<p>E.g.: <cite>ffmpeg -i /dev/video-%(id)s</cite>; in this case udev
has been configured to create a symlink called
<em>/dev/video-TARGETNAME</em> so we can uniquely identify the device
associated to screen capture for said target.</p>
</li>
<li><strong>mimetype</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – MIME type of the capture output, eg image/png</li>
<li><strong>pre_commands</strong> (<em>list</em>) – <p>(optional) list of commands (str) to
execute before the command line, to for example, set parameters
eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pre_commands</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># set some video parameter</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;v4l-ctl -i /dev/video-</span><span class="si">%(id)s</span><span class="s2"> -someparam 45&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note all string parameters are <cite>%(keyword)s</cite> expanded from the
target’s tags (as reported by <cite>tcf list -vv TARGETNAME</cite>), such as:</p>
<ul class="simple">
<li>output_file_name: name of the file where to dump the capture
output; file shall be overwritten.</li>
<li>id: target’s name</li>
<li>type: target’s type</li>
<li>… (more with <cite>tcf list -vv TARGETNAME</cite>)</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>extension</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) string to append to the filename,
like for example, an extension. This is needed because some
capture programs <em>insist</em> on guessing the file type from the
file name and balk of there is no proper extension; eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">extension</span> <span class="o">=</span> <span class="s2">&quot;.png&quot;</span>
</pre></div>
</div>
<p>avoid adding the extension to the command name you are asking to
execute, as the system needs to know the full file name.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>System configuration</strong></p>
<p>It is highly recommendable to configure <em>udev</em> to generate device
nodes named after the target’s name, so make configuration simpler
and isolate the system from changes in the device enumeration
order.</p>
<p>For example, adding to <cite>/etc/udev/rules.d/90-ttbd.rules</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;video4linux&quot;</span><span class="p">,</span> <span class="n">ACTION</span> <span class="o">==</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span>           <span class="n">KERNEL</span><span class="o">==</span><span class="s2">&quot;video*&quot;</span><span class="p">,</span>           <span class="n">ENV</span><span class="p">{</span><span class="n">ID_SERIAL</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>           <span class="n">SYMLINK</span> <span class="o">+=</span> <span class="s2">&quot;video-TARGETNAME&quot;</span>
</pre></div>
</div>
<p>where <em>SERIALNUMBER</em> is the serial number of the device that
captures the screen for <em>TARGETNAME</em>. Note it is recommended to
call the video interface <em>video-SOMETHING</em> so that tools such as
<em>ffmpeg</em> won’t be confused.</p>
<dl class="method">
<dt id="ttbl.capture.generic_snapshot.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>target</em>, <em>capturer</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.generic_snapshot.start" title="Permalink to this definition">¶</a></dt>
<dd><p>If this is a streaming capturer, start capturing the stream</p>
<p>Usually starts a program that is active, capturing to a file
until the <a class="reference internal" href="#ttbl.capture.generic_snapshot.stop_and_get" title="ttbl.capture.generic_snapshot.stop_and_get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">stop_and_get()</span></code></a> method is called.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which we are capturing</li>
<li><strong>capturer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of this capturer</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">dictionary of values to pass to the client, usually
nothing</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.capture.generic_snapshot.stop_and_get">
<code class="descname">stop_and_get</code><span class="sig-paren">(</span><em>target</em>, <em>capturer</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.generic_snapshot.stop_and_get" title="Permalink to this definition">¶</a></dt>
<dd><p>If this is a streaming capturer, stop streaming and return the
captured data or take a snapshot and return it.</p>
<p>This stops the capture of the stream and return the file
or take a snapshot capture and return.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which we are capturing</li>
<li><strong>capturer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of this capturer</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>dictionary of values to pass to the client,
including the data; to stream a large file, include a member
in this dictionary called <em>stream_file</em> pointing to the
file’s path; eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">stream_file</span> <span class="o">=</span> <span class="n">CAPTURE_FILE</span><span class="p">)</span>
</pre></div>
</div>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.capture.generic_stream">
<em class="property">class </em><code class="descclassname">ttbl.capture.</code><code class="descname">generic_stream</code><span class="sig-paren">(</span><em>name</em>, <em>cmdline</em>, <em>mimetype</em>, <em>pre_commands=None</em>, <em>wait_to_kill=1</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.generic_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a generic stream capturer which can be used to invoke any
program that will do capture the stream for a while.</p>
<p>For example, in a server configuration file, define a capturer
that will record video with ffmpeg from a camera that is pointing
to the target’s monitor or an HDMI capturer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">capture_vstream_ffmpeg_v4l</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">generic_snapshot</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="s2">&quot;</span><span class="si">%(id)s</span><span class="s2"> screen&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="s2">&quot;ffmpeg -i /dev/video-</span><span class="si">%(id)s</span><span class="s2">-0&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="s2">&quot; -f avi -qscale:v 10 -y </span><span class="si">%(output_file_name)s</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">mimetype</span> <span class="o">=</span> <span class="s2">&quot;video/avi&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">wait_to_kill</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">pre_commands</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;v4l2-ctl -d /dev/video-</span><span class="si">%(id)s</span><span class="s2">-0 -c focus_auto=0&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>Then attach the capture interface to the target with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;TARGETNAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;capture&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">capture</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">hdmi0_vstream</span> <span class="o">=</span> <span class="n">capture_vstream_ffmpeg_v4l</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>Now, when the client runs to start the capture:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf capture-start TARGETNAME hdmi0_vstream
</pre></div>
</div>
<p>will execute in the server the pre-commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ v4l2-ctl -d /dev/video-TARGETNAME-0 -c focus_auto=0
</pre></div>
</div>
<p>and then start recording with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ffmpeg -i /dev/video-TARGETNAME-0 -f avi -qscale:v 10 -y SOMEFILE
</pre></div>
</div>
<p>so that when we decide it is done, in the client:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcf capture-get TARGETNAME hdmi0_vstream file.avi
</pre></div>
</div>
<p>it will stop recording and download the video file with the
recording to <cite>file.avi</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name for error messges from this capturer</li>
<li><strong>cmdline</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – commandline to invoke the capturing of the
stream</li>
<li><strong>mimetype</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – MIME type of the capture output, eg video/avi</li>
<li><strong>pre_commands</strong> (<em>list</em>) – (optional) list of commands (str) to
execute before the command line, to for example, set
volumes.</li>
<li><strong>wait_to_kill</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) time to wait since we send a
SIGTERM to the capturing process until we send a SIGKILL, so it
has time to close the capture file. Defaults to one second.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note all string parameters are <cite>%(keyword)s</cite> expanded from the
target’s tags (as reported by <cite>tcf list -vv TARGETNAME</cite>), such as:</p>
<ul class="simple">
<li>output_file_name: name of the file where to dump the capture
output; file shall be overwritten.</li>
<li>id: target’s name</li>
<li>type: target’s type</li>
<li>… (more with <cite>tcf list -vv TARGETNAME</cite>)</li>
</ul>
<p>For more information, look at <a class="reference internal" href="#ttbl.capture.generic_snapshot" title="ttbl.capture.generic_snapshot"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.capture.generic_snapshot</span></code></a>.</p>
<dl class="method">
<dt id="ttbl.capture.generic_stream.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>target</em>, <em>capturer</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.generic_stream.start" title="Permalink to this definition">¶</a></dt>
<dd><p>If this is a streaming capturer, start capturing the stream</p>
<p>Usually starts a program that is active, capturing to a file
until the <a class="reference internal" href="#ttbl.capture.generic_stream.stop_and_get" title="ttbl.capture.generic_stream.stop_and_get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">stop_and_get()</span></code></a> method is called.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which we are capturing</li>
<li><strong>capturer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of this capturer</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">dictionary of values to pass to the client, usually
nothing</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.capture.generic_stream.stop_and_get">
<code class="descname">stop_and_get</code><span class="sig-paren">(</span><em>target</em>, <em>capturer</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.capture.generic_stream.stop_and_get" title="Permalink to this definition">¶</a></dt>
<dd><p>If this is a streaming capturer, stop streaming and return the
captured data or take a snapshot and return it.</p>
<p>This stops the capture of the stream and return the file
or take a snapshot capture and return.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which we are capturing</li>
<li><strong>capturer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of this capturer</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>dictionary of values to pass to the client,
including the data; to stream a large file, include a member
in this dictionary called <em>stream_file</em> pointing to the
file’s path; eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">stream_file</span> <span class="o">=</span> <span class="n">CAPTURE_FILE</span><span class="p">)</span>
</pre></div>
</div>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-ttbl.debug"></span><div class="section" id="interface-for-common-debug-operations">
<h4>8.8.5.3. Interface for common debug operations<a class="headerlink" href="#interface-for-common-debug-operations" title="Permalink to this headline">¶</a></h4>
<p>A target’s multiple components can expose each debugging interfaces;
these allow some low level control of CPUs, access to JTAG
functionality, etc in an abstract way based on capability.</p>
<p>Debugging can be started or stopped; depending on the driver this
might mean some things are done to allow that debugging support to
happen. In some components it might need a power cycle.</p>
<p>Each component can have its own <a class="reference internal" href="#ttbl.debug.impl_c" title="ttbl.debug.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">driver</span></code></a> or one driver
might service multiple components (eg: in asymetrical SMP systems)
serviced by OpenOCD.</p>
<p>When the debug support for multiple components is implemented by the
same driver, a single call will be made into it with the list of
components it applies to.</p>
<p>The client side is implemented by <a class="reference internal" href="#tcfl.target_ext_debug.extension" title="tcfl.target_ext_debug.extension"><code class="xref py py-class docutils literal notranslate"><span class="pre">target.debug</span></code></a>.</p>
<dl class="class">
<dt id="ttbl.debug.impl_c">
<em class="property">class </em><code class="descclassname">ttbl.debug.</code><code class="descname">impl_c</code><a class="headerlink" href="#ttbl.debug.impl_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Driver interface for a component’s debugging capabilities</p>
<p>The debug interface supports multiple components which will be
called for the top level debug operations; they are implemented by
an instance subclassed from this interface.</p>
<p>Objects that implement the debug interface then can be passed to
the debug interface as implementations; for example, the QEMU
driver exposes a debug interface and thus:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qemu_pc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">qemu</span><span class="o">.</span><span class="n">pc</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="p">(</span> <span class="s2">&quot;x86&quot;</span><span class="p">,</span> <span class="n">qemu_pc</span> <span class="p">)))</span>
</pre></div>
</div>
<p>this assumes that the QEMU driver object <em>qemu_pc</em> has been
instantiated to implement an <em>x86</em> virtual machine; thus the debug
control for the virtual machine <em>x86</em> is registered with the
<em>debug</em> interface.</p>
<dl class="method">
<dt id="ttbl.debug.impl_c.debug_list">
<code class="descname">debug_list</code><span class="sig-paren">(</span><em>target</em>, <em>component</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.impl_c.debug_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide debugging information about the component</p>
<p>Return <em>None</em> if not currently debugging in this component,
otherwise a dicionary keyed by string with information.</p>
<p>If the dictionary is empty, it is assumed that the debugging
is enabled but the target is off, so most services can’t be
accessed.</p>
<p>Known fields:</p>
<ul class="simple">
<li><em>GDB</em>: string describing the location of the GDB bridge
associated to this component in the format
PROTOCOL:ADDRESS:PORT (eg: tcp:some.host.name:4564); it
shall be possible to feed this directly to the <em>gdb target
remote</em> command.</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="ttbl.debug.impl_c.debug_start">
<code class="descname">debug_start</code><span class="sig-paren">(</span><em>target</em>, <em>components</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.impl_c.debug_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Put the components in debugging mode.</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to operate</li>
<li><strong>components</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – list of components on which to operate</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.debug.impl_c.debug_stop">
<code class="descname">debug_stop</code><span class="sig-paren">(</span><em>target</em>, <em>components</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.impl_c.debug_stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Take the components out of debugging mode.</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target on which to operate</li>
<li><strong>components</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – list of components on which to operate</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.debug.impl_c.debug_halt">
<code class="descname">debug_halt</code><span class="sig-paren">(</span><em>target</em>, <em>components</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.impl_c.debug_halt" title="Permalink to this definition">¶</a></dt>
<dd><p>Halt the components’ CPUs</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.debug.impl_c.debug_resume">
<code class="descname">debug_resume</code><span class="sig-paren">(</span><em>target</em>, <em>components</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.impl_c.debug_resume" title="Permalink to this definition">¶</a></dt>
<dd><p>Resume the components’ CPUs</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.debug.impl_c.debug_reset">
<code class="descname">debug_reset</code><span class="sig-paren">(</span><em>target</em>, <em>components</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.impl_c.debug_reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the components’ CPUs</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.debug.impl_c.debug_reset_halt">
<code class="descname">debug_reset_halt</code><span class="sig-paren">(</span><em>target</em>, <em>components</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.impl_c.debug_reset_halt" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset and halt the components’ CPUs</p>
<p>Note it might need a power cycle for the change to be
effective, depending on the component.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.debug.interface">
<em class="property">class </em><code class="descclassname">ttbl.debug.</code><code class="descname">interface</code><span class="sig-paren">(</span><em>*impls</em>, <em>**kwimpls</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.interface" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic debug interface to start and stop debugging on a
target.</p>
<p>When debug is started before the target is powered up, then upon
power up, the debugger stub shall wait for a debugger to connect
before continuing execution.</p>
<p>When debug is started while the target is executing, the target
shall not be stopped and the debugging stub shall permit a
debugger to connect and interrupt the target upon connection.</p>
<p>Each target provides its own debug methodolody; to find out how to
connect, issue a debug-gdb command to find out where to connect
to.</p>
<p>When a target has this capability, the interface can be added to
the target specifying which actual object derived from
<a class="reference internal" href="#ttbl.debug.impl_c" title="ttbl.debug.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">impl_c</span></code></a> implements the functionality, eg, for a target
based on QEMU, QEMU provides a debug interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qemu_pc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">qemu</span><span class="o">.</span><span class="n">pc</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                     <span class="n">ttbl</span><span class="o">.</span><span class="n">tt_interface</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="n">qemu_pc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">})</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#conf_00_lib_pos.target_qemu_pos_add" title="conf_00_lib_pos.target_qemu_pos_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_pos.target_qemu_pos_add()</span></code></a> or
<a class="reference internal" href="#conf_00_lib_mcu.target_qemu_zephyr_add" title="conf_00_lib_mcu.target_qemu_zephyr_add"><code class="xref py py-func docutils literal notranslate"><span class="pre">conf_00_lib_mcu.target_qemu_zephyr_add()</span></code></a> for an example of
this.</p>
<dl class="method">
<dt id="ttbl.debug.interface.get_list">
<code class="descname">get_list</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.interface.get_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.debug.interface.put_start">
<code class="descname">put_start</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.interface.put_start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.debug.interface.put_stop">
<code class="descname">put_stop</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.interface.put_stop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.debug.interface.put_halt">
<code class="descname">put_halt</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.interface.put_halt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.debug.interface.put_resume">
<code class="descname">put_resume</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.interface.put_resume" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.debug.interface.put_reset">
<code class="descname">put_reset</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.interface.put_reset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.debug.interface.put_reset_halt">
<code class="descname">put_reset_halt</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.debug.interface.put_reset_halt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<span class="target" id="module-ttbl.fastboot"></span><div class="section" id="interface-to-provide-flash-the-target-using-fastboot">
<h4>8.8.5.4. Interface to provide flash the target using fastboot<a class="headerlink" href="#interface-to-provide-flash-the-target-using-fastboot" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="ttbl.fastboot.interface">
<em class="property">class </em><code class="descclassname">ttbl.fastboot.</code><code class="descname">interface</code><span class="sig-paren">(</span><em>usb_serial_number</em>, <em>allowed_commands</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fastboot.interface" title="Permalink to this definition">¶</a></dt>
<dd><p>Interface to execute fastboot commands on target</p>
<p>An instance of this gets added as an object to the main target
with something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;targetname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;fastboot&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">fastboot</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="s2">&quot;R1J56L1006ba8b&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># Allow a command called `flash_pos`; the command</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># flash_pos partition_boot /home/ttbd/partition_boot.pos.img</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># will be replaced with:</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># flash partition_boot /home/ttbd/partition_boot.pos.img</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># anything else will be rejected</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="s2">&quot;flash_pos&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="p">(</span> <span class="s2">&quot;flash_pos&quot;</span><span class="p">,</span> <span class="s2">&quot;flash&quot;</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="s2">&quot;partition_boot&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="s2">&quot;/home/ttbd/partition_boot.pos.img&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># Allow a command called `flash`; the command</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># flash partition_boot FILENAME</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># will be replaced with:</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># flash partition_boot /var/lib/ttbd-INSTANCE/USERNAME/FILENAME</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># anything else will be rejected</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="s2">&quot;flash&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="s2">&quot;flash&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="s2">&quot;partition_boot&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="p">(</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^(.+)$&quot;</span><span class="p">),</span> <span class="s2">&quot;%USERPATH%/\g&lt;1&gt;&quot;</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>this allows to control which commands can be executed in the sever
using fastboot, allowing access to the server’s user storage area
(to which files can be uploaded using the <em>tcf broker-upload</em>
command or <a class="reference internal" href="#tcfl.target_ext_store.extension.upload" title="tcfl.target_ext_store.extension.upload"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target.store.upload</span></code></a>).</p>
<p>The server configuration will decide which commands can be
executed or not (a quick list can be obtained with <em>tcf
fastboot-list TARGETNAME</em>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>usb_serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – serial number of the USB device
under which the target exposes the fastboot interface. E.g.:
<code class="docutils literal notranslate"><span class="pre">&quot;R1J56L1006ba8b&quot;</span></code>.</li>
<li><strong>allowed_commands</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – Commands that can be executed with
fastboot. See <a class="reference internal" href="#ttbl.fastboot.interface.allowed_commands" title="ttbl.fastboot.interface.allowed_commands"><code class="xref py py-data docutils literal notranslate"><span class="pre">interface.allowed_commands</span></code></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="ttbl.fastboot.interface.allowed_commands">
<code class="descname">allowed_commands</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.fastboot.interface.allowed_commands" title="Permalink to this definition">¶</a></dt>
<dd><p>Commands that can be executed with fastboot.</p>
<p>This is a KEY/VALUE list. Each KEY is a command name
(which doesn’t necessarily need to map a fastboot command
itself). The <em>VALUE</em> is a list of arguments to fastboot.</p>
<p>The user must send the same amount of arguments as in the
<em>VALUE</em> list.</p>
<p>Each entry in the <em>VALUE</em> list is either a string or a regular
expression. What ever the user sends must match the string or
regular expression. Otherwise it will be rejected.</p>
<p>The entry can be a tuple <em>( STR|REGEX, REPLACEMENT )</em> that
allows to replace what the user sends (using
<a class="reference external" href="https://docs.python.org/2.7/library/re.html#re.sub" title="(in Python v2.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">re.sub()</span></code></a>). In the example above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^(.+)$&quot;</span><span class="p">),</span> <span class="s2">&quot;%USERPATH%/</span><span class="se">\\</span><span class="s2">g&lt;1&gt;&quot;</span> <span class="p">)</span>
</pre></div>
</div>
<p>it is meant to take a filename uploaded to the server’s user
storage area. A match is done on the totality of the argument
(ala: file name) and then <code class="docutils literal notranslate"><span class="pre">\\g&lt;1&gt;</span></code> in the substitution string
is replaced by that match (group #1), to yield
<code class="docutils literal notranslate"><span class="pre">%USERPATH%/FILENAME</span></code>.</p>
<p>Furthermore, the following substitutions are done on the final
strings before passing the arguments to fastboot:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">%USERPATH%</span></code> will get replaced by the current user path</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">There is a potential to exploit the system’s
security if wide access is given to touch files or
execute commands without filtering what the user is
given. Be very restrictive about what commands and
arguments are whitelisted.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.fastboot.interface.path">
<code class="descname">path</code><em class="property"> = '/usr/bin/fastboot'</em><a class="headerlink" href="#ttbl.fastboot.interface.path" title="Permalink to this definition">¶</a></dt>
<dd><p>path to the fastboot binary</p>
<p>can be changed globally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">fastboot</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/some/other/fastboot&quot;</span>
</pre></div>
</div>
<p>or for an specific instance</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;TARGETNAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fastboot</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/some/other/fastboot&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ttbl.fastboot.interface.put_run">
<code class="descname">put_run</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fastboot.interface.put_run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a fastboot command</p>
<p>Note we don’t allow any command execution, only what is
allowed by <a class="reference internal" href="#ttbl.fastboot.interface.allowed_commands" title="ttbl.fastboot.interface.allowed_commands"><code class="xref py py-data docutils literal notranslate"><span class="pre">allowed_commands</span></code></a>, which might also filter
the arguments based on the configuration.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.fastboot.interface.get_list">
<code class="descname">get_list</code><span class="sig-paren">(</span><em>_target</em>, <em>_who</em>, <em>_args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fastboot.interface.get_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<span class="target" id="module-ttbl.images"></span><div class="section" id="flash-binaries-images-into-the-target">
<h4>8.8.5.5. Flash binaries/images into the target<a class="headerlink" href="#flash-binaries-images-into-the-target" title="Permalink to this headline">¶</a></h4>
<p>Interfaces and drivers to flash blobs/binaries/anything into targets;
most commonly these are firmwares, BIOSes, configuration settings that
are sent via some JTAG or firmware upgrade interface.</p>
<p>Interface implemented by <a class="reference internal" href="#ttbl.images.interface" title="ttbl.images.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.images.interface</span></code></a>,
drivers implemented subclassing <a class="reference internal" href="#ttbl.images.impl_c" title="ttbl.images.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.images.impl_c</span></code></a>.</p>
<dl class="class">
<dt id="ttbl.images.impl_c">
<em class="property">class </em><code class="descclassname">ttbl.images.</code><code class="descname">impl_c</code><a class="headerlink" href="#ttbl.images.impl_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Driver interface for flashing with <a class="reference internal" href="#ttbl.images.interface" title="ttbl.images.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">interface</span></code></a></p>
<dl class="method">
<dt id="ttbl.images.impl_c.flash">
<code class="descname">flash</code><span class="sig-paren">(</span><em>target</em>, <em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.images.impl_c.flash" title="Permalink to this definition">¶</a></dt>
<dd><p>Flash <em>images</em> onto <em>target</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to flash</li>
<li><strong>images</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary keyed by image type of the
files (in the servers’s filesystem) that have to be
flashed.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The implementation assumes, per configuration, that this
driver knows how to flash the images of the given type (hence
why it was configured) and shall abort if given an unknown
type.</p>
<p>If multiple images are given, they shall be (when possible)
flashed all at the same time.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.images.interface">
<em class="property">class </em><code class="descclassname">ttbl.images.</code><code class="descname">interface</code><span class="sig-paren">(</span><em>*impls</em>, <em>**kwimpls</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.images.interface" title="Permalink to this definition">¶</a></dt>
<dd><p>Interface to flash a list of images (OS, BIOS, Firmware…) that
can be uploaded to the target server and flashed onto a target.</p>
<p>Any image type can be supported, it is up to the configuration to
set the image types and the driver that can flash them. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;images&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">interface</span><span class="p">({</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel-x86&quot;</span><span class="p">:</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">openocd</span><span class="o">.</span><span class="n">pc</span><span class="p">(),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel-arc&quot;</span><span class="p">:</span> <span class="s2">&quot;kernel-x86&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;rom&quot;</span><span class="p">:</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">dfu_c</span><span class="p">(),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;bootloader&quot;</span><span class="p">:</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">dfu_c</span><span class="p">(),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>Aliases can be specified that will refer to the another type; in
that case it is implied that images that are aliases will all be
flashed in a single call. Thus in the example above, trying to
flash an image of each type would yield three calls:</p>
<ul class="simple">
<li>a single <em>ttbl.openocd.pc.flash()</em> call would be done for images
<em>kernel-x86</em> and <em>kernel-arc</em>, so they would be flashed at the
same time.</li>
<li>a single <em>ttbl.images.dfu_c.flash()</em> call for <em>rom</em></li>
<li>a single <em>ttbl.images.dfu_c.flash()</em> call for <em>bootloader</em></li>
</ul>
<p>If <em>rom</em> were an alias for <em>bootloader</em>, there would be a single
call to <em>ttbl.images.dfu_c.flash()</em>.</p>
<p>The imaging procedure might take control over the target, possibly
powering it on and off (if power control is available). Thus,
after flashing no assumptions shall be made and the safest one is
to call (in the client) <a class="reference internal" href="#tcfl.target_ext_power.extension.cycle" title="tcfl.target_ext_power.extension.cycle"><code class="xref py py-meth docutils literal notranslate"><span class="pre">target.power.cycle</span></code></a> to ensure the right
state.</p>
<dl class="method">
<dt id="ttbl.images.interface.put_flash">
<code class="descname">put_flash</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.images.interface.put_flash" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.images.interface.get_list">
<code class="descname">get_list</code><span class="sig-paren">(</span><em>_target</em>, <em>_who</em>, <em>_args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.images.interface.get_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.images.bossac_c">
<em class="property">class </em><code class="descclassname">ttbl.images.</code><code class="descname">bossac_c</code><span class="sig-paren">(</span><em>serial_port=None</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.images.bossac_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Flash with the <a class="reference external" href="https://github.com/shumatech/BOSSA">bossac</a> tool</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;images&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel-arm&quot;</span><span class="p">:</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">bossac_c</span><span class="p">(),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel&quot;</span><span class="p">:</span> <span class="s2">&quot;kernel-arm&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) File name of the device node
representing the serial port this device is connected
to. Defaults to <em>/dev/tty-TARGETNAME</em>.</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the target’s console tied
to the serial port; this is needed to disable it so this can
flash. Defaults to <em>serial0</em>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><em>Requirements</em></p>
<ul>
<li><p class="first">Needs a connection to the USB programming port, represented as a
serial port (TTY)</p>
</li>
<li><p class="first"><em>bossac</em> has to be available in the path variable <a class="reference internal" href="#ttbl.images.bossac_c.path" title="ttbl.images.bossac_c.path"><code class="xref py py-data docutils literal notranslate"><span class="pre">path</span></code></a>.</p>
</li>
<li><p class="first">(for Arduino Due) uses the bossac utility built on the <em>arduino</em>
branch from <a class="reference external" href="https://github.com/shumatech/BOSSA/tree/arduino">https://github.com/shumatech/BOSSA/tree/arduino</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/shumatech/BOSSA.git bossac.git
$ cd bossac.git
$ make -k
$ sudo install -o root -g root bin/bossac /usr/local/bin
</pre></div>
</div>
</li>
<li><p class="first">TTY devices need to be properly configured permission wise for
bossac to work; for such, choose a Unix group which can get
access to said devices and add udev rules such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Arduino2 boards: allow reading USB descriptors</span>
<span class="n">SUBSYSTEM</span><span class="o">==</span><span class="s2">&quot;usb&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">idVendor</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;2a03&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">idProduct</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;003d&quot;</span><span class="p">,</span>           <span class="n">GROUP</span><span class="o">=</span><span class="s2">&quot;GROUPNAME&quot;</span><span class="p">,</span> <span class="n">MODE</span> <span class="o">=</span> <span class="s2">&quot;660&quot;</span>

<span class="c1"># Arduino2 boards: allow reading serial port</span>
<span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;tty&quot;</span><span class="p">,</span> <span class="n">ENV</span><span class="p">{</span><span class="n">ID_SERIAL_SHORT</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>           <span class="n">GROUP</span> <span class="o">=</span> <span class="s2">&quot;GROUPNAME&quot;</span><span class="p">,</span> <span class="n">MODE</span> <span class="o">=</span> <span class="s2">&quot;0660&quot;</span><span class="p">,</span>           <span class="n">SYMLINK</span> <span class="o">+=</span> <span class="s2">&quot;tty-TARGETNAME&quot;</span>
</pre></div>
</div>
</li>
</ul>
<p>For Arduino Due and others, the theory of operation is quite
simple. According to
<a class="reference external" href="https://www.arduino.cc/en/Guide/ArduinoDue#toc4">https://www.arduino.cc/en/Guide/ArduinoDue#toc4</a>, the Due will
erase the flash if you open the programming port at 1200bps and
then start a reset process and launch the flash when you open the
port at 115200. This is not so clear in the URL above, but this is
what expermientation found.</p>
<p>So for flashing, we’ll take over the console, set the serial
port to 1200bps, wait a wee bit and then call bossac.</p>
<dl class="attribute">
<dt id="ttbl.images.bossac_c.path">
<code class="descname">path</code><em class="property"> = '/usr/bin/bossac'</em><a class="headerlink" href="#ttbl.images.bossac_c.path" title="Permalink to this definition">¶</a></dt>
<dd><p>Path to <em>bossac</em></p>
<p>Change with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">bossac_c</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/bossac&quot;</span>
</pre></div>
</div>
<p>or for a single instance that then will be added to config:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">imager</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">bossac_c</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">SERIAL</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">imager</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span>  <span class="s2">&quot;/usr/local/bin/bossac&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ttbl.images.bossac_c.flash">
<code class="descname">flash</code><span class="sig-paren">(</span><em>target</em>, <em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.images.bossac_c.flash" title="Permalink to this definition">¶</a></dt>
<dd><p>Flash <em>images</em> onto <em>target</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to flash</li>
<li><strong>images</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary keyed by image type of the
files (in the servers’s filesystem) that have to be
flashed.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The implementation assumes, per configuration, that this
driver knows how to flash the images of the given type (hence
why it was configured) and shall abort if given an unknown
type.</p>
<p>If multiple images are given, they shall be (when possible)
flashed all at the same time.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.images.dfu_c">
<em class="property">class </em><code class="descclassname">ttbl.images.</code><code class="descname">dfu_c</code><span class="sig-paren">(</span><em>usb_serial_number</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.images.dfu_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Flash the target with <a class="reference external" href="http://dfu-util.sourceforge.net/">DFU util</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;images&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel-x86&quot;</span><span class="p">:</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">dfu_c</span><span class="p">(),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel-arc&quot;</span><span class="p">:</span> <span class="s2">&quot;kernel-x86&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel&quot;</span><span class="p">:</span> <span class="s2">&quot;kernel-x86&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>usb_serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – target’s USB Serial Number</td>
</tr>
</tbody>
</table>
<p><em>Requirements</em></p>
<ul class="simple">
<li>Needs a connection to the USB port that exposes a DFU
interface upon boot</li>
<li>Uses the dfu-utils utility, available for most (if not all)
Linux distributions</li>
<li>Permissions to use USB devices in <em>/dev/bus/usb</em> are needed;
<em>ttbd</em> usually roots with group <em>root</em>, which shall be
enough.</li>
<li>In most cases, needs power control for proper operation, but
some MCU boards will reset on their own afterwards.</li>
</ul>
<p>Note the tags to the target must include, on each supported
BSP, a tag named <em>dfu_interface_name</em> listing the name of the
<em>altsetting</em> of the DFU interface to which the image for said
BSP needs to be flashed.</p>
<p>This can be found, when the device exposes the DFU interfaces
with the <em>lsusb -v</em> command; for example, for a tinyTILE
(output summarized for clarity):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lsusb -v
...
Bus 002 Device 110: ID 8087:0aba Intel Corp.
Device Descriptor:
  bLength                18
  bDescriptorType         1
  ...
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update...
      iInterface              4 x86_rom
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update...
      iInterface              5 x86_boot
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface              6 x86_app
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface              7 config
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface              8 panic
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface              9 events
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface             10 logs
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface             11 sensor_core
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface             12 ble_core
</pre></div>
</div>
<p>In this case, the three cores available are x86 (x86_app), arc
(sensor_core) and ARM (ble_core).</p>
<p><em>Example</em></p>
<p>A Tiny Tile can be connected, without exposing a serial console:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">test_target</span><span class="p">(</span><span class="s2">&quot;ti-01&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;power&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">interface</span><span class="p">({</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">(</span> <span class="s2">&quot;USB present&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>          <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay_til_usb_device</span><span class="p">(</span><span class="s2">&quot;5614010001031629&quot;</span><span class="p">)</span> <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;images&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel-x86&quot;</span><span class="p">:</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">dfu_c</span><span class="p">(</span><span class="s2">&quot;5614010001031629&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel-arm&quot;</span><span class="p">:</span> <span class="s2">&quot;kernel-x86&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel-arc&quot;</span><span class="p">:</span> <span class="s2">&quot;kernel-x86&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel&quot;</span><span class="p">:</span> <span class="s2">&quot;kernel-x86&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;bsp_models&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;x86+arc&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x86&#39;</span><span class="p">,</span> <span class="s1">&#39;arc&#39;</span><span class="p">],</span> <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;arc&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;bsps&#39;</span> <span class="p">:</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="s2">&quot;x86&quot;</span><span class="p">:</span>  <span class="nb">dict</span><span class="p">(</span><span class="n">zephyr_board</span> <span class="o">=</span> <span class="s2">&quot;tinytile&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">zephyr_kernelname</span> <span class="o">=</span> <span class="s1">&#39;zephyr.bin&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">dfu_interface_name</span> <span class="o">=</span> <span class="s2">&quot;x86_app&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">console</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="s2">&quot;arm&quot;</span><span class="p">:</span>  <span class="nb">dict</span><span class="p">(</span><span class="n">zephyr_board</span> <span class="o">=</span> <span class="s2">&quot;arduino_101_ble&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">zephyr_kernelname</span> <span class="o">=</span> <span class="s1">&#39;zephyr.bin&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">dfu_interface_name</span> <span class="o">=</span> <span class="s2">&quot;ble_core&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">console</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="s2">&quot;arc&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">zephyr_board</span> <span class="o">=</span> <span class="s2">&quot;arduino_101_sss&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="n">zephyr_kernelname</span> <span class="o">=</span> <span class="s1">&#39;zephyr.bin&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="n">dfu_interface_name</span> <span class="o">=</span> <span class="s1">&#39;sensor_core&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="n">console</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;tinytile&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="ttbl.images.dfu_c.path">
<code class="descname">path</code><em class="property"> = '/usr/bin/dfu-tool'</em><a class="headerlink" href="#ttbl.images.dfu_c.path" title="Permalink to this definition">¶</a></dt>
<dd><p>Path to the dfu-tool</p>
<p>Change with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">dfu_c</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/dfu-tool&quot;</span>
</pre></div>
</div>
<p>or for a single instance that then will be added to config:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">imager</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">dfu_c</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">SERIAL</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">imager</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span>  <span class="s2">&quot;/usr/local/bin/dfu-tool&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ttbl.images.dfu_c.flash">
<code class="descname">flash</code><span class="sig-paren">(</span><em>target</em>, <em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.images.dfu_c.flash" title="Permalink to this definition">¶</a></dt>
<dd><p>Flash <em>images</em> onto <em>target</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to flash</li>
<li><strong>images</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary keyed by image type of the
files (in the servers’s filesystem) that have to be
flashed.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The implementation assumes, per configuration, that this
driver knows how to flash the images of the given type (hence
why it was configured) and shall abort if given an unknown
type.</p>
<p>If multiple images are given, they shall be (when possible)
flashed all at the same time.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.images.esptool_c">
<em class="property">class </em><code class="descclassname">ttbl.images.</code><code class="descname">esptool_c</code><span class="sig-paren">(</span><em>serial_port=None</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.images.esptool_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Flash a target using Tensilica’s <em>esptool.py</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;images&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel-xtensa&quot;</span><span class="p">:</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">esptool_c</span><span class="p">(),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;kernel&quot;</span><span class="p">:</span> <span class="s2">&quot;kernel-xtensa&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) File name of the device node
representing the serial port this device is connected
to. Defaults to <em>/dev/tty-TARGETNAME</em>.</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the target’s console tied
to the serial port; this is needed to disable it so this can
flash. Defaults to <em>serial0</em>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><em>Requirements</em></p>
<ul>
<li><p class="first">The ESP-IDF framework, of which <code class="docutils literal notranslate"><span class="pre">esptool.py</span></code> is used to
flash the target; to install:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd /opt
$ git clone --recursive https://github.com/espressif/esp-idf.git
</pre></div>
</div>
<p>(note the <code class="docutils literal notranslate"><span class="pre">--recursive</span></code>!! it is needed so all the submodules
are picked up)</p>
<p>configure path to it globally by setting
<a class="reference internal" href="#ttbl.images.esptool_c.path" title="ttbl.images.esptool_c.path"><code class="xref py py-attr docutils literal notranslate"><span class="pre">path</span></code></a> in a /etc/ttbd-production/conf_*.py file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ttbl.tt</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">esptool_c</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/opt/esp-idf/components/esptool_py/esptool/esptool.py&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Permissions to use USB devices in <em>/dev/bus/usb</em> are needed;
<em>ttbd</em> usually roots with group <em>root</em>, which shall be
enough.</p>
</li>
<li><p class="first">Needs power control for proper operation; FIXME: pending to
make it operate without power control, using <code class="docutils literal notranslate"><span class="pre">esptool.py</span></code>.</p>
</li>
</ul>
<p>The base code will convert the <em>ELF</em> image to the required
<em>bin</em> image using the <code class="docutils literal notranslate"><span class="pre">esptool.py</span></code> script. Then it will
flash it via the serial port.</p>
<dl class="attribute">
<dt id="ttbl.images.esptool_c.path">
<code class="descname">path</code><em class="property"> = '__unconfigured__ttbl.images.esptool_c.path__'</em><a class="headerlink" href="#ttbl.images.esptool_c.path" title="Permalink to this definition">¶</a></dt>
<dd><p>Path to <em>esptool.py</em></p>
<p>Change with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">esptool_c</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/bin/esptool.py&quot;</span>
</pre></div>
</div>
<p>or for a single instance that then will be added to config:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">imager</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">esptool_c</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">SERIAL</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">imager</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span>  <span class="s2">&quot;/usr/local/bin/esptool.py&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ttbl.images.esptool_c.flash">
<code class="descname">flash</code><span class="sig-paren">(</span><em>target</em>, <em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.images.esptool_c.flash" title="Permalink to this definition">¶</a></dt>
<dd><p>Flash <em>images</em> onto <em>target</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to flash</li>
<li><strong>images</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary keyed by image type of the
files (in the servers’s filesystem) that have to be
flashed.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The implementation assumes, per configuration, that this
driver knows how to flash the images of the given type (hence
why it was configured) and shall abort if given an unknown
type.</p>
<p>If multiple images are given, they shall be (when possible)
flashed all at the same time.</p>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-ttbl.ioc_flash_server_app"></span><div class="section" id="interface-to-flash-the-target-using-ioc-flash-server-app">
<h4>8.8.5.6. Interface to flash the target using <em>ioc_flash_server_app</em><a class="headerlink" href="#interface-to-flash-the-target-using-ioc-flash-server-app" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="ttbl.ioc_flash_server_app.interface">
<em class="property">class </em><code class="descclassname">ttbl.ioc_flash_server_app.</code><code class="descname">interface</code><span class="sig-paren">(</span><em>tty_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ioc_flash_server_app.interface" title="Permalink to this definition">¶</a></dt>
<dd><p>Remote tool interface</p>
<p>An instance of this gets added as an object to the main target
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;TARGETNAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interface_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;ioc_flash_server_app&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">ioc_flash_server_app</span><span class="o">.</span><span class="n">interface</span><span class="p">(</span><span class="s2">&quot;/dev/tty-TARGETNAME-FW&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">/dev/tty-TARGETNAME-FW</span></code> is the serial line for the IOC
firmware interface for <em>TARGETNAME</em>.</p>
<p>Note this requires the Intel Platform Flash Tool installed in your
system; this driver will expect the binary available in a location
described by <a class="reference internal" href="#ttbl.ioc_flash_server_app.interface.path" title="ttbl.ioc_flash_server_app.interface.path"><code class="xref py py-data docutils literal notranslate"><span class="pre">path</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>tty_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – path to the target’s IOC firmware serial port</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="ttbl.ioc_flash_server_app.interface.path">
<code class="descname">path</code><em class="property"> = '/opt/intel/platformflashtool/bin/ioc_flash_server_app'</em><a class="headerlink" href="#ttbl.ioc_flash_server_app.interface.path" title="Permalink to this definition">¶</a></dt>
<dd><p>path to the binary</p>
<p>can be changed globally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">ioc_flash_server_app</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/some/other/ioc_flash_server_app&quot;</span>
</pre></div>
</div>
<p>or for an specific instance</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;TARGETNAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ioc_flash_server_app</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="s2">&quot;/some/other/ioc_flash_server_app&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.ioc_flash_server_app.interface.allowed_modes">
<code class="descname">allowed_modes</code><em class="property"> = ('fabA', 'fabB', 'fabC', 'grfabab', 'grfabc', 'grfabd', 'grfabe', 'hadfaba', 'kslfaba', 'generic', 'w', 't')</em><a class="headerlink" href="#ttbl.ioc_flash_server_app.interface.allowed_modes" title="Permalink to this definition">¶</a></dt>
<dd><p>allowed operation modes</p>
<p>these translate directly to the command line option <code class="docutils literal notranslate"><span class="pre">-MODE</span></code></p>
<ul class="simple">
<li><em>fabA</em></li>
<li><em>fabB</em></li>
<li><em>fabC</em></li>
<li><em>grfabab</em></li>
<li><em>grfabc</em></li>
<li><em>grfabd</em></li>
<li><em>grfabe</em></li>
<li><em>hadfaba</em></li>
<li><em>kslfaba</em></li>
<li><em>generic</em> (requires the <em>generic_id</em> parameter too)</li>
<li><em>w</em></li>
<li><em>t</em></li>
</ul>
</dd></dl>

<dl class="method">
<dt id="ttbl.ioc_flash_server_app.interface.put_run">
<code class="descname">put_run</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.ioc_flash_server_app.interface.put_run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<span class="target" id="module-ttbl.things"></span><div class="section" id="connect-targets-to-other-targets">
<h4>8.8.5.7. Connect targets to other targets<a class="headerlink" href="#connect-targets-to-other-targets" title="Permalink to this headline">¶</a></h4>
<p>This module defines the interface to make targets connect to each
other and control that process.</p>
<p>For example, you can have a target that implements a USB disk being
connected to another via USB.</p>
<p>The interface to the target is the <a class="reference internal" href="#ttbl.things.interface" title="ttbl.things.interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.things.interface</span></code></a>,
which delegates on the the different <em>thing</em> drivers
(<a class="reference internal" href="#ttbl.things.impl_c" title="ttbl.things.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.things.impl_c</span></code></a>) the implementation of the methodology to
plug or unplug the targets.</p>
<dl class="class">
<dt id="ttbl.things.impl_c">
<em class="property">class </em><code class="descclassname">ttbl.things.</code><code class="descname">impl_c</code><span class="sig-paren">(</span><em>name=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.things.impl_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Define how to plug a thing (which is a target) into a target</p>
<p>Each of this drivers implements the details that allows the thing
to be plugged or unplugged from the target. For example:</p>
<ul class="simple">
<li>this might be controlling a relay that connects/disconnects the
USB lines in a cable so that it emulates a human
connecting/disconnecting</li>
<li>this might be controlling a mechanical device which
plugs/unplugs a cable</li>
</ul>
<dl class="method">
<dt id="ttbl.things.impl_c.plug">
<code class="descname">plug</code><span class="sig-paren">(</span><em>target</em>, <em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.things.impl_c.plug" title="Permalink to this definition">¶</a></dt>
<dd><p>Plug <em>thing</em> into <em>target</em></p>
<p>Caller owns both <em>target</em> and <em>thing</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to plug</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to plug into <em>target</em></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.things.impl_c.unplug">
<code class="descname">unplug</code><span class="sig-paren">(</span><em>target</em>, <em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.things.impl_c.unplug" title="Permalink to this definition">¶</a></dt>
<dd><p>Unplug <em>thing</em> from <em>target</em></p>
<p>Caller owns <em>target</em> (not <em>thing</em> necessarily)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to unplug from</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to unplug</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.things.impl_c.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>target</em>, <em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.things.impl_c.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to unplug from</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to unplug</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>True</em> if <em>thing</em> is connected to <em>target</em>, <em>False</em>
otherwise.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.things.interface">
<em class="property">class </em><code class="descclassname">ttbl.things.</code><code class="descname">interface</code><span class="sig-paren">(</span><em>*impls</em>, <em>**kwimpls</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.things.interface" title="Permalink to this definition">¶</a></dt>
<dd><p>Define how to plug things (targets) into other targets</p>
<p>A thing is a target that can be, in any form, connected to another
target. For example, a USB device to a host, where both the US
device and host are targets. This is so that we can make sure
they are owned by someone before plugging, as it can alter state.</p>
<p>For the specificatio of <em>impls</em> and <em>kwimpls</em>, see
<a class="reference internal" href="#ttbl.tt_interface.impls_set" title="ttbl.tt_interface.impls_set"><code class="xref py py-func docutils literal notranslate"><span class="pre">ttbl.tt_interface.impls_set()</span></code></a>, taking into account all
implementations need to be objects derived from
<a class="reference internal" href="#ttbl.things.impl_c" title="ttbl.things.impl_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">ttbl.things.impl_c</span></code></a>.</p>
<dl class="method">
<dt id="ttbl.things.interface.get_list">
<code class="descname">get_list</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>_args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.things.interface.get_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.things.interface.get_get">
<code class="descname">get_get</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.things.interface.get_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Plug <em>thing</em> into <em>target</em></p>
<p>The user who is plugging must own this target <em>and</em> the thing.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.things.interface.put_plug">
<code class="descname">put_plug</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.things.interface.put_plug" title="Permalink to this definition">¶</a></dt>
<dd><p>Plug <em>thing</em> into <em>target</em></p>
<p>The user who is plugging must own this target <em>and</em> the thing.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.things.interface.put_unplug">
<code class="descname">put_unplug</code><span class="sig-paren">(</span><em>target</em>, <em>who</em>, <em>args</em>, <em>_files</em>, <em>_user_path</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.things.interface.put_unplug" title="Permalink to this definition">¶</a></dt>
<dd><p>Unplug <em>thing</em> from <em>target</em></p>
<p>The user who is unplugging must own this target, but don’t
necessary need to own the thing.</p>
<p>Note that when you release the target, all the things
connected to it are released, even if you don’t own the
things.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-commonl">
<span id="common-helper-library"></span><h3>8.8.6. Common helper library<a class="headerlink" href="#module-commonl" title="Permalink to this headline">¶</a></h3>
<p>Common timo infrastructure and code
Command line and logging helpers</p>
<div class="admonition-fixmes admonition">
<p class="first admonition-title">FIXMEs</p>
<ul class="last simple">
<li>This is still leaking temporary files (subpython’s stdout and
stderr) when running top level tests.</li>
</ul>
</div>
<dl class="function">
<dt id="commonl.config_import_file">
<code class="descclassname">commonl.</code><code class="descname">config_import_file</code><span class="sig-paren">(</span><em>filename</em>, <em>namespace='__main__'</em>, <em>raise_on_fail=True</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.config_import_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Import a Python [configuration] file.</p>
<p>Any symbol available to the current namespace is available to the
configuration file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>filename</strong> – path and file name to load.</li>
<li><strong>namespace</strong> – namespace where to insert the configuration file</li>
<li><strong>raise_on_fail</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) raise an exception if the
importing of the config file fails.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timo</span><span class="o">.</span><span class="n">config_import_file</span><span class="p">(</span><span class="s2">&quot;some/path/file.py&quot;</span><span class="p">,</span> <span class="s2">&quot;__main__&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="commonl.path_expand">
<code class="descclassname">commonl.</code><code class="descname">path_expand</code><span class="sig-paren">(</span><em>path_list</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.path_expand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.config_import">
<code class="descclassname">commonl.</code><code class="descname">config_import</code><span class="sig-paren">(</span><em>path_list</em>, <em>file_regex</em>, <em>namespace='__main__'</em>, <em>raise_on_fail=True</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.config_import" title="Permalink to this definition">¶</a></dt>
<dd><p>Import Python [configuration] files that match file_regex in any of
the list of given paths into the given namespace.</p>
<p>Any symbol available to the current namespace is available to the
configuration file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>paths</strong> – list of paths where to import from; each item can be
a list of colon separated paths and thus the list would be further
expanded. If an element is the empty list, it removes the
current list.</li>
<li><strong>file_regex</strong> – a compiled regular expression to match the file
name against.</li>
<li><strong>namespace</strong> – namespace where to insert the configuration file</li>
<li><strong>raise_on_fail</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) raise an exception if the
importing of the config file fails.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timo</span><span class="o">.</span><span class="n">config_import</span><span class="p">([</span> <span class="s2">&quot;.config:/etc/config&quot;</span> <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                   <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;conf[_-].*.py&quot;</span><span class="p">),</span> <span class="s2">&quot;__main__&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="commonl.logging_verbosity_inc">
<code class="descclassname">commonl.</code><code class="descname">logging_verbosity_inc</code><span class="sig-paren">(</span><em>level</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.logging_verbosity_inc" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.logfile_open">
<code class="descclassname">commonl.</code><code class="descname">logfile_open</code><span class="sig-paren">(</span><em>tag</em>, <em>cls=None</em>, <em>delete=True</em>, <em>bufsize=0</em>, <em>suffix='.log'</em>, <em>who=None</em>, <em>directory=None</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.logfile_open" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.log_format_compose">
<code class="descclassname">commonl.</code><code class="descname">log_format_compose</code><span class="sig-paren">(</span><em>log_format</em>, <em>log_pid</em>, <em>log_time=False</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.log_format_compose" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.cmdline_log_options">
<code class="descclassname">commonl.</code><code class="descname">cmdline_log_options</code><span class="sig-paren">(</span><em>parser</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.cmdline_log_options" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes a parser with the standard command line options to
control verbosity when using the logging module</p>
<p>:param python:argparse.ArgParser parser: command line argument parser</p>
<p>-v|–verbose to increase verbosity (defaults to print/log errors only)</p>
<p>Note that after processing the command line options, you need to
initialize logging with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">argparse</span><span class="o">,</span> <span class="nn">timo.core</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arg_parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">timo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">cmdline_log_options</span><span class="p">(</span><span class="n">arg_parser</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="n">arg_parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">log_format</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="commonl.mkid">
<code class="descclassname">commonl.</code><code class="descname">mkid</code><span class="sig-paren">(</span><em>something</em>, <em>l=10</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.mkid" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a 10 character base32 ID out of an iterable object</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>something</strong> – anything from which an id has to be generate
(anything iterable)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.trim_trailing">
<code class="descclassname">commonl.</code><code class="descname">trim_trailing</code><span class="sig-paren">(</span><em>s</em>, <em>trailer</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.trim_trailing" title="Permalink to this definition">¶</a></dt>
<dd><p>Trim <em>trailer</em> from the end of <em>s</em> (if present) and return it.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>s</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – string to trim from</li>
<li><strong>trailer</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – string to trim</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.name_make_safe">
<code class="descclassname">commonl.</code><code class="descname">name_make_safe</code><span class="sig-paren">(</span><em>name</em>, <em>safe_chars=None</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.name_make_safe" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a filename, return the same filename will all characters not
in the set [-_.0-9a-zA-Z] replaced with _.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name to make <em>safe</em></li>
<li><strong>safe_chars</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#set" title="(in Python v2.7)"><em>set</em></a>) – (potional) set of characters that are
considered safe. Defaults to ASCII letters and digits plus - and
_.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.file_name_make_safe">
<code class="descclassname">commonl.</code><code class="descname">file_name_make_safe</code><span class="sig-paren">(</span><em>file_name</em>, <em>extra_chars=':/'</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.file_name_make_safe" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a filename, return the same filename will all characters not
in the set [-_.0-9a-zA-Z] removed.</p>
<p>This is useful to kinda make a URL into a file name, but it’s not
bidirectional (as it is destructive) and not very fool proof.</p>
</dd></dl>

<dl class="function">
<dt id="commonl.hash_file">
<code class="descclassname">commonl.</code><code class="descname">hash_file</code><span class="sig-paren">(</span><em>hash_object</em>, <em>filepath</em>, <em>blk_size=8192</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.hash_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a the contents of a file though a hash generator.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>hash_object</strong> – hash object (from <a class="reference external" href="https://docs.python.org/2.7/library/hashlib.html#module-hashlib" title="(in Python v2.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">hashlib</span></code></a>)</li>
<li><strong>filepath</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – path to the file to feed</li>
<li><strong>blk_size</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – read the file in chunks of that size (in bytes)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.request_response_maybe_raise">
<code class="descclassname">commonl.</code><code class="descname">request_response_maybe_raise</code><span class="sig-paren">(</span><em>response</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.request_response_maybe_raise" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.os_path_split_full">
<code class="descclassname">commonl.</code><code class="descname">os_path_split_full</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.os_path_split_full" title="Permalink to this definition">¶</a></dt>
<dd><p>Split an absolute path in all the directory components</p>
</dd></dl>

<dl class="function">
<dt id="commonl.progress">
<code class="descclassname">commonl.</code><code class="descname">progress</code><span class="sig-paren">(</span><em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.progress" title="Permalink to this definition">¶</a></dt>
<dd><p>Print some sort of progress information banner to standard error
output that will be overriden with real information.</p>
<p>This only works when stdout or stderr are not redirected to files
and is intended to give humans a feel of what’s going on.</p>
</dd></dl>

<dl class="function">
<dt id="commonl.digits_in_base">
<code class="descclassname">commonl.</code><code class="descname">digits_in_base</code><span class="sig-paren">(</span><em>number</em>, <em>base</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.digits_in_base" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a number to a list of the digits it would have if written
in base &#64;base.</p>
<dl class="docutils">
<dt>For example:</dt>
<dd><ul class="first last simple">
<li>(16, 2) -&gt; [1, 6] as 1*10 + 6 = 16</li>
<li>(44, 4) -&gt; [2, 3, 0] as 2*4*4 + 3*4 + 0 = 44</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="commonl.rm_f">
<code class="descclassname">commonl.</code><code class="descname">rm_f</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.rm_f" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a file (not a directory) unconditionally, ignore errors if
it does not exist.</p>
</dd></dl>

<dl class="function">
<dt id="commonl.makedirs_p">
<code class="descclassname">commonl.</code><code class="descname">makedirs_p</code><span class="sig-paren">(</span><em>dirname</em>, <em>mode=None</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.makedirs_p" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a directory tree, ignoring an error if it already exists</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>pathname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – directory tree to crate</li>
<li><strong>mode</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – mode set the directory to</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.symlink_f">
<code class="descclassname">commonl.</code><code class="descname">symlink_f</code><span class="sig-paren">(</span><em>source</em>, <em>dest</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.symlink_f" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a symlink, ignoring an error if it already exists</p>
</dd></dl>

<dl class="function">
<dt id="commonl.process_alive">
<code class="descclassname">commonl.</code><code class="descname">process_alive</code><span class="sig-paren">(</span><em>pidfile</em>, <em>path=None</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.process_alive" title="Permalink to this definition">¶</a></dt>
<dd><p>Return if a process path/PID combination is alive from the
standpoint of the calling context (in terms of UID permissions,
etc).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pidfile</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – path to pid file (or)</li>
<li><strong>pidfile</strong> – PID of the process to check (in str form) (or)</li>
<li><strong>pidfile</strong> – PID of the process to check</li>
<li><strong>path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – path binary that runs the process</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">PID number if alive, <em>None</em> otherwise (might be running as a
separate user, etc)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.process_terminate">
<code class="descclassname">commonl.</code><code class="descname">process_terminate</code><span class="sig-paren">(</span><em>pid</em>, <em>pidfile=None</em>, <em>tag=None</em>, <em>path=None</em>, <em>wait_to_kill=0.25</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.process_terminate" title="Permalink to this definition">¶</a></dt>
<dd><p>Terminate a process (TERM and KILL after 0.25s)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>pid</strong> – PID of the process to kill; this can be an
integer, a string representation of an integer or a path to a
PIDfile.</li>
<li><strong>pidfile</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) pidfile to remove [deprecated]</li>
<li><strong>path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) path to the binary</li>
<li><strong>tag</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) prefix to error messages</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.process_started">
<code class="descclassname">commonl.</code><code class="descname">process_started</code><span class="sig-paren">(</span><em>pidfile</em>, <em>path</em>, <em>tag=None</em>, <em>log=None</em>, <em>verification_f=None</em>, <em>verification_f_args=None</em>, <em>timeout=5</em>, <em>poll_period=0.3</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.process_started" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.origin_get">
<code class="descclassname">commonl.</code><code class="descname">origin_get</code><span class="sig-paren">(</span><em>depth=1</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.origin_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the name of the file and line from which this was called</p>
</dd></dl>

<dl class="function">
<dt id="commonl.origin_fn_get">
<code class="descclassname">commonl.</code><code class="descname">origin_fn_get</code><span class="sig-paren">(</span><em>depth=1</em>, <em>sep=':'</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.origin_fn_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the name of the function and line from which this was called</p>
</dd></dl>

<dl class="function">
<dt id="commonl.kws_update_type_string">
<code class="descclassname">commonl.</code><code class="descname">kws_update_type_string</code><span class="sig-paren">(</span><em>kws</em>, <em>rt</em>, <em>kws_origin=None</em>, <em>origin=None</em>, <em>prefix=''</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.kws_update_type_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a dictionary, update the second only using those keys with
string values</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>kws</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – destination dictionary</li>
<li><strong>d</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – source dictionary</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.kws_update_from_rt">
<code class="descclassname">commonl.</code><code class="descname">kws_update_from_rt</code><span class="sig-paren">(</span><em>kws</em>, <em>rt</em>, <em>kws_origin=None</em>, <em>origin=None</em>, <em>prefix=''</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.kws_update_from_rt" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a target’s tags, update the keywords valid for exporting and
evaluation</p>
<p>This means filtering out things that are not strings and maybe
others, decided in a case by case basis.</p>
<p>We make sure we fix the type and ‘target’ as the fullid.</p>
</dd></dl>

<dl class="function">
<dt id="commonl.if_present">
<code class="descclassname">commonl.</code><code class="descname">if_present</code><span class="sig-paren">(</span><em>ifname</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.if_present" title="Permalink to this definition">¶</a></dt>
<dd><p>Return if network interface <em>ifname</em> is present in the system</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ifname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the network interface to remove</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if interface exists, False otherwise</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.if_index">
<code class="descclassname">commonl.</code><code class="descname">if_index</code><span class="sig-paren">(</span><em>ifname</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.if_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the interface index for <em>ifname</em> is present in the system</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ifname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the network interface</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">index of the interface, or None if not present</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.if_find_by_mac">
<code class="descclassname">commonl.</code><code class="descname">if_find_by_mac</code><span class="sig-paren">(</span><em>mac</em>, <em>physical=True</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.if_find_by_mac" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the name of the physical network interface whose MAC
address matches <em>mac</em>.</p>
<p>Note the comparison is made at the string level, case
insensitive.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>mac</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – MAC address of the network interface to find</li>
<li><strong>physical</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – True if only look for physical devices (eg:
not vlans); this means there a <em>device</em> symlink in
<em>/sys/class/net/DEVICE/</em></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Name of the interface if it exists, None otherwise</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.if_remove">
<code class="descclassname">commonl.</code><code class="descname">if_remove</code><span class="sig-paren">(</span><em>ifname</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.if_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove from the system a network interface using
<em>ip link del</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ifname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the network interface to remove</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">nothing</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.if_remove_maybe">
<code class="descclassname">commonl.</code><code class="descname">if_remove_maybe</code><span class="sig-paren">(</span><em>ifname</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.if_remove_maybe" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove from the system a network interface (if it exists) using
<em>ip link del</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ifname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the network interface to remove</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">nothing</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.ps_children_list">
<code class="descclassname">commonl.</code><code class="descname">ps_children_list</code><span class="sig-paren">(</span><em>pid</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.ps_children_list" title="Permalink to this definition">¶</a></dt>
<dd><p>List all the PIDs that are children of a give process</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>pid</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – PID whose children we are looking for</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">set of PIDs children of <em>PID</em> (if any)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.ps_zombies_list">
<code class="descclassname">commonl.</code><code class="descname">ps_zombies_list</code><span class="sig-paren">(</span><em>pids</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.ps_zombies_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of PIDs, return which are zombies</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>pids</strong> – iterable list of numeric PIDs</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">set of PIDs which are zombies</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.version_get">
<code class="descclassname">commonl.</code><code class="descname">version_get</code><span class="sig-paren">(</span><em>module</em>, <em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.version_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.tcp_port_busy">
<code class="descclassname">commonl.</code><code class="descname">tcp_port_busy</code><span class="sig-paren">(</span><em>port</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.tcp_port_busy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.tcp_port_assigner">
<code class="descclassname">commonl.</code><code class="descname">tcp_port_assigner</code><span class="sig-paren">(</span><em>ports=1</em>, <em>port_range=(1025</em>, <em>65530)</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.tcp_port_assigner" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.tcp_port_connectable">
<code class="descclassname">commonl.</code><code class="descname">tcp_port_connectable</code><span class="sig-paren">(</span><em>hostname</em>, <em>port</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.tcp_port_connectable" title="Permalink to this definition">¶</a></dt>
<dd><p>Return true if we can connect to a TCP port</p>
</dd></dl>

<dl class="function">
<dt id="commonl.conditional_eval">
<code class="descclassname">commonl.</code><code class="descname">conditional_eval</code><span class="sig-paren">(</span><em>tag</em>, <em>kw</em>, <em>conditional</em>, <em>origin</em>, <em>kind='conditional'</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.conditional_eval" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate an action’s conditional string to determine if it
should be considered or not.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns bool:</th><td class="field-body">True if the action must be considered, False
otherwise.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.check_dir">
<code class="descclassname">commonl.</code><code class="descname">check_dir</code><span class="sig-paren">(</span><em>path</em>, <em>what</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.check_dir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.check_dir_writeable">
<code class="descclassname">commonl.</code><code class="descname">check_dir_writeable</code><span class="sig-paren">(</span><em>path</em>, <em>what</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.check_dir_writeable" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.prctl_cap_get_effective">
<code class="descclassname">commonl.</code><code class="descname">prctl_cap_get_effective</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#commonl.prctl_cap_get_effective" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an integer describing the effective capabilities of this process</p>
</dd></dl>

<dl class="function">
<dt id="commonl.which">
<code class="descclassname">commonl.</code><code class="descname">which</code><span class="sig-paren">(</span><em>cmd</em>, <em>mode=1</em>, <em>path=None</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.which" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a command, mode, and a PATH string, return the path which
conforms to the given mode on the PATH, or None if there is no such
file.</p>
<p><cite>mode</cite> defaults to os.F_OK | os.X_OK. <cite>path</cite> defaults to the result
of os.environ.get(“PATH”), or can be overridden with a custom search
path.</p>
</dd></dl>

<dl class="function">
<dt id="commonl.ttbd_locate_helper">
<code class="descclassname">commonl.</code><code class="descname">ttbd_locate_helper</code><span class="sig-paren">(</span><em>filename</em>, <em>log=&lt;module 'logging' from '/usr/lib64/python2.7/logging/__init__.pyc'&gt;</em>, <em>relsrcpath=''</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.ttbd_locate_helper" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the path to a TTBD file, depending on we running from source
or installed system wide.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the TTBD file we are looking for.</li>
<li><strong>relsrcpath</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – path relative to the running binary in the source</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.raise_from">
<code class="descclassname">commonl.</code><code class="descname">raise_from</code><span class="sig-paren">(</span><em>what</em>, <em>cause</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.raise_from" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward compath to Python 3’s raise X from Y</p>
</dd></dl>

<dl class="class">
<dt id="commonl.dict_missing_c">
<em class="property">class </em><code class="descclassname">commonl.</code><code class="descname">dict_missing_c</code><span class="sig-paren">(</span><em>d</em>, <em>missing=None</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.dict_missing_c" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary that returns as a value a string KEY_UNDEFINED_SYMBOL
if KEY is not in the dictionary.</p>
<p>This is useful for things like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;%(idonthavethis)&quot;</span> <span class="o">%</span> <span class="n">dict_missing_c</span><span class="p">({</span><span class="s2">&quot;ihavethis&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="s2">&quot;}</span>
</pre></div>
</div>
<p>to print “idonthavethis_UNDEFINED_SYMBOL” intead of raising KeyError</p>
</dd></dl>

<dl class="function">
<dt id="commonl.ipv4_len_to_netmask_ascii">
<code class="descclassname">commonl.</code><code class="descname">ipv4_len_to_netmask_ascii</code><span class="sig-paren">(</span><em>length</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.ipv4_len_to_netmask_ascii" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.password_get">
<code class="descclassname">commonl.</code><code class="descname">password_get</code><span class="sig-paren">(</span><em>domain</em>, <em>user</em>, <em>password</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.password_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the password for a domain and user</p>
<p>This returns a password obtained from a configuration file, maybe
accessing secure password storage services to get the real
password. This is intended to be use as a service to translate
passwords specified in config files, which in some time might be
cleartext, in others obtained from services.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">real_password</span> <span class="o">=</span> <span class="n">password_get</span><span class="p">(</span><span class="s2">&quot;somearea&quot;</span><span class="p">,</span> <span class="s2">&quot;rtmorris&quot;</span><span class="p">,</span> <span class="s2">&quot;KEYRING&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>will query the <em>keyring</em> service for the password to use for user
<em>rtmorris</em> on domain <em>somearea</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">real_password</span> <span class="o">=</span> <span class="n">password_get</span><span class="p">(</span><span class="s2">&quot;somearea&quot;</span><span class="p">,</span> <span class="s2">&quot;rtmorris&quot;</span><span class="p">,</span> <span class="s2">&quot;KEYRING:Area51&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>would do the same, but <em>keyring</em>’s domain would be <em>Area51</em>
instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">real_password</span> <span class="o">=</span> <span class="n">password_get</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;rtmorris&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="s2">&quot;FILE:/etc/config/some.key&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>would obtain the password from the contents of file
<em>/etc/config/some.key</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">real_password</span> <span class="o">=</span> <span class="n">password_get</span><span class="p">(</span><span class="s2">&quot;somearea&quot;</span><span class="p">,</span> <span class="s2">&quot;rtmorris&quot;</span><span class="p">,</span> <span class="s2">&quot;sikrit&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>would just return <em>sikrit</em> as a password.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>domain</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – a domain to which this password operation
applies; see below <em>password</em> (can be <em>None</em>)</li>
<li><strong>user</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – the username for maybe obtaining a password from
a password service; see below <em>password</em>.</li>
<li><strong>password</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>a password obtained from the user or a
configuration setting; can be <em>None</em>. If the <em>password</em> is</p>
<ul>
<li><dl class="first docutils">
<dt><em>KEYRING</em> will ask the accounts keyring for the password</dt>
<dd>for domain <em>domain</em> for username <em>user</em></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><em>KEYRING:DOMAIN</em> will ask the accounts keyring for the password</dt>
<dd>for domain <em>DOMAIN</em> for username <em>user</em>, ignoring the
<em>domain</em> parameter.</dd>
</dl>
</li>
<li><em>FILE:PATH</em> will read the password from filename <em>PATH</em>.</li>
</ul>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the actual password to use</p>
</td>
</tr>
</tbody>
</table>
<p>Password management procedures (FIXME):</p>
<ul>
<li><p class="first">to set a password in the keyring:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo KEYRINGPASSWORD | gnome-keyring-daemon --unlock
$ keyring set &quot;USER&quot;  DOMAIN
Password for &#39;DOMAIN&#39; in &#39;USER&#39;: &lt;ENTER PASSWORD HERE&gt;
</pre></div>
</div>
</li>
<li><p class="first">to be able to run the daemon has to be executed under a dbus session:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dbus-session -- sh
$ echo KEYRINGPASSWORD | gnome-keyring-daemon --unlock
$ ttbd...etc
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="commonl.split_user_pwd_hostname">
<code class="descclassname">commonl.</code><code class="descname">split_user_pwd_hostname</code><span class="sig-paren">(</span><em>s</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.split_user_pwd_hostname" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a tuple decomponsing <code class="docutils literal notranslate"><span class="pre">[USER[:PASSWORD]&#64;HOSTNAME</span></code></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">tuple <em>( USER, PASSWORD, HOSTNAME )</em>, <em>None</em> in missing fields.</td>
</tr>
</tbody>
</table>
<p>See <a class="reference internal" href="#commonl.password_get" title="commonl.password_get"><code class="xref py py-func docutils literal notranslate"><span class="pre">password_get()</span></code></a> for details on how the password is handled.</p>
</dd></dl>

<dl class="function">
<dt id="commonl.url_remove_user_pwd">
<code class="descclassname">commonl.</code><code class="descname">url_remove_user_pwd</code><span class="sig-paren">(</span><em>url</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.url_remove_user_pwd" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a URL, remove the username and password if any:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">url_remove_user_pwd</span><span class="p">(</span><span class="s2">&quot;https://user:password@host:port/path&quot;</span><span class="p">))</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">host</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">path</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="commonl.field_needed">
<code class="descclassname">commonl.</code><code class="descname">field_needed</code><span class="sig-paren">(</span><em>field</em>, <em>projections</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.field_needed" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if the name <em>field</em> matches any of the <em>patterns</em> (ala
<a class="reference external" href="https://docs.python.org/2.7/library/fnmatch.html#module-fnmatch" title="(in Python v2.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fnmatch</span></code></a>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>field</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – field name</li>
<li><strong>projections</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – list of <a class="reference external" href="https://docs.python.org/2.7/library/fnmatch.html#module-fnmatch" title="(in Python v2.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fnmatch</span></code></a> patterns
against which to check field. Can be <em>None</em> and <em>[ ]</em> (empty).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns bool:</th><td class="field-body"><p class="first last"><em>True</em> if <em>field</em> matches a pattern in <em>patterns</em>
or if <em>patterns</em> is empty or <em>None</em>. <em>False</em> otherwise.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.dict_to_flat">
<code class="descclassname">commonl.</code><code class="descname">dict_to_flat</code><span class="sig-paren">(</span><em>d</em>, <em>projections=None</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.dict_to_flat" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a nested dictionary to a sorted list of tuples <em>( KEY, VALUE )</em></p>
<p>The KEY is like <em>KEY[.SUBKEY[.SUBSUBKEY[….]]]</em>, where <em>SUBKEY</em>
are keys in nested dictionaries.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>d</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary to convert</li>
<li><strong>projections</strong> (<em>list</em><em>(</em><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a><em>)</em>) – (optional) list of <a class="reference external" href="https://docs.python.org/2.7/library/fnmatch.html#module-fnmatch" title="(in Python v2.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fnmatch</span></code></a>
patterns of flay keys to bring in (default: all)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns list:</th><td class="field-body"><p class="first last">sorted list of tuples <em>KEY, VAL</em></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.flat_slist_to_dict">
<code class="descclassname">commonl.</code><code class="descname">flat_slist_to_dict</code><span class="sig-paren">(</span><em>fl</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.flat_slist_to_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a sorted list of flat keys and values, convert them to a
nested dictionary</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>list</strong><strong>(</strong><strong>(</strong><strong>str</strong><strong>,</strong><strong>object</strong><strong>)</strong><strong>)</strong> – list of tuples of key and any value
alphabetically sorted by tuple; same sorting rules as in
<a class="reference internal" href="#commonl.flat_keys_to_dict" title="commonl.flat_keys_to_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">flat_keys_to_dict()</span></code></a>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return dict:</th><td class="field-body">nested dictionary as described by the flat space of
keys and values</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.flat_keys_to_dict">
<code class="descclassname">commonl.</code><code class="descname">flat_keys_to_dict</code><span class="sig-paren">(</span><em>d</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.flat_keys_to_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a dictionary of flat keys, convert it to a nested dictionary</p>
<p>Similar to <a class="reference internal" href="#commonl.flat_slist_to_dict" title="commonl.flat_slist_to_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">flat_slist_to_dict()</span></code></a>, differing in the
keys/values being in a dictionary.</p>
<p>A key/value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;a.b.c&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">34</span>
</pre></div>
</div>
<p>means:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">34</span>
</pre></div>
</div>
<p>Key in the input dictonary are processed in alphabetical order
(thus, key a.a is processed before a.b.c); later keys override
earlier keys:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a.a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;aa&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a.a.a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;aaa&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a.a.b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;aab&#39;</span>
</pre></div>
</div>
<p>will result in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;aaa&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;aab&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a.a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;aa&#39;</span>
</pre></div>
</div>
<p>gets overriden by the other settings</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>d</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of keys/values</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns dict:</th><td class="field-body">(nested) dictionary</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="commonl.tls_prefix_c">
<em class="property">class </em><code class="descclassname">commonl.</code><code class="descname">tls_prefix_c</code><span class="sig-paren">(</span><em>tls</em>, <em>prefix</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.tls_prefix_c" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.data_dump_recursive">
<code class="descclassname">commonl.</code><code class="descname">data_dump_recursive</code><span class="sig-paren">(</span><em>d</em>, <em>prefix=u''</em>, <em>separator=u'.'</em>, <em>of=&lt;open file '&lt;stdout&gt;'</em>, <em>mode 'w'&gt;</em>, <em>depth_limit=10</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.data_dump_recursive" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump a general data tree to stdout in a recursive way</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">dict</span><span class="p">(</span><span class="n">keya</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">keyb</span> <span class="o">=</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;three&quot;</span> <span class="p">],</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="p">]</span>
</pre></div>
</div>
<p>produces the stdout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keya</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keyb</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="n">one</span>
<span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span> <span class="n">two</span>
<span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span> <span class="n">three</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">hello</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="o">&lt;</span><span class="nb">open</span> <span class="n">file</span> <span class="s1">&#39;&lt;stdout&gt;&#39;</span><span class="p">,</span> <span class="n">mode</span> <span class="s1">&#39;w&#39;</span> <span class="n">at</span> <span class="mh">0x7f13ba2861e0</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>in a list/set/tuple, each item is printed prefixing <em>[INDEX]</em></li>
<li>in a dictionary, each item is prefixed with it’s key</li>
<li>strings and cardinals are printed as such</li>
<li>others are printed as what their representation as a string produces</li>
<li>if an attachment is a generator, it is iterated to gather the data.</li>
<li>if an attachment is of :class:generator_factory_c, the method
for creating the generator is called and then the generator
iterated to gather the data.</li>
</ul>
<p>See also <a class="reference internal" href="#commonl.data_dump_recursive_tls" title="commonl.data_dump_recursive_tls"><code class="xref py py-func docutils literal notranslate"><span class="pre">data_dump_recursive_tls()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>d</strong> – data to print</li>
<li><strong>prefix</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – prefix to start with (defaults to nothing)</li>
<li><strong>separator</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – used to separate dictionary keys from the
prefix (defaults to “.”)</li>
<li><strong>of</strong> (<em>FILE</em>) – output stream where to print (defaults to
<em>sys.stdout</em>)</li>
<li><strong>depth_limit</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – maximum nesting levels to go deep in the
data structure (defaults to 10)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="commonl.data_dump_recursive_tls">
<code class="descclassname">commonl.</code><code class="descname">data_dump_recursive_tls</code><span class="sig-paren">(</span><em>d</em>, <em>tls</em>, <em>separator=u'.'</em>, <em>of=&lt;open file '&lt;stdout&gt;'</em>, <em>mode 'w'&gt;</em>, <em>depth_limit=10</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.data_dump_recursive_tls" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump a general data tree to stdout in a recursive way</p>
<p>This function works as <a class="reference internal" href="#commonl.data_dump_recursive" title="commonl.data_dump_recursive"><code class="xref py py-func docutils literal notranslate"><span class="pre">data_dump_recursive()</span></code></a> (see for more
information on the usage and arguments). However, it uses TLS for
storing the prefix as it digs deep into the data structure.</p>
<p>A variable called <em>prefix_c</em> is created in the TLS structure on
which the current prefix is stored; this is meant to be used in
conjunction with stream writes such as
<a class="reference internal" href="#commonl.io_tls_prefix_lines_c" title="commonl.io_tls_prefix_lines_c"><code class="xref py py-class docutils literal notranslate"><span class="pre">io_tls_prefix_lines_c</span></code></a>.</p>
<p>Parameters are as documented in <a class="reference internal" href="#commonl.data_dump_recursive" title="commonl.data_dump_recursive"><code class="xref py py-func docutils literal notranslate"><span class="pre">data_dump_recursive()</span></code></a>,
except for:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>tls</strong> (<em>thread._local</em>) – thread local storage to use (as returned
by <em>threading.local()</em></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="commonl.io_tls_prefix_lines_c">
<em class="property">class </em><code class="descclassname">commonl.</code><code class="descname">io_tls_prefix_lines_c</code><span class="sig-paren">(</span><em>tls</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.io_tls_prefix_lines_c" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Write lines to a stream with a prefix obtained from a thread local
storage variable.</p>
<p>This is a limited hack to transform a string written as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">line1</span>
<span class="n">line2</span>
<span class="n">line3</span>
</pre></div>
</div>
<p>into:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PREFIXline1</span>
<span class="n">PREFIXline2</span>
<span class="n">PREFIXline3</span>
</pre></div>
</div>
<p>without any intervention by the caller other than setting the
prefix in thread local storage and writing to the stream; this
allows other clients to write to the stream without needing to
know about the prefixing.</p>
<p>Note the lines yielded are unicode-escaped or UTF-8 escaped, for
being able to see in reports any special character.</p>
<p>Usage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">commonl</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="n">tls</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/dev/stdout&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">commonl</span><span class="o">.</span><span class="n">tls_prefix_c</span><span class="p">(</span><span class="n">tls</span><span class="p">,</span> <span class="s2">&quot;PREFIX&quot;</span><span class="p">),</span>             <span class="n">commonl</span><span class="o">.</span><span class="n">io_tls_prefix_lines_c</span><span class="p">(</span><span class="n">tls</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">detach</span><span class="p">())</span> <span class="k">as</span> <span class="n">of</span><span class="p">:</span>

    <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;line1</span>
</pre></div>
</div>
</div></blockquote>
<p>line2
line3
“)</p>
<blockquote>
<div><p>Limitations:</p>
<ul class="simple">
<li>hack, only works ok if full lines are being printed; eg:</li>
</ul>
</div></blockquote>
<dl class="method">
<dt id="commonl.io_tls_prefix_lines_c.flush">
<code class="descname">flush</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#commonl.io_tls_prefix_lines_c.flush" title="Permalink to this definition">¶</a></dt>
<dd><p>Flush any leftover data in the temporary buffer, write it to the
stream, prefixing each line with the prefix obtained from
<em>self.tls</em>’s <em>prefix_c</em> attribute.</p>
</dd></dl>

<dl class="method">
<dt id="commonl.io_tls_prefix_lines_c.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>s</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.io_tls_prefix_lines_c.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write string to the stream, prefixing each line with the
prefix obtained from <em>self.tls</em>’s <em>prefix_c</em> attribute.</p>
</dd></dl>

<dl class="method">
<dt id="commonl.io_tls_prefix_lines_c.writelines">
<code class="descname">writelines</code><span class="sig-paren">(</span><em>itr</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.io_tls_prefix_lines_c.writelines" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the iterator to the stream, prefixing each line with the
prefix obtained from <em>self.tls</em>’s <em>prefix_c</em> attribute.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="commonl.mkutf8">
<code class="descclassname">commonl.</code><code class="descname">mkutf8</code><span class="sig-paren">(</span><em>s</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.mkutf8" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="commonl.generator_factory_c">
<em class="property">class </em><code class="descclassname">commonl.</code><code class="descname">generator_factory_c</code><span class="sig-paren">(</span><em>fn</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.generator_factory_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Create generator objects multiple times</p>
<p>Given a generator function and its arguments, create it when
<a class="reference internal" href="#commonl.generator_factory_c.make_generator" title="commonl.generator_factory_c.make_generator"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_generator()</span></code></a> is called.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">factory</span> <span class="o">=</span> <span class="n">generator_factory_c</span><span class="p">(</span><span class="n">genrator</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="o">...</span><span class="p">,</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">value</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">make_generator</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">generator</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">do_something</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">another_generator</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">make_generator</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">another_generator</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">do_something</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>generators once created cannot be reset to the beginning, so this
can be used to simulate that behavior.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>fn</strong> – generator function</li>
<li><strong>args</strong> – arguments to the generator function</li>
<li><strong>kwargs</strong> – keyword arguments to the generator function</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="commonl.generator_factory_c.make_generator">
<code class="descname">make_generator</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#commonl.generator_factory_c.make_generator" title="Permalink to this definition">¶</a></dt>
<dd><p>Create and return a generator</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="commonl.file_iterator">
<code class="descclassname">commonl.</code><code class="descname">file_iterator</code><span class="sig-paren">(</span><em>filename</em>, <em>chunk_size=4096</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.file_iterator" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over a file’s contents</p>
<p>Commonly used along with generator_factory_c to with the TCF
client API to report attachments:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>chunk_size</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) read blocks of this size (optional)</td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">commonl</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">generator_f</span> <span class="o">=</span> <span class="n">commonl</span><span class="o">.</span><span class="n">generator_factory_c</span><span class="p">(</span><span class="n">commonl</span><span class="o">.</span><span class="n">file_iterator</span><span class="p">,</span> <span class="n">FILENAME</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">testcase</span><span class="o">.</span><span class="n">report_pass</span><span class="p">(</span><span class="s2">&quot;some message&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">content</span> <span class="o">=</span> <span class="n">generator_f</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="module-commonl.expr_parser"></span><p>This module implements a simple expression language.</p>
<p>The grammar for this language is as follows:</p>
<blockquote>
<div><dl class="docutils">
<dt>expression ::= expression “and” expression</dt>
<dd><div class="first last line-block">
<div class="line">expression “or” expression</div>
<div class="line">“not” expression</div>
<div class="line">“(” expression “)”</div>
<div class="line">symbol “==” constant</div>
<div class="line">symbol “!=” constant</div>
<div class="line">symbol “&lt;” number</div>
<div class="line">symbol “&gt;” number</div>
<div class="line">symbol “&gt;=” number</div>
<div class="line">symbol “&lt;=” number</div>
<div class="line">symbol “in” list</div>
<div class="line">symbol</div>
</div>
</dd>
</dl>
<p>list ::= “[” list_contents “]”</p>
<dl class="docutils">
<dt>list_contents ::= constant</dt>
<dd><div class="first last line-block">
<div class="line">list_contents “,” constant</div>
</div>
</dd>
<dt>constant ::= number</dt>
<dd><div class="first last line-block">
<div class="line">string</div>
</div>
</dd>
</dl>
</div></blockquote>
<p>When symbols are encountered, they are looked up in an environment
dictionary supplied to the parse() function.</p>
<p>For the case where</p>
<blockquote>
<div>expression ::= symbol</div></blockquote>
<p>it evaluates to true if the symbol is defined to a non-empty string.</p>
<p>For all comparison operators, if the config symbol is undefined, it will
be treated as a 0 (for &gt; &lt; &gt;= &lt;=) or an empty string “” (for == != in).
For numerical comparisons it doesn’t matter if the environment stores
the value as an integer or string, it will be cast appropriately.</p>
<p>Operator precedence, starting from lowest to highest:</p>
<blockquote>
<div>or (left associative)
and (left associative)
not (right associative)
all comparison operators (non-associative)</div></blockquote>
<p>The ‘:’ operator compiles the string argument as a regular expression,
and then returns a true value only if the symbol’s value in the environment
matches. For example, if CONFIG_SOC=”quark_se” then</p>
<blockquote>
<div>filter = CONFIG_SOC : “quark.*”</div></blockquote>
<p>Would match it.</p>
<dl class="function">
<dt id="commonl.expr_parser.t_HEX">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">t_HEX</code><span class="sig-paren">(</span><em>t</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.t_HEX" title="Permalink to this definition">¶</a></dt>
<dd><p>0x[0-9a-fA-F]+</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.t_INTEGER">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">t_INTEGER</code><span class="sig-paren">(</span><em>t</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.t_INTEGER" title="Permalink to this definition">¶</a></dt>
<dd><p>d+</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.t_STR">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">t_STR</code><span class="sig-paren">(</span><em>t</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.t_STR" title="Permalink to this definition">¶</a></dt>
<dd><p>“([^\n]|(.))*?”<a href="#id5"><span class="problematic" id="id6">|</span></a>’([^\n]|(.))*?’</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.t_SYMBOL">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">t_SYMBOL</code><span class="sig-paren">(</span><em>t</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.t_SYMBOL" title="Permalink to this definition">¶</a></dt>
<dd><p>[<a href="#id7"><span class="problematic" id="id8">A-Za-z_</span></a>][-/.0-<a href="#id9"><span class="problematic" id="id10">9A-Za-z_</span></a>]*</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.t_error">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">t_error</code><span class="sig-paren">(</span><em>t</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.t_error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_expr_or">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_expr_or</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_expr_or" title="Permalink to this definition">¶</a></dt>
<dd><p>expr : expr OR expr</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_expr_and">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_expr_and</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_expr_and" title="Permalink to this definition">¶</a></dt>
<dd><p>expr : expr AND expr</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_expr_not">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_expr_not</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_expr_not" title="Permalink to this definition">¶</a></dt>
<dd><p>expr : NOT expr</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_expr_parens">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_expr_parens</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_expr_parens" title="Permalink to this definition">¶</a></dt>
<dd><p>expr : OPAREN expr CPAREN</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_expr_eval">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_expr_eval</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_expr_eval" title="Permalink to this definition">¶</a></dt>
<dd><p>expr : SYMBOL EQUALS const
| SYMBOL NOTEQUALS const
| SYMBOL GT number
| SYMBOL LT number
| SYMBOL GTEQ number
| SYMBOL LTEQ number
| SYMBOL IN list
| SYMBOL IN SYMBOL
| SYMBOL COLON STR</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_expr_single">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_expr_single</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_expr_single" title="Permalink to this definition">¶</a></dt>
<dd><p>expr : SYMBOL</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_list">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_list</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_list" title="Permalink to this definition">¶</a></dt>
<dd><p>list : OBRACKET list_intr CBRACKET</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_list_intr_single">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_list_intr_single</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_list_intr_single" title="Permalink to this definition">¶</a></dt>
<dd><p>list_intr : const</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_list_intr_mult">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_list_intr_mult</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_list_intr_mult" title="Permalink to this definition">¶</a></dt>
<dd><p>list_intr : list_intr COMMA const</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_const">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_const</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_const" title="Permalink to this definition">¶</a></dt>
<dd><p>const : STR
| number</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_number">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_number</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_number" title="Permalink to this definition">¶</a></dt>
<dd><p>number : INTEGER
| HEX</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_error">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_error</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.ast_sym">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">ast_sym</code><span class="sig-paren">(</span><em>ast</em>, <em>env</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.ast_sym" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.ast_sym_int">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">ast_sym_int</code><span class="sig-paren">(</span><em>ast</em>, <em>env</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.ast_sym_int" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.ast_expr">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">ast_expr</code><span class="sig-paren">(</span><em>ast</em>, <em>env</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.ast_expr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.parse">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">parse</code><span class="sig-paren">(</span><em>expr_text</em>, <em>env</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.parse" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a text representation of an expression in our language,
use the provided environment to determine whether the expression
is true or false</p>
</dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="glossary.html" class="btn btn-neutral float-right" title="9. Glossary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="07-Architecture.html" class="btn btn-neutral" title="7. Architecture" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Author

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'0.11',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>