

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8. APIs &mdash; Test Case Framework 0.11 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Test Case Framework 0.11 documentation" href="../index.html"/>
        <link rel="next" title="9. Glossary" href="glossary.html"/>
        <link rel="prev" title="7. Architecture" href="07-Architecture.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../00-README.html" class="icon icon-home"> Test Case Framework
          

          
          </a>

          
            
            
              <div class="version">
                0.11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../02-QUICKSTART.html">1. Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-guides.html">2. Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-server-setup.html">3. Server deployment guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-HOWTOs.html">4. HOWTOs</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-RFAQs.html">5. Rationales and Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-troubleshooting.html">6. Support &amp; Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-Architecture.html">7. Architecture</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">8. APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-tcfl.tc">8.1. <em>TCF run</em>: testcase API and target manipulation during testcases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tcf-s-backbone-test-case-finder-and-runner">8.1.1. TCF’s backbone test case finder and runner</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#testcase-run-identification">8.1.1.1. Testcase run identification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-tcfl.tl">8.1.2. Test library (utilities for testcases)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-tcfl.target_ext_console">8.1.3. Extensions to <code class="docutils literal"><span class="pre">tcfl.tc.target_c</span></code> types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-tcfl.app">8.1.4. <em>TCF run</em> Application builders</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-tcfl.report">8.1.5. <em>TCF run</em> report drivers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#report-infrastructure">8.1.5.1. Report infrastructure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-tcfl.config">8.2. <em>TCF</em> client configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration-api-for-tcf">8.2.1. Configuration API for <em>tcf</em></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-tcfl">8.3. <em>TCF</em> client internals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#expecting-things-that-have-to-happen">8.3.1. Expecting things that have to happen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#client-api-for-accessing-ttbd-s-rest-api">8.3.2. Client API for accessing <em>ttbd</em>’s REST API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zephyr-s-sanitycheck-testcase-ini-driver-for-testcase-integration">8.3.3. Zephyr’s SanityCheck testcase.ini driver for testcase integration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#target-metadata">8.4. Target metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#common-metadata">8.4.1. Common metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interface-specific-metadata">8.4.2. Interface specific metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#driver-targe-type-specific-metadata">8.4.3. Driver / targe type specific metadata</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-conf_00_lib">8.5. <em>ttbd</em> Configuration API for targets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-ttbl.config">8.6. <em>ttbd</em> Configuration API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-ttbl">8.7. <em>ttbd</em> internals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-ttbl.tt">8.7.1. Target types drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-ttbl.user_control">8.7.2. User access control and authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#console-management-interface">8.7.3. Console Management Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-interface">8.7.4. Debugging Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#power-control-interface">8.7.5. Power Control Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#module-ttbl.target">8.7.5.1. Miscelaneous</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-commonl.expr_parser">8.7.6. Common helper library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tcob-fixture-setup-instructions">8.7.6.1. TCOB Fixture setup instructions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-Status.html">10. Current status and plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-CHANGELOG.html">11. TCF release v0.11</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../00-README.html">Test Case Framework</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../00-README.html">Docs</a> &raquo;</li>
        
      <li>8. APIs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/doc/09-api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="apis">
<h1>8. APIs<a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-tcfl.tc">
<span id="tcf-run-testcase-api-and-target-manipulation-during-testcases"></span><h2>8.1. <em>TCF run</em>: testcase API and target manipulation during testcases<a class="headerlink" href="#module-tcfl.tc" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tcf-s-backbone-test-case-finder-and-runner">
<h3>8.1.1. TCF’s backbone test case finder and runner<a class="headerlink" href="#tcf-s-backbone-test-case-finder-and-runner" title="Permalink to this headline">¶</a></h3>
<p>This implements a high level test case finder and runner to find and
execute test cases.</p>
<p>The execution of each test case consists of the following phases:</p>
<blockquote>
<div><ul class="simple">
<li>configure</li>
<li>build</li>
<li>target acquisition</li>
<li>deploy</li>
<li>one or more evaluation sequences
(each consisting of setup, start, evaluation per se, teardown)</li>
<li>clean [not executed by default]</li>
</ul>
</div></blockquote>
<p>the configuration, build and deployment phases happen in the local
host; the evaluation phases can happen in the local host (for static
tests) or in remote targets (for dynamic tests).</p>
<p>The backbone is designed so multiple drivers (test case drivers) can
be implemented that find test cases and specify to the backbone how to
build, run and test for success or failure. This is done by
subclassing <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.tc_c</span></code></a> and extending or redefining
<a class="reference internal" href="#tcfl.tc.tc_c.is_testcase" title="tcfl.tc.tc_c.is_testcase"><code class="xref py py-meth docutils literal"><span class="pre">tc_c.is_testcase()</span></code></a>.</p>
<p>Testcases are defined also by subclassing <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.tc_c</span></code></a> and
implementing the different methods the meta runner will call to
evaluate. Testcases can manipulate targets (if they need any) by using
the APIs defined by <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a>.</p>
<p>The runner will collect the list of available targets and determine
whih testcases have to be run on which targets, and then create an
instance of each testcase for those groups of targets where it has to
run. All the instances will then be run in parallel throgh a
multiprocessing pool.</p>
<p>To testcases report results via the report API, which are handled by
drivers defined following <a class="reference internal" href="#tcfl.report.report_c" title="tcfl.report.report_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.report.report_c</span></code></a>, which can be
subclassed and extended to report to different destinations according
to need. Default drivers report to console and logfiles.</p>
<div class="section" id="testcase-run-identification">
<span id="tc-id"></span><h4>8.1.1.1. Testcase run identification<a class="headerlink" href="#testcase-run-identification" title="Permalink to this headline">¶</a></h4>
<p>A message identification mechanism for which all the messages are
prefixed with a code:</p>
<p>[RUNID:]HASH{CBDEL}[XX][.N]</p>
<ul class="simple">
<li>RUNID is a constant string to identify a run of a set of test cases
(defaults to nothing, can be autogenerated with <cite>-i</cite> or an specific
string given with <cite>-i RUNID</cite>).</li>
<li>HASH is a base32 encoded hash of the testcase name, targets where it
is to be run and their <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>.</li>
<li>CBDEL is one capital letter representing the phase being ran
(Configure, Build, Deploy, Evaluation, cLean)</li>
<li>[XX]: base32 encoded hash of the BSP name, applies only to dynamic
test case builds per BSP.</li>
</ul>
<p>This helps locating anything specific to a testcase by grepping in the
logfile for a given string and adding more components restricts the
output.</p>
<p>This means that the message IDs are stable across runs, save RUNIDs
being specified.</p>
<p>We also use the RUNID:TC combination for a ticket when requesting a
target lock–note this does not conflict with other users, as the
tickets are namespaced per-user. This allows the server log to be used
to crossreference what was being ran, to sort out issues.</p>
<dl class="function">
<dt id="tcfl.tc.import_mp_pathos">
<code class="descclassname">tcfl.tc.</code><code class="descname">import_mp_pathos</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.import_mp_pathos" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.tc.import_mp_std">
<code class="descclassname">tcfl.tc.</code><code class="descname">import_mp_std</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.import_mp_std" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="tcfl.tc.exception">
<em class="property">exception </em><code class="descclassname">tcfl.tc.</code><code class="descname">exception</code><a class="headerlink" href="#tcfl.tc.exception" title="Permalink to this definition">¶</a></dt>
<dd><p>General base exception for reporting results of any phase of test
cases</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>msg</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – a message to report</li>
<li><strong>attachments</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>a dictionary of items to report, with a
few special fields:</p>
<ul>
<li><cite>target</cite>: this is a <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> which shall be used
for reporting</li>
<li><cite>dlevel</cite>: this is an integer that indicates the relative
level of verbosity (FIXME: link to detailed explanation)</li>
<li><cite>alevel</cite>: this is an integer that indicates the relative
level of verbosity for attachments (FIXME: link to detailed
explanation)</li>
<li>any other fields will be passed verbatim and reported</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Have to use a dictionary (vs using kwargs) so the name of the
keys can contain spaces, for better reporting.</p>
</dd></dl>

<dl class="exception">
<dt id="tcfl.tc.pass_e">
<em class="property">exception </em><code class="descclassname">tcfl.tc.</code><code class="descname">pass_e</code><a class="headerlink" href="#tcfl.tc.pass_e" title="Permalink to this definition">¶</a></dt>
<dd><p>The test case passed</p>
</dd></dl>

<dl class="exception">
<dt id="tcfl.tc.blocked_e">
<em class="property">exception </em><code class="descclassname">tcfl.tc.</code><code class="descname">blocked_e</code><a class="headerlink" href="#tcfl.tc.blocked_e" title="Permalink to this definition">¶</a></dt>
<dd><p>The test case could not be completed because something failed and
disallowed testing if it woud pass or fail</p>
</dd></dl>

<dl class="exception">
<dt id="tcfl.tc.error_e">
<em class="property">exception </em><code class="descclassname">tcfl.tc.</code><code class="descname">error_e</code><a class="headerlink" href="#tcfl.tc.error_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Executing the test case found an error</p>
</dd></dl>

<dl class="exception">
<dt id="tcfl.tc.failed_e">
<em class="property">exception </em><code class="descclassname">tcfl.tc.</code><code class="descname">failed_e</code><a class="headerlink" href="#tcfl.tc.failed_e" title="Permalink to this definition">¶</a></dt>
<dd><p>The test case failed</p>
</dd></dl>

<dl class="exception">
<dt id="tcfl.tc.skip_e">
<em class="property">exception </em><code class="descclassname">tcfl.tc.</code><code class="descname">skip_e</code><a class="headerlink" href="#tcfl.tc.skip_e" title="Permalink to this definition">¶</a></dt>
<dd><p>A decission was made to skip executing the test case</p>
</dd></dl>

<dl class="class">
<dt id="tcfl.tc.target_extension_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">target_extension_c</code><span class="sig-paren">(</span><em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_extension_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement API extensions to targets</p>
<p>An API extension allows you to extend the API for the
<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> class so that more functionality can
be added to the <cite>target</cite> objects passed to testcase methods (like
build*(), eval*(), etc) and used as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">extension_a</span><span class="p">(</span><span class="n">target_extension_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">report_info</span><span class="p">(</span><span class="s2">&quot;Hello world from extension_a&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">variable</span> <span class="o">=</span> <span class="mi">34</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target_c</span><span class="o">.</span><span class="n">extension_register</span><span class="p">(</span><span class="n">etension_a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
</pre></div>
</div>
<p>Now, in an (e.g) evaluation function in a testcase:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="k">def</span> <span class="nf">eval_something</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">target1</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>     <span class="n">target1</span><span class="o">.</span><span class="n">extension_a</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>     <span class="k">if</span> <span class="n">target1</span><span class="o">.</span><span class="n">extension_a</span><span class="o">.</span><span class="n">variable</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">do_something</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
</pre></div>
</div>
<p>Extensions have to be registered with
<a class="reference internal" href="#tcfl.tc.target_c.extension_register" title="tcfl.tc.target_c.extension_register"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target_c.extension_register()</span></code></a>. Unregister with
<a class="reference internal" href="#tcfl.tc.target_c.extension_unregister" title="tcfl.tc.target_c.extension_unregister"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target_c.extension_unregister()</span></code></a></p>
<p>The extension can be anything, but are commonly used to provide
the code to access APIs that are not distributed as part of the
core TCF distribution (like for example, an API to access an
special sensor).</p>
<p>A package might add support on the server side for an interface to
access the target and on the client side to access said
interfaces.</p>
<p>The <cite>__init__()</cite> method will typically first check if the target
meets the criteria needed for the extension to work or be used. If
not it can raise <a class="reference internal" href="#tcfl.tc.target_extension_c.unneeded" title="tcfl.tc.target_extension_c.unneeded"><code class="xref py py-class docutils literal"><span class="pre">target_extension_c.unneeded</span></code></a> to avoid
the extension to be created.</p>
<p>Then it proceeds to create an instance that will be attached to
the target for later use.</p>
<dl class="exception">
<dt id="tcfl.tc.target_extension_c.unneeded">
<em class="property">exception </em><code class="descname">unneeded</code><a class="headerlink" href="#tcfl.tc.target_extension_c.unneeded" title="Permalink to this definition">¶</a></dt>
<dd><p>Raise this from __init__() if this extension is not needed for
this target.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_extension_c.target">
<code class="descname">target</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_extension_c.target" title="Permalink to this definition">¶</a></dt>
<dd><p>Target this extension applies to</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc.target_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">target_c</code><span class="sig-paren">(</span><em>rt</em>, <em>testcase</em>, <em>bsp_model</em>, <em>target_want_name</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c" title="Permalink to this definition">¶</a></dt>
<dd><p>A remote target that can be manipulated</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>rt</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – remote target descriptor (dictionary) as returned
by <a class="reference internal" href="#tcfl.ttb_client.rest_target_find_all" title="tcfl.ttb_client.rest_target_find_all"><code class="xref py py-func docutils literal"><span class="pre">tcfl.ttb_client.rest_target_find_all()</span></code></a> and others.</li>
<li><strong>tescase</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tc_c</em></a>) – testcase descriptor to which this target
instance will be uniquely assigned.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>A target always operate in a given <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>, as decided
by the testcase runner. If a remote target A has two BSP models (1
and 2) and a testcase T shall be run on both, it will create two
testcase instances, T1 and T2. Each will be assigned an instance
of <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">target_c</span></code></a>, A1 and A2 respectively, representing the
same target A, but each set to a different <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>.</p>
<p>Note these object expose the basic target API, but then different
extensions provide APIs to access other interfaces, depending on
if the target exposes it or not; these is the current list of
implemented interfaces:</p>
<ul class="simple">
<li><a class="reference internal" href="#tcfl.target_ext_console.console" title="tcfl.target_ext_console.console"><code class="xref py py-class docutils literal"><span class="pre">console</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_debug.debug" title="tcfl.target_ext_debug.debug"><code class="xref py py-class docutils literal"><span class="pre">debug</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_images.images" title="tcfl.target_ext_images.images"><code class="xref py py-class docutils literal"><span class="pre">images</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_power.power" title="tcfl.target_ext_power.power"><code class="xref py py-class docutils literal"><span class="pre">power</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_shell.shell" title="tcfl.target_ext_shell.shell"><code class="xref py py-class docutils literal"><span class="pre">shell</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_ssh.ssh" title="tcfl.target_ext_ssh.ssh"><code class="xref py py-class docutils literal"><span class="pre">ssh</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_tcob.tcob" title="tcfl.target_ext_tcob.tcob"><code class="xref py py-class docutils literal"><span class="pre">tcob</span></code></a></li>
<li><a class="reference internal" href="#tcfl.target_ext_tunnel.tunnel" title="tcfl.target_ext_tunnel.tunnel"><code class="xref py py-class docutils literal"><span class="pre">tunnel</span></code></a></li>
<li><a class="reference internal" href="#tcfl.app_zephyr.zephyr" title="tcfl.app_zephyr.zephyr"><code class="xref py py-class docutils literal"><span class="pre">zephyr</span></code></a></li>
</ul>
<dl class="attribute">
<dt id="tcfl.tc.target_c.want_name">
<code class="descname">want_name</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.want_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Name this target is known to by the testcase (as it was
claimed with the <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target()</span></code></a> decorator)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.rt">
<code class="descname">rt</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.rt" title="Permalink to this definition">¶</a></dt>
<dd><p>Remote tags of this target</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.id">
<code class="descname">id</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.id" title="Permalink to this definition">¶</a></dt>
<dd><p>(short) id of this target</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.fullid">
<code class="descname">fullid</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.fullid" title="Permalink to this definition">¶</a></dt>
<dd><p>Full id of this target</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.type">
<code class="descname">type</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.type" title="Permalink to this definition">¶</a></dt>
<dd><p>Type name of this target</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.ticket">
<code class="descname">ticket</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.ticket" title="Permalink to this definition">¶</a></dt>
<dd><p>ticket used to acquire this target</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.testcase">
<code class="descname">testcase</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.testcase" title="Permalink to this definition">¶</a></dt>
<dd><p>Testcase that this target is currently executing</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.bsp_model">
<code class="descname">bsp_model</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.bsp_model" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a> this target is currently configured for</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.bsps">
<code class="descname">bsps</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.bsps" title="Permalink to this definition">¶</a></dt>
<dd><p>List of BSPs supported by this target’s currently selected
<a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.keep_active">
<code class="descname">keep_active</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.keep_active" title="Permalink to this definition">¶</a></dt>
<dd><p>Make sure the testcase indicates the daemon that this
target is to be marked as active during the testcase
execution of expectation loops.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.bsps_stub">
<code class="descname">bsps_stub</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.bsps_stub" title="Permalink to this definition">¶</a></dt>
<dd><p>Dict of BSPs that have to be stubbed for the board to work
correctly in the current <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a> (if the board
has two BSPs but BSP1 needs to have an image of something
so BSP2 can start). The App builder can manipulate this to
remove BSPs that can be ignored. The value is a tuple (app,
srcinfo) that indicates the App builder that will build the
stub and with which source information (path to the
source).</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.bsp">
<code class="descname">bsp</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.bsp" title="Permalink to this definition">¶</a></dt>
<dd><p>BSP (inside the <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>) this target is currently
configured for</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.tmpdir">
<code class="descname">tmpdir</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.tmpdir" title="Permalink to this definition">¶</a></dt>
<dd><p>Temporary directory where to store files – this is the same
as the testcase’s – it is needed for the report driver to
find where to put stuff.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.kws">
<code class="descname">kws</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.kws" title="Permalink to this definition">¶</a></dt>
<dd><p>Keywords for <em>%(KEY)[sd]</em> substitution specific to this
target and current active <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a> and BSP as set
with <a class="reference internal" href="#tcfl.tc.target_c.bsp_set" title="tcfl.tc.target_c.bsp_set"><code class="xref py py-meth docutils literal"><span class="pre">bsp_set()</span></code></a>.</p>
<p>These are obtained from the remote target descriptor
(<cite>self.rt</cite>) as obtained from the remote <em>ttbd</em> server.</p>
<p>These can be used to generate strings based on information,
as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span> <span class="nb">print</span> <span class="s2">&quot;Something </span><span class="si">%(id)s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">kws</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">target</span><span class="o">.</span><span class="n">shcmd_local</span><span class="p">(</span><span class="s2">&quot;cp </span><span class="si">%(id)s</span><span class="s2">.config final.config&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To find which fields are available for a target:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list -vv TARGETNAME
</pre></div>
</div>
<p>The testcase will provide also other fields, in
<a class="reference internal" href="#tcfl.tc.tc_c.kws" title="tcfl.tc.tc_c.kws"><code class="xref py py-data docutils literal"><span class="pre">tcfl.tc.tc_c.kws</span></code></a>, which are rolled in in this variable
too.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.kws_origin">
<code class="descname">kws_origin</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.target_c.kws_origin" title="Permalink to this definition">¶</a></dt>
<dd><p>Origin of keys defined in self.kws</p>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.target_c.extension_register">
<em class="property">classmethod </em><code class="descname">extension_register</code><span class="sig-paren">(</span><em>ext_cls</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.extension_register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register an extension to the <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> class.</p>
<p>This is usually called from a config file to register an
extension provided by a package.</p>
<p>See <a class="reference internal" href="#tcfl.tc.target_extension_c" title="tcfl.tc.target_extension_c"><code class="xref py py-class docutils literal"><span class="pre">target_extension_c</span></code></a> for details</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ext_cls</strong> (<a class="reference internal" href="#tcfl.tc.target_extension_c" title="tcfl.tc.target_extension_c"><em>target_extension_c</em></a>) – a class that provides an extension</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.target_c.extension_unregister">
<em class="property">classmethod </em><code class="descname">extension_unregister</code><span class="sig-paren">(</span><em>ext_cls</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.extension_unregister" title="Permalink to this definition">¶</a></dt>
<dd><p>Unregister an extension to the <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> class.</p>
<p>This is usually used by unit tests. There usually is no need
to unregister extensions.</p>
<p>See <a class="reference internal" href="#tcfl.tc.target_extension_c" title="tcfl.tc.target_extension_c"><code class="xref py py-class docutils literal"><span class="pre">target_extension_c</span></code></a> for details</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ext_cls</strong> (<a class="reference internal" href="#tcfl.tc.target_extension_c" title="tcfl.tc.target_extension_c"><em>target_extension_c</em></a>) – a class that provides an extension</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.bsps_all">
<code class="descname">bsps_all</code><a class="headerlink" href="#tcfl.tc.target_c.bsps_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of all BSPs in the target (note this might be
more than the ones available in the currentlt selected BSP
model).</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.bsp_set">
<code class="descname">bsp_set</code><span class="sig-paren">(</span><em>bsp=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.bsp_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the active BSP</p>
<p>If the BSP is omitted, this will select the first BSP in the
current BSP model. This means that if there is a preference in
multiple BSPs, they have to be listed as such in the target’s
configuration.</p>
<p>If there are no BSPs, this will raise an exception</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) The name of any BSP supported by
the board (not necessarily in the BSP-Model list of active
BSPs. These are always in <a class="reference internal" href="#tcfl.tc.target_c.bsps_all" title="tcfl.tc.target_c.bsps_all"><code class="xref py py-attr docutils literal"><span class="pre">bsps_all</span></code></a>.
If this argument is False, then the active BSP is reset to none.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.kws_set">
<code class="descname">kws_set</code><span class="sig-paren">(</span><em>d</em>, <em>bsp=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.kws_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a bunch of target’s keywords and values</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>d</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – A dictionary of keywords and values</li>
<li><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) BSP for which we want to set the
keywords; if omitted, we are setting the keywords for the whole
target</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.kw_set">
<code class="descname">kw_set</code><span class="sig-paren">(</span><em>kw</em>, <em>val</em>, <em>bsp=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.kw_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a target’s keyword and value</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>kw</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – A string describing naming the keyword/value pair</li>
<li><strong>val</strong> – the value (can be anything)</li>
<li><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) BSP for which we want to set the
keyword; if omitted, we are setting the keyword for the whole
target</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.kws_required_verify">
<code class="descname">kws_required_verify</code><span class="sig-paren">(</span><em>kws</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.kws_required_verify" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify if a target exports required keywords, raise blocked
exception if any is missing.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.ic_field_get">
<code class="descname">ic_field_get</code><span class="sig-paren">(</span><em>ic</em>, <em>field</em>, <em>field_description=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.ic_field_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Obtain the value of a field for a target in an interconnect</p>
<p>A target might be a member of one or more interconnects, as
described by its tags (<em>interconnects</em> section).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ic</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – target describing the interconnect
of which this target is a member (as defined in a
&#64; <a class="reference internal" href="#tcfl.tc.interconnect" title="tcfl.tc.interconnect"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.interconnect()</span></code></a> decorator to the testcase
class)</li>
<li><strong>field</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the filed whose value we want.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">eval_somestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target1</span><span class="p">,</span> <span class="n">target2</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">target1</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;ifconfig eth0 </span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>                     <span class="o">%</span> <span class="p">(</span><span class="n">target2</span><span class="o">.</span><span class="n">addr_get</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="s1">&#39;ipv4&#39;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="n">target2</span><span class="o">.</span><span class="n">ic_field_get</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="s1">&#39;ipv4_addr_len&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.addr_get">
<code class="descname">addr_get</code><span class="sig-paren">(</span><em>ic</em>, <em>tech</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.addr_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Obtain the address for a target in an interconnect</p>
<p>A target might be a member of one or more interconnects, as
described by its tags (<em>interconnects</em> section).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ic</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – target describing the interconnect
of which this target is a member (as defined in a
&#64; <a class="reference internal" href="#tcfl.tc.interconnect" title="tcfl.tc.interconnect"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.interconnect()</span></code></a> decorator to the testcase
class)</li>
<li><strong>tech</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>name of the technology on which address we
are interested.</p>
<p>As part of said membership, one or more key/value pairs can be
specified. Assigned addresses are always called
<em>TECHNOLOGY_addr</em>, were <em>TECHNOLOGY</em> can be things like
<em>ipv4</em>, <em>ipv6</em>, <em>bt</em>, <em>mac</em>, etc…</p>
<p>If <em>tech</em> fits a whole key name, it will be used instead.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>When the target, for the current testcase is member of a
single interconnect, any <em>TECHNOLOGY_addr</em> for the
interconnect key/value will be available in the <a class="reference internal" href="#tcfl.tc.target_c.kws" title="tcfl.tc.target_c.kws"><code class="xref py py-attr docutils literal"><span class="pre">kws</span></code></a>
member as for example.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;ipv4_addr&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>However, when member of multiple interconnects, which members
are promoted to top level is undertermined if both
interconnects provide address information for the same
technology. Use this function to obtain the
interconnect-specific information.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">eval_somestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target1</span><span class="p">,</span> <span class="n">target2</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">target1</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;scp /etc/passwd </span><span class="si">%s</span><span class="s2">:/etc/passwd&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>                     <span class="o">%</span> <span class="n">target2</span><span class="o">.</span><span class="n">addr_get</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="s1">&#39;ipv4&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.app_get">
<code class="descname">app_get</code><span class="sig-paren">(</span><em>bsp=None</em>, <em>noraise=True</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.app_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the App builder that is assigned to a particular BSP in
the target.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Name of the BSP we are querying the App
builder for. Can be omitted if the current <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>
for the target contains a single BSP, and thus it’ll be
auto-guessed.</li>
<li><strong>noraise</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) if True, do not raise an
exception if we cannot find an App Builder and just return
Nones.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.report_pass">
<code class="descname">report_pass</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.report_pass" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.report_fail">
<code class="descname">report_fail</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.report_fail" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.report_error">
<code class="descname">report_error</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.report_error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.report_blck">
<code class="descname">report_blck</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.report_blck" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.report_skip">
<code class="descname">report_skip</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.report_skip" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.report_info">
<code class="descname">report_info</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.report_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.report_data">
<code class="descname">report_data</code><span class="sig-paren">(</span><em>domain</em>, <em>name</em>, <em>value</em>, <em>expand=True</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.report_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Report measurable data</p>
<p>When running a testcase, if data is collected that has to be
reported for later analysis, use this function to report
it. This will be reported by the report driver in a way that
makes it easy to collect later on.</p>
<p>Measured data is identified by a <em>domain</em> and a <em>name</em>, plus
then the actual value.</p>
<p>A way to picture how this data can look once aggregated is as
a table per domain, on which each invocation is a row and each
column will be the values for each name.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>domain</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – to which domain this measurement applies
(eg: “Latency Benchmark %(type)s”);</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the value  (eg: “context switch
(microseconds)”); it is recommended to always add the unit
the measurement represents.</li>
<li><strong>value</strong> – value to report for the given domain and name;
any type can be reported.</li>
<li><strong>expand</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – <p>(optional) by default, the <em>domain</em> and
<em>name</em> fields will be %(FIELD)s expanded with the keywords
of the testcase or target. If <em>False</em>, it will not be
expanded.</p>
<p>This enables to, for example, specify a domain of “Latency
measurements for target %(type)s” which will automatically
create a different domain for each type of target.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.report_tweet">
<code class="descname">report_tweet</code><span class="sig-paren">(</span><em>what</em>, <em>result</em>, <em>extra_report=''</em>, <em>ignore_nothing=False</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.report_tweet" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.shcmd_local">
<code class="descname">shcmd_local</code><span class="sig-paren">(</span><em>cmd</em>, <em>origin=None</em>, <em>reporter=None</em>, <em>logfile=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.shcmd_local" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a shell command in the local machine, substituting
<em>%(KEYWORD)[sd]</em> with keywords defined by the target and testcase.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.acquire">
<code class="descname">acquire</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.acquire" title="Permalink to this definition">¶</a></dt>
<dd><p>Shall we acquire this target? By default the testcases get
the targets they request acquired for exclusive use, but in
some cases, it might not be needed (default: True)</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.release">
<code class="descname">release</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release a target</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.active">
<code class="descname">active</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.active" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark an owned target as active</p>
<p>For long running tests, indicate to the server that this
target is still active.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.property_get">
<code class="descname">property_get</code><span class="sig-paren">(</span><em>property_name</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.property_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a property from the target</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>property_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Name of the property to read</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns str:</th><td class="field-body">value of the property (if set) or None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.property_set">
<code class="descname">property_set</code><span class="sig-paren">(</span><em>property_name</em>, <em>value=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.property_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a property on the target</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>property_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Name of the property to read</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) Value to set; <em>None</em> to unset it</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.thing_plug">
<code class="descname">thing_plug</code><span class="sig-paren">(</span><em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.thing_plug" title="Permalink to this definition">¶</a></dt>
<dd><p>Connect a thing described in the target’s <a class="reference internal" href="#tcfl.tc.tags" title="tcfl.tc.tags"><code class="xref py py-attr docutils literal"><span class="pre">tags</span></code></a>
<em>things</em> dictionary to the target.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>thing</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – thing to connect</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.thing_unplug">
<code class="descname">thing_unplug</code><span class="sig-paren">(</span><em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.thing_unplug" title="Permalink to this definition">¶</a></dt>
<dd><p>Disconnect a thing described in the target’s <a class="reference internal" href="#tcfl.tc.tags" title="tcfl.tc.tags"><code class="xref py py-attr docutils literal"><span class="pre">tags</span></code></a>
<em>things</em> dictionary from the target.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>thing</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – thing to disconnect</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.thing_list">
<code class="descname">thing_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.thing_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of connected things</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.console_tx">
<code class="descname">console_tx</code><span class="sig-paren">(</span><em>data</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.console_tx" title="Permalink to this definition">¶</a></dt>
<dd><p>Transmits the data over the given console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> – data to be sent; data can be anything that can be
transformed into a sequence of bytes</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of console over which to
send the data (otherwise use the default one).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note this function is equivalent to
<a class="reference internal" href="#tcfl.target_ext_console.console.write" title="tcfl.target_ext_console.console.write"><code class="xref py py-meth docutils literal"><span class="pre">tcfl.target_ext_console.console.write()</span></code></a>, which is the raw
version of this function.</p>
<p>However, this function works with the send/expect engine and
will flush the expect buffer so that next time we call
<a class="reference internal" href="#tcfl.tc.target_c.expect" title="tcfl.tc.target_c.expect"><code class="xref py py-meth docutils literal"><span class="pre">expect()</span></code></a>, it wil look for the expected data <strong>only</strong> in
data received after calling this function.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_c.crlf">
<code class="descname">crlf</code><a class="headerlink" href="#tcfl.tc.target_c.crlf" title="Permalink to this definition">¶</a></dt>
<dd><p>What will <a class="reference internal" href="#tcfl.tc.target_c.send" title="tcfl.tc.target_c.send"><code class="xref py py-meth docutils literal"><span class="pre">target_c.send()</span></code></a> use for CR/LF when sending data
to the target’s consoles. Defaults to <code class="docutils literal"><span class="pre">\r\n</span></code>, but it can be
set to any string, even <code class="docutils literal"><span class="pre">&quot;&quot;</span></code> for an empty string.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.send">
<code class="descname">send</code><span class="sig-paren">(</span><em>data</em>, <em>console=None</em>, <em>crlf=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.send" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#tcfl.tc.target_c.console_tx" title="tcfl.tc.target_c.console_tx"><code class="xref py py-meth docutils literal"><span class="pre">console_tx()</span></code></a>, transmits the string of data
over the given console.</p>
<p>This function, however, differs in takes only strings and that
it will append a CRLF sequence at the end of the given
string. As well, it will <em>flush</em> the receive pipe so that next
time we <a class="reference internal" href="#tcfl.tc.target_c.expect" title="tcfl.tc.target_c.expect"><code class="xref py py-meth docutils literal"><span class="pre">expect()</span></code></a> something, it will be only for anything
received after we called this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – string of data to send</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of console over which to
send the data (otherwise use the default one).</li>
<li><strong>ctlf</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) CRLF technique to use, or what to
append to the string as a CRLF:</p>
<ul>
<li>None: use whatever is in <a class="reference internal" href="#tcfl.tc.target_c.crlf" title="tcfl.tc.target_c.crlf"><code class="xref py py-attr docutils literal"><span class="pre">target_c.crlf</span></code></a></li>
<li><code class="docutils literal"><span class="pre">\r</span></code>: use carriage return</li>
<li><code class="docutils literal"><span class="pre">\r\n</span></code>: use carriage return and line feed</li>
<li><code class="docutils literal"><span class="pre">\n</span></code>: use line feed</li>
<li><code class="docutils literal"><span class="pre">ANYSTRING</span></code>: append <em>ANYSTRING</em></li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.console_rx_read">
<code class="descname">console_rx_read</code><span class="sig-paren">(</span><em>console=None</em>, <em>offset=0</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.console_rx_read" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the data that has been read for a console until now.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of console on which the
the data was received (otherwie use the default one).</li>
<li><strong>offset</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) offset into the recorded data
from which to read. If negative, it is offset from the last
data received.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.on_console_rx">
<code class="descname">on_console_rx</code><span class="sig-paren">(</span><em>regex_or_str</em>, <em>timeout=None</em>, <em>console=None</em>, <em>result='pass'</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.on_console_rx" title="Permalink to this definition">¶</a></dt>
<dd><p>Set up an action to perform (pass, fail, block or skip)
when a string or regular expresison is received on a given
console in this target.</p>
<p>Note this does not wait for said string; you need to run the
testcase’s <em>expecter</em> loop with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span> <span class="bp">self</span><span class="o">.</span><span class="n">expecter</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Als well, those actions will be performed when running
<a class="reference internal" href="#tcfl.tc.target_c.expect" title="tcfl.tc.target_c.expect"><code class="xref py py-meth docutils literal"><span class="pre">expect()</span></code></a> or <a class="reference internal" href="#tcfl.tc.target_c.wait" title="tcfl.tc.target_c.wait"><code class="xref py py-meth docutils literal"><span class="pre">wait()</span></code></a> for blocking versions.</p>
<p>This allows you to specify many different things you are
waiting for from one or <em>more</em> targets and wait for all of
them at the same time and block until all of them are received
(or timeout).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>regex_or_str</strong> – string or regular expression (compiled
with <a class="reference external" href="https://docs.python.org/2.7/library/re.html#re.compile" title="(in Python v2.7)"><code class="xref py py-func docutils literal"><span class="pre">re.compile()</span></code></a>.</li>
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – Seconds to wait for regex_or_str to be
received, raise <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.failed_e</span></code></a>
otherwise. If <em>False</em>, no timeout check is done; if <em>None</em>,
it is taken from the default timeout set by the testcase.</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of console from which to
receive the data</li>
<li><strong>result</strong> – <p>what to do when that regex_or_str is found on
the given console:</p>
<ul>
<li><em>pass</em>, (default) raise <a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.pass_e</span></code></a></li>
<li><em>block</em>, raise <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.blocked_e</span></code></a></li>
<li><em>error</em>, raise <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.error_e</span></code></a>,</li>
<li><em>failed</em>, raise <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.failed_e</span></code></a>,</li>
<li><em>blocked</em>, raise <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.blocked_e</span></code></a></li>
</ul>
<p>Note that when running an expecter loop, if seven different
actions are added indicating they are expected to pass, the
seven of them must have raised a pass exception (or
indicated passage somehow) before the loop will consider it
a full pass. See <a class="reference internal" href="#tcfl.expecter.expecter_c.run" title="tcfl.expecter.expecter_c.run"><code class="xref py py-meth docutils literal"><span class="pre">tcfl.expecter.expecter_c.run()</span></code></a>.</p>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first"><a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.pass_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.blocked_e</span></code></a>, <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.failed_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.error_e</span></code></a>, <a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.skip_e</span></code></a>,
any other exception from runtimes.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>True</em> if a poller for the console was added to the
testcase’s expecter loop, <em>False</em> otherwise.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.wait">
<code class="descname">wait</code><span class="sig-paren">(</span><em>regex_or_str</em>, <em>timeout=None</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.wait" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for a particular regex/string to be received on a given
console of this target before a given timeout.</p>
<p>See <a class="reference internal" href="#tcfl.tc.target_c.expect" title="tcfl.tc.target_c.expect"><code class="xref py py-meth docutils literal"><span class="pre">expect()</span></code></a> for a version that just raises
exceptions when the output is not received.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – Seconds to wait for regex_or_str to be
received, raise <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.error_e</span></code></a>
otherwise. If <em>False</em>, no timeout check is done; if <em>None</em>,
it is taken from the default timeout set by the testcase.</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of console from which to
receive the data</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>True</em> if the output was received before the
timeout, <em>False</em> otherwise.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.expect">
<code class="descname">expect</code><span class="sig-paren">(</span><em>regex_or_str</em>, <em>timeout=None</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.expect" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for a particular regex/string to be received on a given
console of this target before a given timeout.</p>
<p>Similar to <a class="reference internal" href="#tcfl.tc.target_c.wait" title="tcfl.tc.target_c.wait"><code class="xref py py-func docutils literal"><span class="pre">wait()</span></code></a>, it will raise an exception if
&#64;regex_or_str is not received before &#64;timeout on &#64;console.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – Seconds to wait for regex_or_str to be
received, raise <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.error_e</span></code></a>
otherwise. If <em>False</em>, no timeout check is done; if <em>None</em>,
it is taken from the default timeout set by the testcase.</li>
<li><strong>console</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of console from which to
receive the data</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Nothing, if the output is received.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.blocked_e</span></code></a> on error,
<a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.error_e</span></code></a> if not received,
any other runtime exception.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.on_console_rx_cm">
<code class="descname">on_console_rx_cm</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.on_console_rx_cm" title="Permalink to this definition">¶</a></dt>
<dd><p>When regex_or_str is received on the given console (default
console), execute the action given by result.</p>
<p>Context Manager version of <a class="reference internal" href="#tcfl.tc.target_c.on_console_rx" title="tcfl.tc.target_c.on_console_rx"><code class="xref py py-meth docutils literal"><span class="pre">on_console_rx()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>regex_or_str</strong> – string or regular expression (compiled
with <a class="reference external" href="https://docs.python.org/2.7/library/re.html#re.compile" title="(in Python v2.7)"><code class="xref py py-func docutils literal"><span class="pre">re.compile()</span></code></a>.</li>
<li><strong>result</strong> – <p>what to do when that regex_or_str is found on
the given console:</p>
<ul>
<li><em>pass</em>, raise <a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.pass_e</span></code></a></li>
<li><em>block</em>, raise <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.blocked_e</span></code></a></li>
<li><em>failed</em>, raise <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.error_e</span></code></a>,</li>
<li><em>failed</em>, raise <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.failed_e</span></code></a>,</li>
<li><em>blocked</em>, raise <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.blocked_e</span></code></a></li>
</ul>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first"><a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.pass_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.blocked_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.error_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.failed_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.skip_e</span></code></a>).</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Nothing</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.stub_app_add">
<code class="descname">stub_app_add</code><span class="sig-paren">(</span><em>bsp</em>, <em>_app</em>, <em>app_src</em>, <em>app_src_options=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.stub_app_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add App builder information for a BSP that has to be stubbed.</p>
<p>When running on a target that has multiple BSPs but some of
then will not be used by the current <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>, stubs
might have to be added to those BSPs to make sure their CPUs
are not going wild. Use this function to specify which app
builder is going to be used, the path to the stub source and
build options. The App building mechanism will take it from
there.</p>
<p>An app builder might determine that a given BSP needs no stub;
in said case it can remove it from the dict
<a class="reference internal" href="#tcfl.tc.target_c.bsps_stub" title="tcfl.tc.target_c.bsps_stub"><code class="xref py py-meth docutils literal"><span class="pre">bsps_stub()</span></code></a> with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">target</span><span class="o">.</span><span class="n">bsps_stub</span><span class="p">[</span><span class="n">BSPNAME</span><span class="p">]</span>
</pre></div>
</div>
<p>This is like the app information added by _target_app_add(),
but it is stored in the target_c instance, not to the testcase
class.</p>
<p>This is because the stubbing that has to be done is specific
to each target (as the BSPs to stub each target have might be
different depending on the target and BSP-model).</p>
<p>Note this information is only added if there is nothing
existing about said BSP. To override, you need to delete and
add:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">target</span><span class="o">.</span><span class="n">bsps_stub</span><span class="p">[</span><span class="n">BSPNAME</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">stub_app_add</span><span class="p">(</span><span class="n">BSPNAME</span><span class="p">,</span> <span class="n">etc</span> <span class="n">etc</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.bsp_model_suffix">
<code class="descname">bsp_model_suffix</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.bsp_model_suffix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.bsp_suffix">
<code class="descname">bsp_suffix</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.bsp_suffix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_c.report_mk_prefix">
<code class="descname">report_mk_prefix</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_c.report_mk_prefix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc.target_group_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">target_group_c</code><span class="sig-paren">(</span><em>descr</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_group_c" title="Permalink to this definition">¶</a></dt>
<dd><p>A unique group of targets (each set to an specific <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP
model</span></a>) assigned to to a testcase for execution.</p>
<p>A testcase can query a <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> instance of the
remote target to manipualte it by declaring it as an argument to a
testcase method, querying the <a class="reference internal" href="#tcfl.tc.target_group_c.targets" title="tcfl.tc.target_group_c.targets"><code class="xref py py-attr docutils literal"><span class="pre">targets</span></code></a> dictionary or
calling <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-meth docutils literal"><span class="pre">target()</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mytarget&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">mytest</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mytarget</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mytarget</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mytarget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_group</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;mytarget&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mytarget</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mytarget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s2">&quot;mytarget&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mytarget</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="tcfl.tc.target_group_c.name">
<code class="descname">name</code><a class="headerlink" href="#tcfl.tc.target_group_c.name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_group_c.name_set">
<code class="descname">name_set</code><span class="sig-paren">(</span><em>tgid</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_group_c.name_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_group_c.len">
<code class="descname">len</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_group_c.len" title="Permalink to this definition">¶</a></dt>
<dd><p>Return number of targets in the group</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_group_c.target">
<code class="descname">target</code><span class="sig-paren">(</span><em>target_name</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_group_c.target" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the instance of <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> that represents a
remote target that met the specification requested</p>
<p><a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target()</span></code></a> decorator with name <em>target_name</em></p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.target_group_c.target_add">
<code class="descname">target_add</code><span class="sig-paren">(</span><em>target_name</em>, <em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_group_c.target_add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.target_group_c.targets">
<code class="descname">targets</code><a class="headerlink" href="#tcfl.tc.target_group_c.targets" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> descriptor for a remote target
keyed by the name they were requested with the
<a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target()</span></code></a> decorator.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc.result_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">result_c</code><span class="sig-paren">(</span><em>passed</em>, <em>errors</em>, <em>failed</em>, <em>blocked</em>, <em>skipped</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="tcfl.tc.result_c.total">
<code class="descname">total</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.total" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.result_c.summary">
<code class="descname">summary</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.summary" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.result_c.normalized">
<code class="descname">normalized</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.normalized" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.tc.result_c.from_retval">
<em class="property">static </em><code class="descname">from_retval</code><span class="sig-paren">(</span><em>retval</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.from_retval" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.tc.result_c.report_from_exception">
<em class="property">static </em><code class="descname">report_from_exception</code><span class="sig-paren">(</span><em>_tc</em>, <em>e</em>, <em>attachments=None</em>, <em>force_result=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.report_from_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Given an exception, report using the testcase or target report
infrastructure on the exception, traces to it as well as any
attachments it came with and return a valid <a class="reference internal" href="#tcfl.tc.result_c" title="tcfl.tc.result_c"><code class="xref py py-class docutils literal"><span class="pre">result_c</span></code></a>
code.</p>
<p>By default, this is the mapping:</p>
<ul class="simple">
<li><a class="reference internal" href="#tcfl.tc.tc_c.report_pass" title="tcfl.tc.tc_c.report_pass"><code class="xref py py-meth docutils literal"><span class="pre">tc_c.report_pass()</span></code></a> is used for <a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal"><span class="pre">pass_e</span></code></a></li>
<li><a class="reference internal" href="#tcfl.tc.tc_c.report_error" title="tcfl.tc.tc_c.report_error"><code class="xref py py-meth docutils literal"><span class="pre">tc_c.report_error()</span></code></a> is used for <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">error_e</span></code></a></li>
<li><a class="reference internal" href="#tcfl.tc.tc_c.report_fail" title="tcfl.tc.tc_c.report_fail"><code class="xref py py-meth docutils literal"><span class="pre">tc_c.report_fail()</span></code></a> is used for <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal"><span class="pre">failed_e</span></code></a></li>
<li><a class="reference internal" href="#tcfl.tc.tc_c.report_blck" title="tcfl.tc.tc_c.report_blck"><code class="xref py py-meth docutils literal"><span class="pre">tc_c.report_blck()</span></code></a> is used for <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">blocked_e</span></code></a>
and any other exception</li>
<li><a class="reference internal" href="#tcfl.tc.tc_c.report_skip" title="tcfl.tc.tc_c.report_skip"><code class="xref py py-meth docutils literal"><span class="pre">tc_c.report_skip()</span></code></a> is used for <a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal"><span class="pre">skip_e</span></code></a></li>
</ul>
<p>However, it can be forced by passing as <em>force_result</em> or each
testcase can be told to consider specific exceptions as others
per reporting using the <a class="reference internal" href="#tcfl.tc.tc_c.exception_to_result" title="tcfl.tc.tc_c.exception_to_result"><code class="xref py py-attr docutils literal"><span class="pre">tcfl.tc.tc_c.exception_to_result</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>force_result</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – force the exception to be
interpreted as <a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.pass_e</span></code></a>, <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">error_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal"><span class="pre">failed_e</span></code></a>, <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.blocked_e</span></code></a>, or <a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal"><span class="pre">skip_e</span></code></a>; note
there is also translation that can be done from
<a class="reference internal" href="#tcfl.tc.tc_c.exception_to_result" title="tcfl.tc.tc_c.exception_to_result"><code class="xref py py-attr docutils literal"><span class="pre">tcfl.tc.tc_c.exception_to_result</span></code></a>.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="tcfl.tc.result_c.from_exception">
<em class="property">static </em><code class="descname">from_exception</code><span class="sig-paren">(</span><em>fn</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.result_c.from_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Call a phase function to translate exceptions into
<a class="reference internal" href="#tcfl.tc.result_c" title="tcfl.tc.result_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.result_c</span></code></a> return codes.</p>
<p>Passes through the return code, unless it is None, in which
case we just return result_c(1, 0, 0, 0, 0)</p>
<p>Note this function prints some more extra detail in case of
fail/block/skip.
it.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc.tc_logadapter_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">tc_logadapter_c</code><span class="sig-paren">(</span><em>logger</em>, <em>extra</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_logadapter_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Logging adapter to prefix test case’s current <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>,
bsp and target name.</p>
<p>Initialize the adapter with a logger and a dict-like object which
provides contextual information. This constructor signature allows
easy stacking of LoggerAdapters, if so desired.</p>
<p>You can effectively pass keyword arguments as shown in the
following example:</p>
<p>adapter = LoggerAdapter(someLogger, dict(p1=v1, p2=”v2”))</p>
<dl class="attribute">
<dt id="tcfl.tc.tc_logadapter_c.id">
<code class="descname">id</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_logadapter_c.id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_logadapter_c.prefix">
<code class="descname">prefix</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_logadapter_c.prefix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_logadapter_c.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>msg</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_logadapter_c.process" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.tc.tags">
<code class="descclassname">tcfl.tc.</code><code class="descname">tags</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tags" title="Permalink to this definition">¶</a></dt>
<dd><p>Add tags to a testcase</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>args</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – every <cite>arg</cite> is converted into a boolean tag
(present, thus True)</li>
<li><strong>kwargs</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – every argument <cite>name = value</cite> is added as tag
<cite>name</cite> with value <cite>value</cite>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.tc.serially">
<code class="descclassname">tcfl.tc.</code><code class="descname">serially</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.serially" title="Permalink to this definition">¶</a></dt>
<dd><p>Force a testcase method to run serially</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tc.target_want_add">
<code class="descclassname">tcfl.tc.</code><code class="descname">target_want_add</code><span class="sig-paren">(</span><em>_tc</em>, <em>target_want_name</em>, <em>spec</em>, <em>origin</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target_want_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a requirement for a target to a testcase instance</p>
<p>Given a testcase instance, add a requirement for it to need a
target, filtered with the given specification (<em>spec</em>, which
defaults to any), a name and optional arguments in the form of
keywords.</p>
<p>This is equivalent to the <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target()</span></code></a> decorator, which
adds the requirement to the class, not to the instance. Please
refer to it for the arguments.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tc.target">
<code class="descclassname">tcfl.tc.</code><code class="descname">target</code><span class="sig-paren">(</span><em>spec=None</em>, <em>name=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.target" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a requirement for a target to a testcase instance</p>
<p>For each target this testcase will need, a <a class="reference internal" href="02-guides.html#target-specification"><span class="std std-ref">filtering
specification</span></a> can be given (<em>spec</em>), a
name (or it will default to <em>targetN</em> except for the first one,
which is just <em>target</em>) and optional arguments in the form of
keywords.</p>
<p>Of those optional arguments, the most important are the app_*
arguments. An app_* argument is supplying a source path for an
application that has to be (maybe) configured, built and deployed
to the target. The decorator will add phase methods to the
testcase to configure, build and deploy the application. Now,
depending on the application drivers installed, the application
can be built or not. FIXME make this explanation better.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>spec</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="02-guides.html#target-specification"><span class="std std-ref">specification</span></a> to
filter against the tags the remote target exposes.</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name for the target (must not exist already). If
none, first declared target is called <em>target</em>, the next
<em>target1</em>, then <em>target2</em> and so on.</li>
<li><strong>kwargs</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>extra keyword arguments are allowed, which
might be used in different ways that are still TBD. Main ones
recognized:</p>
<blockquote>
<div><ul>
<li><em>app_NAME = dict(BSP1: PATH1, BSP1: PATH2)</em>: specify a list
of paths to apps that shall be built and deployed to the
given BSPs by App builder <em>app_NAME</em>; App builders exist for
Zephyr, Arduino Sketch and other setups, so you don’t
manually have to build your apps. You can create your own
too.<p>When a board is being run in a multiple BSP mode, each BSP
has to be added to an App builder if using the App builder
support, otherwise is an error condition.</p>
</li>
<li><em>app_NAME = PATH</em>: the same, but one for when one BSP is
used; it applies to <cite>any</cite> BSP in a single <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a>
target.<p>FIXME: add link to app builders</p>
</li>
<li><dl class="first docutils">
<dt><em>app_NAME_options = STRING</em>: Extra options to pass to the APP</dt>
<dd>builder FIXME: support also BSP_options?</dd>
</dl>
</li>
</ul>
<ul id="tcf-target-modes">
<li><dl class="first docutils">
<dt><em>mode</em>: how to consider this target at the time of generating</dt>
<dd>multiple permutations of targets to run a testcase:<ul class="last">
<li><em>any</em>: run the testcase on any target that can
be found to match the specification</li>
<li><em>one-per-type</em>: run the testcase on one target of each
type that meets the specification (so if five targets
match the specification but they are all of the same type,
only one will run it; however, if there are two different
types in the set of five, one of each type will run it)</li>
<li><em>all</em>: run on every single target that matches the
specification</li>
</ul>
</dd>
</dl>
<p>Specially on testcases that require multiple targets, there
can be a huge number of permutations on how to run the
testcase to ensure maximum coverage of different combinations
of targets; some experimentation is needed to decide how to
tell TCF to run the testcase and balance how many resources
are used.</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.tc.interconnect">
<code class="descclassname">tcfl.tc.</code><code class="descname">interconnect</code><span class="sig-paren">(</span><em>spec=None</em>, <em>name=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.interconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a requirement for an interconnect to a testcase instance</p>
<p>An interconect is a target that binds two or more targets
together, maybe provides interconnectivity services (networking or
any other); we declare it’s need just like any other
target–however, we add the name to an special list so it is
easier to handle later.</p>
<p>The arguments are the same as to <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target()</span></code></a>.</p>
</dd></dl>

<dl class="class">
<dt id="tcfl.tc.tc_c">
<em class="property">class </em><code class="descclassname">tcfl.tc.</code><code class="descname">tc_c</code><span class="sig-paren">(</span><em>name</em>, <em>tc_file_path</em>, <em>origin</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c" title="Permalink to this definition">¶</a></dt>
<dd><p>A testcase, with instructions for configuring, building, deploying,
setting up, running, evaluating, tearing down and cleaning up.</p>
<p>Derive this class to create a testcase, implementing the different
testcase methods to build, deploy and evaluate if it is considered
a pass or a failure:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">sometest</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_device_present</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>         <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/dev/expected_device&quot;</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>             <span class="k">raise</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">error_e</span><span class="p">(</span><span class="s2">&quot;Device not connected&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_mode_correct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>         <span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s2">&quot;/dev/expected_device&quot;</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>         <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mh">0x644</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>             <span class="k">raise</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">failed_e</span><span class="p">(</span><span class="s2">&quot;wrong mode&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the class will be ignored as a testcase if its name
starts with <em>_base_</em>; this is useful to create common
code which will be instantiated in another class without
it being confused with a testcase.</p>
</div>
<p>The runner will call the testcase methods to evaluate the test;
any failure/blockage causes the evaluation to stop and move on to
the next testcase:</p>
<ul>
<li><p class="first"><em>configure*()</em> for getting source code, configuring a buid,
etc ..</p>
</li>
<li><p class="first"><em>build*()</em> for building anything that is needed to run the
testcase</p>
</li>
<li><p class="first"><em>deploy*()</em> for deploying the build products or artifacts
needed to run the testcase to the diffrent targets</p>
</li>
<li><p class="first">For evaluating:</p>
<ul class="simple">
<li><em>setup*()</em> to setup the system/fixture for an evaluation run</li>
<li><em>start*()</em> to start/power-on the targets or anything needed
for the test case evaluation</li>
<li><em>eval*()</em> to actually do evaluation actions</li>
<li><em>teardown*()</em> for powering off</li>
</ul>
<p>As well, any <em>test*()</em> methods will be run similarly, but for
each, the sequence called will be setup/start/test/teardown (in
contrast to <em>eval</em> methods, where they are run in sequence
without calling setup/start/teardown in between).</p>
</li>
<li><p class="first"><em>clean*()</em> for cleaning up (ran only if <em>-L</em> is passed on the
command line)</p>
</li>
<li><dl class="first docutils">
<dt><em>class_teardown</em> is mostly used for self-testing and debugging,</dt>
<dd><p class="first last">but are functions called whenever every single testcase of the
same class has completed executing.</p>
</dd>
</dl>
</li>
</ul>
<p>Methods can take no arguments or the names of one or more targets
they will operate with/on. These targets are declared using the
<a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target()</span></code></a> (for a normal target) and
<a class="reference internal" href="#tcfl.tc.interconnect" title="tcfl.tc.interconnect"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.interconnect()</span></code></a> (for a target that
interconnects/groups the rest of the targets together).</p>
<p>The methods that take no targets will be called sequentially in
<strong>alphabetical order</strong> (not in declaration order!). The methods
that take different targets will be called in parallel (to
maximize multiple cores, unless decorated with
<a class="reference internal" href="#tcfl.tc.serially" title="tcfl.tc.serially"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.serially()</span></code></a>). Evaluation functions are always called
sequentially.</p>
<p>The testcase methods use the APIs exported by this class and module:</p>
<blockquote>
<div><ul>
<li><p class="first">to report information at the appropiate log level:
<a class="reference internal" href="#tcfl.tc.tc_c.report_pass" title="tcfl.tc.tc_c.report_pass"><code class="xref py py-meth docutils literal"><span class="pre">report_pass()</span></code></a>, <a class="reference internal" href="#tcfl.tc.tc_c.report_fail" title="tcfl.tc.tc_c.report_fail"><code class="xref py py-meth docutils literal"><span class="pre">report_fail()</span></code></a>, <a class="reference internal" href="#tcfl.tc.tc_c.report_blck" title="tcfl.tc.tc_c.report_blck"><code class="xref py py-meth docutils literal"><span class="pre">report_blck()</span></code></a>
and <a class="reference internal" href="#tcfl.tc.tc_c.report_info" title="tcfl.tc.tc_c.report_info"><code class="xref py py-meth docutils literal"><span class="pre">report_info()</span></code></a></p>
</li>
<li><p class="first">raise an exception to indicate result of this method:</p>
<ul class="simple">
<li><em>pass</em>, raise <a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.pass_e</span></code></a> (or simply return)</li>
<li><em>failed</em>, raise <a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.failed_e</span></code></a>,</li>
<li><em>error</em>, raise <a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.error_e</span></code></a>,</li>
<li><em>blocked</em>, raise <a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.blocked_e</span></code></a>; any other
uncaught Python exception is also converted to this.</li>
<li><em>skipped</em>, raise <a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.skip_e</span></code></a></li>
</ul>
</li>
<li><p class="first">run commands in the local machine with <a class="reference internal" href="#tcfl.tc.tc_c.shcmd_local" title="tcfl.tc.tc_c.shcmd_local"><code class="xref py py-meth docutils literal"><span class="pre">shcmd_local()</span></code></a>; the
command can be formatted with <em>%(KEYWORD)[sd]</em> that will be
substituted with values found in <a class="reference internal" href="#tcfl.tc.tc_c.kws" title="tcfl.tc.tc_c.kws"><code class="xref py py-attr docutils literal"><span class="pre">kws</span></code></a>.</p>
</li>
<li><p class="first">Interact with the remote targets through instances of
<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">target_c</span></code></a> that represent them:</p>
<ul>
<li><p class="first">via arguments to the method</p>
</li>
<li><p class="first">via <a class="reference internal" href="#tcfl.tc.tc_c.targets" title="tcfl.tc.tc_c.targets"><code class="xref py py-attr docutils literal"><span class="pre">targets</span></code></a>, a dictionary keyed by the names of the
targets requested with the <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal"><span class="pre">target()</span></code></a> and
<a class="reference internal" href="#tcfl.tc.interconnect" title="tcfl.tc.interconnect"><code class="xref py py-func docutils literal"><span class="pre">interconnect()</span></code></a> decorators; for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">interconnect</span><span class="p">()</span>    <span class="c1"># named &quot;ic&quot; by default</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>          <span class="c1"># named &quot;target1&quot; by default</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>          <span class="c1"># named &quot;target&quot; by default</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">mytest</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">target1</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ic</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target1</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_group</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">target2</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;Ready&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">mytarget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s2">&quot;ic&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">ic</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;targets are online&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">for</span> <span class="n">_n</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
<span class="gp">&gt;&gt;&gt; </span>           <span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
</li>
</ul>
<p><a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">target_c</span></code></a> expose APIs to act on the targets, such as
power control, serial console access, image deployment</p>
</li>
</ul>
</div></blockquote>
<dl class="attribute">
<dt id="tcfl.tc.tc_c.valid_results">
<code class="descname">valid_results</code><em class="property"> = ('PASS', 'ERRR', 'FAIL', 'BLCK', 'SKIP')</em><a class="headerlink" href="#tcfl.tc.tc_c.valid_results" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.kws">
<code class="descname">kws</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.kws" title="Permalink to this definition">¶</a></dt>
<dd><p>Keywords for <em>%(KEY)[sd]</em> substitution specific to this
testcase.</p>
<p>Note these do not include values gathered from remote
targets (as they would collide with each other). Look at
data:<cite>target.kws &lt;tcfl.tc.target_c.kws&gt;</cite> for that.</p>
<p>These can be used to generate strings based on information,
as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span> <span class="nb">print</span> <span class="s2">&quot;Something </span><span class="si">%(FIELD)s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">kws</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">target</span><span class="o">.</span><span class="n">shcmd_local</span><span class="p">(</span><span class="s2">&quot;cp </span><span class="si">%(FIELD)s</span><span class="s2">.config final.config&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Fields available:</p>
<blockquote>
<div><ul class="simple">
<li><cite>runid</cite>: string specified by the user that applies to
all the testcases</li>
<li><cite>srcdir</cite> and <cite>srcdir_abs</cite>: directory where this
testcase was found</li>
<li><cite>thisfile</cite>: file where this testscase as found</li>
<li><cite>tc_hash</cite>: unique four letter ID assigned to this
testcase instance. Note that this is the same for all
the targets it runs on. A unique ID for each target of
the same testcase instance is the field <em>tg_hash</em> in the
target’s keywords <a class="reference internal" href="#tcfl.tc.target_c.kws" title="tcfl.tc.target_c.kws"><code class="xref py py-data docutils literal"><span class="pre">target.kws</span></code></a> (FIXME: generate, currently
only done by app builders)</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.kws_origin">
<code class="descname">kws_origin</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.kws_origin" title="Permalink to this definition">¶</a></dt>
<dd><p>Origin of the keyword in self.kws; the values for these are
lists of places where the setting was set, or re-set</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.buffers_lock">
<code class="descname">buffers_lock</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.buffers_lock" title="Permalink to this definition">¶</a></dt>
<dd><p>Lock to access <a class="reference internal" href="#tcfl.tc.tc_c.buffers" title="tcfl.tc.tc_c.buffers"><code class="xref py py-attr docutils literal"><span class="pre">buffers</span></code></a> safely from multiple threads
at the same time for the same testcase.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.origin">
<code class="descname">origin</code><em class="property"> = '/home/inaky/t/master-tcf.git/tcfl/tc.py:5607'</em><a class="headerlink" href="#tcfl.tc.tc_c.origin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.build_only">
<code class="descname">build_only</code><em class="property"> = []</em><a class="headerlink" href="#tcfl.tc.tc_c.build_only" title="Permalink to this definition">¶</a></dt>
<dd><p>List of places where we declared this testcase is build only</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.expecter">
<code class="descname">expecter</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.expecter" title="Permalink to this definition">¶</a></dt>
<dd><p>Expect loop to wait for things to happen</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.targets">
<code class="descname">targets</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.targets" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">Target</span> <span class="pre">objects</span></code></a>) in which this
testcase is running (keyed by target want name, as given to
decorators <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target()</span></code></a> and
func:<cite>tcfl.tc.interconnect</cite>.
Note this maps to <code class="docutils literal"><span class="pre">self._target_groups_c.targets()</span></code> for
convenience.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.result_eval">
<code class="descname">result_eval</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.result_eval" title="Permalink to this definition">¶</a></dt>
<dd><p>Result of the last evaluation run</p>
<p>When an evaluation is run (setup/start/eval/teardown), this
variable reflexts the evaluation status; it is meant to be
used during the <em>teardown</em> phase, so for example, in case
of failure, the teardown phase might decide to gather
information about the current target’s state.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.result">
<code class="descname">result</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.result" title="Permalink to this definition">¶</a></dt>
<dd><p>Result of the last run of all phases in this testcase</p>
<p>we might need to look at this in other testcases executed
inmediately after (as added with <a class="reference internal" href="#tcfl.tc.tc_c.post_tc_append" title="tcfl.tc.tc_c.post_tc_append"><code class="xref py py-meth docutils literal"><span class="pre">post_tc_append()</span></code></a>).</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.is_static">
<code class="descname">is_static</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.is_static" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <em>True</em> if the testcase is <em>static</em> (needs to targets to
execute), <em>False</em> otherwise.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.report_pass">
<code class="descname">report_pass</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.report_pass" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.report_error">
<code class="descname">report_error</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.report_error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.report_fail">
<code class="descname">report_fail</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.report_fail" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.report_blck">
<code class="descname">report_blck</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.report_blck" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.report_skip">
<code class="descname">report_skip</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.report_skip" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.report_info">
<code class="descname">report_info</code><span class="sig-paren">(</span><em>message</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.report_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.report_data">
<code class="descname">report_data</code><span class="sig-paren">(</span><em>domain</em>, <em>name</em>, <em>value</em>, <em>expand=True</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.report_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Report measurable data</p>
<p>When running a testcase, if data is collected that has to be
reported for later analysis, use this function to report
it. This will be reported by the report driver in a way that
makes it easy to collect later on.</p>
<p>Measured data is identified by a <em>domain</em> and a <em>name</em>, plus
then the actual value.</p>
<p>A way to picture how this data can look once aggregated is as
a table per domain, on which each invocation is a row and each
column will be the values for each name.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>domain</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – to which domain this measurement applies
(eg: “Latency Benchmark %(type)s”);</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the value  (eg: “context switch
(microseconds)”); it is recommended to always add the unit
the measurement represents.</li>
<li><strong>value</strong> – value to report for the given domain and name;
any type can be reported.</li>
<li><strong>expand</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – <p>(optional) by default, the <em>domain</em> and
<em>name</em> fields will be %(FIELD)s expanded with the keywords
of the testcase or target. If <em>False</em>, it will not be
expanded.</p>
<p>This enables to, for example, specify a domain of “Latency
measurements for target %(type)s” which will automatically
create a different domain for each type of target.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.report_tweet">
<code class="descname">report_tweet</code><span class="sig-paren">(</span><em>what</em>, <em>result</em>, <em>extra_report=''</em>, <em>ignore_nothing=False</em>, <em>attachments=None</em>, <em>level=None</em>, <em>dlevel=0</em>, <em>alevel=2</em>, <em>ulevel=5</em>, <em>dlevel_failed=0</em>, <em>dlevel_blocked=0</em>, <em>dlevel_passed=0</em>, <em>dlevel_skipped=0</em>, <em>dlevel_error=0</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.report_tweet" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.shcmd_local">
<code class="descname">shcmd_local</code><span class="sig-paren">(</span><em>cmd</em>, <em>origin=None</em>, <em>reporter=None</em>, <em>logfile=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.shcmd_local" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a shell command in the local machine, substituting
%(KEYWORD)[sd] with keywords defined by the testcase.</p>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.tc_c.file_ignore_add_regex">
<em class="property">classmethod </em><code class="descname">file_ignore_add_regex</code><span class="sig-paren">(</span><em>regex</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.file_ignore_add_regex" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a regex to match a file name to ignore when looking
for testcase files</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Regular expression to match against the
file name (not path)</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – [optional] string describing where this
regular expression comes from (eg: <a class="reference external" href="FILE:LINENO">FILE:LINENO</a>).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.tc_c.dir_ignore_add_regex">
<em class="property">classmethod </em><code class="descname">dir_ignore_add_regex</code><span class="sig-paren">(</span><em>regex</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.dir_ignore_add_regex" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a regex to match a directory name to ignore when looking
for testcase files</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Regular expression to match against the
directory name (not path)</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – [optional] string describing where this
regular expression comes from (eg: <a class="reference external" href="FILE:LINENO">FILE:LINENO</a>).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.tc_c.driver_add">
<em class="property">classmethod </em><code class="descname">driver_add</code><span class="sig-paren">(</span><em>_cls</em>, <em>origin=None</em>, <em>*args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.driver_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a driver to handle test cases (a subclass of :class:tc_c)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.hook_pre">
<code class="descname">hook_pre</code><em class="property"> = []</em><a class="headerlink" href="#tcfl.tc.tc_c.hook_pre" title="Permalink to this definition">¶</a></dt>
<dd><p>(list of callables) a list of functions to call before starting
execution of each test case instance (right before any phases
are run)</p>
<p>Usable to do final testcase touch up, adding keywords needed
for the site deployment. etc.</p>
<p>Note these will be called as methods in the order in the list,
so the first argument will be always be the the testcase
instance.</p>
<p>E.g.: in a TCF configuration file <cite>.tcf/conf_hook.py</cite> you can
set:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">_my_hook_fn</span><span class="p">(</span><span class="n">tc</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># Classify testcases based on category:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># - red</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># - green</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># - blue</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1">#</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># tc_name keyword has the path of the testcase, which</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># we are using for the sake of example to categorize;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># keywords can be dumped by running `tcf run</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># /usr/share/examples/test_dump_kws*py.</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">name</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;tc_name&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">categories</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span> <span class="p">]:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="c1"># if test&#39;s path has CATEGORY, add it</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">if</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">categories</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">categories</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">categories</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;uncategorized&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tc</span><span class="o">.</span><span class="n">kw_set</span><span class="p">(</span><span class="s1">&#39;categories&#39;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">categories</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tc</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;DEBUG categories: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">categories</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="o">.</span><span class="n">hook_pre</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_my_hook_fn</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>this is a global variable for all testcases of all classes
and instances assigned to run in different targets</li>
<li>these functions will execute on different threads
and processes, so <strong>do not use shared data or global
variables</strong>.</li>
<li>only add to this list from configuration files, never from
testcases or testcase driver code.</li>
</ul>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.type_map">
<code class="descname">type_map</code><em class="property"> = {}</em><a class="headerlink" href="#tcfl.tc.tc_c.type_map" title="Permalink to this definition">¶</a></dt>
<dd><p>(dict) a dictionary to translate target type names, from
<em>TYPE[:BSP]</em> to another name to use when reporting as it is
useful/convenient to your application (eg: if what you are
testing prefers other type names); will be only translated if
present. E.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_c</span><span class="o">.</span><span class="n">type_map</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># translate to Zephyr names</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;arduino-101:x86&quot;</span> <span class="o">=</span> <span class="s2">&quot;arduino_101&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;arduino-101:arc&quot;</span> <span class="o">=</span> <span class="s2">&quot;arduino_101_ss&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.exception_to_result">
<code class="descname">exception_to_result</code><em class="property"> = {&lt;type 'exceptions.AssertionError'&gt;: &lt;class 'tcfl.tc.blocked_e'&gt;}</em><a class="headerlink" href="#tcfl.tc.tc_c.exception_to_result" title="Permalink to this definition">¶</a></dt>
<dd><p>Map exception types to results</p>
<p>this allows to automaticall map an exception raised
automatically and be converted to a type. Any testcase can
define their own version of this to decide how to convert
exceptions from the default of them being considered blockage
to skip, fail or pass</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">configure_exceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">exception_to_result</span><span class="p">[</span><span class="ne">OSError</span><span class="p">]</span> <span class="o">=</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">error_e</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.eval_repeat">
<code class="descname">eval_repeat</code><em class="property"> = 1</em><a class="headerlink" href="#tcfl.tc.tc_c.eval_repeat" title="Permalink to this definition">¶</a></dt>
<dd><p>How many times do we repeat the evaluation (for stress/MTBF)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.eval_count">
<code class="descname">eval_count</code><em class="property"> = 0</em><a class="headerlink" href="#tcfl.tc.tc_c.eval_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Which evaluation are we currently running (out of <a class="reference internal" href="#tcfl.tc.tc_c.eval_repeat" title="tcfl.tc.tc_c.eval_repeat"><code class="xref py py-data docutils literal"><span class="pre">eval_repeat</span></code></a>)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.testcase_patchers">
<code class="descname">testcase_patchers</code><em class="property"> = []</em><a class="headerlink" href="#tcfl.tc.tc_c.testcase_patchers" title="Permalink to this definition">¶</a></dt>
<dd><p>List of callables that will be executed when a testcase is
identified; these can modify as needed the testcase (eg:
scanning for tags)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.runid">
<code class="descname">runid</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.runid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.runid_visible">
<code class="descname">runid_visible</code><em class="property"> = ''</em><a class="headerlink" href="#tcfl.tc.tc_c.runid_visible" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.tmpdir">
<code class="descname">tmpdir</code><em class="property"> = '/tmp/tcf.run-dmNDDM'</em><a class="headerlink" href="#tcfl.tc.tc_c.tmpdir" title="Permalink to this definition">¶</a></dt>
<dd><p>temporary directory where testcases can drop things; this will
be specific to each testcase instance (testcase and target
group where it runs).</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.buffers">
<code class="descname">buffers</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.buffers" title="Permalink to this definition">¶</a></dt>
<dd><p>temporary directory where to store information (serial console,
whatever) that will be captured on each different evaluation;
on each invocation of the evaluation, a new buffer dir will be
allocated and code that captures things from the target will
store captures in there.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.jobs">
<code class="descname">jobs</code><em class="property"> = 1</em><a class="headerlink" href="#tcfl.tc.tc_c.jobs" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of testcases running on targets</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.rt_all">
<code class="descname">rt_all</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc.tc_c.rt_all" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.release">
<code class="descname">release</code><em class="property"> = True</em><a class="headerlink" href="#tcfl.tc.tc_c.release" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.report_mk_prefix">
<code class="descname">report_mk_prefix</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.report_mk_prefix" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the prefix we use for the logging/reports when some
parameter changes.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.target_group">
<code class="descname">target_group</code><a class="headerlink" href="#tcfl.tc.tc_c.target_group" title="Permalink to this definition">¶</a></dt>
<dd><p>Group of targets this testcase is being ran on</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.tag_set">
<code class="descname">tag_set</code><span class="sig-paren">(</span><em>tagname</em>, <em>value=None</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.tag_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a testcase tag.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tagname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the tag (string)</li>
<li><strong>value</strong> – (optional) value for the tag; can be a string,
bool; if none specified, it is set to True</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) origin of the tag; defaults to
the calling function</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note that there are a few tags that have speciall conventions:</p>
<ul>
<li><p class="first"><em>component/COMPONENTNAME</em> is a tag with value
<em>COMPONENTNAME</em> and it is used to classify the testcases by
component. Multiple tags like this might exist if the
testcase belongs to multiple components. Note it should be a
single word.</p>
<p>TCF will create a tag <em>components</em> with value <em>COMPONENTNAME1
COMPONENTNAME2 …</em> (space separated list of components)
which shall match the <em>component/COMPONENTx</em>
<em>name</em> contains the name of the testcase after testcase
instantiation.</p>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.tags_set">
<code class="descname">tags_set</code><span class="sig-paren">(</span><em>_tags</em>, <em>origin=None</em>, <em>overwrite=True</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.tags_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set multiple testcase tags.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tags</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of tags and values</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) origin of the tag; defaults to
the calling function</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Same notes as for <a class="reference internal" href="#tcfl.tc.tc_c.tag_set" title="tcfl.tc.tc_c.tag_set"><code class="xref py py-meth docutils literal"><span class="pre">tag_set()</span></code></a> apply</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.kw_set">
<code class="descname">kw_set</code><span class="sig-paren">(</span><em>key</em>, <em>value</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.kw_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a testcase’s keyword and value</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – keyword name</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – value</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) where this comes from</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.kws_set">
<code class="descname">kws_set</code><span class="sig-paren">(</span><em>d</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.kws_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a bunch of testcase’s keywords and values</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>d</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – A dictionary of keywords and values</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.tag_get">
<code class="descname">tag_get</code><span class="sig-paren">(</span><em>tagname</em>, <em>value_default</em>, <em>origin_default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.tag_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a tuple (value, origin) with the value of the tag and
where it was defined.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.target_event">
<code class="descname">target_event</code><em class="property"> = &lt;threading._Event object&gt;</em><a class="headerlink" href="#tcfl.tc.tc_c.target_event" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.mkticket">
<code class="descname">mkticket</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.mkticket" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc.tc_c.post_tc_append">
<code class="descname">post_tc_append</code><span class="sig-paren">(</span><em>tc</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.post_tc_append" title="Permalink to this definition">¶</a></dt>
<dd><p>Append a testcase that shall be executed inmediately after
this testcase is done executing in the same target group.</p>
<p>This is a construct that can be used for:</p>
<ul class="simple">
<li>execute other testcases that have been detected as needed
only during runtime</li>
<li>reporting subtestcases of a main testcase (relying only on
the output of the main testcase execution, such as in
<code class="xref py py-class docutils literal"><span class="pre">tc_zephyr_sanity.tc_zephyr_subsanity_c</span></code>.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>tc</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tc_c</em></a>) – <p>[instance of a] testcase to append; note this
testcase will be executed in the same target group as this
testcase is being executed. So the testcase has to declare
at the same targets (with the same names) or a subset of
them. Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target3&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">some_tc</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_something</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target2</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">new_tc</span> <span class="o">=</span> <span class="n">another_tc</span><span class="p">(</span><span class="n">SOMEPARAMS</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">post_tc_append</span><span class="p">(</span><span class="n">new_tc</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">another_tc</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_something</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target2</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">report_info</span><span class="p">(</span><span class="s2">&quot;I&#39;m running on target2&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;target3&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">yet_another_tc</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">eval_something</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target1</span><span class="p">,</span> <span class="n">target3</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">report_info</span><span class="p">(</span><span class="s2">&quot;I&#39;m running on target1 and target3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.file_regex">
<code class="descname">file_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#tcfl.tc.tc_c.file_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc.tc_c.class_result">
<code class="descname">class_result</code><em class="property"> = 0 (0 0 0 0 0)</em><a class="headerlink" href="#tcfl.tc.tc_c.class_result" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.tc_c.is_testcase">
<em class="property">classmethod </em><code class="descname">is_testcase</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.is_testcase" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc.tc_c.find_in_path">
<em class="property">classmethod </em><code class="descname">find_in_path</code><span class="sig-paren">(</span><em>tcs</em>, <em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.tc_c.find_in_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a path, scan for test cases and put them in the
dictionary &#64;tcs based on filename where found.
list of zero or more paths, scan them for files that
contain testcase tc information and report them.
:param dict tcs: dictionary where to add the test cases found</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – path where to scan for test cases</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">result_c with counts of tests passed/failed (zero,
as at this stage we cannot know), blocked (due to error
importing) or skipped(due to whichever condition).</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.tc.find">
<code class="descclassname">tcfl.tc.</code><code class="descname">find</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.find" title="Permalink to this definition">¶</a></dt>
<dd><p>Discover test cases in a list of paths</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tc.testcases_discover">
<code class="descclassname">tcfl.tc.</code><code class="descname">testcases_discover</code><span class="sig-paren">(</span><em>tcs_filtered</em>, <em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.testcases_discover" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.tc.argp_setup">
<code class="descclassname">tcfl.tc.</code><code class="descname">argp_setup</code><span class="sig-paren">(</span><em>arg_subparsers</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc.argp_setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>
<div class="section" id="module-tcfl.tl">
<span id="test-library-utilities-for-testcases"></span><h3>8.1.2. Test library (utilities for testcases)<a class="headerlink" href="#module-tcfl.tl" title="Permalink to this headline">¶</a></h3>
<p>Common utilities for test cases</p>
<dl class="function">
<dt id="tcfl.tl.zephyr_tags">
<code class="descclassname">tcfl.tl.</code><code class="descname">zephyr_tags</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.zephyr_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate the build environment and make sure all it is needed to
build Zephyr apps is in place.</p>
<p>If not, return a dictionary defining a <em>skip</em> tag with the reason
that can be fed directly to decorator <a class="reference internal" href="#tcfl.tc.tags" title="tcfl.tc.tags"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.tags()</span></code></a>; usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">qal</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tags</span><span class="p">(</span><span class="o">**</span><span class="n">qal</span><span class="o">.</span><span class="n">zephyr_tests_tags</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">some_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.console_dump_on_failure">
<code class="descclassname">tcfl.tl.</code><code class="descname">console_dump_on_failure</code><span class="sig-paren">(</span><em>testcase</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.console_dump_on_failure" title="Permalink to this definition">¶</a></dt>
<dd><p>If a testcase has errored, failed or blocked, dump the consoles of
all the targets.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>testcase</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – testcase whose targets’ consoles we
want to dump</td>
</tr>
</tbody>
</table>
<p>Usage: in a testcase’s teardown function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tl</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">some_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">teardown_SOMETHING</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">console_dump_on_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.setup_verify_slip_feature">
<code class="descclassname">tcfl.tl.</code><code class="descname">setup_verify_slip_feature</code><span class="sig-paren">(</span><em>zephyr_client</em>, <em>zephyr_server</em>, <em>_ZEPHYR_BASE</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.setup_verify_slip_feature" title="Permalink to this definition">¶</a></dt>
<dd><p>The Zephyr kernel we use needs to support
CONFIG_SLIP_MAC_ADDR, so if any of the targets needs SLIP
support, make sure that feature is Kconfigurable
Note we do this after building, because we need the full
target’s configuration file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>zephyr_client</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – Client Zephyr target</li>
<li><strong>zephyr_server</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – Client Server target</li>
<li><strong>_ZEPHYR_BASE</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Path of Zephyr source code</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Usage: in a testcase’s setup methods, before building Zephyr code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span>    <span class="nd">@staticmethod</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">setup_SOMETHING</span><span class="p">(</span><span class="n">zephyr_client</span><span class="p">,</span> <span class="n">zephyr_server</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">setup_verify_slip_feature</span><span class="p">(</span><span class="n">zephyr_client</span><span class="p">,</span> <span class="n">zephyr_server</span><span class="p">,</span>
<span class="go">                                              tcfl.tl.ZEPHYR_BASE)</span>
</pre></div>
</div>
<p>Look for a complete example in
<a class="reference download internal" href="../_downloads/test_network_linux_zephyr_echo.py" download=""><code class="xref download docutils literal"><span class="pre">../examples/test_network_linux_zephyr_echo.py</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.teardown_targets_power_off">
<code class="descclassname">tcfl.tl.</code><code class="descname">teardown_targets_power_off</code><span class="sig-paren">(</span><em>testcase</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.teardown_targets_power_off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off all the targets used on a testcase.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>testcase</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – testcase whose targets we are to
power off.</td>
</tr>
</tbody>
</table>
<p>Usage: in a testcase’s teardown function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tl</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">some_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">teardown_SOMETHING</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">teardown_targets_power_off</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Note this is usually not necessary as the daemon will power off
the targets when cleaning them up; usually when a testcase fails,
you want to keep them on to be able to inspect them.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.tcpdump_enable">
<code class="descclassname">tcfl.tl.</code><code class="descname">tcpdump_enable</code><span class="sig-paren">(</span><em>ic</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.tcpdump_enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Ask an interconnect to capture IP traffic with TCPDUMP</p>
<p>Note this is only possible if the server to which the interconnect
is attached has access to it; if the interconnect is based on the
:class:vlan_pci driver, it will support it.</p>
<p>Note the interconnect <em>must be</em> power cycled after this for the
setting to take effect. Normally you do this in the <em>start</em> method
of a multi-target testcase</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">tcpdump_enable</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">ic</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="tcfl.tl.tcpdump_collect">
<code class="descclassname">tcfl.tl.</code><code class="descname">tcpdump_collect</code><span class="sig-paren">(</span><em>ic</em>, <em>filename=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tl.tcpdump_collect" title="Permalink to this definition">¶</a></dt>
<dd><p>Collects from an interconnect target the tcpdump capture</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ic</strong> (<a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><em>tcfl.tc.target_c</em></a>) – interconnect target</li>
<li><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the local file where to
copy the tcpdump data to; defaults to
<em>report-RUNID:HASHID-REP.tcpdump</em> (where REP is the repetition
count)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-tcfl.target_ext_console">
<span id="extensions-to-tcfl-tc-target-c-types"></span><h3>8.1.3. Extensions to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> types<a class="headerlink" href="#module-tcfl.target_ext_console" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="tcfl.target_ext_console.console">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_console.</code><code class="descname">console</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.console" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> to run methods from the console
management interface to TTBD targets.</p>
<p>Use as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="tcfl.target_ext_console.console.read">
<code class="descname">read</code><span class="sig-paren">(</span><em>console_id=None</em>, <em>offset=0</em>, <em>fd=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.console.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read data received on the target’s console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>console_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to read from</li>
<li><strong>offset</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) offset to read from (defaults to zero)</li>
<li><strong>fd</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) file descriptor to which to write
the output (in which case, it returns the bytes read).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">data read (or if written to a file descriptor,
amount of bytes read)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.console.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>data</em>, <em>console_id=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.console.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write data received to a console</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> – data to write</li>
<li><strong>console_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) console to read from</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.console.setup">
<code class="descname">setup</code><span class="sig-paren">(</span><em>console_id=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.console.setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_console.console.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_console.console.list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-tcfl.target_ext_broker_files"></span><dl class="class">
<dt id="tcfl.target_ext_broker_files.broker_files">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_broker_files.</code><code class="descname">broker_files</code><span class="sig-paren">(</span><em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_broker_files.broker_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> to run methods to manage
the files available in the target broker for the current logged in
use.</p>
<p>Use as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">files</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">broker_files</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">broker_files</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">REMOTE</span><span class="p">,</span> <span class="n">LOCAL</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">broker_files</span><span class="o">.</span><span class="n">dnload</span><span class="p">(</span><span class="n">REMOTE</span><span class="p">,</span> <span class="n">LOCAL</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">broker_files</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">REMOTE</span><span class="p">)</span>
</pre></div>
</div>
<p>Note these files are, for example:</p>
<ul>
<li><p class="first">images for the server to flash into targets (usually handled with
the <a class="reference internal" href="#tcfl.target_ext_images.images" title="tcfl.target_ext_images.images"><code class="xref py py-class docutils literal"><span class="pre">tcfl.target_ext_images.images</span></code></a> extension)</p>
</li>
<li><p class="first">copying specific log files from the server (eg: downloading TCP
dump captures form <em>tcpdump</em> as done by the
<a class="reference internal" href="#conf_00_lib.vlan_pci" title="conf_00_lib.vlan_pci"><code class="xref py py-class docutils literal"><span class="pre">conf_00_lib.vlan_pci</span></code></a> network element).</p>
</li>
<li><p class="first">the storage area is commong to <em>all</em> targets of the server for
each user, thus multiple test cases running in parallel can
access it at the same time. Use the testcase’s hash to safely
namespace:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tc_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;tc_hash&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">broker_files</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">tc_hash</span> <span class="o">+</span> <span class="s2">&quot;-NAME&quot;</span><span class="p">,</span> <span class="n">LOCAL</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>Presence of the <em>broker_file</em> attribute in a target indicates this
interface is supported.</p>
<dl class="method">
<dt id="tcfl.target_ext_broker_files.broker_files.upload">
<code class="descname">upload</code><span class="sig-paren">(</span><em>remote</em>, <em>local</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_broker_files.broker_files.upload" title="Permalink to this definition">¶</a></dt>
<dd><p>Upload a local file to a remote name</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>remote</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name in the server</li>
<li><strong>local</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – local file name</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_broker_files.broker_files.dnload">
<code class="descname">dnload</code><span class="sig-paren">(</span><em>remote</em>, <em>local</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_broker_files.broker_files.dnload" title="Permalink to this definition">¶</a></dt>
<dd><p>Download a file to a local file name</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>remote</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the file to download in the server</li>
<li><strong>local</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – local file name</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_broker_files.broker_files.delete">
<code class="descname">delete</code><span class="sig-paren">(</span><em>remote</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_broker_files.broker_files.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete a remote file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>remote</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the file to remove from the server</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_broker_files.broker_files.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_broker_files.broker_files.list" title="Permalink to this definition">¶</a></dt>
<dd><p>List available files and their MD5 sums</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-tcfl.target_ext_debug"></span><dl class="class">
<dt id="tcfl.target_ext_debug.debug">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_debug.</code><code class="descname">debug</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.debug" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> to run methods form the debug
interface to TTBD targets.</p>
<p>Use as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">reset_halt</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span>
</pre></div>
</div>
<p>etc …</p>
<dl class="method">
<dt id="tcfl.target_ext_debug.debug.start">
<code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.debug.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start debugging support on the target</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.debug.info">
<code class="descname">info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.debug.info" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a string with information about the target’s debugging support</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.debug.halt">
<code class="descname">halt</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.debug.halt" title="Permalink to this definition">¶</a></dt>
<dd><p>Issue a CPU halt to the target’s CPUs</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.debug.reset">
<code class="descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.debug.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Issue a CPU reset and into runing to the target’s CPUs</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.debug.reset_halt">
<code class="descname">reset_halt</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.debug.reset_halt" title="Permalink to this definition">¶</a></dt>
<dd><p>Issue a CPU reset and halt the target’s CPUs</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.debug.resume">
<code class="descname">resume</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.debug.resume" title="Permalink to this definition">¶</a></dt>
<dd><p>Issue a CPU resume to the target’s CPUs</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.debug.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.debug.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop debugging support on the target</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_debug.debug.openocd">
<code class="descname">openocd</code><span class="sig-paren">(</span><em>command</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_debug.debug.openocd" title="Permalink to this definition">¶</a></dt>
<dd><p>Run an OpenOCD command (if supported)</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-tcfl.target_ext_images"></span><dl class="class">
<dt id="tcfl.target_ext_images.images">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_images.</code><code class="descname">images</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_images.images" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> to run methods from the
image management interface to TTBD targets.</p>
<p>Use as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</pre></div>
</div>
<p>Presence of the <em>images</em> attribute in a target indicates imaging
is supported by it.</p>
<dl class="attribute">
<dt id="tcfl.target_ext_images.images.retries">
<code class="descname">retries</code><em class="property"> = 4</em><a class="headerlink" href="#tcfl.target_ext_images.images.retries" title="Permalink to this definition">¶</a></dt>
<dd><p>When a deployment fails, how many times can we retry before
failing</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.target_ext_images.images.wait">
<code class="descname">wait</code><em class="property"> = 4</em><a class="headerlink" href="#tcfl.target_ext_images.images.wait" title="Permalink to this definition">¶</a></dt>
<dd><p>When power cycling a target to retry a flashing operation, how
much many seconds do we wait before powering on</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_images.images.upload_set">
<code class="descname">upload_set</code><span class="sig-paren">(</span><em>images</em>, <em>wait=None</em>, <em>retries=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_images.images.upload_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Upload and flash a set of images to the target</p>
<p>How this is done is HW specific on the target; however, upon
return, the image is loaded in the target’s memory, or flashed
into some flash ROM or into a hardrive.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>images</strong> – list of images to upload; each item is a
string in the format TYPE:PATHTOIMAGE, where TYPE is the
kind of image to flash (target specific, but such “room”,
“fw”, “kernel”, etc…)</li>
<li><strong>wait</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – see <a class="reference internal" href="#tcfl.target_ext_images.images.wait" title="tcfl.target_ext_images.images.wait"><code class="xref py py-attr docutils literal"><span class="pre">wait</span></code></a></li>
<li><strong>retries</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – see <a class="reference internal" href="#tcfl.target_ext_images.images.retries" title="tcfl.target_ext_images.images.retries"><code class="xref py py-attr docutils literal"><span class="pre">retries</span></code></a></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_images.images.get_types">
<code class="descname">get_types</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_images.images.get_types" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-tcfl.target_ext_power"></span><dl class="class">
<dt id="tcfl.target_ext_power.power">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_power.</code><code class="descname">power</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.power" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> to run methods form the power
control to TTBD targets.</p>
<p>Use as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="tcfl.target_ext_power.power.on">
<code class="descname">on</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.power.on" title="Permalink to this definition">¶</a></dt>
<dd><p>Power on a target</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_power.power.get">
<code class="descname">get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.power.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a target’s power status, <em>True</em> if powered, <em>False</em> otherwise.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_power.power.off">
<code class="descname">off</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.power.off" title="Permalink to this definition">¶</a></dt>
<dd><p>Power off a target</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_power.power.cycle">
<code class="descname">cycle</code><span class="sig-paren">(</span><em>wait=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.power.cycle" title="Permalink to this definition">¶</a></dt>
<dd><p>Power cycle a target</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_power.power.reset">
<code class="descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_power.power.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset a target</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-tcfl.target_ext_shell"></span><dl class="class">
<dt id="tcfl.target_ext_shell.shell">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_shell.</code><code class="descname">shell</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> for targets that support
some kind of shell (Linux, Windows) to run some common remote
commands without needing to worry about the details.</p>
<p>The target has to be set to boot into console prompt, so password
login has to be disabled.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">up</span><span class="p">()</span>
</pre></div>
</div>
<p>Waits for the shell to be up and ready; sets it up so that if an
error happens, it will print an error message and raise a block
exception.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;some command&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Remove remote files (if the target supports it) with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">file_remove</span><span class="p">(</span><span class="s2">&quot;/tmp/filename&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Copy files to the target with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">file_copy_to</span><span class="p">(</span><span class="s2">&quot;local_file&quot;</span><span class="p">,</span> <span class="s2">&quot;/tmp/remote_file&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="tcfl.target_ext_shell.shell.up">
<code class="descname">up</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell.up" title="Permalink to this definition">¶</a></dt>
<dd><p>Giving it ample time to boot, wait for a shell prompt and set
up the shell so that if an error happens, it will print an error
message and raise a block exception.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_shell.shell.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>cmd=None</em>, <em>expect=None</em>, <em>prompt_regex=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs <em>some command</em> as a shell command and wait for the shell
prompt to show up.</p>
<p>If it fails, it will raise an exception. If you want to get
the error code or not have it raise exceptions on failure, you
will have to play shell-specific games, such as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;failing-command || true&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Files can be easily generated in <em>unix</em> targets with commands
such as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">cat &gt; /etc/somefile &lt;&lt;EOF</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">these are the</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">file contents</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">that I want</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">EOF&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) command to run; if none, only the
expectations are waited for (if <em>expect</em> is not set, then
only the prompt is expected).</li>
<li><strong>expect</strong> – (optional) output to expect (string or
regex) before the shell prompt. This an also be a list of
things to expect (in the given order)</li>
<li><strong>prompt_regex</strong> – (optional) output to expect (string or
regex) as a shell prompt, which is always to be found at the
end. Defaults to the preconfigured shell prompt (NUMBER $).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_shell.shell.file_remove">
<code class="descname">file_remove</code><span class="sig-paren">(</span><em>remote_filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell.file_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a remote file (if the target supports it)</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_shell.shell.file_copy_to">
<code class="descname">file_copy_to</code><span class="sig-paren">(</span><em>local_filename</em>, <em>remote_filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_shell.shell.file_copy_to" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a file to the target via the console (if the target supports it)</p>
<p>Encodes the file to base64 and sends it via the console in chunks
of 64 bytes (some consoles are kinda…unreliable) to a file in
the target called /tmp/file.b64, which then we decode back to
normal.</p>
<p>Assumes the target has python3; permissions are not maintained</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">it is <em>slow</em>. The limits are not well defined; how
big a file can be sent/received will depend on local
and remote memory capacity, as things are read
hole. This could be optimized to stream instead of
just read all, but still sending a way big file over
a cheap ASCII protocol is not a good idea. Warned
you are.</p>
</div>
</dd></dl>

</dd></dl>

<span class="target" id="module-tcfl.target_ext_ssh"></span><dl class="class">
<dt id="tcfl.target_ext_ssh.ssh">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_ssh.</code><code class="descname">ssh</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> for targets that support
SSH to run remote commands via SSH or copy files around.</p>
<p>The target has to be set to accept password less login, either by:</p>
<ul class="simple">
<li>disabling password for the target user (<strong>DANGEROUS!!</strong> use only
on isolated targets)</li>
<li>storing SSH identities in SSH agents (FIXME: not implemented
yet) and provisioning the keys via cloud-init or similar</li>
</ul>
<p>Use as:</p>
<ol class="arabic">
<li><p class="first">As described in <a class="reference internal" href="#tcfl.target_ext_tunnel.tunnel" title="tcfl.target_ext_tunnel.tunnel"><code class="xref py py-class docutils literal"><span class="pre">IP</span> <span class="pre">tunnels</span></code></a>, upon which this extension
builds, this will only work with a target with IPv4/6
connectivity, which means there has to be an interconnect
powered on and reachable for the server.</p>
<p>As well, the target has to export the <em>ssh_client</em>
tag. <a class="reference internal" href="#conf_00_lib.tt_qemu_linux" title="conf_00_lib.tt_qemu_linux"><code class="xref py py-class docutils literal"><span class="pre">Linux</span></code></a> targets are
configured by default to accept root login over SSH and declare
<em>ssh_client</em>; e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">interconnect</span><span class="p">(</span><span class="s2">&quot;ipv4_addr&quot;</span><span class="p">)</span>
<span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;linux and ssh_client&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
</pre></div>
</div>
</li>
<li><p class="first">ensure the interconnect is powered on before powering on the
target; otherwise some targets won’t acquire an IP configuration
(as they will assume there is no interconnect); e.g.: on <em>start</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="n">ic</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
    <span class="n">target</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">cycle</span><span class="p">()</span>
    <span class="n">target</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">up</span><span class="p">()</span>          <span class="c1"># wait for target to power up</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="2">
<li><p class="first">indicate the tunneling system which IP address is to be
used:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="o">...</span> <span class="n">on</span> <span class="n">the</span> <span class="n">start</span><span class="p">()</span> <span class="n">function</span> <span class="o">...</span> <span class="p">]</span>
    <span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">ip_addr</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">addr_get</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="s2">&quot;ipv4&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Use SSH:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">exitcode</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;test -f file_that_should_exist&quot;</span><span class="p">)</span>
<span class="n">target</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="s2">&quot;test -f file_that_should_exist&quot;</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;cat some_file&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;what_im_looking_for&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
   <span class="n">do_something</span><span class="p">()</span>
<span class="n">target</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">copy_to</span><span class="p">(</span><span class="s2">&quot;somedir/local.file&quot;</span><span class="p">,</span> <span class="s2">&quot;remotedir&quot;</span><span class="p">)</span>
<span class="n">target</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="s2">&quot;someremotedir/file&quot;</span><span class="p">,</span> <span class="s2">&quot;localdir&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>FIXME: provide pointers to a private key to use</p>
<dl class="attribute">
<dt id="tcfl.target_ext_ssh.ssh.host">
<code class="descname">host</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.host" title="Permalink to this definition">¶</a></dt>
<dd><p>SSH destination host; this will be filled out automatically
with any IPv4 or IPv6 address the target declares, but can
be assigned to a new value if needed.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.target_ext_ssh.ssh.login">
<code class="descname">login</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.login" title="Permalink to this definition">¶</a></dt>
<dd><p>SSH login identity; default to root login, as otherwise it
would default to the login of the user running the daemon.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.target_ext_ssh.ssh.port">
<code class="descname">port</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.port" title="Permalink to this definition">¶</a></dt>
<dd><p>SSH port to use</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_ssh.ssh.call">
<code class="descname">call</code><span class="sig-paren">(</span><em>cmd</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.call" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a shell command over SSH, substituting any %(KEYWORD)[ds]
field from the target’s keywords in
<a class="reference internal" href="#tcfl.tc.target_c.kws" title="tcfl.tc.target_c.kws"><code class="xref py py-attr docutils literal"><span class="pre">tcfl.tc.target_c.kws</span></code></a></p>
<p>Similar to <a class="reference external" href="https://docs.python.org/2.7/library/subprocess.html#subprocess.call" title="(in Python v2.7)"><code class="xref py py-func docutils literal"><span class="pre">subprocess.call()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – shell command to execute via SSH</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">exitcode</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_ssh.ssh.check_call">
<code class="descname">check_call</code><span class="sig-paren">(</span><em>cmd</em>, <em>result_on_failure='error'</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.check_call" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a shell command over SSH, substituting any %(KEYWORD)[ds]
field from the target’s keywords in
<a class="reference internal" href="#tcfl.tc.target_c.kws" title="tcfl.tc.target_c.kws"><code class="xref py py-attr docutils literal"><span class="pre">tcfl.tc.target_c.kws</span></code></a></p>
<p>Similar to <a class="reference external" href="https://docs.python.org/2.7/library/subprocess.html#subprocess.check_call" title="(in Python v2.7)"><code class="xref py py-func docutils literal"><span class="pre">subprocess.check_call()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – shell command to execute via SSH</li>
<li><strong>result_on_failure</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) how shall a failure
considered to be (errr|fail|blck|skip).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">exitcode</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_ssh.ssh.check_output">
<code class="descname">check_output</code><span class="sig-paren">(</span><em>cmd</em>, <em>result_on_failure='error'</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.check_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a shell command over SSH, substituting any %(KEYWORD)[ds]
field from the target’s keywords in
<a class="reference internal" href="#tcfl.tc.target_c.kws" title="tcfl.tc.target_c.kws"><code class="xref py py-attr docutils literal"><span class="pre">tcfl.tc.target_c.kws</span></code></a></p>
<p>Similar to <a class="reference external" href="https://docs.python.org/2.7/library/subprocess.html#subprocess.check_output" title="(in Python v2.7)"><code class="xref py py-func docutils literal"><span class="pre">subprocess.check_output()</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – shell command to execute via SSH</li>
<li><strong>result_on_failure</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) how shall a failure
considered to be (errr|fail|blck|skip).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">exitcode</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_ssh.ssh.copy_to">
<code class="descname">copy_to</code><span class="sig-paren">(</span><em>src</em>, <em>dst=''</em>, <em>recursive=False</em>, <em>result_on_failure='error'</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.copy_to" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy a file or tree with <em>SCP</em> to the target from the client</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>src</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – local file or directory to copy</li>
<li><strong>dst</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) destination file or directoy
(defaults to root’s home directory)</li>
<li><strong>recursive</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) copy recursively (needed for
directories)</li>
<li><strong>result_on_failure</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) how shall a failure
considered to be (errr|fail|blck|skip).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_ssh.ssh.copy_from">
<code class="descname">copy_from</code><span class="sig-paren">(</span><em>src</em>, <em>dst='.'</em>, <em>recursive=False</em>, <em>result_on_failure='error'</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_ssh.ssh.copy_from" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy a file or tree with <em>SCP</em> from the target to the client</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>src</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – remote file or directory to copy</li>
<li><strong>dst</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) destination file or directory
(defaults to current working directory)</li>
<li><strong>recursive</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) copy recursively (needed for
directories)</li>
<li><strong>result_on_failure</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) how shall a failure
considered to be (errr|fail|blck|skip).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-tcfl.target_ext_tags"></span><dl class="class">
<dt id="tcfl.target_ext_tags.patch_tags">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_tags.</code><code class="descname">patch_tags</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tags.patch_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> to patch different tags in older
servers that are not properly configured.</p>
</dd></dl>

<span class="target" id="module-tcfl.target_ext_tcob"></span><dl class="class">
<dt id="tcfl.target_ext_tcob.tcob">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_tcob.</code><code class="descname">tcob</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tcob.tcob" title="Permalink to this definition">¶</a></dt>
<dd><p>TCOB interface extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> using
<a class="reference internal" href="#module-commonl.tcob" title="commonl.tcob"><code class="xref py py-mod docutils literal"><span class="pre">commonl.tcob</span></code></a>.</p>
<p>To use, access as, eg:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">tcob</span><span class="o">.</span><span class="n">port</span><span class="p">(</span><span class="s2">&quot;PORTNAME&#39;)</span>
</pre></div>
</div>
<dl class="method">
<dt id="tcfl.target_ext_tcob.tcob.port">
<code class="descname">port</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tcob.tcob.port" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-tcfl.target_ext_tunnel"></span><dl class="class">
<dt id="tcfl.target_ext_tunnel.tunnel">
<em class="property">class </em><code class="descclassname">tcfl.target_ext_tunnel.</code><code class="descname">tunnel</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.tunnel" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> to create IP tunnels to
targets with IP connectivity.</p>
<p>Use by indicating a default IP address to use for interconnect
<em>ic</em> or explicitly indicating it in the <a class="reference internal" href="#tcfl.target_ext_tunnel.tunnel.add" title="tcfl.target_ext_tunnel.tunnel.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">ip_addr</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">addr_get</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="s2">&quot;ipv4&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">tunnel</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that for tunnels to work, the target has to be acquired and
IP has to be up on it, which might requires it to be connected to
some IP network (it can be a TCF interconnect or any other
network).</p>
<dl class="method">
<dt id="tcfl.target_ext_tunnel.tunnel.add">
<code class="descname">add</code><span class="sig-paren">(</span><em>port</em>, <em>ip_addr=None</em>, <em>proto=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.tunnel.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup a TCP/UDP/SCTP v4 or v5 tunnel to the target</p>
<p>A local port of the given protocol in the server is fowarded
to the target’s port. Teardown with <a class="reference internal" href="#tcfl.target_ext_tunnel.tunnel.remove" title="tcfl.target_ext_tunnel.tunnel.remove"><code class="xref py py-meth docutils literal"><span class="pre">remove()</span></code></a>.</p>
<p>If the tunnel already exists, it is not recreated, but the
port it uses is returned.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – port to redirect to</li>
<li><strong>ip_addr</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) target’s IP address to use (it
must be listed on the targets’s tags <em>ipv4_address</em> or
<em>ipv6_address</em>).</li>
<li><strong>proto</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) Protocol to tunnel:
{udp,sctp,tcp}[{4,6}] (defaults to v4 and to TCP)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Returns int local_port:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first last">port in the server where to connect
to in order to access the target.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_tunnel.tunnel.remove">
<code class="descname">remove</code><span class="sig-paren">(</span><em>port</em>, <em>ip_addr=None</em>, <em>proto=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.tunnel.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Teardown a TCP/UDP/SCTP v4 or v5 tunnel to the target
previously created with <a class="reference internal" href="#tcfl.target_ext_tunnel.tunnel.add" title="tcfl.target_ext_tunnel.tunnel.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – port to redirect to</li>
<li><strong>ip_addr</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) target’s IP address to use (it
must be listed on the targets’s tags <em>ipv4_address</em> or
<em>ipv6_address</em>).</li>
<li><strong>proto</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) Protocol to tunnel:
{udp,sctp,tcp}[{4,6}] (defaults to v4 and to TCP)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.target_ext_tunnel.tunnel.list">
<code class="descname">list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.tunnel.list" title="Permalink to this definition">¶</a></dt>
<dd><p>List existing IP tunnels</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of tuples (protocol, target-ip-address, port,
port-in-server)</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.target_ext_tunnel.cmdline_tunnel_add">
<code class="descclassname">tcfl.target_ext_tunnel.</code><code class="descname">cmdline_tunnel_add</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.cmdline_tunnel_add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.target_ext_tunnel.cmdline_tunnel_remove">
<code class="descclassname">tcfl.target_ext_tunnel.</code><code class="descname">cmdline_tunnel_remove</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.cmdline_tunnel_remove" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.target_ext_tunnel.cmdline_tunnel_list">
<code class="descclassname">tcfl.target_ext_tunnel.</code><code class="descname">cmdline_tunnel_list</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.cmdline_tunnel_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.target_ext_tunnel.cmdline_setup">
<code class="descclassname">tcfl.target_ext_tunnel.</code><code class="descname">cmdline_setup</code><span class="sig-paren">(</span><em>argsp</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.target_ext_tunnel.cmdline_setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-tcfl.app">
<span id="tcf-run-application-builders"></span><h3>8.1.4. <em>TCF run</em> Application builders<a class="headerlink" href="#module-tcfl.app" title="Permalink to this headline">¶</a></h3>
<p>Application builder are a generic tool for building applications of
different types.</p>
<p>They all use the same interface to make it easy and fast for the test
case writer to specify what has to be built for which BSP of which
target with a very simple specification given to the
<a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target()</span></code></a> decorator:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="n">app_zephyr</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="s2">&quot;path/to/zephyr_app&quot;</span> <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>               <span class="n">app_sketch</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;arc&#39;</span><span class="p">:</span> <span class="s2">&quot;path/to/sketch&quot;</span> <span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">mytestcase</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
</pre></div>
</div>
<p>which allows the testcase developer to point the app builders to the
locations of the source code and on which BSPs of the targets it shall
run and have it deal with the details of inserting the right code to
build, deploy, setup and start the testcase.</p>
<p>This allows the testcase writer to focus on writing the test
application.</p>
<p>App builders:</p>
<ul class="simple">
<li>can be made once and reused multiple times</li>
<li>they are plugins to the testcase system</li>
<li>keep no state; they need to be able to gather everything
from the parameters passed (this is needed so they can be called from
multiple threads).</li>
<li>are always called <em>app_SOMETHING</em></li>
</ul>
<p>Note implementation details on <a class="reference internal" href="#tcfl.app.app_c" title="tcfl.app.app_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.app.app_c</span></code></a>; drivers can
be added with <a class="reference internal" href="#tcfl.app.driver_add" title="tcfl.app.driver_add"><code class="xref py py-func docutils literal"><span class="pre">tcfl.app.driver_add()</span></code></a>.</p>
<p>Currently available application buildrs for:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#tcfl.app_zephyr.app_zephyr" title="tcfl.app_zephyr.app_zephyr"><code class="xref py py-class docutils literal"><span class="pre">Zephyr</span> <span class="pre">OS</span> <span class="pre">apps</span></code></a></li>
<li><a class="reference internal" href="#tcfl.app_sketch.app_sketch" title="tcfl.app_sketch.app_sketch"><code class="xref py py-class docutils literal"><span class="pre">Arduino</span> <span class="pre">Sketches</span></code></a></li>
</ul>
</div></blockquote>
<dl class="function">
<dt id="tcfl.app.import_mp_pathos">
<code class="descclassname">tcfl.app.</code><code class="descname">import_mp_pathos</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.import_mp_pathos" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.import_mp_std">
<code class="descclassname">tcfl.app.</code><code class="descname">import_mp_std</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.import_mp_std" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.args_app_src_check">
<code class="descclassname">tcfl.app.</code><code class="descname">args_app_src_check</code><span class="sig-paren">(</span><em>app_name</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.args_app_src_check" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify the source specification for a given App Driver</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.app.driver_add">
<code class="descclassname">tcfl.app.</code><code class="descname">driver_add</code><span class="sig-paren">(</span><em>cls</em>, <em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.driver_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new driver for app building</p>
<p>Note the driver will be called as the class name; it is
recommended to call then <em>app_something</em>.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.app.driver_valid">
<code class="descclassname">tcfl.app.</code><code class="descname">driver_valid</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.driver_valid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.get_real_srcdir">
<code class="descclassname">tcfl.app.</code><code class="descname">get_real_srcdir</code><span class="sig-paren">(</span><em>origin_filename</em>, <em>_srcdir</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.get_real_srcdir" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the absolute version of _srcdir, which might be relative
which the file described by origin_file.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.app.configure">
<code class="descclassname">tcfl.app.</code><code class="descname">configure</code><span class="sig-paren">(</span><em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.configure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.build">
<code class="descclassname">tcfl.app.</code><code class="descname">build</code><span class="sig-paren">(</span><em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.build" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.deploy">
<code class="descclassname">tcfl.app.</code><code class="descname">deploy</code><span class="sig-paren">(</span><em>images</em>, <em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.deploy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.setup">
<code class="descclassname">tcfl.app.</code><code class="descname">setup</code><span class="sig-paren">(</span><em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.start">
<code class="descclassname">tcfl.app.</code><code class="descname">start</code><span class="sig-paren">(</span><em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.teardown">
<code class="descclassname">tcfl.app.</code><code class="descname">teardown</code><span class="sig-paren">(</span><em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.teardown" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.app.clean">
<code class="descclassname">tcfl.app.</code><code class="descname">clean</code><span class="sig-paren">(</span><em>ab</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="tcfl.app.app_c">
<em class="property">class </em><code class="descclassname">tcfl.app.</code><code class="descname">app_c</code><a class="headerlink" href="#tcfl.app.app_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Subclass this to create an App builder, provide implementations
only of what is needed.</p>
<p>The driver will be invoked by the test runner using the methods
<a class="reference internal" href="#tcfl.app.configure" title="tcfl.app.configure"><code class="xref py py-func docutils literal"><span class="pre">tcfl.app.configure()</span></code></a>, <a class="reference internal" href="#tcfl.app.build" title="tcfl.app.build"><code class="xref py py-func docutils literal"><span class="pre">tcfl.app.build()</span></code></a>,
<a class="reference internal" href="#tcfl.app.deploy" title="tcfl.app.deploy"><code class="xref py py-func docutils literal"><span class="pre">tcfl.app.deploy()</span></code></a>, <a class="reference internal" href="#tcfl.app.setup" title="tcfl.app.setup"><code class="xref py py-func docutils literal"><span class="pre">tcfl.app.setup()</span></code></a>,
<a class="reference internal" href="#tcfl.app.start" title="tcfl.app.start"><code class="xref py py-func docutils literal"><span class="pre">tcfl.app.start()</span></code></a>, <a class="reference internal" href="#tcfl.app.teardown" title="tcfl.app.teardown"><code class="xref py py-func docutils literal"><span class="pre">tcfl.app.teardown()</span></code></a>,
<a class="reference internal" href="#tcfl.app.clean" title="tcfl.app.clean"><code class="xref py py-func docutils literal"><span class="pre">tcfl.app.clean()</span></code></a>.</p>
<p>If your App builder does not need to implement any, then it is
enough with not specifying it in the class.</p>
<p><strong>Targets with multiple BSPs</strong></p>
<p>When the target contains multiple BSPs the App builders are
invoked for each BSP in the same order as they were declared with
the decorator <a class="reference internal" href="#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target()</span></code></a>. E.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="n">app_zephyr</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;arc&#39;</span><span class="p">:</span> <span class="s1">&#39;path/to/zephyr_code&#39;</span> <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="n">app_sketch</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="s1">&#39;path/to/arduino_code&#39;</span> <span class="p">})</span>
</pre></div>
</div>
<p>We are specifying that the <em>x86</em> BSP in the target has to run code
to be built with the Arduino IDE/compiler and the <em>arc</em> core will
run a Zephyr app, built with the Zephyr SDK.</p>
<p>If the target is being ran in a BSP model where one or more of the
BSPs are not used, the App builders are responsible for providing
stub information with <a class="reference internal" href="#tcfl.tc.target_c.stub_app_add" title="tcfl.tc.target_c.stub_app_add"><code class="xref py py-meth docutils literal"><span class="pre">tcfl.tc.target_c.stub_app_add()</span></code></a>. As
well, if an app builder determines a BSP does not need to be
stubbed, it can also remove it from the target’s list with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">target</span><span class="o">.</span><span class="n">bsps_stub</span><span class="p">[</span><span class="n">BSPNAME</span><span class="p">]</span>
</pre></div>
</div>
<p>Note this removal is done at the specific target level, as each
target might have different models or needs.</p>
<p>Note you can use the dictionary <a class="reference internal" href="#tcfl.tc.tc_c.buffers" title="tcfl.tc.tc_c.buffers"><code class="xref py py-meth docutils literal"><span class="pre">tcfl.tc.tc_c.buffers()</span></code></a> to
store data to communicate amongst phases. This dictionary:</p>
<ul class="simple">
<li>will be cleaned in between evaluation runs</li>
<li>is not multi-threaded protected; take
<a class="reference internal" href="#tcfl.tc.tc_c.buffers_lock" title="tcfl.tc.tc_c.buffers_lock"><code class="xref py py-meth docutils literal"><span class="pre">tcfl.tc.tc_c.buffers_lock()</span></code></a> if you need to access it
from different paralell execution methods
(setup/start/eval/test/teardown methods are <em>always</em> executed
serially).</li>
<li>take care not to <em>start</em> more than once; app builders are setup
to start a target only if there is not a field
<em>started-TARGETNAME</em> set to <em>True</em>.</li>
</ul>
<dl class="staticmethod">
<dt id="tcfl.app.app_c.configure">
<em class="property">static </em><code class="descname">configure</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.configure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app.app_c.build">
<em class="property">static </em><code class="descname">build</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.build" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app.app_c.deploy">
<em class="property">static </em><code class="descname">deploy</code><span class="sig-paren">(</span><em>images</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.deploy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app.app_c.setup">
<em class="property">static </em><code class="descname">setup</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app.app_c.start">
<em class="property">static </em><code class="descname">start</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app.app_c.teardown">
<em class="property">static </em><code class="descname">teardown</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.teardown" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app.app_c.clean">
<em class="property">static </em><code class="descname">clean</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.app_c.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.app.make_j_guess">
<code class="descclassname">tcfl.app.</code><code class="descname">make_j_guess</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app.make_j_guess" title="Permalink to this definition">¶</a></dt>
<dd><p>How much paralellism?</p>
<p>In theoryt there is a make job server that can help throtle this,
but in practice this also influences how much virtual the build of a
bunch of TCs can do so…</p>
<p>So depending on how many jobs are already queued, decide how much
-j we want to give to make.</p>
</dd></dl>

<span class="target" id="module-tcfl.app_zephyr"></span><dl class="data">
<dt id="tcfl.app_zephyr.boot_delay">
<code class="descclassname">tcfl.app_zephyr.</code><code class="descname">boot_delay</code><em class="property"> = {}</em><a class="headerlink" href="#tcfl.app_zephyr.boot_delay" title="Permalink to this definition">¶</a></dt>
<dd><p>for each target type, an integer on how long we shall wait to
boot Zephyr</p>
</dd></dl>

<dl class="class">
<dt id="tcfl.app_zephyr.app_zephyr">
<em class="property">class </em><code class="descclassname">tcfl.app_zephyr.</code><code class="descname">app_zephyr</code><a class="headerlink" href="#tcfl.app_zephyr.app_zephyr" title="Permalink to this definition">¶</a></dt>
<dd><p>Support for configuring, building, deploying and evaluating a Zephyr-OS
application.</p>
<p>To setup:</p>
<blockquote>
<div><ul>
<li><p class="first">a toolchain capable of building Zephyr has to be installed in
the system and the corresponding environment variables
exported, such as:</p>
<ul class="simple">
<li><cite>ZEPHYR_SDK_INSTALL_DIR</cite> for the Zephyr SDK</li>
<li><cite>ISSM_INSTALLATION_PATH</cite> for the Intel ISSM toolchain</li>
<li><cite>ESPRESSIF_TOOLCHAIN_PATH</cite> for the Espress toolchain</li>
<li><cite>XTENSA_SDK</cite> for the Xtensa SDK</li>
</ul>
</li>
<li><p class="first">environment variables set:</p>
<ul class="simple">
<li><cite>ZEPHYR_TOOLCHAIN_VARIANT</cite> (<cite>ZEPHYR_GCC_VARIANT</cite> before
v1.11) pointing to the toolchain to use (<em>zephyr</em>, <em>issm</em>,
<em>espressif</em>, <em>xcc</em>, etc…)</li>
<li><cite>ZEPHYR_BASE</cite> pointing to the path where the Zephyr tree is located</li>
</ul>
<p>note these variables can be put in a <a class="reference internal" href="02-guides.html#tcf-configure-zephyr"><span class="std std-ref">TCF configuration
file</span></a> or they can also be specified as
options to <em>app_zephyr</em> (see below).</p>
</li>
</ul>
</div></blockquote>
<p>Usage:</p>
<ul>
<li><p class="first">Declare in a target <em>app_zephyr</em> and point to the source tree
and optionally, provide extra arguments to add to the Makefile
invocation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;zephyr_board&quot;</span><span class="p">,</span>
                <span class="n">app_zephyr</span> <span class="o">=</span> <span class="s1">&#39;path/to/app/source&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>If extra makefile arguments are needed, a tuple that starts with
the path and contains multiple strings can be used:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;zephyr_board&quot;</span><span class="p">,</span>
                <span class="n">app_zephyr</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;path/to/app/source&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ZEPHYR_TOOLCHAIN_VARIANT=zephyr&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ZEPHYR_BASE=some/path&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;OTHEREXTRAARGSTOZEPHYRMAKE&#39;</span><span class="p">))</span>
<span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>to build multiple BSPs of the same target:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;type == &#39;arduino101&#39;&quot;</span><span class="p">,</span>
                <span class="n">app_zephyr</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="s1">&#39;path/to/app/source/for/x86&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;ZEPHYR_TOOLCHAIN_VARIANT=zephyr&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;ZEPHYR_BASE=some/path&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;OTHEREXTRAARGSTOZEPHYRMAKE&#39;</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;arc&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="s1">&#39;path/to/app/source/for/arc&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;ZEPHYR_TOOLCHAIN_VARIANT=zephyr&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;ZEPHYR_BASE=some/path&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;OTHEREXTRAARGSTOZEPHYRMAKE&#39;</span>
                    <span class="p">)</span>
                <span class="p">})</span>
<span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>furthermore, common options can be specified in
<em>app_zephyr_options</em> (note this is just a string versus a
tuple), so the previous example can be simplified as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s2">&quot;type == &#39;arduino101&#39;&quot;</span><span class="p">,</span>
                <span class="n">app_zephyr</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="s1">&#39;path/to/app/source/for/x86&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;OTHER-X86-EXTRAS&#39;</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;arc&#39;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="s1">&#39;path/to/app/source/for/arc&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;OTHER-ARC-EXTRAS&#39;</span>
                    <span class="p">)</span>
                <span class="p">},</span>
                <span class="n">app_zephyr_options</span> <span class="o">=</span> \
                  <span class="s1">&#39;ZEPHYR_TOOLCHAIN_VARIANT=zephyr&#39;</span> \
                  <span class="s1">&#39;ZEPHYR_BASE=some/path&#39;</span> \
                  <span class="s1">&#39;OTHER-COMMON-EXTRAS&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
</ul>
<p>The test creator can set the attributes (in the test class or in
the target object):</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">zephyr_filter</span></code></li>
<li><code class="docutils literal"><span class="pre">zephyr_filter_origin</span></code> (optional)</li>
</ul>
<p>to indicate a Zephyr Sanity Check style filter to apply before
building, to be able to skip a test case if a logical expression
on the Zephyr build configuration is not satisfied. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@tcfl.tc.target</span><span class="p">(</span><span class="s2">&quot;zephyr_board&quot;</span><span class="p">,</span> <span class="n">app_zephyr</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">my_test</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
    <span class="n">zephyr_filter</span> <span class="o">=</span> <span class="s2">&quot;CONFIG_VALUE_X == 2000 and CONFIG_SOMETHING != &#39;foo&#39;&quot;</span>
    <span class="n">zephyr_filter_origin</span> <span class="o">=</span> <span class="vm">__file__</span>
</pre></div>
</div>
<dl class="staticmethod">
<dt id="tcfl.app_zephyr.app_zephyr.configure">
<em class="property">static </em><code class="descname">configure</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.app_zephyr.configure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_zephyr.app_zephyr.build">
<em class="property">static </em><code class="descname">build</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.app_zephyr.build" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a Zephyr App whichever active BSP is active on a target</p>
</dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_zephyr.app_zephyr.deploy">
<em class="property">static </em><code class="descname">deploy</code><span class="sig-paren">(</span><em>images</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.app_zephyr.deploy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_zephyr.app_zephyr.setup">
<em class="property">static </em><code class="descname">setup</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.app_zephyr.setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_zephyr.app_zephyr.clean">
<em class="property">static </em><code class="descname">clean</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.app_zephyr.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.app_zephyr.zephyr">
<em class="property">class </em><code class="descclassname">tcfl.app_zephyr.</code><code class="descname">zephyr</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.zephyr" title="Permalink to this definition">¶</a></dt>
<dd><p>Extension to <a class="reference internal" href="#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.target_c</span></code></a> to add Zephyr specific
APIs; this extension is activated <em>only</em> if any BSP in the target
is to be loaded with Zephyr.</p>
<dl class="staticmethod">
<dt id="tcfl.app_zephyr.zephyr.sdk_keys">
<em class="property">static </em><code class="descname">sdk_keys</code><span class="sig-paren">(</span><em>arch</em>, <em>variant</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.zephyr.sdk_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Figure out the architecture, calling convention and SDK
prefixes for this target’s current BSP.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.app_zephyr.zephyr.config_file_read">
<code class="descname">config_file_read</code><span class="sig-paren">(</span><em>name=None</em>, <em>bsp=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.zephyr.config_file_read" title="Permalink to this definition">¶</a></dt>
<dd><p>Open a config file and return its values as a dictionary</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the configuration file,
default to <em>%(zephyr_objdir)s/.config</em>.</li>
<li><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) BSP on which to operate; when the
target is configured for a <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a> which contains
multiple Zephyr BSPs, you will need to specify which one to
modify.</p>
<p>This parameter can be omitted if only one BSP is available
in the current BSP Model.</p>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">dictionary keyed by CONFIG_ name with its value.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.app_zephyr.zephyr.config_file_write">
<code class="descname">config_file_write</code><span class="sig-paren">(</span><em>name</em>, <em>data</em>, <em>bsp=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.zephyr.config_file_write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write an extra config file called <em>NAME</em>.conf in the Zephyr’s
App build directory.</p>
<p>Note this takes care to only write it if the data is new or
the file is unexistant, to avoid unnecesary rebuilds.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Name for the configuration file; this has to
be a valid filename; <em>.conf</em> will be added by the function.</li>
<li><strong>data</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>Data to include in the configuration file;
this is (currently) valid kconfig data, which are lines of
text with # acting as comment character; for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CONFIG_UART_CONSOLE_ON_DEV_NAME</span><span class="o">=</span><span class="s2">&quot;UART_1&quot;</span>
</pre></div>
</div>
</li>
<li><strong>bsp</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) BSP on which to operate; when the
target is configured for a <a class="reference internal" href="glossary.html#term-bsp-model"><span class="xref std std-term">BSP model</span></a> which contains
multiple Zephyr BSPs, you will need to specify which one to
modify.</p>
<p>This parameter can be omitted if only one BSP is available
in the current BSP Model.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">something</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target</span><span class="o">.</span><span class="n">zephyr</span><span class="o">.</span><span class="n">conf_file_write</span><span class="p">(</span><span class="s2">&quot;mytweaks&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                  <span class="s1">&#39;CONFIG_SOMEVAR=1</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="gp">&gt;&gt;&gt; </span>                                  <span class="s1">&#39;CONFIG_ANOTHER=&quot;VALUE&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tcfl.app_zephyr.zephyr.check_filter">
<code class="descname">check_filter</code><span class="sig-paren">(</span><em>_objdir</em>, <em>arch</em>, <em>board</em>, <em>_filter</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_zephyr.zephyr.check_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>This is going to be called by the App Builder’s build function
to evaluate if we need to filter out a build of a testcase. In
any other case, it will be ignored.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>objdir</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the Zephyr’s object directory
where to find configuration files</li>
<li><strong>arch</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the architecture we are building</li>
<li><strong>board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Zephyr’s board we are building</li>
<li><strong>_filter</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Zephyr’s sanity Check style filter
expression</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – where does this come from?</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-tcfl.app_sketch"></span><dl class="class">
<dt id="tcfl.app_sketch.app_sketch">
<em class="property">class </em><code class="descclassname">tcfl.app_sketch.</code><code class="descname">app_sketch</code><a class="headerlink" href="#tcfl.app_sketch.app_sketch" title="Permalink to this definition">¶</a></dt>
<dd><p>Driver to build Arduino Sketch applications for flashing into
MCU’s BSPs.</p>
<p>Note the <a class="reference internal" href="02-guides.html#tcf-configure-sketch"><span class="std std-ref">setup instructions</span></a>.</p>
<dl class="staticmethod">
<dt id="tcfl.app_sketch.app_sketch.configure">
<em class="property">static </em><code class="descname">configure</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_sketch.app_sketch.configure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_sketch.app_sketch.build">
<em class="property">static </em><code class="descname">build</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_sketch.app_sketch.build" title="Permalink to this definition">¶</a></dt>
<dd><p>Build an Sketh App whichever active BSP is active on a target</p>
</dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_sketch.app_sketch.deploy">
<em class="property">static </em><code class="descname">deploy</code><span class="sig-paren">(</span><em>images</em>, <em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_sketch.app_sketch.deploy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.app_sketch.app_sketch.clean">
<em class="property">static </em><code class="descname">clean</code><span class="sig-paren">(</span><em>testcase</em>, <em>target</em>, <em>app_src</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.app_sketch.app_sketch.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-tcfl.app_manual"></span><dl class="class">
<dt id="tcfl.app_manual.app_manual">
<em class="property">class </em><code class="descclassname">tcfl.app_manual.</code><code class="descname">app_manual</code><a class="headerlink" href="#tcfl.app_manual.app_manual" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an App Builder that tells the system the testcase will
provide instructions to configure/build/deploy/eval/clean in the
testcase methods.</p>
<p>It is used when we are combining App Builders to build for some
BSPs with manual methods. Note it can also be used to manually
adding stubbing information with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">bsp_stub</span> <span class="ow">in</span> <span class="s1">&#39;BSP1&#39;</span><span class="p">,</span> <span class="s1">&#39;BSP2&#39;</span><span class="p">,</span> <span class="s1">&#39;BSP3&#39;</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">target</span><span class="o">.</span><span class="n">stub_app_add</span><span class="p">(</span><span class="n">bsp_stub</span><span class="p">,</span> <span class="n">app_manual</span><span class="p">,</span> <span class="s2">&quot;nothing&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-tcfl.report">
<span id="tcf-run-report-drivers"></span><h3>8.1.5. <em>TCF run</em> report drivers<a class="headerlink" href="#module-tcfl.report" title="Permalink to this headline">¶</a></h3>
<div class="section" id="report-infrastructure">
<h4>8.1.5.1. Report infrastructure<a class="headerlink" href="#report-infrastructure" title="Permalink to this headline">¶</a></h4>
<p>Infrastructure for reporting test case results and progress in a modular way.</p>
<dl class="class">
<dt id="tcfl.report.report_c">
<em class="property">class </em><code class="descclassname">tcfl.report.</code><code class="descname">report_c</code><span class="sig-paren">(</span><em>verbosity=1</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.report.report_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Report driver to write to stdout (for human consumption) and to a
log file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>verbosity</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) maximum verbosity to report;
defaults to 1, for failures only</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="tcfl.report.report_c.verbosity_set">
<code class="descname">verbosity_set</code><span class="sig-paren">(</span><em>verbosity</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.report.report_c.verbosity_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.report.report_c.driver_add">
<em class="property">classmethod </em><code class="descname">driver_add</code><span class="sig-paren">(</span><em>obj</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.report.report_c.driver_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a driver to handle other report mechanisms</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.report.report_c.driver_rm">
<em class="property">classmethod </em><code class="descname">driver_rm</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.report.report_c.driver_rm" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a driver to handle other report mechanisms</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.report.report_c.report">
<em class="property">classmethod </em><code class="descname">report</code><span class="sig-paren">(</span><em>level</em>, <em>alevel</em>, <em>ulevel</em>, <em>_tc</em>, <em>tag</em>, <em>message</em>, <em>attachments</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.report.report_c.report" title="Permalink to this definition">¶</a></dt>
<dd><p>Low level reporting</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>level</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – report level for the main, one liner
message; note report levels greater or equal to 1000 are
using to pass control messages, so they might not be subject
to normal verbosity control (for example, for a log file you
might want to always include them).</li>
<li><strong>alevel</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – report level for the attachments, or extra messages</li>
<li><strong>ulevel</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – report level for unabridged attachments</li>
<li><strong>obj</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – string identifying the reporting object</li>
<li><strong>prefix</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – prefix for the message</li>
<li><strong>tag</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – tag for this message (PASS, ERRR, FAIL, BLCK, INFO),
all same length</li>
<li><strong>message</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – message string</li>
<li><strong>dict</strong> – dictionary of attachments; either an open file,
to report the contents of the file or list of strings or
strings or whatever</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>When a testcase completes execution, it will issue a report
with a message <strong>COMPLETION &lt;result&gt;</strong> (where result is
<em>passed</em>, <em>error</em>, <em>failed</em>, <em>blocked</em> or <em>skipped</em>) and a very high
verbosity level which is meant for the driver do to any
synchronization tasks it might need to do (eg: uploading the
data to a database).</p>
<p>Likewise, when all the testcases are run, the global testcase
reporter will use a <strong>COMPLETION &lt;result&gt;</strong> report. The global
testcase reporter can be identified because it has an
attribute <em>skip_reports</em> set to <em>True</em> and thus can be
identified with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_tc</span><span class="p">,</span> <span class="s2">&quot;skip_reports&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">do_somethin_for_the_global_reporter</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.report.report_console_c">
<em class="property">class </em><code class="descclassname">tcfl.report.</code><code class="descname">report_console_c</code><span class="sig-paren">(</span><em>verbosity</em>, <em>log_dir</em>, <em>log_file=None</em>, <em>verbosity_logf=999</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.report.report_console_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Report driver to write to stdout (for human consumption) and to a
log file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>verbosity_logf</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) maximum verbosity to report
to the logfile; defaults to all of them, but on some cases you
might want to limit to cut on disk consumption.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="tcfl.report.file_c">
<em class="property">class </em><code class="descclassname">tcfl.report.</code><code class="descname">file_c</code><span class="sig-paren">(</span><em>log_dir</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.report.file_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Report driver to write a text file with information about a
testcase failure</p>
<p>This driver is always enabled by default to generate text
reports. You can flip the configuration to enable JUnit reports
with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">file_c</span><span class="o">.</span><span class="n">junit</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>in any TCF configuration file.</p>
<p>This driver will log messages to separate log files based on their
<a class="reference internal" href="#tcfl.msgid_c" title="tcfl.msgid_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.msgid_c</span></code></a> code (which is unique to each testcase
running separately on a thread). When it detects a “COMPLETION”
message (a top level conclussion), it will generate a report using
the data gathered in the log file to a formatted file (text or
JUnit) and remove the log file.</p>
<p>This will generate <code class="docutils literal"><span class="pre">report-ID.txt</span></code> files for each
error/failure/skip/blockage or a <code class="docutils literal"><span class="pre">junit.xml</span></code> file with information
from all the testcases executed based on the configuration
settings below.</p>
<dl class="attribute">
<dt id="tcfl.report.file_c.helpurl">
<code class="descname">helpurl</code><em class="property"> = 'http://HELP-URL-NOT-CONFIGURED'</em><a class="headerlink" href="#tcfl.report.file_c.helpurl" title="Permalink to this definition">¶</a></dt>
<dd><p>(str) URL to where to obtain more help</p>
<p>Note you can use any <em>%(FIELD)TYPE</em> Python codes to replace
values from the testcase dictionary.</p>
<p>For available values, run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf run /usr/share/tcf/examples/test_dump_kws.py
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.report_header">
<code class="descname">report_header</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.report.file_c.report_header" title="Permalink to this definition">¶</a></dt>
<dd><p>(str) Text to be inserted at the beginning of the
error/failure/skip/blockage report, after the summary.</p>
<p>Note you can use any <em>%(FIELD)TYPE</em> Python codes to replace
values from the testcase dictionary. See <a class="reference internal" href="#tcfl.report.file_c.helpurl" title="tcfl.report.file_c.helpurl"><code class="xref py py-data docutils literal"><span class="pre">helpurl</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.reproduction">
<code class="descname">reproduction</code><em class="property"> = '\nReproduce it [*]:\n\n  tcf run -vvv{{ t_option }} -s \'name:&quot;.*{{ tc_name }}$&quot;\' {{ thisfile }}\n\nFind more information about targets:\n\n  tcf list -vv TARGETNAME1 TARGETNAME2 ...\n\nAcquire them for exclusive useoo\n\n  tcf acquire TARGETNAME1 TARGETNAME2 ...\n\n(note the daemon will relinquish them after 5min of inactivity)\n\nStart debugging with\n\n  tcf debug-start TARGETNAME\n  tcf debug-info TARGETNAME\n\nPower on\n\n  tcf power-on TARGETNAME1 TARGETNAME2 ...\n\nReset with\n\n  tcf reset TARGETNAME1 TARGETNAME2 ...\n\nRead the console with\n\n  tcf console-read -a TARGETNAME\n\nRelease when done\n\n  tcf release TARGETNAME1 TARGETNAME2 ...\n\n[*] Make sure your TCF configuration in ~/.tcf is set to access the servers\n    used in this run:\n\n{% for server_url, ssl_ignore, server_aka, ca_path in tcfl_config_urls %}\n     tcfl.config.url_add(&quot;{{ server_url }}&quot;, ssl_ignore = {{ ssl_ignore }}{{ \', aka = &quot;\' + server_aka + \'&quot;\' if server_aka }}{{ \', ca_path = &quot;\' + ca_path + \'&quot;\' if ca_path }}){% endfor %}\n\n\nHow do I install TCF?\n=====================\nGo to {{ helpurl }}\n\n(You can configure this text by setting the parameter\n tcfl.report.reproduction to a Jinja2 template)\n'</em><a class="headerlink" href="#tcfl.report.file_c.reproduction" title="Permalink to this definition">¶</a></dt>
<dd><p>(str) Text to be inserted as reproduction instructions (e.g.:
to checkout the code at the right versions and locations).</p>
<p>Note: This is a Jinja2 template in which you can use any <em>{{
FIELDNAME }}</em> Python codes to replace values from the testcase
dictionary and:</p>
<ul class="simple">
<li><em>{{ tcfl_config_urls }}</em> which maps to <code class="xref py py-data docutils literal"><span class="pre">tcfl.config.urls</span></code></li>
<li><em>{{ t_option }}</em> a value that indicates what has to be given to
<em>tcf</em> to select the targets where the testcase was run.</li>
</ul>
<p>See <a class="reference external" href="http://jinja.pocoo.org/docs/2.10/templates">http://jinja.pocoo.org/docs/2.10/templates</a>/# for more
information.</p>
<p>See <a class="reference internal" href="#tcfl.report.file_c.helpurl" title="tcfl.report.file_c.helpurl"><code class="xref py py-data docutils literal"><span class="pre">helpurl</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.junit_reproduction">
<code class="descname">junit_reproduction</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.report.file_c.junit_reproduction" title="Permalink to this definition">¶</a></dt>
<dd><p>(str) Overrides <a class="reference internal" href="#tcfl.report.file_c.reproduction" title="tcfl.report.file_c.reproduction"><code class="xref py py-data docutils literal"><span class="pre">reproduction</span></code></a> for JUnit reports</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.text_reproduction">
<code class="descname">text_reproduction</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.report.file_c.text_reproduction" title="Permalink to this definition">¶</a></dt>
<dd><p>(str) Overrides <a class="reference internal" href="#tcfl.report.file_c.reproduction" title="tcfl.report.file_c.reproduction"><code class="xref py py-data docutils literal"><span class="pre">reproduction</span></code></a> for text reports</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.junit">
<code class="descname">junit</code><em class="property"> = False</em><a class="headerlink" href="#tcfl.report.file_c.junit" title="Permalink to this definition">¶</a></dt>
<dd><p>(bool) produce Junit reports (default False) to <em>junit.xml</em></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.junit_domain">
<code class="descname">junit_domain</code><em class="property"> = 'default'</em><a class="headerlink" href="#tcfl.report.file_c.junit_domain" title="Permalink to this definition">¶</a></dt>
<dd><p>(str) Domain to which to output JUnit reports for this testcase</p>
<p>When completing the report on a testcase, it will be written to
a <cite>junit-DOMAIN.xml</cite> file in the current working directory,
where <em>DOMAIN</em> is extracted from this variable.</p>
<p>Note you can use any <em>%(FIELD)TYPE</em> Python codes to replace
values from the testcase dictionary. See <a class="reference internal" href="#tcfl.report.file_c.helpurl" title="tcfl.report.file_c.helpurl"><code class="xref py py-data docutils literal"><span class="pre">helpurl</span></code></a>. This
allows you to use something like <a class="reference internal" href="#tcfl.tc.tc_c.hook_pre" title="tcfl.tc.tc_c.hook_pre"><code class="xref py py-data docutils literal"><span class="pre">tcfl.tc.tc_c.hook_pre</span></code></a>
to scan testcases and assign them a keyword (see the example in
there) and then use the keyword to generate a domain:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="o">.</span><span class="n">hook_pre</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_my_hook_fn</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">file_c</span><span class="o">.</span><span class="n">junit_domain</span> <span class="o">=</span> <span class="s2">&quot;$(categories)s&quot;</span>
</pre></div>
</div>
<p>Following the example in <a class="reference internal" href="#tcfl.tc.tc_c.hook_pre" title="tcfl.tc.tc_c.hook_pre"><code class="xref py py-data docutils literal"><span class="pre">tcfl.tc.tc_c.hook_pre</span></code></a>,
depending on the categorization of each testcases, a run would
provide multiple JUnit output files to match the different
categories a testcase would match under:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">junit-uncategorized.xml</span></code></li>
<li><code class="docutils literal"><span class="pre">junit-red.xml</span></code></li>
<li><code class="docutils literal"><span class="pre">junit-green.xml</span></code></li>
<li><code class="docutils literal"><span class="pre">junit-blue.xml</span></code></li>
<li><code class="docutils literal"><span class="pre">junit-red.xml</span></code></li>
<li><code class="docutils literal"><span class="pre">junit-blue,red.xml</span></code></li>
<li><code class="docutils literal"><span class="pre">junit-red,green.xml</span></code></li>
<li><code class="docutils literal"><span class="pre">junit-red,blue,green.xml</span></code></li>
<li>…</li>
</ul>
<p>If the <em>DOMAIN</em> is <em>default</em>, then the file will be called
<code class="docutils literal"><span class="pre">junit.xml</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.junit_hooks">
<code class="descname">junit_hooks</code><em class="property"> = []</em><a class="headerlink" href="#tcfl.report.file_c.junit_hooks" title="Permalink to this definition">¶</a></dt>
<dd><p>List of hook functions to call before finalizing a Junit report
to modify anything</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.junit_report_pass">
<code class="descname">junit_report_pass</code><em class="property"> = False</em><a class="headerlink" href="#tcfl.report.file_c.junit_report_pass" title="Permalink to this definition">¶</a></dt>
<dd><p>(bool) in Junit reports, include output of a testcase if it
passed (defaults to False to reduce the amount of data in the XML
file); if <em>None</em>, the <em>stderr</em> and <em>stdout</em> fields will be omitted.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.junit_report_skip">
<code class="descname">junit_report_skip</code><em class="property"> = False</em><a class="headerlink" href="#tcfl.report.file_c.junit_report_skip" title="Permalink to this definition">¶</a></dt>
<dd><p>(bool) in Junit reports, include output of a testcase if it
is skipped (defaults to False to reduce the amount of data in the XML
file)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.junit_name">
<code class="descname">junit_name</code><em class="property"> = '%(tc_name)s'</em><a class="headerlink" href="#tcfl.report.file_c.junit_name" title="Permalink to this definition">¶</a></dt>
<dd><p>(str) Classname for the JUnit testcase</p>
<p>Note you can use any <em>%(FIELD)TYPE</em> Python codes to replace
values from the testcase dictionary. See <a class="reference internal" href="#tcfl.report.file_c.helpurl" title="tcfl.report.file_c.helpurl"><code class="xref py py-data docutils literal"><span class="pre">helpurl</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.junit_classname">
<code class="descname">junit_classname</code><em class="property"> = '%(target_group_types)s:%(tc_name_short)s'</em><a class="headerlink" href="#tcfl.report.file_c.junit_classname" title="Permalink to this definition">¶</a></dt>
<dd><p>(str) Classname for the JUnit testcase</p>
<p>Note you can use any <em>%(FIELD)TYPE</em> Python codes to replace
values from the testcase dictionary. See <a class="reference internal" href="#tcfl.report.file_c.helpurl" title="tcfl.report.file_c.helpurl"><code class="xref py py-data docutils literal"><span class="pre">helpurl</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.junit_suite_name">
<code class="descname">junit_suite_name</code><em class="property"> = 'TCF test suite'</em><a class="headerlink" href="#tcfl.report.file_c.junit_suite_name" title="Permalink to this definition">¶</a></dt>
<dd><p>(str) Name of the JUnit test suite.</p>
<p>Note you can use any <em>%(FIELD)TYPE</em> Python codes to replace
values from the testcase dictionary. See <a class="reference internal" href="#tcfl.report.file_c.helpurl" title="tcfl.report.file_c.helpurl"><code class="xref py py-data docutils literal"><span class="pre">helpurl</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.junit_suite_package">
<code class="descname">junit_suite_package</code><em class="property"> = 'n/a'</em><a class="headerlink" href="#tcfl.report.file_c.junit_suite_package" title="Permalink to this definition">¶</a></dt>
<dd><p>(str) Name of the JUnit test suite package field.</p>
<p>Note you can use any <em>%(FIELD)TYPE</em> Python codes to replace
values from the testcase dictionary. See <a class="reference internal" href="#tcfl.report.file_c.helpurl" title="tcfl.report.file_c.helpurl"><code class="xref py py-data docutils literal"><span class="pre">helpurl</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.junit_suite_properties">
<code class="descname">junit_suite_properties</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.report.file_c.junit_suite_properties" title="Permalink to this definition">¶</a></dt>
<dd><p>(dict) Properties of the JUnit test suite.</p>
<p>This is a dictionary of string values that will be filled in as
test suite properties.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.text">
<code class="descname">text</code><em class="property"> = True</em><a class="headerlink" href="#tcfl.report.file_c.text" title="Permalink to this definition">¶</a></dt>
<dd><p>(bool) produce text reports (default True) to <em>report-HASH.txt</em></p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.text_report_pass">
<code class="descname">text_report_pass</code><em class="property"> = False</em><a class="headerlink" href="#tcfl.report.file_c.text_report_pass" title="Permalink to this definition">¶</a></dt>
<dd><p>(bool) in text reports, include output of a testcase if it
passed (defaults to False to reduce the amount of data)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report.file_c.text_report_skip">
<code class="descname">text_report_skip</code><em class="property"> = True</em><a class="headerlink" href="#tcfl.report.file_c.text_report_skip" title="Permalink to this definition">¶</a></dt>
<dd><p>(bool) in text reports, include output of a testcase if it
skipped (defaults to True) FIXME: unimplemented yet</p>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-tcfl.report_mongodb"></span><dl class="class">
<dt id="tcfl.report_mongodb.report_mongodb_c">
<em class="property">class </em><code class="descclassname">tcfl.report_mongodb.</code><code class="descname">report_mongodb_c</code><a class="headerlink" href="#tcfl.report_mongodb.report_mongodb_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Report results of testcase execution into a MongoDB database</p>
<p>The database used is pointed to by MongoDB URL <a class="reference internal" href="#tcfl.report_mongodb.report_mongodb_c.url" title="tcfl.report_mongodb.report_mongodb_c.url"><code class="xref py py-attr docutils literal"><span class="pre">url</span></code></a> and
name <a class="reference internal" href="#tcfl.report_mongodb.report_mongodb_c.db_name" title="tcfl.report_mongodb.report_mongodb_c.db_name"><code class="xref py py-attr docutils literal"><span class="pre">db_name</span></code></a>.</p>
<p><strong>Testcase execution results</strong></p>
<p>The results of execution (pass/errr/fail/skip/block) are stored in
a collection called <em>results</em>.</p>
<p>For each testcase and the targets where it is ran on
(identified by a <em>hashid</em>) we generate a <em>document</em>; each
report done for that this <em>hashid</em> is a <em>record</em> in said
document with any attachments stored.</p>
<p>Each result document is keyed by <em>runid:hashid</em> and structured
as:</p>
<ul class="simple">
<li>result:</li>
<li>runid:</li>
<li>hashid</li>
<li>tc_name</li>
<li>target_name</li>
<li>target_types</li>
<li>target_server</li>
<li>timestamp</li>
<li>targest: dict of keyed by target name<ul>
<li>TARGETNAME:<ul>
<li>id</li>
<li>server</li>
<li>type</li>
<li>bsp_model</li>
</ul>
</li>
</ul>
</li>
<li>results: list of<ul>
<li>timestamp</li>
<li>ident</li>
<li>level</li>
<li>tag</li>
<li>message</li>
<li>attachments</li>
</ul>
</li>
</ul>
<p>Notes:</p>
<ul class="simple">
<li>When a field is missing we don’t insert it to save space, it
has to be considered an empty string (if we expected one) or
none present</li>
</ul>
<p>Usage:</p>
<ol class="arabic">
<li><p class="first">Ensure you have a access to a MongoDB in <code class="docutils literal"><span class="pre">HOST:PORT</span></code>,
where you can create (or there is already) a database called
<code class="docutils literal"><span class="pre">DATABASENAME</span></code>.</p>
</li>
<li><p class="first">Create a TCF configuration file
<code class="docutils literal"><span class="pre">{/etc/tcf,~,.}/.tcf/conf_mongodb.py</span></code> with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tcfl.report</span>
<span class="kn">import</span> <span class="nn">tcfl.report_mongodb</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">tcfl</span><span class="o">.</span><span class="n">report_mongodb</span><span class="o">.</span><span class="n">report_mongodb_c</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;mongodb://HOST:PORT&quot;</span> <span class="c1"># Or a more complex mongodb URL</span>
<span class="n">m</span><span class="o">.</span><span class="n">db_name</span> <span class="o">=</span> <span class="s2">&quot;DATABASENAME&quot;</span>
<span class="n">m</span><span class="o">.</span><span class="n">collection_name</span> <span class="o">=</span> <span class="s2">&quot;COLLECTIONNAME&quot;</span>
<span class="c1"># Optional: modify the record before going in</span>
<span class="n">m</span><span class="o">.</span><span class="n">complete_hooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SOMEHOOKFUNCTION</span><span class="p">)</span>
<span class="n">tcfl</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_c</span><span class="o">.</span><span class="n">driver_add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Troubleshooting</strong></p>
<ul>
<li><p class="first">When giving SSL and passwords in the URL, the connection fails
with messages such as <em>ConfigurationError: command SON(…)
failed: auth failed</em></p>
<p>The installation of PyMongo in your system might be too old, we
need &gt; v3.</p>
</li>
</ul>
<dl class="attribute">
<dt id="tcfl.report_mongodb.report_mongodb_c.url">
<code class="descname">url</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.report_mongodb.report_mongodb_c.url" title="Permalink to this definition">¶</a></dt>
<dd><p>MongoDB URL where to connect to</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report_mongodb.report_mongodb_c.extra_params">
<code class="descname">extra_params</code><em class="property"> = {}</em><a class="headerlink" href="#tcfl.report_mongodb.report_mongodb_c.extra_params" title="Permalink to this definition">¶</a></dt>
<dd><p>MongoDB client extra params, as described in
<a class="reference external" href="http://api.mongodb.com/python/current/api/pymongo/mongo_client.html#pymongo.mongo_client.MongoClient" title="(in PyMongo v3.7.1)"><code class="xref py py-class docutils literal"><span class="pre">pymongo.mongo_client.MongoClient</span></code></a>; this you want to use
to configure SSL, such as:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">tcfl</span><span class="o">.</span><span class="n">report_mongodb</span><span class="o">.</span><span class="n">report_mongodb_c</span><span class="o">.</span><span class="n">extra_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">ssl_keyfile</span> <span class="o">=</span> <span class="n">PATH_TO_KEY_FILE</span><span class="p">,</span>
    <span class="n">ssl_certfile</span> <span class="o">=</span> <span class="n">PATH_TO_CERT_FILE</span><span class="p">,</span>
    <span class="n">ssl_ca_certs</span> <span class="o">=</span> <span class="n">PATH_TO_CA_FILE</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report_mongodb.report_mongodb_c.db_name">
<code class="descname">db_name</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.report_mongodb.report_mongodb_c.db_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of the database to which to connect</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report_mongodb.report_mongodb_c.collection_name">
<code class="descname">collection_name</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.report_mongodb.report_mongodb_c.collection_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of the collection in the database to fill out</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.report_mongodb.report_mongodb_c.complete_hooks">
<code class="descname">complete_hooks</code><em class="property"> = []</em><a class="headerlink" href="#tcfl.report_mongodb.report_mongodb_c.complete_hooks" title="Permalink to this definition">¶</a></dt>
<dd><p>List of functions to run when a document is completed before
uploading to MongoDB; each is passed the arguments:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>_tc</strong> (<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><em>tcfl.tc.tc_c</em></a>) – testcase object</li>
<li><strong>runid</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – current TC’s runid</li>
<li><strong>hashid</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – current TC’s hashid</li>
<li><strong>tc_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – current testcase name</li>
<li><strong>doc</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – current document that will be inserted into
the database; the hook function can add fields, but it is not
recommended modifying existing fields.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-tcfl.config">
<span id="tcf-client-configuration"></span><h2>8.2. <em>TCF</em> client configuration<a class="headerlink" href="#module-tcfl.config" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configuration-api-for-tcf">
<h3>8.2.1. Configuration API for <em>tcf</em><a class="headerlink" href="#configuration-api-for-tcf" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="tcfl.config.url_add">
<code class="descclassname">tcfl.config.</code><code class="descname">url_add</code><span class="sig-paren">(</span><em>url</em>, <em>ssl_ignore=False</em>, <em>aka=None</em>, <em>ca_path=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.config.url_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a TTBD server</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – server’s URL (<code class="docutils literal"><span class="pre">http://SERVER:PORT</span></code>); it can be
<em>https</em>; port is most commonly <em>5000</em>.</li>
<li><strong>ssl_ignore</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – if True, skips verifying SSL certificates</li>
<li><strong>aka</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Short form for this server, to use in display messages</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.config.load">
<code class="descclassname">tcfl.config.</code><code class="descname">load</code><span class="sig-paren">(</span><em>config_path=None</em>, <em>config_files=None</em>, <em>state_path='~/.tcf'</em>, <em>ignore_ssl=True</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.config.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the TCF Library configuration</p>
<p>This is needed before you can access from your client program any
other module.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>config_path</strong> – list of strings containing UNIX-style
paths (DIR:DIR) to look for config files (conf_*.py) that will
be loaded in alphabetical order. An empty path clears the
current list.</li>
<li><strong>config_files</strong> – list of extra config files to load</li>
<li><strong>state_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) path where to store state</li>
<li><strong>ignore_ssl</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (optional) wether to ignore SSL
verification or not (useful for self-signed certs)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.config.tc_driver_add">
<code class="descclassname">tcfl.config.</code><code class="descname">tc_driver_add</code><span class="sig-paren">(</span><em>_cls</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.config.tc_driver_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a testcase driver</p>
<p>A testcase driver is a subclass of <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.tc_c</span></code></a> which
overrides the methods used to locate testcases and implements the
different testcase configure/build/evaluation functions.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.tc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">my_tc_driver</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tc_driver_add</span><span class="p">(</span><span class="n">my_tc_driver</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>_cls</strong> – subclass of <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.tc_c</span></code></a> that implements the
driver</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.config.report_driver_add">
<code class="descclassname">tcfl.config.</code><code class="descname">report_driver_add</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.config.report_driver_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a reporting driver</p>
<p>A report driver is used by <em>tcf run</em>, the meta test runner, to
report information about the execution of testcases.</p>
<p>A driver implements the reporting in whichever way it decides it
needs to suit the application, uploading information to a server,
writing it to files, printing it to screen, etc.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tcfl.report</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">my_report_driver</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_c</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tcfl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">report_driver_add</span><span class="p">(</span><span class="n">my_report_driver</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>_cls</strong> – subclass <a class="reference internal" href="#tcfl.report.report_c" title="tcfl.report.report_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.report.report_c</span></code></a> of type that
implements the driver</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="module-tcfl">
<span id="tcf-client-internals"></span><h2>8.3. <em>TCF</em> client internals<a class="headerlink" href="#module-tcfl" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="tcfl.msgid_c">
<em class="property">class </em><code class="descclassname">tcfl.</code><code class="descname">msgid_c</code><span class="sig-paren">(</span><em>s=None</em>, <em>s_encode=None</em>, <em>l=4</em>, <em>root=None</em>, <em>phase=None</em>, <em>depth=None</em>, <em>parent=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Accumulate data local to the current running thread.</p>
<p>This is used to generate a random ID (four chars) at the beginning
of the testcase run in a thread by instantiating a local object of
this class. As we call deeper into functions to do different
parts, we instantiate more objects that will add random characters
to said ID <em>just</em> for that call (as when the object created goes
out of scope, the ID is returned to what it was.</p>
<p>So thus, as the call chain gets deeper, the message IDs go:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">abcd</span>
<span class="n">abcdef</span>
<span class="n">abcdefgh</span>
<span class="n">abcdefghij</span>
</pre></div>
</div>
<p>this allows for easy identification / lookup on a log file or
classification.</p>
<p>Note we also keep a depth (usefuly for increasing the verbosity of
log messages) and a phase, which we use it to set the phase in
which we are running, so log messages don’t have to specify it.</p>
<p>Note this is to be used as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">msgid_c</span><span class="p">(</span><span class="n">ARGS</span><span class="p">):</span>
  <span class="n">do</span> <span class="n">stuff</span><span class="o">...</span>
  <span class="n">msgid_c</span><span class="o">.</span><span class="n">ident</span><span class="p">()</span>
  <span class="n">msgid_c</span><span class="o">.</span><span class="n">phase</span><span class="p">()</span>
  <span class="n">msgid_c</span><span class="o">.</span><span class="n">depth</span><span class="p">()</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="tcfl.msgid_c.tls">
<code class="descname">tls</code><em class="property"> = &lt;thread._local object&gt;</em><a class="headerlink" href="#tcfl.msgid_c.tls" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.cls_init">
<em class="property">classmethod </em><code class="descname">cls_init</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.cls_init" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.encode">
<em class="property">classmethod </em><code class="descname">encode</code><span class="sig-paren">(</span><em>s</em>, <em>l</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.encode" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.generate">
<em class="property">classmethod </em><code class="descname">generate</code><span class="sig-paren">(</span><em>l=4</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.generate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.depth">
<em class="property">classmethod </em><code class="descname">depth</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.depth" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.phase">
<em class="property">classmethod </em><code class="descname">phase</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.phase" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.ident">
<em class="property">classmethod </em><code class="descname">ident</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.ident" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.current">
<em class="property">classmethod </em><code class="descname">current</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.current" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.msgid_c.parent">
<em class="property">classmethod </em><code class="descname">parent</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.msgid_c.parent" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.origin_get">
<code class="descclassname">tcfl.</code><code class="descname">origin_get</code><span class="sig-paren">(</span><em>depth=1</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.origin_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.origin_get_object">
<code class="descclassname">tcfl.</code><code class="descname">origin_get_object</code><span class="sig-paren">(</span><em>o</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.origin_get_object" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.origin_get_object_path">
<code class="descclassname">tcfl.</code><code class="descname">origin_get_object_path</code><span class="sig-paren">(</span><em>o</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.origin_get_object_path" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<span class="target" id="module-tcfl.expecter"></span><div class="section" id="expecting-things-that-have-to-happen">
<h3>8.3.1. Expecting things that have to happen<a class="headerlink" href="#expecting-things-that-have-to-happen" title="Permalink to this headline">¶</a></h3>
<p>This module implements an <em>expecter</em> object: something that is told to
expect things to happen, what to do when they happen (or not).</p>
<p>It is a combination of a poor man’s select() and Tk/Tcl Expect.</p>
<p>We cannot use select() or Tk/TCL Expect or Python’s PyExpect because:</p>
<ul class="simple">
<li>we need to listen to many things over HTTP connections and the
library is quite very simplistic in that sense, so there is maybe no
point on hooking up a pure event system.</li>
<li>we need to be able to listen to poll for data and evaluate it from
one or more sources (like serial port, sensor, network data,
whatever) in one or more targets all at the same time.</li>
<li>it is simple, and works quite well</li>
</ul>
<p>Any given testcase has an <cite>expecter</cite> object associated with it that
can be used to wait for a list of events to happen in one or more
targets. This allows, for example, to during the execution of a
testcase with multiple nodes, to always have pollers reading (eg)
their serial consoles and evaluators making sure no kernel panics are
happening in none while at the same time checking for the output that
should be coming from them.</p>
<p>The ‘expecter’ object can be also associated just to a single target
for a more simple interface when only access to one target is needed.</p>
<dl class="class">
<dt id="tcfl.expecter.expecter_c">
<em class="property">class </em><code class="descclassname">tcfl.expecter.</code><code class="descname">expecter_c</code><span class="sig-paren">(</span><em>log</em>, <em>testcase</em>, <em>poll_period=0.25</em>, <em>timeout=30</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Object that is told to expect things to happen and what to do when
they happen (or</p>
<p>When calling <a class="reference internal" href="#tcfl.expecter.expecter_c.run" title="tcfl.expecter.expecter_c.run"><code class="xref py py-meth docutils literal"><span class="pre">run()</span></code></a>, a loop is called by that will run
repeatedly, waiting <a class="reference internal" href="#tcfl.expecter.expecter_c.poll_period" title="tcfl.expecter.expecter_c.poll_period"><code class="xref py py-data docutils literal"><span class="pre">poll_period</span></code></a> seconds in between
polling periods until a given <a class="reference internal" href="#tcfl.expecter.expecter_c.timeout" title="tcfl.expecter.expecter_c.timeout"><code class="xref py py-data docutils literal"><span class="pre">timeout</span></code></a> ellapses.</p>
<p>On each loop run, a bunch of functions are run. Functions are
added with <a class="reference internal" href="#tcfl.expecter.expecter_c.add" title="tcfl.expecter.expecter_c.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a> and removed with <a class="reference internal" href="#tcfl.expecter.expecter_c.remove" title="tcfl.expecter.expecter_c.remove"><code class="xref py py-meth docutils literal"><span class="pre">remove()</span></code></a>.</p>
<p>Each function polls and stores data, evals said data or both. It
can then end the loop by raising an exception. It is also possible
that nothing of the interest happened and thus it won’t cause the
loop to end.  thus it will evaluate nothing. See <a class="reference internal" href="#tcfl.expecter.expecter_c.add" title="tcfl.expecter.expecter_c.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a>
for more details</p>
<p>Some of those functions can be considered ‘expectations’ that have
to pass for the full loop to be considered succesful. An boolean
to <a class="reference internal" href="#tcfl.expecter.expecter_c.add" title="tcfl.expecter.expecter_c.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a> clarifies that. All those ‘expectations’ have to
pass before the run can be considered succesful.</p>
<p>The loop will timeout if no evaluating function raises an exception to
get out of it and fail with a timeout.</p>
<p><strong>Rationale</strong></p>
<p>This allows to implement simple usages like waiting for something to
come off any console with a default</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">console</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>which also check for other things we know that can come from the OS in
a console, like abort strings, kernel panics or dumps for which new
know we should abort inmediately with an specific message.</p>
<p>FIXME:</p>
<p>it has to be easy to use and still providing things like</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">console</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="kc">True</span> <span class="o">|</span> <span class="kc">False</span> <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">target</span><span class="o">.</span><span class="n">expecter</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">console_rx</span><span class="p">,</span> <span class="p">(</span><span class="n">STRING</span><span class="p">,</span> <span class="n">console</span><span class="p">),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="n">TIMEOUT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">raise</span> <span class="n">error</span><span class="o">/</span><span class="n">fail</span><span class="o">/</span><span class="n">block</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">on_rx</span><span class="p">(</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="k">raise</span> <span class="n">failure</span> <span class="n">function</span><span class="p">)</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="tcfl.expecter.expecter_c.functors">
<code class="descname">functors</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.expecter.expecter_c.functors" title="Permalink to this definition">¶</a></dt>
<dd><p>List of functions to call for poll and evaluation; this is</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.expecter.expecter_c.buffers">
<code class="descname">buffers</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.expecter.expecter_c.buffers" title="Permalink to this definition">¶</a></dt>
<dd><p>dictionary for poll/eval functions to store data from run
to run of the loop that can be examined for evaluation;
will be cleared every time the <a class="reference internal" href="#tcfl.expecter.expecter_c.run" title="tcfl.expecter.expecter_c.run"><code class="xref py py-func docutils literal"><span class="pre">run()</span></code></a> function is
called.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.expecter.expecter_c.active_period">
<code class="descname">active_period</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.expecter.expecter_c.active_period" title="Permalink to this definition">¶</a></dt>
<dd><p>Each this many seconds, touch the targets to indicate the
server we are actively using them (in case the pollers are
not polling every target)</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.expecter.expecter_c.buffers_persistent">
<code class="descname">buffers_persistent</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.expecter.expecter_c.buffers_persistent" title="Permalink to this definition">¶</a></dt>
<dd><p>dictionary for poll/eval functions to store data from run
to run of the loop that can be examined for evaluation;
will NOT be cleared every time the <a class="reference internal" href="#tcfl.expecter.expecter_c.run" title="tcfl.expecter.expecter_c.run"><code class="xref py py-func docutils literal"><span class="pre">run()</span></code></a> function is
called.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.expecter.expecter_c.have_to_pass">
<code class="descname">have_to_pass</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.expecter.expecter_c.have_to_pass" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of expectations that have to pass for a run to be
successful</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.expecter.expecter_c.ts0">
<code class="descname">ts0</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.expecter.expecter_c.ts0" title="Permalink to this definition">¶</a></dt>
<dd><p>Time base, to calculate relative timestamps; when we call
run(), we reinitialized it, but we also set it here for when
we call the poller outside of run()</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.expecter.expecter_c.timeout">
<code class="descname">timeout</code><a class="headerlink" href="#tcfl.expecter.expecter_c.timeout" title="Permalink to this definition">¶</a></dt>
<dd><p>Time in seconds the <a class="reference internal" href="#tcfl.expecter.expecter_c.run" title="tcfl.expecter.expecter_c.run"><code class="xref py py-meth docutils literal"><span class="pre">run()</span></code></a> will consider we have
timed out if no polling/evaluation function raises an
exception to complete the loop</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.expecter.expecter_c.poll_period">
<code class="descname">poll_period</code><a class="headerlink" href="#tcfl.expecter.expecter_c.poll_period" title="Permalink to this definition">¶</a></dt>
<dd><p>Time in seconds the <a class="reference internal" href="#tcfl.expecter.expecter_c.run" title="tcfl.expecter.expecter_c.run"><code class="xref py py-meth docutils literal"><span class="pre">run()</span></code></a> function waits before
calling all the polling/evaluation functions</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.expecter.expecter_c.console_get_file">
<code class="descname">console_get_file</code><span class="sig-paren">(</span><em>target</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c.console_get_file" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.expecter.expecter_c.add">
<code class="descname">add</code><span class="sig-paren">(</span><em>has_to_pass</em>, <em>functor</em>, <em>arguments</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a function to the list of things to poll/evaluate</p>
<p>These functions shall either poll, evaluate or both:</p>
<ul class="simple">
<li>poll data and store it in the dictionary or anywhere else
where it can be accessed later. Use a unique key into the
dictorionary <a class="reference internal" href="#tcfl.expecter.expecter_c.buffers" title="tcfl.expecter.expecter_c.buffers"><code class="xref py py-data docutils literal"><span class="pre">buffers</span></code></a>.</li>
<li>evaluate some previously polled data or whichever system
condition and raise an exception to indicate what happened
(from the set <a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.pass_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.blocked_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.error_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.failed_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.skip_e</span></code></a>).</li>
</ul>
<p>Eval functions can check their own timeouts and raise an
exception to signal it (normally
<a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.error_e</span></code></a>)</p>
<p>It is also possible that nothing of the interest of this
evaluation function happened and thus it will evaluate
nothing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>has_to_pass</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – In order to consider the whole expect
sequence a pass, this functor has to declare its evaluation
passes by returning anything but <cite>None</cite> or by raising
<a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.pass_e</span></code></a>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">to stop the <a class="reference internal" href="#tcfl.expecter.expecter_c.run" title="tcfl.expecter.expecter_c.run"><code class="xref py py-meth docutils literal"><span class="pre">run()</span></code></a> loop, raise
<a class="reference internal" href="#tcfl.tc.pass_e" title="tcfl.tc.pass_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.pass_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.blocked_e</span></code></a>,
<a class="reference internal" href="#tcfl.tc.error_e" title="tcfl.tc.error_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.error_e</span></code></a> or
<a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.skip_e</span></code></a>.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">ignored</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.expecter.expecter_c.remove">
<code class="descname">remove</code><span class="sig-paren">(</span><em>functor</em>, <em>arguments</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c.remove" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.expecter.expecter_c.log">
<code class="descname">log</code><span class="sig-paren">(</span><em>msg</em>, <em>attachments=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c.log" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.expecter.expecter_c.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.expecter_c.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the expectation loop on the testcase until all
expectations pass or the timeout is exceeded.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) maximum time to wait for all
expectations to be met (defaults to
<a class="reference internal" href="#tcfl.expecter.expecter_c.timeout" title="tcfl.expecter.expecter_c.timeout"><code class="xref py py-attr docutils literal"><span class="pre">tcfl.expecter.expecter_c.timeout</span></code></a>)</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.expecter.console_mk_code">
<code class="descclassname">tcfl.expecter.</code><code class="descname">console_mk_code</code><span class="sig-paren">(</span><em>target</em>, <em>console</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.console_mk_code" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.expecter.console_mk_uid">
<code class="descclassname">tcfl.expecter.</code><code class="descname">console_mk_uid</code><span class="sig-paren">(</span><em>target</em>, <em>what</em>, <em>console</em>, <em>_timeout</em>, <em>result</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.console_mk_uid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.expecter.console_rx_poller">
<code class="descclassname">tcfl.expecter.</code><code class="descname">console_rx_poller</code><span class="sig-paren">(</span><em>expecter</em>, <em>target</em>, <em>console=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.console_rx_poller" title="Permalink to this definition">¶</a></dt>
<dd><p>Poll a console</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.expecter.console_rx_flush">
<code class="descclassname">tcfl.expecter.</code><code class="descname">console_rx_flush</code><span class="sig-paren">(</span><em>expecter</em>, <em>target</em>, <em>console=None</em>, <em>truncate=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.console_rx_flush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.expecter.console_rx_eval">
<code class="descclassname">tcfl.expecter.</code><code class="descname">console_rx_eval</code><span class="sig-paren">(</span><em>expecter</em>, <em>target</em>, <em>regex</em>, <em>console=None</em>, <em>_timeout=None</em>, <em>result=None</em>, <em>uid=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.expecter.console_rx_eval" title="Permalink to this definition">¶</a></dt>
<dd><p>Check what came on a console and act on it</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>uid</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) identifier to use to store offset data</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<span class="target" id="module-tcfl.ttb_client"></span><div class="section" id="client-api-for-accessing-ttbd-s-rest-api">
<h3>8.3.2. Client API for accessing <em>ttbd</em>’s REST API<a class="headerlink" href="#client-api-for-accessing-ttbd-s-rest-api" title="Permalink to this headline">¶</a></h3>
<p>This API provides a way to access teh REST API exposed by the <em>ttbd</em>
daemon; it is divided in two main blocks:</p>
<blockquote>
<div><ul>
<li><p class="first"><a class="reference internal" href="#tcfl.ttb_client.rest_target_broker" title="tcfl.ttb_client.rest_target_broker"><code class="xref py py-class docutils literal"><span class="pre">rest_target_broker</span></code></a>: abstracts a remote <em>ttbd</em> server and
provides methods to run stuff on targets and and connect/disconnect
things on/from targets.</p>
</li>
<li><p class="first"><cite>rest_*()</cite> methods that take a namespace of arguments, lookup the
object target, map it to a remote server, execute the method and
then print the result to console.</p>
<p>This breakup is a wee arbitrary, it can use some cleanup</p>
</li>
</ul>
</div></blockquote>
<dl class="function">
<dt id="tcfl.ttb_client.import_mp_pathos">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">import_mp_pathos</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.import_mp_pathos" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.import_mp_std">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">import_mp_std</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.import_mp_std" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.tls_var">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">tls_var</code><span class="sig-paren">(</span><em>name</em>, <em>factory</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.tls_var" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="tcfl.ttb_client.rest_target_broker">
<em class="property">class </em><code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_broker</code><span class="sig-paren">(</span><em>state_path</em>, <em>url</em>, <em>ignore_ssl=False</em>, <em>aka=None</em>, <em>ca_path=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a proxy for a target broker, optionally loading state
(like cookies) previously saved.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>state_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Path prefix where to load state from</li>
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – URL for which we are loading state</li>
<li><strong>ignore_ssl</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – Ignore server’s SSL certificate
validation (use for self-signed certs).</li>
<li><strong>aka</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Short name for this server; defaults to the
hostname (sans domain) of the URL.</li>
<li><strong>ca_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Path to SSL certificate or chain-of-trust bundle</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">True if information was loaded for the URL, False otherwise</p>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="tcfl.ttb_client.rest_target_broker.API_VERSION">
<code class="descname">API_VERSION</code><em class="property"> = 1</em><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.API_VERSION" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.ttb_client.rest_target_broker.API_PREFIX">
<code class="descname">API_PREFIX</code><em class="property"> = '/ttb-v1/'</em><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.API_PREFIX" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.ttb_client.rest_target_broker.rts_cache_flush">
<em class="property">classmethod </em><code class="descname">rts_cache_flush</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rts_cache_flush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.tb_state_save">
<code class="descname">tb_state_save</code><span class="sig-paren">(</span><em>filepath</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.tb_state_save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save cookies in <em>path</em> so they can be loaded by when the object is
created.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Filename where to save to</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.send_request">
<code class="descname">send_request</code><span class="sig-paren">(</span><em>method</em>, <em>url</em>, <em>data=None</em>, <em>files=None</em>, <em>stream=False</em>, <em>raw=False</em>, <em>timeout=480</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.send_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Send request to server using url and data, save the cookies
generated from request, search for issues on connection and
raise and exception or return the response object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – url to request</li>
<li><strong>data</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – args to send in the request. default None</li>
<li><strong>method</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – method used to request GET, POST and PUT. default PUT</li>
<li><strong>raise_error</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – if true, raise an error if something goes
wrong in the request. default True</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">response object</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="http://docs.python-requests.org/en/master/api/#requests.Response" title="(in Requests v2.19.1)">requests.Response</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.login">
<code class="descname">login</code><span class="sig-paren">(</span><em>email</em>, <em>password</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.login" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.logout">
<code class="descname">logout</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.logout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.validate_session">
<code class="descname">validate_session</code><span class="sig-paren">(</span><em>validate=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.validate_session" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_list">
<code class="descname">rest_tb_target_list</code><span class="sig-paren">(</span><em>all_targets=False</em>, <em>target_id=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_list" title="Permalink to this definition">¶</a></dt>
<dd><p>List targets in this server</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>all_targets</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – If True, include also targets that are marked
as disabled.</li>
<li><strong>target_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Only get information for said target id</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_update">
<code class="descname">rest_tb_target_update</code><span class="sig-paren">(</span><em>target_id</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update information about a target</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>target_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – ID of the target to operate on</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">updated target tags</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_acquire">
<code class="descname">rest_tb_target_acquire</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_acquire" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_active">
<code class="descname">rest_tb_target_active</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_active" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_enable">
<code class="descname">rest_tb_target_enable</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_enable" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_disable">
<code class="descname">rest_tb_target_disable</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_disable" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_thing_plug">
<code class="descname">rest_tb_thing_plug</code><span class="sig-paren">(</span><em>rt</em>, <em>thing</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_thing_plug" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_thing_list">
<code class="descname">rest_tb_thing_list</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_thing_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_thing_unplug">
<code class="descname">rest_tb_thing_unplug</code><span class="sig-paren">(</span><em>rt</em>, <em>thing</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_thing_unplug" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_release">
<code class="descname">rest_tb_target_release</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em>, <em>force=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_release" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_property_set">
<code class="descname">rest_tb_property_set</code><span class="sig-paren">(</span><em>rt</em>, <em>prop</em>, <em>value</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_property_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_property_get">
<code class="descname">rest_tb_property_get</code><span class="sig-paren">(</span><em>rt</em>, <em>prop</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_property_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_ip_tunnel_add">
<code class="descname">rest_tb_target_ip_tunnel_add</code><span class="sig-paren">(</span><em>rt</em>, <em>ip_addr</em>, <em>port</em>, <em>proto</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_ip_tunnel_add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_ip_tunnel_remove">
<code class="descname">rest_tb_target_ip_tunnel_remove</code><span class="sig-paren">(</span><em>rt</em>, <em>ip_addr</em>, <em>port</em>, <em>proto</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_ip_tunnel_remove" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_ip_tunnel_list">
<code class="descname">rest_tb_target_ip_tunnel_list</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_ip_tunnel_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_power_on">
<code class="descname">rest_tb_target_power_on</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_power_on" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_power_off">
<code class="descname">rest_tb_target_power_off</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_power_off" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_reset">
<code class="descname">rest_tb_target_reset</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_reset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_power_cycle">
<code class="descname">rest_tb_target_power_cycle</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em>, <em>wait=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_power_cycle" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_power_get">
<code class="descname">rest_tb_target_power_get</code><span class="sig-paren">(</span><em>rt</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_power_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_images_set">
<code class="descname">rest_tb_target_images_set</code><span class="sig-paren">(</span><em>rt</em>, <em>images</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_images_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Write/configure images to the targets (depending on the
target)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>images</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – Dictionary of image types and filenames, like in
<a class="reference internal" href="#ttbl.test_target_images_mixin.images_set" title="ttbl.test_target_images_mixin.images_set"><code class="xref py py-meth docutils literal"><span class="pre">ttbl.test_target_images_mixin.images_set()</span></code></a>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">Exception in case of errors</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_file_upload">
<code class="descname">rest_tb_file_upload</code><span class="sig-paren">(</span><em>remote_filename</em>, <em>local_filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_file_upload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_file_dnload">
<code class="descname">rest_tb_file_dnload</code><span class="sig-paren">(</span><em>remote_filename</em>, <em>local_filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_file_dnload" title="Permalink to this definition">¶</a></dt>
<dd><p>Download a remote file from the broker to a local file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>remote_filename</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – filename in the broker’s user
storage area</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Params str local_filename:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body">local filename where to download it</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_file_dnload_to_fd">
<code class="descname">rest_tb_file_dnload_to_fd</code><span class="sig-paren">(</span><em>fd</em>, <em>remote_filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_file_dnload_to_fd" title="Permalink to this definition">¶</a></dt>
<dd><p>Download a remote file from the broker to a local file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>remote_filename</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – filename in the broker’s user
storage area</td>
</tr>
<tr class="field-even field"><th class="field-name">Params int fd:</th><td class="field-body">file descriptor where to write the data to</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_file_delete">
<code class="descname">rest_tb_file_delete</code><span class="sig-paren">(</span><em>remote_filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_file_delete" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_file_list">
<code class="descname">rest_tb_file_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_file_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary of files names available to the user in the
broker and their sha256 hash.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_console_read">
<code class="descname">rest_tb_target_console_read</code><span class="sig-paren">(</span><em>rt</em>, <em>console</em>, <em>offset</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_console_read" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_console_read_to_fd">
<code class="descname">rest_tb_target_console_read_to_fd</code><span class="sig-paren">(</span><em>fd</em>, <em>rt</em>, <em>console</em>, <em>offset</em>, <em>max_size=0</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_console_read_to_fd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_console_write">
<code class="descname">rest_tb_target_console_write</code><span class="sig-paren">(</span><em>rt</em>, <em>console</em>, <em>data</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_console_write" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_info">
<code class="descname">rest_tb_target_debug_info</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_start">
<code class="descname">rest_tb_target_debug_start</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_stop">
<code class="descname">rest_tb_target_debug_stop</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_stop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_halt">
<code class="descname">rest_tb_target_debug_halt</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_halt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_reset">
<code class="descname">rest_tb_target_debug_reset</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_reset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_reset_halt">
<code class="descname">rest_tb_target_debug_reset_halt</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_reset_halt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_resume">
<code class="descname">rest_tb_target_debug_resume</code><span class="sig-paren">(</span><em>rt</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_resume" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_openocd">
<code class="descname">rest_tb_target_debug_openocd</code><span class="sig-paren">(</span><em>rt</em>, <em>command</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_debug_openocd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_init">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_init</code><span class="sig-paren">(</span><em>path</em>, <em>url</em>, <em>ignore_ssl=False</em>, <em>aka=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize access to a remote target broker.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>state_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Path prefix where to load state from</li>
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – URL for which we are loading state</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">True if information was loaded for the URL, False otherwise</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_shutdown">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_shutdown</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>Shutdown REST API, saving state in <em>path</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Path to where to save state information</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_login">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_login</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_login" title="Permalink to this definition">¶</a></dt>
<dd><p>Login into remote servers.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/argparse.html#module-argparse" title="(in Python v2.7)"><em>argparse</em></a>) – login arguments like -q (quiet) or userid.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if it can be logged into at least 1 remote server.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_logout">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_logout</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_logout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_print">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_print</code><span class="sig-paren">(</span><em>rt</em>, <em>verbosity=0</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_print" title="Permalink to this definition">¶</a></dt>
<dd><p>Print information about a REST target taking into account the
verbosity level from the logging module</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>rt</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – object describing the REST target to print</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_list_table">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_list_table</code><span class="sig-paren">(</span><em>args</em>, <em>spec</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_list_table" title="Permalink to this definition">¶</a></dt>
<dd><p>List all the targets in a table format, appending * if powered
up, ! if owned.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_list">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_list</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_find_all">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_find_all</code><span class="sig-paren">(</span><em>all_targets=False</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_find_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Return descriptors for all the known remote targets</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>all_targets</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – Include or not disabled targets</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of remote target descriptors (each being a dictionary).</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_acquire">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_acquire</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_acquire" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">dictionary of tags</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_enable">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_enable</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_enable" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_disable">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_disable</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_disable" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_property_set">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_property_set</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_property_set" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_property_get">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_property_get</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_property_get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_release">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_release</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_release" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_power_on">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_power_on</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_power_on" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_power_off">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_power_off</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_power_off" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_reset">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_reset</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_reset" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_debug_halt">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_debug_halt</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_debug_halt" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_debug_reset">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_debug_reset</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_debug_reset" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_debug_reset_halt">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_debug_reset_halt</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_debug_reset_halt" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_debug_resume">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_debug_resume</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_debug_resume" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_debug_openocd">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_debug_openocd</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_debug_openocd" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_power_cycle">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_power_cycle</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_power_cycle" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_images_set">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_images_set</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_images_set" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_tb_target_images_upload">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_tb_target_images_upload</code><span class="sig-paren">(</span><em>rtb</em>, <em>_images</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_tb_target_images_upload" title="Permalink to this definition">¶</a></dt>
<dd><p>Upload images from a list images</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>rtb</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – Remote Target Broker</li>
<li><strong>_images</strong> – <p>list of images, which can be specified as:</p>
<ul>
<li>string with <code class="docutils literal"><span class="pre">&quot;IMAGE1:FILE1</span> <span class="pre">IMAGE2:FILE2...&quot;</span></code></li>
<li>list or set of strings <code class="docutils literal"><span class="pre">[&quot;IMAGE1:FILE1&quot;,</span> <span class="pre">&quot;IMAGE2:FILE2&quot;,</span> <span class="pre">...]</span></code></li>
<li>list or set of tuples <code class="docutils literal"><span class="pre">[(&quot;IMAGE1&quot;,</span> <span class="pre">&quot;FILE1&quot;),</span> <span class="pre">(&quot;IMAGE2&quot;,</span> <span class="pre">&quot;FILE2&quot;),</span> <span class="pre">...]</span></code></li>
</ul>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of remote images (that can be fed straight to
<a class="reference internal" href="#tcfl.ttb_client.rest_target_broker.rest_tb_target_images_set" title="tcfl.ttb_client.rest_target_broker.rest_tb_target_images_set"><code class="xref py py-meth docutils literal"><span class="pre">tcfl.ttb_client.rest_target_broker.rest_tb_target_images_set()</span></code></a>)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_tb_target_images_upload_set">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_tb_target_images_upload_set</code><span class="sig-paren">(</span><em>rtb</em>, <em>rt</em>, <em>_images</em>, <em>ticket=''</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_tb_target_images_upload_set" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>rtb</strong> – Remote Target Broker</li>
<li><strong>rt</strong> – Remote Target descriptor</li>
<li><strong>_images</strong> – <p>list of images, which can be specified as:</p>
<ul>
<li>string with <code class="docutils literal"><span class="pre">&quot;IMAGE1:FILE1</span> <span class="pre">IMAGE2:FILE2...&quot;</span></code></li>
<li>list or set of strings <code class="docutils literal"><span class="pre">[&quot;IMAGE1:FILE1&quot;,</span> <span class="pre">&quot;IMAGE2:FILE2&quot;,</span> <span class="pre">...]</span></code></li>
<li>list or set of tuples <code class="docutils literal"><span class="pre">[(&quot;IMAGE1&quot;,</span> <span class="pre">&quot;FILE1&quot;),</span>&#160; <span class="pre">(&quot;IMAGE2&quot;,</span> <span class="pre">&quot;FILE2&quot;),</span> <span class="pre">...]</span></code></li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_images_upload_set">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_images_upload_set</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_images_upload_set" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_power_get">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_power_get</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_power_get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_broker_file_upload">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_broker_file_upload</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_broker_file_upload" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_broker_file_dnload">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_broker_file_dnload</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_broker_file_dnload" title="Permalink to this definition">¶</a></dt>
<dd><p>Download a file from a target broker</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_broker_file_delete">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_broker_file_delete</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_broker_file_delete" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_broker_file_list">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_broker_file_list</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_broker_file_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Print a list of files names available to the user in the broker
and their sha256 hash.</p>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_console_read">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_console_read</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_console_read" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_console_write">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_console_write</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_console_write" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_debug_info">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_debug_info</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_debug_info" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_debug_start">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_debug_start</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_debug_start" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_debug_stop">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_debug_stop</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_debug_stop" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> – object containing the processed command line
arguments; need args.target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IndexError if target not found</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_thing_plug">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_thing_plug</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_thing_plug" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_thing_unplug">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_thing_unplug</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_thing_unplug" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.ttb_client.rest_target_thing_list">
<code class="descclassname">tcfl.ttb_client.</code><code class="descname">rest_target_thing_list</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.ttb_client.rest_target_thing_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<span class="target" id="module-tcfl.util"></span><dl class="function">
<dt id="tcfl.util.healthcheck_power">
<code class="descclassname">tcfl.util.</code><code class="descname">healthcheck_power</code><span class="sig-paren">(</span><em>rtb</em>, <em>rt</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.util.healthcheck_power" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.util.healthcheck">
<code class="descclassname">tcfl.util.</code><code class="descname">healthcheck</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.util.healthcheck" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="tcfl.util.argp_setup">
<code class="descclassname">tcfl.util.</code><code class="descname">argp_setup</code><span class="sig-paren">(</span><em>arg_subparsers</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.util.argp_setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<span class="target" id="module-tcfl.tc_zephyr_sanity"></span><div class="section" id="zephyr-s-sanitycheck-testcase-ini-driver-for-testcase-integration">
<h3>8.3.3. Zephyr’s SanityCheck testcase.ini driver for testcase integration<a class="headerlink" href="#zephyr-s-sanitycheck-testcase-ini-driver-for-testcase-integration" title="Permalink to this headline">¶</a></h3>
<p>This implements a driver to run Zephyr’s Sanity Check testcases
(described with a testcase.ini file) without having to implement any
new descriptions. Details are explained in
<a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c"><code class="xref py py-class docutils literal"><span class="pre">tc_zephyr_sanity_c</span></code></a>.</p>
<dl class="exception">
<dt id="tcfl.tc_zephyr_sanity.ConfigurationError">
<em class="property">exception </em><code class="descclassname">tcfl.tc_zephyr_sanity.</code><code class="descname">ConfigurationError</code><a class="headerlink" href="#tcfl.tc_zephyr_sanity.ConfigurationError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="tcfl.tc_zephyr_sanity.SanityConfigParser">
<em class="property">class </em><code class="descclassname">tcfl.tc_zephyr_sanity.</code><code class="descname">SanityConfigParser</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.SanityConfigParser" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to read architecture and test case .ini files with semantic
checking</p>
<p>This is only used for the old, .ini support</p>
<p>Instantiate a new SanityConfigParser object</p>
<p>&#64;param filename Source .ini file to read</p>
<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.SanityConfigParser.sections">
<code class="descname">sections</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.SanityConfigParser.sections" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the set of sections within the .ini file</p>
<p>&#64;return a list of string section names</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.SanityConfigParser.get_section">
<code class="descname">get_section</code><span class="sig-paren">(</span><em>section</em>, <em>valid_keys</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.SanityConfigParser.get_section" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a dictionary representing the keys/values within a section</p>
<p>&#64;param section The section in the .ini file to retrieve data from</p>
<dl class="docutils">
<dt>&#64;param valid_keys A dictionary representing the intended semantics</dt>
<dd><p class="first">for this section. Each key in this dictionary is a key that could
be specified, if a key is given in the .ini file which isn’t in
here, it will generate an error. Each value in this dictionary
is another dictionary containing metadata:</p>
<blockquote class="last">
<div><p>“default” - Default value if not given</p>
<dl class="docutils">
<dt>“type” - Data type to convert the text value to. Simple types</dt>
<dd>supported are “str”, “float”, “int”, “bool” which will get
converted to respective Python data types. “set” and “list”
may also be specified which will split the value by
whitespace (but keep the elements as strings). finally,
“list:&lt;type&gt;” and “set:&lt;type&gt;” may be given which will
perform a type conversion after splitting the value up.</dd>
<dt>“required” - If true, raise an error if not defined. If false</dt>
<dd>and “default” isn’t specified, a type conversion will be
done on an empty string</dd>
</dl>
</div></blockquote>
</dd>
<dt>&#64;return A dictionary containing the section key-value pairs with</dt>
<dd>type conversion and default values filled in per valid_keys</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc_zephyr_sanity.harness_c">
<em class="property">class </em><code class="descclassname">tcfl.tc_zephyr_sanity.</code><code class="descname">harness_c</code><a class="headerlink" href="#tcfl.tc_zephyr_sanity.harness_c" title="Permalink to this definition">¶</a></dt>
<dd><p>A test harness for a Zephyr test</p>
<p>In the Zephyr SanityCheck environment, a harness is a set of steps
to verify that a testcase did the right thing.</p>
<p>The default harness just verifies if <em>PROJECT EXECUTION FAILED</em> or
<em>PROJECT EXECUTION SUCCESFUL</em>  was printed (which is done in
<a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.eval_50" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.eval_50"><code class="xref py py-meth docutils literal"><span class="pre">tc_zephyr_sanity_c.eval_50()</span></code></a>).</p>
<p>However, if a harness is specified in the testcase/sample YAML
with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">harness</span><span class="p">:</span> <span class="n">HARNESSNAME</span>
<span class="n">harness_config</span><span class="p">:</span>
  <span class="n">field1</span><span class="p">:</span> <span class="n">value1</span>
  <span class="n">field2</span><span class="p">:</span> <span class="n">value2</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>then <em>tc_zephyr_sanity_c._dict_init()</em> will create a harness
object of class <em>_harness_HARNESSNAME_c</em> and set it to
<a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.harness" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.harness"><code class="xref py py-data docutils literal"><span class="pre">tc_zephyr_sanity_c.harness</span></code></a>. Then, during the evaluation
phase, we’ll run it in <a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.eval_50" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.eval_50"><code class="xref py py-meth docutils literal"><span class="pre">tc_zephyr_sanity_c.eval_50()</span></code></a>.</p>
<p>The harness object has <a class="reference internal" href="#tcfl.tc_zephyr_sanity.harness_c.evaluate" title="tcfl.tc_zephyr_sanity.harness_c.evaluate"><code class="xref py py-meth docutils literal"><span class="pre">evaluate()</span></code></a> which is called to
implement the harness on the testcase and target it is running
on.</p>
<p>For each type of harness, there is a class for it implementing the
details of it.</p>
<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.harness_c.evaluate">
<code class="descname">evaluate</code><span class="sig-paren">(</span><em>_testcase</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.harness_c.evaluate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c">
<em class="property">class </em><code class="descclassname">tcfl.tc_zephyr_sanity.</code><code class="descname">tc_zephyr_subsanity_c</code><span class="sig-paren">(</span><em>name</em>, <em>tc_file_path</em>, <em>origin</em>, <em>zephyr_name</em>, <em>parent</em>, <em>attachments=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Subtestcase of a Zephyr Sanity Check</p>
<p>A Zephyr Sanity Check testcase might be composed of one or more
subtestcases.</p>
<p>We run them all in a single shot using <a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c"><code class="xref py py-class docutils literal"><span class="pre">tc_zephyr_sanity_c</span></code></a>
and when done, we parse the output
(tc_zephyr_sanity_c._subtestcases_grok) and for each subtestcase,
we create one of this sub testcase objects and queue it to be
executed in the same target where the main testcase was ran.</p>
<p>This is only a construct to ensure they are reported as separate
testcases. We already know if they passed or errored or failed, so
all we do is report as such.</p>
<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.configure_50">
<code class="descname">configure_50</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.configure_50" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.eval_50">
<code class="descname">eval_50</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.eval_50" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.clean">
<em class="property">static </em><code class="descname">clean</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.class_result">
<code class="descname">class_result</code><em class="property"> = 0 (0 0 0 0 0)</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_subsanity_c.class_result" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c">
<em class="property">class </em><code class="descclassname">tcfl.tc_zephyr_sanity.</code><code class="descname">tc_zephyr_sanity_c</code><span class="sig-paren">(</span><em>name</em>, <em>tc_file_path</em>, <em>origin</em>, <em>zephyr_name</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Test case driver specific to Zephyr project testcases</p>
<p>This will generate test actions based on Zephyr project testcase.ini
files.</p>
<p>See Zephyr sanitycheck –help for details on the format on these
testcase configuration files. A single testcase.ini may specify
one or more test cases.</p>
<p>This rides on top of <a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.tc_c</span></code></a> driver; tags are
translated, whitelist/excludes are translated to target selection
language and and a single target is declared (for cases that are
not unit tests).</p>
<p><a class="reference internal" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase"><code class="xref py py-meth docutils literal"><span class="pre">is_testcase()</span></code></a> looks for <code class="docutils literal"><span class="pre">testcase.ini</span></code> files, parses up
using <a class="reference internal" href="#tcfl.tc_zephyr_sanity.SanityConfigParser" title="tcfl.tc_zephyr_sanity.SanityConfigParser"><code class="xref py py-class docutils literal"><span class="pre">SanityConfigParser</span></code></a> to load it up into memory and
calls <code class="docutils literal"><span class="pre">_dict_init()</span></code> to set values and generate the target
(when needed) and setup the App Zephyr builder.</p>
<p>This is how we map the different testcase.ini sections/concepts to
<a class="reference internal" href="#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.tc_c</span></code></a> data:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">extra_args</span> <span class="pre">=</span> <span class="pre">VALUES</span></code>: handled as <code class="docutils literal"><span class="pre">app_zephyr_options</span></code>,
passed to the Zephyr App Builder.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">extra_configs</span> <span class="pre">=</span> <span class="pre">LIST</span></code>: list of extra configuration settings</p>
</li>
<li><p class="first">testcase source is assumed to be in the same directory as the
<code class="docutils literal"><span class="pre">testcase.ini</span></code> file. Passed to the Zephyr App Builder with
<code class="docutils literal"><span class="pre">app_zephyr</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">timeout</span> <span class="pre">=</span> <span class="pre">VALUE</span></code>: use to set the timeout in the testcase
expect loop.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">tags</span> <span class="pre">=</span> <span class="pre">TAGS</span></code>: added to the tags list, with an origin</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">skip</span></code>: skipped right away with an <a class="reference internal" href="#tcfl.tc.skip_e" title="tcfl.tc.skip_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.skip_e</span></code></a> exception</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">slow</span></code>: coverted to tag</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">build_only</span></code>: added as <code class="docutils literal"><span class="pre">self.build_only</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">(arch,platform)_(whitelist,exclude)</span></code>: what testcase.ini calls
<cite>arch</cite> is a <cite>bsp</cite> in TCF parlance and <cite>platform</cite> maps to the
<cite>zerphyr_board</cite> parameter the Zephyr test targets export on their BSP
specific tags. Thus, our spec becomes something like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bsp</span> <span class="o">==</span> <span class="s2">&quot;ARCH1&#39; or bsp == &quot;</span><span class="n">ARCH2</span><span class="s2">&quot; ) and not ( bsp == &quot;</span><span class="n">ARCH3</span><span class="s2">&quot; or bsp == &quot;</span><span class="n">ARCH4</span><span class="s2">&quot;)</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">arch_whitelist</span> <span class="pre">=</span> <span class="pre">ARCH1</span> <span class="pre">ARCH2</span></code> mapped to
<code class="docutils literal"><span class="pre">&#64;targets</span> <span class="pre">+=</span> <span class="pre">bsp:^(ARCH1|ARCH2)$</span></code></li>
<li><code class="docutils literal"><span class="pre">arch_exclude</span> <span class="pre">=</span> <span class="pre">ARCH1</span> <span class="pre">ARCH2</span></code> mapped to
<code class="docutils literal"><span class="pre">&#64;targets</span> <span class="pre">+=</span> <span class="pre">bsp:(?!^(ARCH1|ARCH2)$)</span></code></li>
<li><code class="docutils literal"><span class="pre">platform_whitelist</span> <span class="pre">=</span> <span class="pre">PLAT1</span> <span class="pre">PLAT2</span></code> mapped to
<code class="docutils literal"><span class="pre">&#64;targets</span> <span class="pre">+=</span> <span class="pre">board:^(PLAT1|PLAT2)$</span></code></li>
<li><code class="docutils literal"><span class="pre">platform_exclude</span> <span class="pre">=</span> <span class="pre">PLAT1</span> <span class="pre">PLAT2</span></code> mapped to
<code class="docutils literal"><span class="pre">&#64;targets</span> <span class="pre">+=</span> <span class="pre">board:(?!^(PLAT1|PLAT2)$)</span></code></li>
<li><code class="docutils literal"><span class="pre">config_whitelist</span></code> and <code class="docutils literal"><span class="pre">filter</span></code>: filled into the args
stored in the testcase as which then gets passed as part of
the kws[config_whitelist] dictionary… The build process then
calls the action_eval_skip() method to test if the TC has to
be skipped after creating the base config.</li>
</ul>
</li>
</ul>
<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.harness">
<code class="descname">harness</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.harness" title="Permalink to this definition">¶</a></dt>
<dd><p>Harness to run</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.subtestcases">
<code class="descname">subtestcases</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.subtestcases" title="Permalink to this definition">¶</a></dt>
<dd><p>Subtestcases that are identified as part of this (possibly)
a container testcase.</p>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.unit_test_output">
<code class="descname">unit_test_output</code><em class="property"> = None</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.unit_test_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Filename of the output of the unit test case; when we run a
unit testcase, the output does not come from the console
system, as it runs local, but from a local file.</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.configure_00">
<code class="descname">configure_00</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.configure_00" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.patch_tags">
<code class="descname">patch_tags</code><em class="property"> = {}</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.patch_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of tags that we want to add to given test cases; the
key is the name of the testcase – if the testcase name <em>ends</em> with
the same value as in here, then the given list of boolean tags
will be patched as True; eg:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;dir1/subdir2/testcase.ini#testname&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;ignore_faults&#39;</span><span class="p">,</span> <span class="s1">&#39;slow&#39;</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>usually this will be setup in a
<code class="docutils literal"><span class="pre">{/etc/tc,~/.tcf.tcf}/conf_zephy.py</span></code> configuration file as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_zephyr_sanity</span><span class="o">.</span><span class="n">tc_zephyr_sanity_c</span><span class="o">.</span><span class="n">patch_tags</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;tests/legacy/kernel/test_static_idt/testcase.ini#test&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s1">&#39;ignore_faults&#39;</span>
  <span class="p">],</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.patch_hw_requires">
<code class="descname">patch_hw_requires</code><em class="property"> = {}</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.patch_hw_requires" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of <em>hw_requires</em> values that we want to add to given
test cases; the key is the name of the testcase – if the
testcase name <em>ends</em> with the same value as in here, then the
given list of <em>hw_requires</em> will be appended as requirements to
the target; eg:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;dir1/subdir2/testcase.ini#testname&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;fixture_1&#39;</span> <span class="p">],</span>
  <span class="s2">&quot;dir1/subdir2/testcase2.ini#testname&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;fixture_2&#39;</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>usually this will be setup in a
<code class="docutils literal"><span class="pre">{/etc/tc,~/.tcf.tcf}/conf_zephy.py</span></code> configuration file as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc_zephyr_sanity</span><span class="o">.</span><span class="n">tc_zephyr_sanity_c</span><span class="o">.</span><span class="n">patch_hw_requires</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;dir1/subdir2/testcase.ini#testname&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;fixture_1&#39;</span> <span class="p">],</span>
  <span class="s2">&quot;dir1/subdir2/testcase2.ini#testname&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;fixture_2&#39;</span> <span class="p">],</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.schema_get_file">
<em class="property">classmethod </em><code class="descname">schema_get_file</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.schema_get_file" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.schema_get">
<em class="property">classmethod </em><code class="descname">schema_get</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.schema_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.build_00_tc_zephyr">
<code class="descname">build_00_tc_zephyr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.build_00_tc_zephyr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.build_unit_test">
<code class="descname">build_unit_test</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.build_unit_test" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a Zephyr Unit Test in the local machine</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.eval_50">
<code class="descname">eval_50</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.eval_50" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.data_harvest">
<em class="property">classmethod </em><code class="descname">data_harvest</code><span class="sig-paren">(</span><em>domain</em>, <em>name</em>, <em>regex</em>, <em>main_trigger_regex=None</em>, <em>trigger_regex=None</em>, <em>origin=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.data_harvest" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure a data harverster</p>
<p>After a Zephyr sanity check is executed succesfully, the
output of each target is examined by the data harvesting
engine to extract data to store in the database with
<a class="reference internal" href="#tcfl.tc.tc_c.report_data" title="tcfl.tc.tc_c.report_data"><code class="xref py py-meth docutils literal"><span class="pre">tcfl.tc.tc_c.report_data()</span></code></a>.</p>
<p>The harvester is a very simple state machine controlled by up
to three regular expressions whose objective is to extract a
value, that will be reported to the datase as a
domain/name/value triad.</p>
<p>A domain groups together multiple name/value pairs that are
related (for example, latency measurements).</p>
<p>Each line of output will be matched by each of the entries
registered with this function.</p>
<p>All arguments (except for <em>origin</em>) will expand ‘%(FIELD)s’
with values taken from the target’s keywords
(<a class="reference internal" href="#tcfl.tc.target_c.kws" title="tcfl.tc.target_c.kws"><code class="xref py py-data docutils literal"><span class="pre">tcfl.tc.target_c.kws</span></code></a>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>domain</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – to which domain this measurement applies
(eg: “Latency Benchmark %(type)s”);
It is recommended this is used to aggregate values to
different types of targets.</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the value  (eg: “context switch
(microseconds)”)</li>
<li><strong>regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – regular expression to match against each
line of the target’s output. A Python regex
‘(?P&lt;value&gt;SOMETHING)` has to be used to point to the value
that has to be extracted (eg: “context switch time
(?P&lt;value&gt;[0-9]+) usec”).</li>
<li><strong>main_trigger_regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) only look for
<em>regex</em> if this regex has already been found. This trigger
is then considered active for the rest of the output.
This is used to enable searching this if there is a banner
in the output that indicates that the measurements are about
to follow (eg: “Latency Benchmark starts here).</li>
<li><strong>trigger_regex</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) only look for
<em>regex</em> if this regex has already been found. However, once
<em>regex</em> is found, then this trigger is deactivated.
This is useful when the measurements are reported in two
lines:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">measuring</span> <span class="n">context</span> <span class="n">switch</span> <span class="n">like</span> <span class="n">this</span>
<span class="n">measurement</span> <span class="ow">is</span> <span class="n">X</span> <span class="n">usecs</span>
</pre></div>
</div>
<p>and thus the regex could catch multiple lines because
another measurement is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">measuring</span> <span class="n">context</span> <span class="n">switch</span> <span class="n">like</span> <span class="n">that</span>
<span class="n">measurement</span> <span class="ow">is</span> <span class="n">X</span> <span class="n">usecs</span>
</pre></div>
</div>
<p>the regex <cite>measurement is (?P&lt;value&gt;[0-9]) usecs</cite> would
catch both, but by giving it a <em>trigger_regex</em> of <cite>measuring
context switch like this</cite>, then it will catch only the
first, as once it is found, the trigger is removed.</p>
</li>
<li><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) where this values are coming
from; if not specified, it will be the call site for the
function.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.subtc_results_valid">
<code class="descname">subtc_results_valid</code><em class="property"> = ('PASS', 'FAIL', 'SKIP')</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.subtc_results_valid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.subtc_regex">
<code class="descname">subtc_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.subtc_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.teardown_subtestcases">
<code class="descname">teardown_subtestcases</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.teardown_subtestcases" title="Permalink to this definition">¶</a></dt>
<dd><p>Given the output of the testcases, parse subtestcases for each target</p>
</dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.teardown">
<code class="descname">teardown</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.teardown" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.clean">
<code class="descname">clean</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.filename_regex">
<code class="descname">filename_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.filename_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.filename_yaml_regex">
<code class="descname">filename_yaml_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.filename_yaml_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.class_result">
<code class="descname">class_result</code><em class="property"> = 0 (0 0 0 0 0)</em><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.class_result" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase">
<em class="property">classmethod </em><code class="descname">is_testcase</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c.is_testcase" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="target-metadata">
<h2>8.4. Target metadata<a class="headerlink" href="#target-metadata" title="Permalink to this headline">¶</a></h2>
<p>Each target has associated a list of metadata, some of them common to
all targets, some of them driver or target type specific that you can
get on the command line with <code class="docutils literal"><span class="pre">tcf</span> <span class="pre">list</span> <span class="pre">-vvv</span> <span class="pre">TARGETNAME</span></code></p>
<div class="section" id="common-metadata">
<h3>8.4.1. Common metadata<a class="headerlink" href="#common-metadata" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><em>id</em> (str): name of the target</p>
</li>
<li><p class="first"><em>fullid</em> (str): Full name of the target that includes the server’s
short name (<em>AKA</em>); <em>SERVERAKA/ID</em>.</p>
</li>
<li><p class="first"><em>TARGETNAME</em> (bool) True</p>
</li>
<li><p class="first"><em>bsp_models</em> (list of str): ways in which the BSPs in a target
(described in the <em>bsps</em> dictionary) can be used.</p>
<p>If a target has more than one BSP, how can they be combined? e.g:</p>
<ul class="simple">
<li>BSP1</li>
<li>BSP2</li>
<li>BSP1+2</li>
<li>BSP1+3</li>
</ul>
<p>would describe that in a target with three BSPs, 1 and 2 can be used
individually or the target can operate using 1+2 or 1+3 together
(but not 3+2 or 1+2+3).</p>
</li>
<li><p class="first"><em>bsps</em> (dictionary of dictionaries keyed by BSP name): describes
each BSP the target contains</p>
<p>A target that is capable of computing (eg: an MCU board vs let’s
say, a toaster) would describe a BSP; each BSP dictionary contains
the following keys:</p>
<ul class="simple">
<li><em>cmdline</em> (str): [QEMU driver] command line used to boot a QEMU
target</li>
<li><em>zephyr_board</em> (str): [Zephyr capable targets] identifier to use
for building Zephyr OS applications for this board as the <em>BOARD</em>
parameter to the Zephyr build process.</li>
<li><em>zephyr_kernelname</em> (str): [Zephyr capable targets] name of the
file to use as Zephyr image resulting from the Zephyr OS build
process.</li>
<li><em>sketch_fqbn</em> (str): [Sketch capable targets] identifier to use
for building Arduino applications for this board.</li>
<li><em>sketch_kernelname</em> (str): [Sketch capable targets] name of the
file to use as image resulting from the Sketch build process.</li>
</ul>
</li>
<li><p class="first"><em>disabled</em> (bool): True if the target is disabled, False otherwise.</p>
</li>
<li><p class="first"><em>fixture_XYZ</em> (bool): when present and True, the target exposes
feature (or a test fixture) named XYZ</p>
</li>
<li><p class="first"><em>interconnects</em> (dictionary of dictionaries keyed by interconnect
name):</p>
<p>When a target belongs to an interconnect, there will be an entry
here naming the interconnect. Note the interconnect might be in
another server, not necessarily in the same server as the target is.</p>
<p>Each interconnect might have the following (or other fields) with
address assignments, etc:</p>
<ul class="simple">
<li><em>bt_addr</em> (str): Bluetooth Address (48bits HH:HH:HH:HH:HH:HH,
where HH are two hex digits) that will be assigned to this target
in this interconnect (when describing a Bluetooth interconnect)</li>
<li><em>mac_addr</em> (str): Ethernet Address (48bits HH:HH:HH:HH:HH:HH,
where HH are two hex digits) that will be assigned to this target
in this interconnect (when describing ethernet or similar
interconnects)</li>
<li><em>ipv4_addr</em> (str): IPv4 Address (32bits, DDD.DDD.DDD.DDD, where
DDD are decimal integers 0-255) that will be assigned to this
target in this interconnect</li>
<li><em>ipv4_prefix_len</em> (int): length in bits of the network portion of
the IPv4 address</li>
<li><em>ipv6_addr</em> (str): IPv6 Address (128bits, standard ipv6 colon
format) that will be assigned to this target in this interconnect</li>
<li><em>ipv4_prefix_len</em> (int): length in bits of the network portion of
the IPv6 address</li>
</ul>
</li>
<li><p class="first"><em>idle_poweroff</em> (int): seconds the target will be idle before the
system will automatically power it off (if 0, it will never be
powered off).</p>
</li>
<li><p class="first"><em>interfaces</em> (list of str): list of interface names</p>
</li>
<li><p class="first"><em>interfaces_names</em> (str): list of interface names as a single string
separated by spaces</p>
</li>
<li><p class="first"><em>mutex</em> (str): who is the current owner of the target</p>
</li>
<li><p class="first"><em>owner</em> (str): who is the current owner of the target</p>
</li>
<li><p class="first"><em>path</em> (str): path where the target state is maintained</p>
</li>
<li><p class="first"><em>things</em> (list of str): list of names of targets that can be
plugged/unplugged to/from this target.</p>
</li>
<li><p class="first"><em>type</em> (str): type of the target</p>
</li>
</ul>
</div>
<div class="section" id="interface-specific-metadata">
<h3>8.4.2. Interface specific metadata<a class="headerlink" href="#interface-specific-metadata" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><em>consoles</em> (list of str): [console interface] names of serial
consoles supported by the target</li>
<li><em>debug-BSP-gdb-tcp-port</em> (int): [debug interface] TCF port on which
to reach a GDB remote stub for the given BSP (depending on target
capability).</li>
<li><em>images-TYPE-QUALIFIER</em> (str): [imaging interface] File name of
image that was flashed of a given type and qualifier; eg
<em>images-kernel-arc</em> with a value of
<em>/var/cache/ttbd-production/USERNAME/somefile.elf</em> was an image
flashed as a kernel for architecture ARC).</li>
<li><em>openocd.path</em> (str): [imaging interface] path of the OpenOCD
implementation being used</li>
<li><em>openocd.pid</em> (unsigned): [imaging interface] PID of the OpenOCD
process driving this target</li>
<li><em>openocd.port</em> (unsigned): [imaging interface] Base TCP port where
we can connect to the OpenOCD process driving this target</li>
<li><em>powered</em> (bool): [power control interface] True if the target is
powered up, False otherwise.</li>
<li><em>power_state</em> (bool): [power control interface] ‘on’ if the target
is powered up, ‘off’ otherwise. (FIXME: this has to be unified with
<em>powered</em>)</li>
</ul>
</div>
<div class="section" id="driver-targe-type-specific-metadata">
<h3>8.4.3. Driver / targe type specific metadata<a class="headerlink" href="#driver-targe-type-specific-metadata" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><em>hard_recover_rest_time</em> (unsigned): [ttbl.tt.tt_flasher driver,
OpenOCD targets] time the target has to be kept off when
power-cycling to recover after a failed reset, reset halt or reset
after power-cycle when flashing.</p>
<p>When the flasher (usually OpenOCD) cannot make the target comply,
the driver will power cycle it to try to get it to a well known
state.</p>
</li>
<li><p class="first"><em>linux</em> (bool): True if this is a target that runs linux</p>
</li>
<li><p class="first"><em>quark_se_stub</em> (bool): FIXME: DEPRECATED</p>
</li>
<li><p class="first"><em>qemu_bios_image</em> (str): [QEMU driver] file name used for the
target’s BIOS (depending on configuration)</p>
</li>
<li><p class="first"><em>qemu_ro_image</em> (str): [QEMU driver] file name used for the target’s
read-only image (depending on configuration)</p>
</li>
<li><p class="first"><em>qemu-image-kernel-ARCH</em> (str): [QEMU driver] file used as a kernel to
boot a QEMU target (depending on configuration)</p>
</li>
<li><p class="first"><em>qemu-cmdline-ARCH</em> (str): [QEMU driver] command line used to launch
the QEMU process implementing the target (depending on configuration)</p>
</li>
<li><p class="first"><em>ifname</em> (str): [QEMU driver / SLIP] interface created to hookup the
SLIP networking tun/tap into the vlan to connect to external
networks or other VMs [FIXME: make internal]</p>
</li>
<li><p class="first"><em>slow_flash_factor</em> (int): [[ttbl.tt.tt_flasher driver, OpenOCD
targets] amount to scale up the timeout to flash into an OpenOCD
capable target. Some targets have a slower flashing interface and
need more time.</p>
</li>
<li><p class="first"><em>tunslip-ARCH-pid</em> (int): [QEMU driver] PID of the process
implementing tunslip for a QEMU target.</p>
</li>
<li><p class="first"><em>ram_megs</em> (int): Megs of RAM supported by the target</p>
</li>
<li><p class="first"><em>ssh_client</em> (bool): True if the target supports SSH</p>
</li>
</ul>
</div>
</div>
<div class="section" id="module-conf_00_lib">
<span id="ttbd-configuration-api-for-targets"></span><h2>8.5. <em>ttbd</em> Configuration API for targets<a class="headerlink" href="#module-conf_00_lib" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="conf_00_lib.arduino101_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">arduino101_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>fs2_serial=None</em>, <em>serial_port=None</em>, <em>ykush_url=None</em>, <em>ykush_serial=None</em>, <em>variant=None</em>, <em>openocd_path='/opt/zephyr-sdk-0.9.3/sysroots/x86_64-pokysdk-linux/usr/bin/openocd'</em>, <em>openocd_scripts='/opt/zephyr-sdk-0.9.3/sysroots/x86_64-pokysdk-linux/usr/share/openocd/scripts'</em>, <em>debug=False</em>, <em>build_only=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.arduino101_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an Arduino 101 for the fixture described below</strong></p>
<p>This Arduino101 fixture includes a Flyswatter2 JTAG which allows
flashing, debugging and a YKUSH power switch for power control.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">arduino101_add</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;arduino101-NN&quot;</span><span class="p">,</span>
  <span class="n">fs2_serial</span> <span class="o">=</span> <span class="s2">&quot;arduino101-NN-fs2&quot;</span><span class="p">,</span>
  <span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-arduino101-NN&quot;</span><span class="p">,</span>
  <span class="n">ykush_url</span> <span class="o">=</span> <span class="s2">&quot;http://USER:PASSWORD@HOST/SOCKET&quot;</span><span class="p">,</span>
  <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/arduino101-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>fs2_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the FlySwatter2 (defaults
to <em>TARGETNAME-fs2</em></li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port  (defaults to
<code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>)</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub.</li>
<li><strong>ykush_url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>(optional) URL for the DLWPS7 power controller
to the YKUSH. If <em>None</em>, the YKUSH is considered always on. See
<a class="reference internal" href="#conf_00_lib.dlwps7_add" title="conf_00_lib.dlwps7_add"><code class="xref py py-func docutils literal"><span class="pre">dlwps7_add()</span></code></a>.</p>
<p>FIXME: take a PC object so something different than a DLWPS7 can be
used.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>To power on the target, first we power the YKUSH, then the
Flyswatter, then the serial port and then the board itself. And thus
we need to wait for each part to correctly show up in the system
after we power it up (or power off). Then the system starts OpenOCD
to connect it (via the JTAG) to the board.</p>
<p>Powering on/off the YKUSH is optional, but highly recommended.</p>
<p>See the <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a> for this complicated
setup.</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>an available port on a DLWPS7 power switch (optional)</li>
<li>a Yepkit YKUSH power-switching hub (see bill of materials in
<a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></li>
<li>an Arduino101 (note it must have original firmware; if you need
to reset it, follow <a class="reference internal" href="04-HOWTOs.html#a101-fw-upgrade"><span class="std std-ref">these instructions</span></a>).</li>
<li>a USB A-Male to B-female for power to the Arduino 101</li>
<li>a USB-to-TTL serial cable for the console (power)</li>
<li>three M/M jumper cables</li>
<li>A Flyswatter2 for flashing and debugging</li>
</ul>
<ol class="arabic simple" start="3">
<li>Flash a new serial number on the Flyswatter2 following the
<a class="reference internal" href="04-HOWTOs.html#fs2-serial-update"><span class="std std-ref">instructions</span></a>.</li>
</ol>
<ul class="simple">
<li>a USB A-Male to B-female for connecting the Flyswatter to the YKush
(power and data)</li>
<li>An ARM-JTAG 20-10 adapter miniboard and flat ribbon cable
(<a class="reference external" href="https://www.olimex.com/Products/ARM/JTAG/ARM-JTAG-20-10/">https://www.olimex.com/Products/ARM/JTAG/ARM-JTAG-20-10/</a>) to
connect the JTAG to the Arduino101’s jtag port.</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the Arduino’s USB port to the YKUSH downstream port 3</li>
<li>Flyswatter2 JTAG:</li>
</ol>
<blockquote>
<div><ol class="loweralpha">
<li><p class="first">connect the USB port to the YKUSH downstream port 1</p>
</li>
<li><p class="first">flash a new serial number on the Flyswatter2 following the
<a class="reference internal" href="04-HOWTOs.html#fs2-serial-update"><span class="std std-ref">instructions</span></a>.</p>
<p>This is needed to distinguish multiple Flyswatter2 JTAGs
connected in the same system, as they all come flashed with
the same number (<em>FS20000</em>).</p>
</li>
<li><p class="first">connect the ARM-JTAG 20-10 adapter cable to the FlySwatter2 and
to the Arduino101.</p>
<p>Note the flat ribbon cable has to be properly aligned; the
red cable indicates pin #1. The board connectors might have a
dot, a number <em>1</em> or some sort of marking indicating where
pin #1 is.</p>
<p>If your ribbon cable has no red cable, just choose one end as
one and align it on both boards to be pin #1.</p>
</li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>connect the USB-to-TTY serial adapter to the YKUSH downstream
port 2</li>
<li>connect the USB-to-TTY serial adapter to the Arduino 101 with the
M/M jumper cables:<ul>
<li>USB FTDI Black (ground) to Arduino101’s serial ground pin</li>
<li>USB FTDI White (RX) to the Arduino101’ TX</li>
<li>USB FTDI Green (TX) to Arduino101’s RX.</li>
<li>USB FTDI Red (power) is left open, it has 5V.</li>
</ul>
</li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>arduino101-NN</em> (where NN is a
number)</li>
<li>Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and run <em>dmesg</em>
for a quick find], see <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a>.</li>
<li>Configure <em>udev</em> to add a name for the serial device that
represents the USB-to-TTY dongle connected to the target so we can
easily find it at <code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Different options for
USB-to-TTY dongles <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">with</span></a> or <a class="reference internal" href="04-HOWTOs.html#usb-tty-sibling"><span class="std std-ref">without</span></a> a USB serial number.</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.a101_dfu_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">a101_dfu_add</code><span class="sig-paren">(</span><em>name</em>, <em>serial_number</em>, <em>ykush_serial</em>, <em>ykush_port_board</em>, <em>ykush_port_serial=None</em>, <em>serial_port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.a101_dfu_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an Arduino 101</strong></p>
<p>This is an Arduino101 fixture that uses an YKUSH hub for power
control, with or without a serial port (via external USB-to-TTY
serial adapter) and requires no JTAG, using DFU mode for
flashing. It allows flashing the BLE core.</p>
<p>Add to a server configuration file (eg:
<code class="docutils literal"><span class="pre">/etc/ttbd-production/conf_10_targets.py:</span></code>):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">a101_dfu_add</span><span class="p">(</span><span class="s2">&quot;a101-NN&quot;</span><span class="p">,</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span> <span class="s2">&quot;YKNNNNN&quot;</span><span class="p">,</span> <span class="n">PORTNUMBER</span><span class="p">,</span>
             <span class="p">[</span><span class="n">ykush_port_serial</span> <span class="o">=</span> <span class="n">PORTNUMBER2</span><span class="p">,]</span>
             <span class="p">[</span><span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-a101-NN&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/arduino101-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the Arduino 101</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub used for power control</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board is connected.</li>
<li><strong>ykush_port_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) number of the YKUSH
downstream port where the board’s serial port is connected. If
not specified, it will be considered there is no serial port.</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the serial port
(defaults to <code class="docutils literal"><span class="pre">/dev/tty-NAME</span></code>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>The Arduino 101 is powered via the USB connector. The Arduino 101
does not export a serial port over the USB connector–applications
loaded onto it might create a USB serial port, but this is not
necessarily so all the time.</p>
<p>Thus, for ease of use this fixture connects an optional external
USB-to-TTY dongle to the TX/RX/GND lines of the Arduino 101 that
allows a reliable serial console to be present.</p>
<p>When the serial dongle is in use, the power rail needs to first
power up the serial dongle and then the board.</p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p>This fixture uses <a class="reference internal" href="#ttbl.tt.tt_dfu" title="ttbl.tt.tt_dfu"><code class="xref py py-class docutils literal"><span class="pre">ttbl.tt.tt_dfu</span></code></a> to implement the target;
refer to it for implementation details.</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>two available ports on an YKUSH power switching hub (serial
<em>YKNNNNN</em>); only one if the serial console will not be used.</li>
<li>an Arduino 101 board</li>
<li>a USB A-Male to micro-B male cable (for board power)</li>
<li>(optional) a USB-to-TTY serial port dongle</li>
<li>(optional) three M/M jumper cables</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>(if not yet connected), connect the YKUSH to the server system
and to power as described in <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></li>
<li>connect the Arduino 101’s USB port to the YKUSH downstream port
<em>PORTNUMBER</em></li>
<li>(if a serial console will be connected) connect the USB-to-TTY
serial adapter to the YKUSH downstream port <em>PORTNUMBER2</em></li>
</ol>
<ol class="arabic simple" start="3">
<li>(if a serial console will be connected) connect the USB-to-TTY
serial adapter to the Arduino 101 with the M/M jumper cables:<ul>
<li>USB FTDI Black (ground) to Arduino 101’s serial ground pin
(fourth pin from the bottom)</li>
<li>USB FTDI White (RX) to the Arduino 101’s TX.</li>
<li>USB FTDI Green (TX) to Arduino 101’s RX.</li>
<li>USB FTDI Red (power) is left open, it has 5V.</li>
</ul>
</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic">
<li><p class="first">Choose a name for the target: <em>a101-NN</em> (where NN is a number)</p>
</li>
<li><p class="first">(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a>.</p>
</li>
<li><p class="first">Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a>.</p>
<p>Note these boards, when freshly plugged in, will only stay in
DFU mode for <em>five seconds</em> and then boot Zephyr (or whichever
OS they have), so the USB device will dissapear. You need to
run the lsusb or whichever command you are using quick (or
monitor the kernel output with <em>dmesg -w</em>).</p>
</li>
<li><p class="first">Configure <em>udev</em> to add a name for the serial device that
represents the USB-to-TTY dongle connected to the target so we can
easily find it at <code class="docutils literal"><span class="pre">/dev/tty-a101-NN</span></code>. Different options for
USB-to-TTY dongles <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">with</span></a> or <a class="reference internal" href="04-HOWTOs.html#usb-tty-sibling"><span class="std std-ref">without</span></a> a USB serial number.</p>
</li>
<li><p class="first">Add to the configuration file (eg:
<code class="docutils literal"><span class="pre">/etc/ttbd-production/conf_10_targets.py</span></code>):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">a101_dfu_add</span><span class="p">(</span><span class="s2">&quot;a101-NN&quot;</span><span class="p">,</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span> <span class="s2">&quot;YKNNNNN&quot;</span><span class="p">,</span> <span class="n">PORTNUMBER</span><span class="p">,</span>
             <span class="n">ykush_port_serial</span> <span class="o">=</span> <span class="n">PORTNUMBER2</span><span class="p">,</span>
             <span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-a101-NN&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.esp32_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">esp32_add</code><span class="sig-paren">(</span><em>name</em>, <em>serial_number</em>, <em>ykush_serial</em>, <em>ykush_port_board</em>, <em>serial_port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.esp32_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an ESP-32 MCU board</strong></p>
<p>The ESP-32 is an Tensillica based MCU, implementing two Xtensa
CPUs. This fixture uses an YKUSH hub for power control with a
serial power over the USB cable which is also used to flash using
<code class="docutils literal"><span class="pre">esptool.py</span></code> from the ESP-IDF framework.</p>
<p>See instructions in <a class="reference internal" href="#ttbl.tt.tt_esp32" title="ttbl.tt.tt_esp32"><code class="xref py py-class docutils literal"><span class="pre">ttbl.tt.tt_esp32</span></code></a> to install and
configure prerequisites in the server.</p>
<p>Add to a server configuration file (eg:
<code class="docutils literal"><span class="pre">/etc/ttbd-production/conf_10_targets.py:</span></code>):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">esp32_add</span><span class="p">(</span><span class="s2">&quot;esp32-NN&quot;</span><span class="p">,</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span> <span class="s2">&quot;YKNNNNN&quot;</span><span class="p">,</span> <span class="n">PORTNUMBER</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/esp32-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the <em>esp32</em></li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub used for power control</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board is connected.</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the serial port
(defaults to <code class="docutils literal"><span class="pre">/dev/tty-NAME</span></code>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>The ESP32 offers the same USB connector for serial port and flashing.</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>one available port on an YKUSH power switching hub (serial
<em>YKNNNNN</em>)</li>
<li>an ESP32 board</li>
<li>a USB A-Male to micro-B male cable</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>(if not yet connected), connect the YKUSH to the server system
and to power as described in <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></li>
<li>connect the esp32’s USB port to the YKUSH downstream port
<em>PORTNUMBER</em></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic" start="0">
<li><p class="first">See instructions in <a class="reference internal" href="#ttbl.tt.tt_esp32" title="ttbl.tt.tt_esp32"><code class="xref py py-class docutils literal"><span class="pre">ttbl.tt.tt_esp32</span></code></a> to install and
configure prerequisites in the server.</p>
</li>
<li><p class="first">Choose a name for the target: <em>esp32-NN</em> (where NN is a number)</p>
</li>
<li><p class="first">(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a>.</p>
</li>
<li><p class="first">Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a>.</p>
<p>Note these boards usually have a serial number of <em>001</em>; it can
be updated easily to a unique serial number following
<a class="reference internal" href="04-HOWTOs.html#cp210x-serial-update"><span class="std std-ref">these steps</span></a>.</p>
</li>
<li><p class="first">Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</p>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.mv_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">mv_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>fs2_serial=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>ykush_port_serial=None</em>, <em>openocd_path='/opt/zephyr-sdk-0.9.3/sysroots/x86_64-pokysdk-linux/usr/bin/openocd'</em>, <em>openocd_scripts='/opt/zephyr-sdk-0.9.3/sysroots/x86_64-pokysdk-linux/usr/share/openocd/scripts'</em>, <em>debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.mv_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a Quark D2000 for the fixture described below.</strong></p>
<p>The Quark D2000 development board includes a Flyswatter2 JTAG which allows
flashing, debugging; it requires two upstream connections to
a YKUSH power-switching hub for power and JTAG and another for serial
console.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mv_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mv-NN&quot;</span><span class="p">,</span>
       <span class="n">fs2_serial</span> <span class="o">=</span> <span class="s2">&quot;mv-NN-fs2&quot;</span><span class="p">,</span>
       <span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-mv-NN&quot;</span><span class="p">,</span>
       <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
       <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N1</span><span class="p">,</span>
       <span class="n">ykush_port_serial</span> <span class="o">=</span> <span class="n">N2</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/mv-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>fs2_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the FlySwatter2 (should
be <em>TARGETNAME-fs2</em> [FIXME: default to that]</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port  [FIXME: default to
/dev/tty-TARGETNAME]</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
<li><strong>ykush_port_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board’s serial port is connected.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>The Quark D2000 board comes with a builtin JTAG / Flyswatter, whose
port can be programmed. The serial port is externally provided via a
USB-to-TTY dongle.</p>
<p>However, because of this, to power the test target up the power rail
needs to first power up the serial dongle and then the board. There
is a delay until the internal JTAG device we can access it, thus we
need a delay before the system starts OpenOCD to connect it (via the
JTAG) to the board.</p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>two available ports on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
<li>a Quark D2000 reference board</li>
<li>a USB A-Male to micro-B male cable (for board power)</li>
<li>a USB-to-TTY serial port dongle</li>
<li>three M/M jumper cables</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the Quark D2000’s USB-ATP port with the USB A-male to
B-micro to YKUSH downstream port <em>N1</em> for powering the board</li>
<li>connect the USB-to-TTY serial adapter to the YKUSH downstream
port <em>N2</em></li>
<li>connect the USB-to-TTY serial adapter to the Quark D2000 with the
M/M jumper cables:<ul>
<li>USB FTDI Black (ground) to board’s serial ground pin</li>
<li>USB FTDI White (RX) to the board’s serial TX ping</li>
<li>USB FTDI Green (TX) to board’s serial RX pin</li>
<li>USB FTDI Red (power) is left open, it has 5V.</li>
</ul>
</li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>mv-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a>.</li>
<li>Flash a new serial number on the Flyswatter2 following the
<a class="reference internal" href="04-HOWTOs.html#fs2-serial-update"><span class="std std-ref">instructions</span></a>.</li>
<li>Configure <em>udev</em> to add a name for the serial device that
represents the USB-to-TTY dongle connected to the target so we can
easily find it at <code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Different options for
USB-to-TTY dongles <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">with</span></a> or <a class="reference internal" href="04-HOWTOs.html#usb-tty-sibling"><span class="std std-ref">without</span></a> a USB serial number.</li>
</ol>
<ol class="arabic simple" start="6">
<li>Ensure the board is flashed with the Quark D2000 ROM (as
described <a class="reference internal" href="04-HOWTOs.html#fw-update-d2000"><span class="std std-ref">here</span></a>).</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.nrf5x_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">nrf5x_add</code><span class="sig-paren">(</span><em>name</em>, <em>serial_number</em>, <em>family</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/usr/bin/openocd'</em>, <em>openocd_scripts='/usr/share/openocd/scripts'</em>, <em>debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.nrf5x_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a NRF51 board for the fixture described below</strong></p>
<p>The NRF51 is an ARM M0-based development board. Includes a builting
JTAG which allows flashing, debugging; it only requires one upstream
connection to a YKUSH power-switching hub for power, serial console
and JTAG.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">frdm_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;nrf51-NN&quot;</span><span class="p">,</span>
         <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
         <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
         <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/nrf51-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the board</li>
<li><strong>family</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Family of the board (<em>nrf51_blenano</em>,
<em>nrf51_pca10028</em>, <em>nrf52840_pca10056</em>, <em>nrf52_blenano2</em>,
<em>nrf52_pca10040</em>)</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the serial port, which
defaults to <code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>.</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>a nrf51 board</li>
<li>a USB A-Male to micro-B male cable (for board power, JTAG and console)</li>
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the FRDM’s USB port with the USB A-male to B-micro to
YKUSH downstream port <em>N</em></li>
<li>ensure the battery is disconnected</li>
</ol>
<ol class="arabic simple" start="2">
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>nrf51-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a>.</li>
<li>Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></li>
<li>Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.frdm_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">frdm_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/usr/bin/openocd'</em>, <em>openocd_scripts='/usr/share/openocd/scripts'</em>, <em>debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.frdm_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a FRDM board for the fixture described below</strong></p>
<p>The FRDM k64f is an ARM-based development board. Includes a builting
JTAG which allows flashing, debugging; it only requires one upstream
connection to a YKUSH power-switching hub for power, serial console
and JTAG.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">frdm_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;frdm-NN&quot;</span><span class="p">,</span>
         <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
         <span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-frdm-NN&quot;</span><span class="p">,</span>
         <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
         <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/frdm-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the FRDM board</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port  [FIXME: default to
/dev/tty-TARGETNAME]</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>a FRDM k64f board</li>
<li>a USB A-Male to micro-B male cable (for board power, JTAG and console)</li>
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the FRDM’s OpenSDA port with the USB A-male to B-micro to
YKUSH downstream port <em>N</em></li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>frdm-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a>.</li>
<li>Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></li>
<li>Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Ugly magic here. The FRDMs sometimes boot into some bootloader
upload mode (with a different USB serial number) from which the
only way to get them out is by power-cycling it.</p>
<p>So the power rail for this thing is set with a Power Controller
object that does the power cycle itself (pc_board) and then
another that looks for a USB device with the right serial number
(serial_number). If it fails to find it, it executes an action
and waits for it to show up. The action is power cycling the USB
device with the pc_board power controller. Lastly, in the power
rail, we have the glue that opens the serial ports to the device
and the flasher object that start/stops OpenOCD.</p>
<p class="last">Yup, I dislike computers too.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.arduino2_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">arduino2_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.arduino2_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an Arduino Due board for the fixture described below</strong></p>
<p>The Arduino Due an ARM-based development board. Includes a builtin
flasher that requires the bossac tool. Single wire is used for
flashing, serial console and power.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">arduino2_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;arduino2-NN&quot;</span><span class="p">,</span>
             <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
             <span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-arduino2-NN&quot;</span><span class="p">,</span>
             <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
             <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/arduino2-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the board</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port (defaults to
/dev/tty-TARGETNAME).</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>an Arduino Due board</li>
<li>a USB A-Male to micro-B male cable (for board power, flashing
and console)</li>
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the Arduino Due’s OpenSDA (?) port with the USB A-male
to B-micro to YKUSH downstream port <em>N</em></li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>arduino2-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a>.</li>
<li>Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></li>
<li>Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.ma_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">ma_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/opt/zephyr-sdk-0.9.3/sysroots/x86_64-pokysdk-linux/usr/bin/openocd'</em>, <em>openocd_scripts='/opt/zephyr-sdk-0.9.3/sysroots/x86_64-pokysdk-linux/usr/share/openocd/scripts'</em>, <em>debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.ma_add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="conf_00_lib.quark_c1000_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">quark_c1000_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/opt/zephyr-sdk-0.9.3/sysroots/x86_64-pokysdk-linux/usr/bin/openocd'</em>, <em>openocd_scripts='/opt/zephyr-sdk-0.9.3/sysroots/x86_64-pokysdk-linux/usr/share/openocd/scripts'</em>, <em>debug=False</em>, <em>variant='qc10000_crb'</em>, <em>target_type='ma'</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.quark_c1000_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a Quark C1000 for the fixture described below</strong></p>
<p>The Quark C1000 development board has a built-in JTAG which allows
flashing, debugging, thus it only requires an upstream connection
to a YKUSH power-switching hub for power, serial console and JTAG.</p>
<p>This board has a USB serial number and should not require any
flashing of the USB descriptors for setup.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">quark_c1000_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;qc10000-NN&quot;</span><span class="p">,</span>
                <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
                <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
                <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/qc10000-NN
</pre></div>
</div>
<p>earlier versions of these boards can be added with the <em>ma_add()</em> and
<em>ah_add()</em> versions of this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the Quark C1000 board</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port  [FIXME: default to
/dev/tty-TARGETNAME]</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
<li><strong>variant</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – variant of ROM version and address map as
defined in (FIXME) flasher configuration.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
<li>a Quark C1000 reference board</li>
<li>a USB A-Male to micro-B male cable (for board power, JTAG and console)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the Quark C1000’s FTD_USB port with the USB A-male to
B-micro to YKUSH downstream port <em>N</em></li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic">
<li><p class="first">Choose a name for the target: <em>qc10000-NN</em> (where NN is a number)</p>
</li>
<li><p class="first">(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a>.</p>
</li>
<li><p class="first">Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></p>
</li>
<li><p class="first">Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</p>
<p>Note, <strong>however</strong> that these boards might present two serial
ports to the system, one of which later converts to another
interface. So in order to avoid configuration issues, the right
port has to be explicitly specified with <cite>ENV{ID_PATH} == “*:1.1”</cite>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Force second interface, first is for JTAG/update</span>
<span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;tty&quot;</span><span class="p">,</span> <span class="n">ENV</span><span class="p">{</span><span class="n">ID_SERIAL_SHORT</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;IN0521621&quot;</span><span class="p">,</span>            <span class="n">ENV</span><span class="p">{</span><span class="n">ID_PATH</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;*:1.1&quot;</span><span class="p">,</span>            <span class="n">SYMLINK</span> <span class="o">+=</span> <span class="s2">&quot;tty-TARGETNAME&quot;</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.nios2_max10_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">nios2_max10_add</code><span class="sig-paren">(</span><em>name</em>, <em>device_id</em>, <em>serial_port_serial_number</em>, <em>pc_board</em>, <em>serial_port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.nios2_max10_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an Altera MAX10 NIOS-II</strong></p>
<p>The <a class="reference external" href="https://www.altera.com/products/fpga/max-series/max-10/overview.html">Altera MAX10</a>
is used to implement a NIOS-II CPU; it has a serial port, JTAG for
flashing and power control.</p>
<p>The USB serial port is based on a FTDI chipset with a serial
number, so it requires no modification. However, the JTAG
connector has no serial number and can be addressed only path.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">nios2_max10_add</span><span class="p">(</span><span class="s2">&quot;max10-NN&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CABLEID&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
                <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://admin:1234@HOST/PORT&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/max10-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>cableid</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>identification of the JTAG for the board; this
can be determined using the <em>jtagconfig</em> tool from the Quartus
Programming Tools; make sure only a single board is connected to
the system and powered on and run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ jtagconfig
1) USB-BlasterII [2-2.1]
  031050DD   10M50DA(.|ES)/10M50DC
</pre></div>
</div>
<p>Note <em>USB-BlasterII [2-2.1]</em> is the cable ID for said board.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">this cable ID is path dependent. Moving any of the
USB cables (including the upstream hubs), including
changing the ports to which the cables are
connected, will change the <em>cableid</em> and will
require re-configuration.</p>
</div>
</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the serial port of
the MAX10 board.</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port  [defaults to
/dev/tty-TARGETNAME]</li>
<li><strong>pc</strong> (<a class="reference internal" href="#ttbl.tt_power_control_impl" title="ttbl.tt_power_control_impl"><em>ttbl.tt_power_control_impl</em></a>) – power controller to switch
on/off the MAX10 board.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>Altera MAX10 reference board</li>
<li>Altera MAX10 power brick</li>
<li>a USB A-Male to mini-B male cable (for JTAG)</li>
<li>a USB A-Male to mini-B male cable (for UART)</li>
<li>an available power socket in a power controller like the <a class="reference internal" href="#ttbl.pc.dlwps7" title="ttbl.pc.dlwps7"><code class="xref py py-class docutils literal"><span class="pre">Digital</span>
<span class="pre">Loggers</span> <span class="pre">Web</span> <span class="pre">Power</span> <span class="pre">Switch</span></code></a></li>
<li>two USB ports leading to the server</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the power brick to the MAX10 board</li>
<li>connect the power plug to port N of the power controller
POWERCONTROLLER</li>
<li>connect a USB cable to the UART connector in the MAX10; connect
to the server</li>
<li>connect a USB cable to the JTAG connector in the MAX10; connect
to the server</li>
<li>ensure the DIP SW2 (back of board) are all OFF except for 3
that has to be on and that J7 (front of board next to coaxial
connectors) is open.</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic">
<li><p class="first">Ensure the system is setup for MAX10 boards:</p>
<ul class="simple">
<li>Setup <a class="reference internal" href="#ttbl.tt.tt_max10.quartus_path" title="ttbl.tt.tt_max10.quartus_path"><code class="xref py py-data docutils literal"><span class="pre">ttbl.tt.tt_max10.quartus_path</span></code></a></li>
<li>Setup <a class="reference internal" href="#ttbl.tt.tt_max10.input_sof" title="ttbl.tt.tt_max10.input_sof"><code class="xref py py-data docutils literal"><span class="pre">ttbl.tt.tt_max10.input_sof</span></code></a></li>
</ul>
</li>
<li><p class="first">Choose a name for the target: <em>max10-NN</em> (where NN is a number)</p>
</li>
<li><p class="first">Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>; e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;tty&quot;</span><span class="p">,</span> <span class="n">ENV</span><span class="p">{</span><span class="n">ID_SERIAL_SHORT</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;AC0054PT&quot;</span><span class="p">,</span>            <span class="n">SYMLINK</span> <span class="o">+=</span> <span class="s2">&quot;tty-max10-46&quot;</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.nucleo_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">nucleo_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/usr/bin/openocd'</em>, <em>openocd_scripts='/usr/share/openocd/scripts'</em>, <em>debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.nucleo_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure an Nucleo F10 board for the fixture described below</strong></p>
<p>The Nucleo F10 is an ARM-based development board. Includes a
builting JTAG which allows flashing, debugging; it only requires
one upstream connection to a YKUSH power-switching hub for power,
serial console and JTAG.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">nucleo_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;nucleo-NN&quot;</span><span class="p">,</span>
           <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
           <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
           <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/nucleo-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the board</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port (defaults to
/dev/tty-TARGETNAME).</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>a Nucleo F10 board</li>
<li>a USB A-Male to micro-B male cable (for board power, flashing
and console)</li>
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the Nucleo F10’s micro USB port with the USB A-male
to B-micro to YKUSH downstream port <em>N</em></li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>nucleo-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a>.</li>
<li>Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></li>
<li>Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.ykush_targets_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">ykush_targets_add</code><span class="sig-paren">(</span><em>ykush_serial</em>, <em>pc_url</em>, <em>powered_on_start=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.ykush_targets_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Given the <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">serial number</span></a> for an YKUSH
hub connected to the system, set up a number of targets to
manually control it.</p>
<ul class="simple">
<li>(maybe) one target to control the whole hub</li>
<li>One target per port <em>YKNNNNN-1</em> to <em>YKNNNNN-3</em> to control the three
ports individually; this is used to debug powering up different
parts of a target.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ykush_targets_add</span><span class="p">(</span><span class="s2">&quot;YK34567&quot;</span><span class="p">,</span> <span class="s2">&quot;http://USER:PASSWD@HOST/4&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/YK34567
local/YK34567-base
local/YK34567-1
local/YK34567-2
local/YK34567-3
</pre></div>
</div>
<p>To use then the YKUSH hubs as power controllers, create instances of
<a class="reference internal" href="#ttbl.pc_ykush.ykush" title="ttbl.pc_ykush.ykush"><code class="xref py py-class docutils literal"><span class="pre">ttbl.pc_ykush.ykush</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">pc_ykush</span><span class="o">.</span><span class="n">ykush</span><span class="p">(</span><span class="s2">&quot;YK34567&quot;</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
</pre></div>
</div>
<p>where <em>PORT</em> is 1, 2 or 3.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB Serial Number of the hub
(<a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">finding</span></a>).</li>
<li><strong>pc_url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>Power Control URL</p>
<ul>
<li>A DLPWS7 URL (<a class="reference internal" href="#ttbl.pc.dlwps7" title="ttbl.pc.dlwps7"><code class="xref py py-class docutils literal"><span class="pre">ttbl.pc.dlwps7</span></code></a>), if given, will create a
target <em>YKNNNNN</em> to power on or off the whole hub and wait for it
to connect to the system.<p>It will also create one called <em>YKNNNN-base</em> that allows to power
it off or on, but will not wait for the USB device to show up in
the system (useful for poking the power control to the hub when it
is failing to connect to the system)</p>
</li>
<li>If None, no power control targets for the whole hub will be
created. It will just be expected the hub is connected permanently
to the system.</li>
</ul>
</li>
<li><strong>powered_on_start</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – <p>what to do with the power on the
downstream ports:</p>
<ul>
<li><em>None</em>: leave them as they are</li>
<li><em>False</em>: power them off</li>
<li><em>True</em>: power them on</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Bill of materials</strong></p>
<ul>
<li><p class="first">YKUSH hub and it’s <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">serial number</span></a></p>
<p>Note the hub itself has no serial number, but an internal device
connected to its downstream port number 4 does have the <em>YK34567</em>
serial number.</p>
</li>
<li><p class="first">a male to mini-B male cable for power</p>
</li>
<li><p class="first">a USB brick for power</p>
<ul class="simple">
<li>(optional) a DLWPS7 power switch to control the hub’s power</li>
<li>or an always-on connection to a power plug</li>
</ul>
</li>
<li><p class="first">a male to micro-B male cable for upstream USB connectivity</p>
</li>
<li><p class="first">an upstream USB B-female port to the server (in a hub or root hub)</p>
</li>
</ul>
<p>Note the <em>YKNNNNN</em> targets are always tagged <em>idle_poweroff = 0</em>
(so they are never automatically powered off) but not
<em>skip_cleanup</em>; the later would never release them when idle and
if a recovery fails somewhere, then none would be able to
re-acquire it to recover.</p>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.usbrly08b_targets_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">usbrly08b_targets_add</code><span class="sig-paren">(</span><em>serial_number</em>, <em>target_name_prefix=None</em>, <em>power=False</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.usbrly08b_targets_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Set up individual power control targets for each relay of a
<a class="reference external" href="https://www.robot-electronics.co.uk/htm/usb_rly08btech.htm">Devantech USB-RLY08B</a></p>
<p>See below for configuration steps</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB Serial Number of the relay board
(<a class="reference internal" href="04-HOWTOs.html#usbrly08b-serial-number"><span class="std std-ref">finding</span></a>).</li>
<li><strong>target_name_prefix</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) Prefix for the target
names (which defaults to <em>usbrly08b-SERIALNUMBER-</em>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>A Devantech USB-RLY08B USB relay controller
(<a class="reference external" href="https://www.robot-electronics.co.uk/htm/usb_rly08btech.htm">https://www.robot-electronics.co.uk/htm/usb_rly08btech.htm</a>)</li>
<li>a USB A-Male to B-female to connect it to the server</li>
<li>an upstream USB A-female port to the server (in a hub or root hub)</li>
</ul>
<p><strong>Connecting the relay board to the system</strong></p>
<ol class="arabic simple">
<li>Connect the USB A-Male to the free server USB port</li>
<li>Connect the USB B-Male to the relay board</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a prefix name for the target (eg: <em>re00</em>) or let it be
the default (<em>usbrly08b-SERIALNUMBER</em>).</li>
<li>Find the relay board’s <a class="reference internal" href="04-HOWTOs.html#usbrly08b-serial-number"><span class="std std-ref">serial number</span></a> (<a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">more methods</span></a>)</li>
<li>Ensure the device node for the board is accessible by the user
or groups running the daemon. See
<a class="reference internal" href="#ttbl.usbrly08b.pc" title="ttbl.usbrly08b.pc"><code class="xref py py-class docutils literal"><span class="pre">ttbl.usbrly08b.pc</span></code></a> for details.</li>
</ol>
<ol class="arabic" start="3">
<li><p class="first">To create individual targets to control each individual relay,
add in a configuration file such as
<code class="docutils literal"><span class="pre">/etc/ttbd-production/conf_10_targets.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">usbrly08b_targets_add</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>which yields, after restarting the server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list -a
local/usbrly08b-00023456-01
local/usbrly08b-00023456-02
local/usbrly08b-00023456-03
local/usbrly08b-00023456-04
local/usbrly08b-00023456-05
local/usbrly08b-00023456-06
local/usbrly08b-00023456-07
</pre></div>
</div>
<p>To use the relays as power controllers on a power rail for
another target, create instances of
<a class="reference internal" href="#ttbl.usbrly08b.pc" title="ttbl.usbrly08b.pc"><code class="xref py py-class docutils literal"><span class="pre">ttbl.usbrly08b.pc</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">pc</span><span class="p">(</span><span class="s2">&quot;0023456&quot;</span><span class="p">,</span> <span class="n">RELAYNUMBER</span><span class="p">)</span>
</pre></div>
</div>
<p>where <em>RELAYNUMBER</em> is 1 - 8, which matches the number of the
relay etched on the board.</p>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.emsk_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">emsk_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>brick_url=None</em>, <em>ykush_serial=None</em>, <em>ykush_port=None</em>, <em>openocd_path='/opt/zephyr-sdk-0.9.3/sysroots/x86_64-pokysdk-linux/usr/bin/openocd'</em>, <em>openocd_scripts='/opt/zephyr-sdk-0.9.3/sysroots/x86_64-pokysdk-linux/usr/share/openocd/scripts'</em>, <em>debug=False</em>, <em>model=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.emsk_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure a Synposis EM Starter Kit (EMSK) board configured for a
EM* SOC architecture, with a power brick and a YKUSH USB port
providing power control.</p>
<p>The board includes a builting JTAG which allows flashing,
debugging; it only requires one upstream connection to a YKUSH
power-switching hub for power, serial console and JTAG.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">emsk_add</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;emsk-NN&quot;</span><span class="p">,</span>
         <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
         <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
         <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span>
         <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;emsk7d&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/emsk-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the board</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the serial port (defaults to
/dev/tty-TARGETNAME).</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
<li><strong>brick_url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – URL for the power switch to which the EMSK’s
power brick is connected (this assumes for now you are using a
DLWPS7 for power, so the url witll be in the form
<a class="reference external" href="http://user:password&#64;hostname/port">http://user:password&#64;hostname/port</a>.</li>
<li><strong>model</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <p>SOC model configured in the board with the blue
DIP switches (from <em>emsk7d</em> [default], <em>emsk9d</em>, <em>emsk11d</em>).</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="19%" />
<col width="19%" />
<col width="19%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">DIP1</th>
<th class="head">DIP2</th>
<th class="head">DIP3</th>
<th class="head">DIP4</th>
<th class="head">Model</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>off</td>
<td>off</td>
<td>&#160;</td>
<td>&#160;</td>
<td>em7d</td>
</tr>
<tr class="row-odd"><td>on</td>
<td>off</td>
<td>&#160;</td>
<td>&#160;</td>
<td>em9d</td>
</tr>
<tr class="row-even"><td>off</td>
<td>on</td>
<td>&#160;</td>
<td>&#160;</td>
<td>em11d</td>
</tr>
</tbody>
</table>
<p>(<em>on</em> means DIP down, towards the board)</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>a EM Starter Kit board and its power brick</li>
<li>a USB A-Male to micro-B male cable (for board power, flashing
and console)</li>
<li>one available port on a switchable power hub</li>
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>connect the EMSK’s micro USB port with the USB A-male
to B-micro to YKUSH downstream port <em>N</em></li>
<li>connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></li>
<li>Connect the power brick to the EMSK’s power barrel</li>
<li>Connect the power brick to the available power in the power switch</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>emsk-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a>.</li>
<li>Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></li>
<li>Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the boards’ <em>serial number</em>.</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.dlwps7_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">dlwps7_add</code><span class="sig-paren">(</span><em>hostname</em>, <em>powered_on_start=None</em>, <em>user='admin'</em>, <em>password='1234'</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.dlwps7_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add test targets to individually control each of a DLWPS7’s sockets</p>
<p>The DLWPS7 needs to be setup and configured; this function exposes
the different targets for to expose the individual sockets for debug.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">dlwps7_add</span><span class="p">(</span><span class="s2">&quot;sp6&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/sp6-1
local/sp6-2
local/sp6-3
local/sp6-4
local/sp6-5
local/sp6-6
local/sp6-7
local/sp6-8
</pre></div>
</div>
<p>Power controllers for targets can be implemented instantiating an
<a class="reference internal" href="#ttbl.pc.dlwps7" title="ttbl.pc.dlwps7"><code class="xref py py-class docutils literal"><span class="pre">ttbl.pc.dlwps7</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">pc</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://admin:1234@spM/O&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>where <em>O</em> is the outlet number as it shows in the physical unit and
<em>spM</em> is the name of the power switch.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>hostname</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Hostname of the switch</li>
<li><strong>user</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User name for HTTP Basic authentication</li>
<li><strong>password</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – password for HTTP Basic authentication</li>
<li><strong>powered_on_start</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – <p>what to do with the power on the
downstream ports:</p>
<ul>
<li><em>None</em>: leave them as they are</li>
<li><em>False</em>: power them off</li>
<li><em>True</em>: power them on</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>a DLWPS7 unit and power cable connected to power plug</li>
<li>a network cable</li>
<li>a connection to a network switch to which the server is also
connected (<em>nsN</em>)</li>
</ul>
<p><strong>Connecting the power switch</strong></p>
<ol class="arabic">
<li><p class="first">Ensure you have configured an class C <em>192.168.X.0/24</em>,
configured with static IP addresses, to which maybe only this
server has access to connect IP-controlled power
switches.</p>
<p>Follow <a class="reference internal" href="04-HOWTOs.html#internal-network"><span class="std std-ref">these instructions</span></a> to create a
network.</p>
<p>You might need a new Ethernet adaptor to connect to said
network (might be PCI, USB, etc).</p>
</li>
<li><p class="first">connect the power switch to said network</p>
</li>
<li><p class="first">assign a name to the power switch and add it along its IP
address in <code class="docutils literal"><span class="pre">/etc/hosts</span></code>; convention is to call them <em>spY</em>,
where X is a number and <em>sp</em> stands for <em>Switch; Power</em>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">if your system uses proxies, you need to add <em>spY</em>
also to the <em>no_proxy</em> environment varible in
<code class="file docutils literal"><span class="pre">/etc/bashrc</span></code> to avoid the daemon trying to access the
power switch through the proxy, which will not work.</p>
</div>
</li>
<li><p class="first">with the names <code class="docutils literal"><span class="pre">/etc/hosts</span></code>, refer to the switches by name
rather than by IP address.</p>
</li>
</ol>
<p><strong>Configuring the system</strong></p>
<ol class="arabic">
<li><p class="first">Choose a name for the power switch (<em>spM</em>), where <em>M</em> is a number</p>
</li>
<li><p class="first">The power switch starts with IP address <em>192.168.0.100</em>; it needs
to be changed to <em>192.168.X.M</em>:</p>
<ol class="loweralpha">
<li><p class="first">Connect to <em>nsN</em></p>
</li>
<li><p class="first">Ensure the server access to <em>192.168.0.100</em> by adding this
routing hack:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># ifconfig nsN:2 192.168.0.0/24</span>
</pre></div>
</div>
</li>
<li><p class="first">With lynx or a web browser, from the server, access the
switch’s web control interface:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ lynx http://192.168.0.100
</pre></div>
</div>
</li>
<li><p class="first">Enter the default user <em>admin</em>, password <em>1234</em>, select <em>ok</em>
and indicate <em>A</em> to always accept cookies</p>
</li>
<li><p class="first">Hit enter to refresh link redirecting to
<em>192.168.0.100/index.htm</em>, scroll down to <em>Setup</em> and page down
to <em>IP address</em>.</p>
</li>
<li><p class="first">Lookup setup of IP address, change to <em>192.168.N.M</em> (where <em>x</em>
matches <em>spM</em>), gateway <em>192.168.N.1</em>; hit the <em>submit</em> next to
it.</p>
</li>
<li><p class="first">remove the routing hack:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># ifconfig nsN:2 down</span>
</pre></div>
</div>
</li>
</ol>
<ol class="loweralpha" start="5">
<li><p class="first">Extra steps needed for newer units
(<a class="reference external" href="https://dlidirect.com/products/new-pro-switch">https://dlidirect.com/products/new-pro-switch</a>)</p>
<p>The new refreshed unit looks the same, but has wifi
connectivity and pleny of new features, some of which need
tweaking; login to the setup page again and for each of
this, set the value/s and hit <em>submit</em> before going to the
next one:</p>
<ul>
<li><p class="first">Disable the security lockout</p>
<p><em>Delay&gt; Wrong password lockout</em> set to zero minutes</p>
</li>
<li><p class="first">Turn on setting power after power loss:</p>
<p><em>Power Loss Recovery Mode &gt; When recovering after power
loss</em> select <em>Turn all outlets on</em></p>
</li>
<li><p class="first">Access setings (quite important, as this allows the driver
to access the same way for the previous generation of the
product too):</p>
<p>ENABLE: <em>allow legacy plaintext login methods</em></p>
<p>Note in (3) below it is explained why this is not a
security problem in this kind of deployments.</p>
</li>
</ul>
</li>
</ol>
</li>
<li><p class="first">The unit’s default admin username and password are kept per
original (admin, 1234):</p>
<ul class="simple">
<li>They are deployed in a dedicated network switch that is internal
to the server; none has access but the server users (targets run
on another switch).</li>
<li>they use HTTP Basic Auth, they might as well not use
authentication</li>
</ul>
</li>
<li><p class="first">Add an entry in <code class="docutils literal"><span class="pre">/etc/hosts</span></code> for <em>spM</em> so we can refer to the
DLWPS7 by name instead of IP address:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mf">192.168</span><span class="o">.</span><span class="mf">4.</span><span class="n">X</span>    <span class="n">spM</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="class">
<dt id="conf_00_lib.vlan_pci">
<em class="property">class </em><code class="descclassname">conf_00_lib.</code><code class="descname">vlan_pci</code><a class="headerlink" href="#conf_00_lib.vlan_pci" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Fake power controller to implement networks using macvtap</dt>
<dd><p class="first">for virtual machines and bridges for physical devices.</p>
<p>This behaves as a power control implementation that when turned:</p>
<ul class="simple">
<li>on: starts an internal network a <cite>macvtap
http://virt.kernelnewbies.org/MacVTap</cite> Linux device that allows
virtual machines to talk to each other and to the outside. When
a physical device is also present, it is used as the upper
device (instead of a bridge) so traffic can flow from physical
targets to the virtual machines in the network.</li>
<li>off: stops all the network devices, making communication impossible.</li>
</ul>
<p>This also supports capturing network traffic with <em>tcpdump</em>, which
can be enabled setting the target’s property <em>tcpdump</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf property-set TARGETNAME tcpdump FILENAME
</pre></div>
</div>
<p>this will have the target dump all traffic capture to a file
called <em>FILENAME</em> in the daemon file storage area for the user who
owns the target. The file can then be recovered with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf broker-file-download FILENAME
</pre></div>
</div>
<p><em>FILENAME</em> must be a valid file name, with no directory
components. Note this requires the property <em>tcpdump</em> being listed
in <a class="reference internal" href="#ttbl.test_target.user_properties" title="ttbl.test_target.user_properties"><code class="xref py py-data docutils literal"><span class="pre">ttbl.test_target.user_properties</span></code></a>, which is added after
this class declaration.</p>
<p>Example configuration:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">tt</span><span class="o">.</span><span class="n">tt_power</span><span class="p">(</span><span class="s2">&quot;nw01&quot;</span><span class="p">,</span> <span class="n">vlan_pci</span><span class="p">()),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv6_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;fc00::1:1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv4_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;ipv4_prefix_len&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;mac_addr&#39;</span><span class="p">:</span> <span class="s1">&#39;02:01:01:00:00:24:&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;nw01&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;interconnect_c&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now QEMU targets (for example), can declare they are part of this
network and upon start, create a tap interface for themselves:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ip link add link _bnw01 name tnw01TARGET type macvtap mode bridge
$ ip link set tnw01TARGET address 02:01:00:00:00:IC_INDEX up
</pre></div>
</div>
<p>which then is given to QEMU as an open file descriptor:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">net</span> <span class="n">nic</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="n">virtio</span><span class="p">,</span><span class="n">macaddr</span><span class="o">=</span><span class="mi">02</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="n">IC_INDEX</span>
<span class="o">-</span><span class="n">net</span> <span class="n">tap</span><span class="p">,</span><span class="n">fd</span><span class="o">=</span><span class="n">FD</span>
</pre></div>
</div>
</dd>
</dl>
<p>(<a class="reference internal" href="#conf_00_lib.tt_qemu_linux" title="conf_00_lib.tt_qemu_linux"><code class="xref py py-class docutils literal"><span class="pre">Linux</span></code></a> and
<a class="reference internal" href="#conf_00_lib.tt_qemu_zephyr" title="conf_00_lib.tt_qemu_zephyr"><code class="xref py py-class docutils literal"><span class="pre">Zephyr</span></code></a> VMs already
implement this behaviour).</p>
<blockquote>
<div><p>Notes:</p>
<ul class="simple">
<li>keep target names short, as they will be used to generate
network interface names and those are limited in size (usually to
about 12 chars?), eg tnw01TARGET comes from <em>nw01</em> being the
name of the network target/interconnect, TARGET being the target
connected to said interconnect.</li>
<li>IC_INDEX: is the index of the TARGET in the interconnect/network;
it is recommended, for simplicty to make them match with the mac
address, IP address and target name, so for example:<ul>
<li>targetname: pc-04</li>
<li>ic_index: 04</li>
<li>ipv4_addr: 192.168.1.4</li>
<li>ipv6_addr: fc00::1:4</li>
<li>mac_addr: 02:01:00:00:00:04</li>
</ul>
</li>
</ul>
<p>If a tag named <em>mac_addr</em> is given, containing the MAC address
of a physical interface in the system, then it will be taken over
as the point of connection to external targets. Connectivity from
any virtual machine in this network will be extended to said
network interface, effectively connecting the physical and virtual
targets.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>DISABLE Network Manager’s (or any other network
manager) control of this interface, otherwise it will
interfere with it and network will not operate.</p>
<p class="last">Follow <a class="reference internal" href="04-HOWTOs.html#howto-nm-disable-control"><span class="std std-ref">these steps</span></a></p>
</div>
<p>System setup:</p>
<ul>
<li><dl class="first docutils">
<dt><em>ttbd</em> must be ran with CAP_NET_ADMIN so it can create network</dt>
<dd><p class="first">interfaces. For that, either add to systemd’s
<code class="docutils literal"><span class="pre">/etc/systemd/system/ttbd&#64;.service</span></code>:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">CapabilityBoundingSet</span> <span class="o">=</span> <span class="n">CAP_NET_ADMIN</span>
<span class="n">AmbientCapabilities</span> <span class="o">=</span> <span class="n">CAP_NET_ADMIN</span>
</pre></div>
</div>
</dd>
</dl>
<p>or as root, give ttbd the capability:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># setcap cap_net_admin+pie /usr/bin/ttbd</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>udev</em>’s <em>/etc/udev/rules.d/ttbd-vlan</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;macvtap&quot;</span><span class="p">,</span> <span class="n">ACTION</span> <span class="o">==</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="n">DEVNAME</span> <span class="o">==</span> <span class="s2">&quot;/dev/tap*&quot;</span><span class="p">,</span>             <span class="n">GROUP</span> <span class="o">=</span> <span class="s2">&quot;ttbd&quot;</span><span class="p">,</span> <span class="n">MODE</span> <span class="o">=</span> <span class="s2">&quot;0660&quot;</span>
</pre></div>
</div>
<p>This is needed so the tap devices can be accessed by user
<em>ttbd</em>, which is the user that runs the daemon.</p>
<p>Remember to reload <em>udev</em>’s configuration with <cite>udevadm control
–reload-rules</cite>.</p>
<p>This is already taken care by the RPM installation.</p>
</li>
</ul>
<p><strong>Fixture setup</strong></p>
<ul>
<li><p class="first">Select a network interface to use (it can be a USB or PCI
interface); find out it’s MAC address with <em>ip link show</em>.</p>
</li>
<li><p class="first">add the tag <em>mac_addr</em> with said address to the tags of the
target object that represents the network to which which said
interface is to be connected; for example, for a network called
<em>nwc</em></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
    <span class="n">ttbl</span><span class="o">.</span><span class="n">tt</span><span class="o">.</span><span class="n">tt_power</span><span class="p">(</span><span class="s1">&#39;nwc&#39;</span><span class="p">,</span> <span class="n">vlan_pci</span><span class="p">()),</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">mac_addr</span> <span class="o">=</span> <span class="s2">&quot;a0:ce:c8:00:18:73&quot;</span><span class="p">,</span>
        <span class="n">ipv6_addr</span> <span class="o">=</span> <span class="s1">&#39;fc00::13:1&#39;</span><span class="p">,</span>
        <span class="n">ipv6_prefix_len</span> <span class="o">=</span> <span class="mi">112</span><span class="p">,</span>
        <span class="n">ipv4_addr</span> <span class="o">=</span> <span class="s1">&#39;192.168.13.1&#39;</span><span class="p">,</span>
        <span class="n">ipv4_prefix_len</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;interconnect_c&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or for an existing network (such as the configuration’s default
<em>nwa</em>):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># eth dongle mac 00:e0:4c:36:40:b8 is assigned to NWA</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;nwa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tags_update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">mac_addr</span> <span class="o">=</span> <span class="s1">&#39;00:e0:4c:36:40:b8&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Furthermore, default networks <em>nwa</em>, <em>nwb</em> and <em>nwc</em> are defined
to have a power control rail (versus an individual power
controller), so it is possible to add another power controller
to, for example, power on or off a network switch:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;nwa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pc_impl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://USER:PASSWORD@sp5/8&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This creates a power controller to switch on or off plug #8 on
a Digital Loggers Web Power Switch named <em>sp5</em> and makes it part
of the <em>nwa</em> power control rail. Thus, when powered on, it will
bring the network up up and also turn on the network switch.</p>
</li>
<li><p class="first">lastly, for each target connected to that network, update it’s
tags to indicate it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;TARGETNAME-NN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tags_update</span><span class="p">(</span>
    <span class="p">{</span>
      <span class="s1">&#39;ipv4_addr&#39;</span><span class="p">:</span> <span class="s2">&quot;192.168.10.30&quot;</span><span class="p">,</span>
      <span class="s1">&#39;ipv4_prefix_len&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
      <span class="s1">&#39;ipv6_addr&#39;</span><span class="p">:</span> <span class="s2">&quot;fc00::10:30&quot;</span><span class="p">,</span>
      <span class="s1">&#39;ipv4_prefix_len&#39;</span><span class="p">:</span> <span class="mi">112</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">ic</span> <span class="o">=</span> <span class="s1">&#39;nwc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>By convention, the server is .1, the QEMU Linux virtual machines
are set from .2 to .10 and the QEMU Zephyr virtual machines from
.30 to .45. Physical targets are set to start at 100.</p>
<p>Note the networks for targets and infrastructure <a class="reference internal" href="05-RFAQs.html#separated-networks"><span class="std std-ref">have to be
kept separated</span></a>.</p>
</div></blockquote>
<dl class="method">
<dt id="conf_00_lib.vlan_pci.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.vlan_pci.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="conf_00_lib.vlan_pci.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.vlan_pci.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="conf_00_lib.vlan_pci.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.vlan_pci.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="conf_00_lib.tt_qemu_linux">
<em class="property">class </em><code class="descclassname">conf_00_lib.</code><code class="descname">tt_qemu_linux</code><span class="sig-paren">(</span><em>_id</em>, <em>tags</em>, <em>qemu_cmdline_append=''</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.tt_qemu_linux" title="Permalink to this definition">¶</a></dt>
<dd><p>QEMU x86-64 test target that can run Linux cloud images
(Fedora, Clear and other) with serial port control.</p>
<p>Supports power control, serial console and image flashing
interfaces, as well as networking in between images and to the
upstream host’s network.</p>
<p>Note that the disk assigned to this images is transient,
implemented in a couple of ways:</p>
<ul>
<li><p class="first">if a QCOW image is given, a copy-on-write disk is created when
the machine powers up and then discarded when it powers off. The
original image is never modified. A property (<em>persist</em>) can be
set to non-false to allow keeping the transient disk.</p>
</li>
<li><p class="first">if an ISO image is given, it is considered to be a LIVE image
and a transient disk with serial number TCF-home is created,
that can be used to write to.</p>
<p>TCF provides a Fedora Kickstarter configuration to generate
images that are used for testing:</p>
<ul class="simple">
<li>remove root’s password</li>
<li>autologin the console to a root shell</li>
<li>configure the IP address (if networking is setup)</li>
<li>enable SSH access to the root account with no password</li>
</ul>
</li>
</ul>
<p>Add to your configuration file <code class="docutils literal"><span class="pre">/etc/ttbd-production/conf_10_targets.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
    <span class="n">tt_qemu_linux</span><span class="p">(</span><span class="s2">&quot;qlNAME&quot;</span><span class="p">,</span>
                  <span class="nb">dict</span><span class="p">(</span>
                      <span class="n">ram_megs</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
                      <span class="n">qemu_ro_image</span> <span class="o">=</span> <span class="s1">&#39;/var/lib/ttbd/tcf-live.iso&#39;</span><span class="p">,</span>
                      <span class="n">qemu_bios_image</span> <span class="o">=</span> <span class="s1">&#39;/usr/share/qemu/bios.bin&#39;</span><span class="p">,</span>
                  <span class="p">)),</span>
    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;qemu-linux-TYPE-x86_64&quot;</span><span class="p">,</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">more</span> <span class="n">tags</span><span class="o">...</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Where:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">qemu_ro_image</span></code>: file path of the virtual disk image to use
as base (see below for configuring the image)
Note this has to be given mandatorily to the tt_qemu_linux
constructor, cannot be added after the fact</li>
<li><code class="docutils literal"><span class="pre">qemu_image_size</span></code>: Size in gigs (eg: 10G) of the virtual disk
image size; when the virtual disk image is created referring to
the base, it will be made to be this size.</li>
<li><code class="docutils literal"><span class="pre">qemu_bios_image</span></code>: path the BIOS file to use; depending on
the image, one or another will be needed.</li>
<li><code class="docutils literal"><span class="pre">ram_megs</span></code>: Megabytes of RAM to use; for bigger Linux
distros, you want to start with 1024.</li>
<li><code class="docutils literal"><span class="pre">TYPE</span></code>: <em>fedora</em>, <em>clear</em>, …</li>
<li><code class="docutils literal"><span class="pre">NAME</span></code>: name for the virtual machine; it is recommend to
begin with <em>ql</em> (QEMU Linux) and a letter matching the type
(eg: <em>qlf03</em> for QEMU Linux Fedora #3).</li>
</ul>
</dd>
</dl>
<p>Restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/qlNAME
</pre></div>
</div>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>QEMU installed in the server (<code class="docutils literal"><span class="pre">dnf</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">qemu</span></code>)</li>
<li>(optional) Fedora 25 cloud image deployed to the server’s
<code class="docutils literal"><span class="pre">/var/lib/ttbd</span></code> or any location specified in <em>ro_image</em>.</li>
</ul>
<p><strong>Setting up for the fixture</strong></p>
<p>Note that due to the size of the images, it is not possible to
upload them to the server’s repository using <em>tcf images</em>. They
have to be uploaded to the server via other methods and then the
images can be configured.</p>
<p>To create the <code class="docutils literal"><span class="pre">tcf-live.iso</span></code> image:</p>
<ul>
<li><p class="first">use a Fedora system, with access to any repositories you will
require RPMs from (setup proxies, etc)</p>
</li>
<li><p class="first">create a work directory <em>MYWORKDIR</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ mkdir -p MYWORKDIR
$ cd $MYWORKDIR
</pre></div>
</div>
</li>
<li><p class="first">if any specific RPM packages are needed, create files
<em>tcf-live-ANYNAME.pkgs</em> in <em>MYWORKDIR</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ echo RPM1 &gt; tcf-live-01-list.pkgs
$ echo RPM2 &gt; tcf-live-04-list.pkgs
</pre></div>
</div>
<p>one RPM per line, multiple lines per file, see
<a class="reference download internal" href="../_downloads/tcf-live-02-core.pkgs" download=""><code class="xref download docutils literal"><span class="pre">/usr/share/tcf/live/tcf-live-02-core.pkgs</span></code></a> for examples.</p>
</li>
<li><p class="first">if any extra kickstarter configuration is needed, add in
<em>tcf-live-extra-</em>.ks* files</p>
</li>
<li><p class="first">invoke <em>/usr/share/tcf/live/mk-liveimg.sh</em>, for which you need
<em>sudo</em> rights:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ /usr/share/tcf/live/mk-liveimg.sh .
...
frags = 20
Setting supported flag to 0
</pre></div>
</div>
<p>note this creates a cache in <em>MYWORDIR/tcf-live/cache</em> with
downloaded RPMs and others; if you re-run again from within the
same workdir, the cache will be reused.</p>
</li>
<li><p class="first">Move the image to its default location on /var/lib/ttbd:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ mv tcf-live/tcf-live.iso /var/lib/ttbd/
</pre></div>
</div>
<p>obviously, other names and locations can be used, as long as
they are then configured when invoking <a class="reference internal" href="#conf_00_lib.tt_qemu_linux" title="conf_00_lib.tt_qemu_linux"><code class="xref py py-class docutils literal"><span class="pre">tt_qemu_linux</span></code></a>
with the <em>qemu_ro_image</em> variable</p>
</li>
</ul>
<p><strong>Configuring the system for the fixture</strong></p>
<p>Once the image file <code class="docutils literal"><span class="pre">tcf-live.iso</span></code> has been setup and
distributed to the server, add to each server’s
<code class="docutils literal"><span class="pre">conf_10_targets.py</span></code> configuration files with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
    <span class="n">tt_qemu_linux</span><span class="p">(</span><span class="s2">&quot;qlfNN&quot;</span><span class="p">,</span>
                  <span class="n">tags</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                      <span class="n">ram_megs</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
                      <span class="n">qemu_ro_image</span> <span class="o">=</span> <span class="s1">&#39;/var/lib/ttbd/tcf-live.iso&#39;</span><span class="p">,</span>
                      <span class="n">qemu_bios_image</span> <span class="o">=</span> <span class="s1">&#39;/usr/share/qemu/bios.bin&#39;</span><span class="p">,</span>
                  <span class="p">)),</span>
    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;qemu-linux-fedora-x86_64&quot;</span><span class="p">,</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="o">...</span> <span class="n">more</span> <span class="n">tags</span> <span class="k">as</span> <span class="n">neeed</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note the default location for images is <code class="docutils literal"><span class="pre">/var/lib/ttbd</span></code>, but it
can be anywhere the daemon has access to.</p>
<p><strong>Network configuration</strong></p>
<p>Network is supported in various ways:</p>
<ul>
<li><p class="first">NAT is currently broken!!!</p>
<p>To have the VM connect to the host’s upstream network via NAT,
connect it to the interconnect <em>nat_host</em> (last lines) by adding
a tag <em>nat_host</em> set to <em>True</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tags</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">nat_host</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">))</span>
</pre></div>
</div>
<p>Alternatively, once created:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;qlfNAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_to_interconnect</span><span class="p">(</span><span class="s1">&#39;nat_host&#39;</span><span class="p">,</span> <span class="p">{})</span>
</pre></div>
</div>
<p>The <em>nat_host</em> interconnect, albeit doesn’t really exist, makes
teh <em>tt_qemu_linux</em> class create a network interface that will
be configured to NAT on the upstream connection of the host.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">this will get you potentially to the open Internet
or whatever is available from the host.</p>
</div>
</li>
<li><p class="first">Connecting to <em>ttbd</em> internal test networks is accomplished by
using QEMU and <em>macvtap</em> to a <em>TTBD interconnect</em> as
<a class="reference internal" href="#conf_00_lib.vlan_pci" title="conf_00_lib.vlan_pci"><code class="xref py py-class docutils literal"><span class="pre">vlan_pci</span></code></a> added to any target that supports power
switching.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;qlfNN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_to_interconnect</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;nwXX&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="nb">dict</span><span class="p">(</span><span class="n">ipv4_addr</span> <span class="o">=</span> <span class="s2">&quot;192.168.XX.NN&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>         <span class="n">ipv4_prefix_len</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>         <span class="n">ipv6_addr</span> <span class="o">=</span> <span class="s2">&quot;fc00::X:NN&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>         <span class="n">ipv6_prefix_len</span> <span class="o">=</span> <span class="mi">112</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>         <span class="n">mac_addr</span> <span class="o">=</span> <span class="s2">&quot;02:XX:00:00:00:%NN&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">))</span>
</pre></div>
</div>
<p>For that, the target’s tags need to define in their
interconnects dictionary an entry named after the interconnect’s
name with (eg: to add <em>qlfNAMEXX</em> to interconnect <em>XX</em>, append
after the target definition):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;qlNAMEXX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tags_update</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="nb">dict</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">ipv4_addr</span> <span class="o">=</span> <span class="s2">&quot;192.168.XX.NN&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">ipv4_addr_len</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">ipv6_addr</span> <span class="o">=</span> <span class="s2">&quot;fc00::XX:NN&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">ipv4_addr_len</span> <span class="o">=</span> <span class="mi">112</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">mac_addr</span> <span class="o">=</span> <span class="s2">&quot;02:XX:00:00:00:NN&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ic</span> <span class="o">=</span> <span class="s2">&quot;XX&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>Network number (<em>XX</em>) – try have your networks named in a way
that calls for easy numbering numbered (eg: a -&gt; 10, b -&gt; 11,
c -&gt; 12…)  so those numbers can be used to assign IP
addresses (eg: for letter A, number 10 (0x0A), IPv4 prefix can
be 192.168.X.Y and MAC address prefix can be 02:0A:00:00:00:YY</li>
<li><em>mac_addr</em>: is the MAC address to give the target; note it has
to be different for all targets (so if we use proper network and
target indexes, they shall all end up being different).</li>
</ul>
</li>
</ul>
<p><strong>Troubleshooting notes</strong></p>
<ul class="simple">
<li>If <em>cloud-init</em> seems not to be working, make sure
<code class="docutils literal"><span class="pre">/var/lib/cloud/sem/user-scripts*</span></code> in the image is removed</li>
</ul>
<dl class="method">
<dt id="conf_00_lib.tt_qemu_linux.qemu_preexec_fn">
<code class="descname">qemu_preexec_fn</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.tt_qemu_linux.qemu_preexec_fn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="conf_00_lib.tt_qemu_zephyr">
<em class="property">class </em><code class="descclassname">conf_00_lib.</code><code class="descname">tt_qemu_zephyr</code><span class="sig-paren">(</span><em>id</em>, <em>bsps</em>, <em>tags={}</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.tt_qemu_zephyr" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a QEMU test target that can run Zephyr kernels
and display the output over a serial port.</p>
<p>Supports power control, serial console and image flashing
interfaces.</p>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.sam_xplained_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">sam_xplained_add</code><span class="sig-paren">(</span><em>name=None</em>, <em>serial_number=None</em>, <em>serial_port=None</em>, <em>ykush_serial=None</em>, <em>ykush_port_board=None</em>, <em>openocd_path='/usr/bin/openocd'</em>, <em>openocd_scripts='/usr/share/openocd/scripts'</em>, <em>debug=False</em>, <em>target_type='sam_e70_xplained'</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.sam_xplained_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a SAM E70/V71 boards for the fixture described below</strong></p>
<p>The SAM E70/V71 xplained is an ARM-based development
board. Includes a builtin JTAG which allows flashing, debugging;
it only requires one upstream connection to a YKUSH
power-switching hub for power, serial console and JTAG.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sam_xplained_add</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;sam-e70-NN&quot;</span><span class="p">,</span>
    <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>
    <span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-same70-NN&quot;</span><span class="p">,</span>
    <span class="n">ykush_serial</span> <span class="o">=</span> <span class="s2">&quot;YKXXXXX&quot;</span><span class="p">,</span>
    <span class="n">ykush_port_board</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span>
    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;sam_e70_xplained&quot;</span><span class="p">)</span> <span class="c1"># or sam_v71_xplained</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/sam-e70-NN
local/sam-v71-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the SAM board</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the serial port (defaults to
<code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>)</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub where it is connected to
for power control.</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board power is connected.</li>
<li><strong>target_type</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – the target type “sam_e70_xplained”
or “sam_v71_xplained”</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>a SAM E70 or V71 xplained board</li>
<li>a USB A-Male to micro-B male cable (for board power, JTAG and console)</li>
<li>one available port on an YKUSH power switching hub (serial <em>YKNNNNN</em>)</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic">
<li><p class="first">Ensure the SAM E70 is properly setup:</p>
<p>Using Atmel’s <em>SAM-BA</em> In-system programmer, change the boot
sequence and reset the board in case there is a bad image;
this utility can be also used to recover the board in case
it gets stuck.</p>
<ol class="upperalpha">
<li><p class="first">Download from <a class="reference external" href="http://www.atmel.com/tools/atmelsam-bain-systemprogrammer.aspx">Atmel’s website</a>
(registration needed) and install.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is <strong>not</strong> open source software</p>
</div>
</li>
<li><p class="first">Close the erase jumper <em>erase</em> (in SAMEv70 that’s J200 and
in SAMEv71 it is J202; in both cases, it is located above the
CPU when you rotate the board so you can read the CPU’s
labeling in a normal orientation).</p>
</li>
<li><p class="first">Connect the USB cable to the taget’s <em>target USB</em> port (the
one next to the Ethernet connector) and to a USB port that
is known to be powered on.</p>
<p>Ensure power is on by verifying the orange led lights on on
the Ethernet RJ-45 connector.</p>
</li>
<li><p class="first">Wait 10 seconds</p>
</li>
<li><p class="first">Open the erase jumper J202 to stop erasing</p>
</li>
<li><p class="first">Open <em>SAM-BA</em> 2.16</p>
<p>Note on Fedora 25 you need to run <em>sam-ba_64</em> from the
SAM-BA package.</p>
</li>
<li><p class="first">Select which serial port is that of the SAM e70 connected to
the system. Use <em>lsusb.py -ciu</em> to locate the <em>tty/ttyACM</em>
device assigned to your board:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ lsusb.py -ciu
...
2-1      03eb:6124 02  2.00  480MBit/s 100mA 2IFs (Atmel Corp. at91sam SAMBA bootloader)
 2-1:1.0   (IF) 02:02:00 1EP  (Communications:Abstract (modem):None) cdc_acm tty/ttyACM2
 2-1:1.1   (IF) 0a:00:00 2EPs (CDC Data:) cdc_acm
...
</pre></div>
</div>
<p>(in this example <code class="docutils literal"><span class="pre">/dev/tty/ttyACM2</span></code>).</p>
</li>
<li><p class="first">Select board <em>at91same70-explained</em>, click connect.</p>
</li>
<li><p class="first">chose the flash tab and in the scripts
drop down menu, choose <em>boot from Flash (GPNVM1)</em> and then
<em>execute</em>.</p>
</li>
<li><p class="first">Exit <em>SAM-BA</em></p>
</li>
</ol>
</li>
<li><p class="first">connect the SAM E70/V71’s <em>Debug USB</em> port with the USB
A-male to B-micro to YKUSH downstream port <em>N</em></p>
</li>
<li><p class="first">connect the YKUSH to the server system and to power as
described in <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></p>
</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic simple">
<li>Choose a name for the target: <em>sam-e70-NN</em> (where NN is a number)</li>
<li>(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a>.</li>
<li>Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a></li>
<li>Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the board’s <em>serial number</em>.</li>
</ol>
</dd></dl>

<dl class="data">
<dt id="conf_00_lib.simics_zephyr_cmds">
<code class="descclassname">conf_00_lib.</code><code class="descname">simics_zephyr_cmds</code><em class="property"> = '$disk_image = &quot;%(simics_hd0)s&quot;\n$cpu_class = &quot;pentium-pro&quot;\n$text_console = TRUE\nrun-command-file &quot;%%simics%%/targets/x86-440bx/x86-440bx-pci-system.include&quot;\ncreate-telnet-console-comp $system.serconsole %(simics_console_port)d\nconnect system.serconsole.serial cnt1 = system.motherboard.sio.com[0]\ninstantiate-components\nsystem.serconsole.con.capture-start &quot;%(simics_console)s&quot;\nc\n'</em><a class="headerlink" href="#conf_00_lib.simics_zephyr_cmds" title="Permalink to this definition">¶</a></dt>
<dd><p>Commmands to configure Simics to run a simulation for Zephyr by
default</p>
<p><a class="reference internal" href="#ttbl.tt.simics.simics_vars" title="ttbl.tt.simics.simics_vars"><code class="xref py py-data docutils literal"><span class="pre">Fields</span> <span class="pre">available</span></code></a> via string
formatting <code class="docutils literal"><span class="pre">%(FIELD)L</span></code></p>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.simics_zephyr_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">simics_zephyr_add</code><span class="sig-paren">(</span><em>name</em>, <em>simics_cmds='$disk_image = &quot;%(simics_hd0)s&quot;\n$cpu_class = &quot;pentium-pro&quot;\n$text_console = TRUE\nrun-command-file &quot;%%simics%%/targets/x86-440bx/x86-440bx-pci-system.include&quot;\ncreate-telnet-console-comp $system.serconsole %(simics_console_port)d\nconnect system.serconsole.serial cnt1 = system.motherboard.sio.com[0]\ninstantiate-components\nsystem.serconsole.con.capture-start &quot;%(simics_console)s&quot;\nc\n'</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.simics_zephyr_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure a virtual Zephyr target running inside Simics</p>
<p>Simics is a platform simulator available from Wind River Systems;
it can be used to implement a virtual machine environment that
will be treated as a target.</p>
<p>Add to your configuration file
<code class="docutils literal"><span class="pre">/etc/ttbd-production/conf_10_targets.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">simics_zephyr_add</span><span class="p">(</span><span class="s2">&quot;szNN&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/szNN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target (<a class="reference internal" href="03-server-setup.html#bp-naming-targets"><span class="std std-ref">naming
best practices</span></a>).</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>A Simics invocation in a standalone workspace will be created by
the server to run for earch target when it is powered on. This
driver currently supports only booting an ELF target and console
output support (no console input or debugging). For more details,
see <a class="reference internal" href="#ttbl.tt.simics" title="ttbl.tt.simics"><code class="xref py py-class docutils literal"><span class="pre">ttbl.tt.simics</span></code></a>.</p>
<p>Note the default Simics settings for Zephyr are defined in
<a class="reference internal" href="#conf_00_lib.simics_zephyr_cmds" title="conf_00_lib.simics_zephyr_cmds"><code class="xref py py-data docutils literal"><span class="pre">simics_zephyr_cmds</span></code></a> and you can create target which use a
different Simics configuration by specifying it as a string in
parameter <em>simics_cmd</em>.</p>
<p><strong>Bill of materials</strong></p>
<ul>
<li><p class="first">Simics installed in your server machine</p>
</li>
<li><p class="first"><a class="reference internal" href="#ttbl.tt.simics" title="ttbl.tt.simics"><code class="xref py py-class docutils literal"><span class="pre">ttbl.tt.simics</span></code></a> expects a global environment variable
SIMICS_BASE_PACKAGE defined to point to where Simics (and its
extension packages) have been installed; e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SIMICS_BASE_PACKAGE</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">simics</span><span class="o">/</span><span class="mf">5.0</span><span class="o">/</span><span class="n">simics</span><span class="o">-</span><span class="mf">5.0</span><span class="o">.</span><span class="mi">136</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.tinytile_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">tinytile_add</code><span class="sig-paren">(</span><em>name</em>, <em>serial_number</em>, <em>ykush_serial</em>, <em>ykush_port_board</em>, <em>ykush_port_serial=None</em>, <em>serial_port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.tinytile_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a tinyTILE for the fixture described below.</strong></p>
<p>The tinyTILE is a miniaturization of the Arduino/Genuino 101 (see
<a class="reference external" href="https://www.zephyrproject.org/doc/boards/x86/tinytile/doc/board.html">https://www.zephyrproject.org/doc/boards/x86/tinytile/doc/board.html</a>).</p>
<p>The fixture used by this configuration uses a YKUSH hub for power
switching, no debug/JTAG interface and allows for an
optional external serial port using an USB-to-TTY serial adapter.</p>
<p>Add to a server configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">tinytile_add</span><span class="p">(</span><span class="s2">&quot;ti-NN&quot;</span><span class="p">,</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span> <span class="s2">&quot;YKNNNNN&quot;</span><span class="p">,</span> <span class="n">PORTNUMBER</span><span class="p">,</span>
             <span class="p">[</span><span class="n">ykush_port_serial</span> <span class="o">=</span> <span class="n">N2</span><span class="p">,]</span>
             <span class="p">[</span><span class="n">serial_port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-NAME&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/ti-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number for the tinyTILE</li>
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – <a class="reference internal" href="04-HOWTOs.html#ykush-serial-number"><span class="std std-ref">USB serial number</span></a> of the YKUSH hub</li>
<li><strong>ykush_port_board</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the YKUSH downstream port
where the board is connected.</li>
<li><strong>ykush_port_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) number of the YKUSH
downstream port where the board’s serial port is connected.</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the serial port
(defaults to <code class="docutils literal"><span class="pre">/dev/tty-NAME</span></code>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>The tinyTILE is powered via the USB connector. The tinyTILE does
not export a serial port over the USB connector–applications
loaded onto it might create a USB serial port, but this is not
necessarily so all the time.</p>
<p>Thus, for ease of use this fixture connects an optional external
USB-to-TTY dongle to the TX/RX/GND lines of the tinyTILE that
allows a reliable serial console to be present. To allow for
proper MCU board reset, this serial port has to be also power
switched on the same YKUSH hub (to avoid ground derivations).</p>
<p>For the serial console output to be usableq, the Zephyr Apps
configuration has to be altered to change the console to said
UART. The client side needs to be aware of that (via
configuration, for example, to the Zephyr App Builder).</p>
<p>When the serial dongle is in use, the power rail needs to first
power up the serial dongle and then the board.</p>
<p>Per this <a class="reference internal" href="05-RFAQs.html#arduino101-rationale"><span class="std std-ref">rationale</span></a>, current leakage and
full power down needs necesitate of this setup to cut all power to
all cables connected to the board (power and serial).</p>
<p>This fixture uses <a class="reference internal" href="#ttbl.tt.tt_dfu" title="ttbl.tt.tt_dfu"><code class="xref py py-class docutils literal"><span class="pre">ttbl.tt.tt_dfu</span></code></a> to implement the target;
refer to it for implementation details.</p>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>two available ports on an YKUSH power switching hub (serial
<em>YKNNNNN</em>); only one if the serial console will not be used.</li>
<li>a tinyTILE board</li>
<li>a USB A-Male to micro-B male cable (for board power)</li>
<li>a USB-to-TTY serial port dongle</li>
<li>three M/M jumper cables</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic simple">
<li>(if not yet connected), connect the YKUSH to the server system
and to power as described in <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a></li>
<li>connect the Tiny Tile’s USB port to the YKUSH downstream port
N1</li>
<li>(if a serial console will be connected) connect the USB-to-TTY
serial adapter to the YKUSH downstream port N2</li>
</ol>
<ol class="arabic simple" start="3">
<li>(if a serial console will be connected) connect the USB-to-TTY
serial adapter to the Tiny Tile with the M/M jumper cables:<ul>
<li>USB FTDI Black (ground) to Tiny Tile’s serial ground pin
(fourth pin from the bottom)</li>
<li>USB FTDI White (RX) to the Tiny Tile’s TX.</li>
<li>USB FTDI Green (TX) to Tiny Tile’s RX.</li>
<li>USB FTDI Red (power) is left open, it has 5V.</li>
</ul>
</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic">
<li><p class="first">Choose a name for the target: <em>ti-NN</em> (where NN is a number)</p>
</li>
<li><p class="first">(if needed) Find the YKUSH’s serial number <em>YKNNNNN</em> [plug it and
run <em>dmesg</em> for a quick find], see <a class="reference internal" href="#conf_00_lib.ykush_targets_add" title="conf_00_lib.ykush_targets_add"><code class="xref py py-func docutils literal"><span class="pre">ykush_targets_add()</span></code></a>.</p>
</li>
<li><p class="first">Find the board’s <a class="reference internal" href="04-HOWTOs.html#find-usb-info"><span class="std std-ref">serial number</span></a>.</p>
<p>Note these boards, when freshly plugged in, will only stay in
DFU mode for <em>five seconds</em> and then boot Zephyr (or whichever
OS they have), so the USB device will dissapear. You need to
run the lsusb or whichever command you are using quick (or
monitor the kernel output with <em>dmesg -w</em>).</p>
</li>
<li><p class="first">Configure <em>udev</em> to add a name for the serial device that
represents the USB-to-TTY dongle connected to the target so we can
easily find it at <code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Different options for
USB-to-TTY dongles <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">with</span></a> or <a class="reference internal" href="04-HOWTOs.html#usb-tty-sibling"><span class="std std-ref">without</span></a> a USB serial number.</p>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="conf_00_lib.nw_default_targets_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">nw_default_targets_add</code><span class="sig-paren">(</span><em>letter</em>, <em>pairs=1</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.nw_default_targets_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the default targets to a configuration</p>
<p>This adds a configuration which consists of a network and &#64;pairs
pairs of QEMU Linux VMs (one without upstream NAT connection, one with).</p>
<p>The network index nw_idx will be used to assign IP addresses
(192.168.IDX.x and fc00::IDX:x)</p>
<p>IP address assignment:
- .1         is the server (this machine)
- .2 - 10    Virtual Linux machines
- .30 - 45   Virtual Zephyr machines
- .100- 255  Real HW targets</p>
</dd></dl>

<dl class="class">
<dt id="conf_00_lib.minnowboard_EFI_boot_grub_pc">
<em class="property">class </em><code class="descclassname">conf_00_lib.</code><code class="descname">minnowboard_EFI_boot_grub_pc</code><span class="sig-paren">(</span><em>console_name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.minnowboard_EFI_boot_grub_pc" title="Permalink to this definition">¶</a></dt>
<dd><p>A power control interface that directs EFI to boot grub</p>
<p>When something (with a serial console that can access EFI) is
powering up, this looks at the output. If it takes us to the EFI
shell, then it runs fs0:EFIBOOTootx64 manually, which shall
launch the automatic grub process.</p>
<p>It relies on <a class="reference download internal" href="../_downloads/setup-efi-grub2-elf.sh" download=""><code class="xref download docutils literal"><span class="pre">../ttbd/setup-efi-grub2-elf.sh</span></code></a>
making <em>grub2</em> print a banner <code class="docutils literal"><span class="pre">TCF</span> <span class="pre">Booting</span> <span class="pre">kernel-HEXID.elf</span></code>.</p>
<p>Intended for Minnowboard and to be placed in the power rail of
anything right after powering up the anything.</p>
<dl class="method">
<dt id="conf_00_lib.minnowboard_EFI_boot_grub_pc.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.minnowboard_EFI_boot_grub_pc.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="conf_00_lib.minnowboard_EFI_boot_grub_pc.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.minnowboard_EFI_boot_grub_pc.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="conf_00_lib.minnowboard_EFI_boot_grub_pc.reset_do">
<code class="descname">reset_do</code><span class="sig-paren">(</span><em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.minnowboard_EFI_boot_grub_pc.reset_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="conf_00_lib.minnowboard_EFI_boot_grub_pc.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.minnowboard_EFI_boot_grub_pc.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="conf_00_lib.minnowboard_add">
<code class="descclassname">conf_00_lib.</code><code class="descname">minnowboard_add</code><span class="sig-paren">(</span><em>name</em>, <em>power_controller</em>, <em>usb_drive_serial</em>, <em>usbrly08b_serial</em>, <em>usbrly08b_bank</em>, <em>serial_port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#conf_00_lib.minnowboard_add" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Configure a Minnowboard for use with Zephyr</strong></p>
<p>The <a class="reference external" href="https://minnowboard.org/">Minnowboard</a> is an open hardware
board that can be used to run Linux, Zephyr and other OSes. This
configuration supports power control, a serial console and image
flashing.</p>
<p>Add to a server configuration file (note the serial numbers and
paths are examples that you need to adapt to your configuration):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span><span class="n">ttbl</span><span class="o">.</span><span class="n">tt</span><span class="o">.</span><span class="n">tt_power</span><span class="p">(</span>
    <span class="s2">&quot;minnowboard-NN-disk&quot;</span><span class="p">,</span>
    <span class="n">power_control</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">plugger</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">],),</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;skip_cleanup&#39;</span><span class="p">:</span> <span class="bp">True</span> <span class="p">}</span>
<span class="p">)</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;minnowboard-56-disk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">disable</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">minnowboard_add</span><span class="p">(</span><span class="s2">&quot;minnowboard-NN&quot;</span><span class="p">,</span>
                <span class="n">power_controller</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://admin:1234@sp06/6&quot;</span><span class="p">),</span>
                <span class="n">usb_drive_serial</span> <span class="o">=</span> <span class="s2">&quot;76508A8E&quot;</span><span class="p">,</span>
                <span class="n">usbrly08b_serial</span> <span class="o">=</span> <span class="s2">&quot;00023456&quot;</span><span class="p">,</span> <span class="n">usbrly08b_bank</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>restart the server and it yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/minnowboard-NN
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the target</li>
<li><strong>power_controller</strong> (<a class="reference internal" href="#ttbl.tt_power_control_impl" title="ttbl.tt_power_control_impl"><em>ttbl.tt_power_control_impl</em></a>) – <p>an
implementation of a power controller than can power off or on
the Minnowboard, for example a DLWPS7:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://admin:1234@sp06/6&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><strong>usb_drive_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB Serial number for the USB boot
drive that is multiplexed to the Minnowboard and the server
host as per the <em>Overview</em> below.</li>
<li><strong>usbrly08b_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB Serial number for the USBRLY8b
board that is going to be used to multiplex the USB boot drive
from the minnowboard to the server host.</li>
<li><strong>usbrly08b_bank</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – relay bank number (#0 will use relays
1, 2, 3 and 4, #1 will use 5, 6, 7 and 8).</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) name of the serial port
(defaults to <code class="docutils literal"><span class="pre">/dev/tty-NAME</span></code>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Overview</strong></p>
<p>The Minnowboard provides a serial port which is used to control
the BIOS (when needed) and to access the OS. Any AC power controller
can be used to power on/off the Minnowboard’s power brick.</p>
<p>The target type implemented here can only boot ELF kernels and is
implemented using the <a class="reference internal" href="#ttbl.tt.grub2elf" title="ttbl.tt.grub2elf"><code class="xref py py-class docutils literal"><span class="pre">grub2</span> <span class="pre">loader</span></code></a>. In
summary, a USB drive is used as a boot drive that is multiplexed
using a USBRLY8b relay bank from the Minnowboard to the
server:</p>
<blockquote>
<div><ul class="simple">
<li>when the Minnowboard is off, the USB drive is connected to the
server, so it can be setup / partitioned / formatted / flashed</li>
<li>when Minnowboard is on, the USB drive is connected to it.</li>
</ul>
</div></blockquote>
<p><strong>Bill of materials</strong></p>
<ul class="simple">
<li>A Minnowboard and its power brick</li>
<li>An open socket on an AC power switch, like the <a class="reference internal" href="#ttbl.pc.dlwps7" title="ttbl.pc.dlwps7"><code class="xref py py-class docutils literal"><span class="pre">Digital</span>
<span class="pre">Logger</span> <span class="pre">Web</span> <span class="pre">Power</span> <span class="pre">Switch</span> <span class="pre">7</span></code></a></li>
<li>A USB serial cable terminated with 6 way header (eg:
<a class="reference external" href="https://www.amazon.com/Converter-Terminated-Galileo-BeagleBone-Minnowboard/dp/B06ZYPLFNB">https://www.amazon.com/Converter-Terminated-Galileo-BeagleBone-Minnowboard/dp/B06ZYPLFNB</a>)
preferibly with a serial number (easier to configure)</li>
<li>a USB drive (any size will do)</li>
<li>four relays on a USBRLY08b USB relay bank
(<a class="reference external" href="https://www.robot-electronics.co.uk/htm/usb_rly08btech.htm">https://www.robot-electronics.co.uk/htm/usb_rly08btech.htm</a>)
[either 1, 2, 3 and 4 or 5, 6, 7 and 8]</li>
<li>One USB Type A female to male cable, one USB Type A male cable</li>
<li>Two USB ports into the server</li>
</ul>
<p><strong>Connecting the test target fixture</strong></p>
<ol class="arabic">
<li><p class="first">connect the Minnowboard’s power trick to the socket in the AC
power switch and to the board DC input</p>
</li>
<li><p class="first">connect the USB serial cable to the Minnowboard’s TTY
connection and to the server</p>
</li>
<li><p class="first">Cut and the USB-A male-to-female cable and separate the four
lines on each end; likewise, cut and separate the four lines on
the other USB-A male cable; follow the detailed instructions in
<a class="reference internal" href="#ttbl.usbrly08b.plugger" title="ttbl.usbrly08b.plugger"><code class="xref py py-class docutils literal"><span class="pre">ttbl.usbrly08b.plugger</span></code></a> where:</p>
<ul class="simple">
<li>Ensure the USBRLY8B is properly connected and setup as per
<a class="reference internal" href="#ttbl.usbrly08b.rly08b" title="ttbl.usbrly08b.rly08b"><code class="xref py py-class docutils literal"><span class="pre">ttbl.usbrly08b.rly08b</span></code></a></li>
<li><em>DUT</em> is the USB-A female where we’ll connect the USB drive,
plug the USB drive to it. Label as <em>minnowboard-NN boot</em></li>
<li><em>Host A1/ON/NO</em> is the USB-A male connector we’ll connect to
the Minnowboard’s USB 2.0 port – label as
<em>minnowboard-NN ON</em> and plug to the board</li>
<li><em>Host A2/OFF/NC</em> is the USB-A make connector we’ll connect to
the server’s USB port – label as <em>minnowboard-NN OFF</em> and
plug to the server.</li>
</ul>
<p>Note tinning the cables for better contact will reduce the
chance of the USB device misbehaving.</p>
<p>It is critical to get this part right; the cable connected to
the NC terminals has to be what is connected to the server when
the target is <em>off</em>.</p>
<p>It is recommended to test this thoroughly in a separate system
first.</p>
</li>
<li><p class="first">Ensure the Minnowboard MAX is flashed with <em>64 bit</em> firmware,
otherwise it will fail to boot.</p>
<p>To update it, connect it to a solid power (so TCF doesn’t power
it off in the middle), download the images from
<a class="reference external" href="https://firmware.intel.com/projects/minnowboard-max">https://firmware.intel.com/projects/minnowboard-max</a> (0.97 as of
writing this) and follow the instructions.</p>
</li>
</ol>
<p><strong>Configuring the system for the fixture</strong></p>
<ol class="arabic">
<li><p class="first">Choose a name for the target: <em>minnowboard-NNx</em> (see <a class="reference internal" href="03-server-setup.html#bp-naming-targets"><span class="std std-ref">naming
best practices</span></a>).</p>
</li>
<li><p class="first">Find the serial number of the USB drive, blank it to ensure it
is properly initialized; example, in this case being
<em>/dev/sdb</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ lsblk -nro NAME,TRAN,SERIAL | grep USB-DRIVE-SERIAL
sdb usb USB-DRIVE-SERIAL
$ dd if=/dev/zero of=/dev/sdb
</pre></div>
</div>
</li>
<li><p class="first">Find the serial number of the USBRLY8b and determine the relay
bank to use; bank 0 for relays 1, 2, 3 and bank 1 for relays 4
or 5, 6, 7 and 8.</p>
</li>
<li><p class="first">Configure <em>udev</em> to add a name for the serial device for the
board’s serial console so it can be easily found at
<code class="docutils literal"><span class="pre">/dev/tty-TARGETNAME</span></code>. Follow <a class="reference internal" href="04-HOWTOs.html#usb-tty-serial"><span class="std std-ref">these instructions</span></a> using the serial dongle’s <em>serial number</em>; e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;tty&quot;</span><span class="p">,</span> <span class="n">ENV</span><span class="p">{</span><span class="n">ID_SERIAL_SHORT</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;AC0054PT&quot;</span><span class="p">,</span> \
  <span class="n">SYMLINK</span> <span class="o">+=</span> <span class="s2">&quot;tty-minnowboard-NN&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Connect the Minnowboard to a display [vs the serial port, to
make it easier] and with a keyboard, plug the USB drive
directly and boot into the BIOS.</p>
<ol class="loweralpha">
<li><p class="first">Enter into the <em>Boot Options Manager</em>, ensure <em>EFI USB
Device</em> is enabled; otherwise, add the option.</p>
<p>Depending on the BIOS revision, the save/commit mechanism
might be tricky to get right, so double check it by
rebooting and entering the BIOS again to verify that <em>EFI
booting from USB</em> is enabled.</p>
</li>
<li><p class="first">In the same <em>Boot Options Manager</em>, change the boot order to
consider the <em>EFI booting from USB</em> option to be the first
thing booted.</p>
<p>Note that the EFI Bios tends to reset the boot drive order
if at some point it fails to detect it, so a boot coercer
like <a class="reference internal" href="#conf_00_lib.minnowboard_EFI_boot_grub_pc" title="conf_00_lib.minnowboard_EFI_boot_grub_pc"><code class="xref py py-class docutils literal"><span class="pre">minnowboard_EFI_boot_grub_pc</span></code></a> is needed. This
will workaound the issue.</p>
</li>
</ol>
</li>
</ol>
<dl class="docutils">
<dt>FIXME:</dt>
<dd><ul class="first last simple">
<li>FIXME: need to have it re-plug the dongle if the server
doesn’t see it</li>
</ul>
</dd>
</dl>
<p>Troubleshooting:</p>
<blockquote>
<div><ul>
<li><p class="first">UEFI keeps printing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">find</span> <span class="n">required</span> <span class="nb">map</span> <span class="n">name</span><span class="o">.</span>
</pre></div>
</div>
<p>Make sure:</p>
<blockquote>
<div><ul>
<li><p class="first">the USB relay plugger is properly connected and the drive is
re-directed to the target when powered on, to the server
when off</p>
</li>
<li><p class="first">the drive is not DOS formatted, it needs a GPT
partition table. Wipe it hard and re-deploy (eg: running tcf
run) so it will be re-flashed from the ground up:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># dd if=/dev/zero of=/dev/DEVICENODE bs=$((1024 * 1024)) count=100</span>
</pre></div>
</div>
</li>
<li><p class="first">Minnowboard is picky and some drives are faulty for it, even
if they work ok in any other machine; replace the drive?</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<ul>
<li><p class="first">UEFI will do nothing when <em>BOOTX64</em> is executed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Shell&gt; fs0:\EFI\BOOTootx64
Shell&gt;
</pre></div>
</div>
<p>Double check the Minnowboard is flashed with a 64 bit firmware;
see above in <strong>Connecting the test target fixture</strong>.</p>
</li>
</ul>
</dd></dl>

</div>
<div class="section" id="module-ttbl.config">
<span id="ttbd-configuration-api"></span><h2>8.6. <em>ttbd</em> Configuration API<a class="headerlink" href="#module-ttbl.config" title="Permalink to this headline">¶</a></h2>
<p>Configuration API for <em>ttbd</em></p>
<dl class="data">
<dt id="ttbl.config.defaults_enabled">
<code class="descclassname">ttbl.config.</code><code class="descname">defaults_enabled</code><em class="property"> = True</em><a class="headerlink" href="#ttbl.config.defaults_enabled" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse defaults configuration blocks protected by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaults_enabled</span><span class="p">:</span>
</pre></div>
</div>
<p>This is done so that a sensible configuration can be shipped by
default that is easy to deactivate in a local configuration file.</p>
<p>This is important as the default configuration includes the
definition for three networks (<em>nwa</em>, <em>nwb</em> and <em>nwc</em>) that if
spread around multiple servers will lead the clients to think they
are the same network but spread around multiple servers, when they
are in truth different networks.</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.processes">
<code class="descclassname">ttbl.config.</code><code class="descname">processes</code><em class="property"> = 20</em><a class="headerlink" href="#ttbl.config.processes" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of processes to start</p>
<p>How many servers shall be started, each being able to run a request
in parallel. Defaults to 20, but can be increased if HW is not
being very cooperative.</p>
<p>(this is currently a hack, we plan to switch to a server that can
spawn them more dynamically).</p>
</dd></dl>

<dl class="function">
<dt id="ttbl.config.target_add">
<code class="descclassname">ttbl.config.</code><code class="descname">target_add</code><span class="sig-paren">(</span><em>target</em>, <em>_id=None</em>, <em>tags=None</em>, <em>target_type=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.config.target_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a target to the list of managed targets</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (subtype of <a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><code class="xref py py-class docutils literal"><span class="pre">ttbl.test_target</span></code></a>) – target to add</li>
<li><strong>tags</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – Dictionary of tags that apply to the target (all
tags are strings)</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) – name of the target, by default taken from the target
object</li>
<li><strong>target_type</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) – string describing type of the target; by
default it’s taken from the object’s type.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ttbl.config.interconnect_add">
<code class="descclassname">ttbl.config.</code><code class="descname">interconnect_add</code><span class="sig-paren">(</span><em>ic</em>, <em>_id=None</em>, <em>tags=None</em>, <em>ic_type=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.config.interconnect_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a target interconnect</p>
<p>An interconnect is just another target that offers interconnection
services to other targets.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ic</strong> (<a class="reference internal" href="#ttbl.interconnect_c" title="ttbl.interconnect_c"><em>ttbl.interconnect_c</em></a>) – interconnect to add</li>
<li><strong>_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the interconnect, by default taken from
the object itself.</li>
<li><strong>_tags</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – Dictionary of tags that apply to the target (all
tags are strings)</li>
<li><strong>ic_type</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – string describing type of the interconnect; by
default it’s taken from the object’s type.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ttbl.config.add_authenticator">
<code class="descclassname">ttbl.config.</code><code class="descname">add_authenticator</code><span class="sig-paren">(</span><em>a</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.config.add_authenticator" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an authentication methodology, eg:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>a</strong> (<a class="reference internal" href="#ttbl.authenticator_c" title="ttbl.authenticator_c"><em>ttbl.authenticator_c</em></a>) – authentication engine</td>
</tr>
</tbody>
</table>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">add_authentication</span><span class="p">(</span><span class="n">ttbl</span><span class="o">.</span><span class="n">ldap_auth</span><span class="o">.</span><span class="n">ldap_user_authenticator</span><span class="p">(</span><span class="s2">&quot;ldap://&quot;</span> <span class="o">...</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.target_max_idle">
<code class="descclassname">ttbl.config.</code><code class="descname">target_max_idle</code><em class="property"> = 30</em><a class="headerlink" href="#ttbl.config.target_max_idle" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum time a target is idle before it is powered off (seconds)</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.target_owned_max_idle">
<code class="descclassname">ttbl.config.</code><code class="descname">target_owned_max_idle</code><em class="property"> = 300</em><a class="headerlink" href="#ttbl.config.target_owned_max_idle" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum time an acquired target is idle before it is released (seconds)</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.cleanup_files_period">
<code class="descclassname">ttbl.config.</code><code class="descname">cleanup_files_period</code><em class="property"> = 60</em><a class="headerlink" href="#ttbl.config.cleanup_files_period" title="Permalink to this definition">¶</a></dt>
<dd><p>Time gap after which call the function to perform clean-up</p>
</dd></dl>

<dl class="data">
<dt id="ttbl.config.cleanup_files_maxage">
<code class="descclassname">ttbl.config.</code><code class="descname">cleanup_files_maxage</code><em class="property"> = 86400</em><a class="headerlink" href="#ttbl.config.cleanup_files_maxage" title="Permalink to this definition">¶</a></dt>
<dd><p>Age of the file after which it will be deleted</p>
</dd></dl>

</div>
<div class="section" id="module-ttbl">
<span id="ttbd-internals"></span><h2>8.7. <em>ttbd</em> internals<a class="headerlink" href="#module-ttbl" title="Permalink to this headline">¶</a></h2>
<p>Internal API for <em>ttbd</em></p>
<p>Note classes names defining general interfaces are expected to end in
_mixin, to be recognized by the auto-lister in
<a class="reference internal" href="#ttbl.config.target_add" title="ttbl.config.target_add"><code class="xref py py-func docutils literal"><span class="pre">ttbl.config.target_add()</span></code></a></p>
<dl class="exception">
<dt id="ttbl.test_target_e">
<em class="property">exception </em><code class="descclassname">ttbl.</code><code class="descname">test_target_e</code><a class="headerlink" href="#ttbl.test_target_e" title="Permalink to this definition">¶</a></dt>
<dd><p>A base for all operations regarding test targets.</p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.test_target_busy_e">
<em class="property">exception </em><code class="descclassname">ttbl.</code><code class="descname">test_target_busy_e</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_busy_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.test_target_not_acquired_e">
<em class="property">exception </em><code class="descclassname">ttbl.</code><code class="descname">test_target_not_acquired_e</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_not_acquired_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.test_target_release_denied_e">
<em class="property">exception </em><code class="descclassname">ttbl.</code><code class="descname">test_target_release_denied_e</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_release_denied_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.test_target_not_admin_e">
<em class="property">exception </em><code class="descclassname">ttbl.</code><code class="descname">test_target_not_admin_e</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_not_admin_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="ttbl.test_target_logadapter_c">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">test_target_logadapter_c</code><span class="sig-paren">(</span><em>logger</em>, <em>extra</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_logadapter_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Prefix to test target logging the name of the target and if
acquired, the current owner.</p>
<p>This is useful to correlate logs in server in client when
diagnosing issues.</p>
<p>Initialize the adapter with a logger and a dict-like object which
provides contextual information. This constructor signature allows
easy stacking of LoggerAdapters, if so desired.</p>
<p>You can effectively pass keyword arguments as shown in the
following example:</p>
<p>adapter = LoggerAdapter(someLogger, dict(p1=v1, p2=”v2”))</p>
<dl class="method">
<dt id="ttbl.test_target_logadapter_c.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>msg</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_logadapter_c.process" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.thing_plugger_mixin">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">thing_plugger_mixin</code><a class="headerlink" href="#ttbl.thing_plugger_mixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Define how to plug things (targets) into other targets</p>
<p>A thing is a target that can be, in any form, connected to another
target. For example, a USB device to a host, where both the US
device and host are targets. This is so that we can make sure
they are owned by someone before plugging, as it can alter state.</p>
<dl class="method">
<dt id="ttbl.thing_plugger_mixin.plug">
<code class="descname">plug</code><span class="sig-paren">(</span><em>target</em>, <em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.thing_plugger_mixin.plug" title="Permalink to this definition">¶</a></dt>
<dd><p>Plug <em>thing</em> into <em>target</em></p>
<p>Caller must own both <em>target</em> and <em>thing</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to plug</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to plug into <em>target</em></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.thing_plugger_mixin.unplug">
<code class="descname">unplug</code><span class="sig-paren">(</span><em>target</em>, <em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.thing_plugger_mixin.unplug" title="Permalink to this definition">¶</a></dt>
<dd><p>Unplug <em>thing</em> from <em>target</em></p>
<p>Caller must own <em>target</em> (not <em>thing</em> necessarily)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – target where to unplug from</li>
<li><strong>thing</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>ttbl.test_target</em></a>) – thing to unplug</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.test_target">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">test_target</code><span class="sig-paren">(</span><em>_test_target__id</em>, <em>_tags=None</em>, <em>_type=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="ttbl.test_target.state_path">
<code class="descname">state_path</code><em class="property"> = '/var/run/ttbd'</em><a class="headerlink" href="#ttbl.test_target.state_path" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.files_path">
<code class="descname">files_path</code><em class="property"> = '__undefined__'</em><a class="headerlink" href="#ttbl.test_target.files_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Path where files are stored</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.user_properties">
<code class="descname">user_properties</code><em class="property"> = set(['tcpdump'])</em><a class="headerlink" href="#ttbl.test_target.user_properties" title="Permalink to this definition">¶</a></dt>
<dd><p>A test target base class</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.id">
<code class="descname">id</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.id" title="Permalink to this definition">¶</a></dt>
<dd><p>Target name/identifier</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.tags">
<code class="descname">tags</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.tags" title="Permalink to this definition">¶</a></dt>
<dd><p>Target’s tags</p>
<p>FIXME document more</p>
<ul>
<li><p class="first"><em>things</em>: dictionary with information about things
(devices, etc) that can be hotplugged to this target;
the target’s driver is the one in charge of implementing
said hotplugging:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span> <span class="s2">&quot;THINGNAME&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;TYPE&quot;</span><span class="p">[,</span> <span class="n">ARG1</span><span class="p">,</span> <span class="p">[</span><span class="n">ARG2</span> <span class="p">[</span><span class="o">...</span><span class="p">]])</span> <span class="p">}</span>
</pre></div>
</div>
<p><em>TYPE</em> is driver specific, but as of now, the following
types are known:</p>
<ul class="simple">
<li><em>usb:sibling_of_serial, SERIAL, NUMBER</em>: connect
whichever USB device is in USB port number <em>NUMBER</em> of
the hub to which another USB device with serial number
<em>SERIAL</em> is connected.</li>
</ul>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.things">
<code class="descname">things</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.things" title="Permalink to this definition">¶</a></dt>
<dd><p>references to the targets that implement things that can be
plugged to this target.</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.thing_to">
<code class="descname">thing_to</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.thing_to" title="Permalink to this definition">¶</a></dt>
<dd><p>List of targets this target is a thing to</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.fsdb">
<code class="descname">fsdb</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.fsdb" title="Permalink to this definition">¶</a></dt>
<dd><p>filesystem database of target state; the multiple daemon
processes use this to store information that reflect’s the
target’s state.</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.kws">
<code class="descname">kws</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.kws" title="Permalink to this definition">¶</a></dt>
<dd><p>Keywords that can be used to substitute values in commands,
messages. Target’s tags are translated to keywords
here. <a class="reference internal" href="#ttbl.config.target_add" title="ttbl.config.target_add"><code class="xref py py-func docutils literal"><span class="pre">ttbl.config.target_add()</span></code></a> will update this with
the final list of tags.</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.release_hooks">
<code class="descname">release_hooks</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.release_hooks" title="Permalink to this definition">¶</a></dt>
<dd><p>Functions to call when the target is released (things like
removing tunnels the user created, resetting debug state,
etc); this is meant to leave the target’s state pristine
so that it does not affect the next user that acquires it.
Each interface will add as needed, so it gets executed upon
<a class="reference internal" href="#ttbl.test_target.release" title="ttbl.test_target.release"><code class="xref py py-meth docutils literal"><span class="pre">release()</span></code></a>, under the owned lock.</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.thing_methods">
<code class="descname">thing_methods</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.test_target.thing_methods" title="Permalink to this definition">¶</a></dt>
<dd><p>Methods used to plug/unplug things to/from targets, keyed
by method name and value being a tuple with two functions
(the plug function and the unplug function).</p>
<p>Said functions take as arguments the thing name and the
thing desciptor from the target’s tags.</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target.type">
<code class="descname">type</code><a class="headerlink" href="#ttbl.test_target.type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.test_target.get_id">
<code class="descname">get_id</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.get_id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.test_target.add_to_interconnect">
<code class="descname">add_to_interconnect</code><span class="sig-paren">(</span><em>ic_id</em>, <em>ic_tags=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.add_to_interconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a target to an interconnect</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ic_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the interconnect; might be present in
this server or another one.</li>
<li><strong>ic_tags</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – (optional) dictionary of tags describing the
tags for this target on this interconnect.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.tags_update">
<code class="descname">tags_update</code><span class="sig-paren">(</span><em>d=None</em>, <em>ic=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.tags_update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the tags assigned to a target</p>
<p>This will ensure the tags described in <em>d</em> are given to the
target and all the values associated to them updated (such as
interconnect descriptions, addresses, etc).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>d</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of tags</li>
<li><strong>ic</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – (optional) the dict d has to be used to only
update the data of the given interconnect</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>It can be used to add tags to a target after it is added to
the configuration, such as with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arduino101_add</span><span class="p">(</span><span class="s2">&quot;a101-03&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tclf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s2">&quot;a101-03&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tags_update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">val</span> <span class="o">=</span> <span class="mi">34</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.owner_get">
<code class="descname">owner_get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.owner_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return who the current owner of this target is</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">object describing the owner</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.timestamp_get">
<code class="descname">timestamp_get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.timestamp_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.test_target.timestamp">
<code class="descname">timestamp</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.timestamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the timestamp on the target to record last activity tme</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.acquire">
<code class="descname">acquire</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.acquire" title="Permalink to this definition">¶</a></dt>
<dd><p>Assign the test target to user <em>who</em> unless it is already
taken by someone else.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User that is claiming the target</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><a class="reference internal" href="#ttbl.test_target_busy_e" title="ttbl.test_target_busy_e"><code class="xref py py-class docutils literal"><span class="pre">test_target_busy_e</span></code></a> if already taken</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.enable">
<code class="descname">enable</code><span class="sig-paren">(</span><em>who=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable the target (so it will be regularly used)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Deprecated</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.disable">
<code class="descname">disable</code><span class="sig-paren">(</span><em>who=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable the target (so it will not be regularly used)</p>
<p>It still can be used, but it will be filtered out by the
client regular listings.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Deprecated</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.property_set">
<code class="descname">property_set</code><span class="sig-paren">(</span><em>who</em>, <em>prop</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.property_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a target’s property</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User that is claiming the target</li>
<li><strong>prop</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Property name</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Value for the property (None for deleting)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.property_set_locked">
<code class="descname">property_set_locked</code><span class="sig-paren">(</span><em>who</em>, <em>prop</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.property_set_locked" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a target’s property (must be locked by the user)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User that is claiming the target</li>
<li><strong>prop</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Property name</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Value for the property (None for deleting)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.property_get">
<code class="descname">property_get</code><span class="sig-paren">(</span><em>who</em>, <em>prop</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.property_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a target’s property</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User that is claiming the target</li>
<li><strong>prop</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Property name</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.property_get_locked">
<code class="descname">property_get_locked</code><span class="sig-paren">(</span><em>who</em>, <em>prop</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.property_get_locked" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a target’s property</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User that is claiming the target</li>
<li><strong>prop</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Property name</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.thing_add">
<code class="descname">thing_add</code><span class="sig-paren">(</span><em>name</em>, <em>plugger</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.thing_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Define a thing that can be un/plugged to this target</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of an existing target in this server
that is considered to be a thing to this target</li>
<li><strong>plugger</strong> (<a class="reference internal" href="#ttbl.thing_plugger_mixin" title="ttbl.thing_plugger_mixin"><em>ttbl.thing_plugger_mixin</em></a>) – <p>object that has
methods to do the physical action of plugging/unplugging the
thing to the target.</p>
<p>For example, this can be an instance of
<a class="reference internal" href="#ttbl.usbrly08b.plugger" title="ttbl.usbrly08b.plugger"><code class="xref py py-class docutils literal"><span class="pre">ttbl.usbrly08b.plugger</span></code></a>.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.thing_plug">
<code class="descname">thing_plug</code><span class="sig-paren">(</span><em>who</em>, <em>thing_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.thing_plug" title="Permalink to this definition">¶</a></dt>
<dd><p>Connect a thing to the target</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – user that owns the target</li>
<li><strong>thing_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the thing we want to plug; note
the current user has to own the thing (which is also a
target)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The user who is plugging must own this target <em>and</em> the thing.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.thing_unplug">
<code class="descname">thing_unplug</code><span class="sig-paren">(</span><em>who</em>, <em>thing_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.thing_unplug" title="Permalink to this definition">¶</a></dt>
<dd><p>Disconnect a thing from the target.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – user that owns the target</li>
<li><strong>thing_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – thing to disconnect; note the current
user has to own the thing (which is also a target)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The user who is unplugging must own this target, but don’t
necessary need to own the thing.</p>
<p>Note that when you release the target, all the things
connected to it are released, even if you don’t own the
things.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.thing_list">
<code class="descname">thing_list</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.thing_list" title="Permalink to this definition">¶</a></dt>
<dd><p>List the things available for connection and their current
connection state</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.ip_tunnel_list">
<code class="descname">ip_tunnel_list</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.ip_tunnel_list" title="Permalink to this definition">¶</a></dt>
<dd><p>List existing IP tunnels</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of tuples (protocol, target-ip-address, port,
port-in-server)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.ip_tunnel_add">
<code class="descname">ip_tunnel_add</code><span class="sig-paren">(</span><em>who</em>, <em>ip_addr</em>, <em>port</em>, <em>proto</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.ip_tunnel_add" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup a TCP/UDP/SCTP v4 or v5 tunnel to the target</p>
<p>A local port of the given protocol in the server is fowarded
to the target’s port. Stop with <a class="reference internal" href="#ttbl.test_target.ip_tunnel_remove" title="ttbl.test_target.ip_tunnel_remove"><code class="xref py py-meth docutils literal"><span class="pre">ip_tunnel_remove()</span></code></a>.</p>
<p>If the tunnel already exists, it is not recreated, but the
port it uses is returned.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>who</strong> – user descriptor</li>
<li><strong>ip_addr</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – target’s IP address to use (it must be
listed on the targets’s tags <em>ipv4_address</em> or
<em>ipv6_address</em>).</li>
<li><strong>port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – port to redirect to</li>
<li><strong>proto</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) Protocol to tunnel:
{udp,sctp,tcp}[{4,6}] (defaults to v4 and to TCP)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Returns int local_port:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first last">port in the server where to connect
to in order to access the target.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.ip_tunnel_remove">
<code class="descname">ip_tunnel_remove</code><span class="sig-paren">(</span><em>who</em>, <em>ip_addr</em>, <em>port</em>, <em>proto='tcp'</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.ip_tunnel_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Teardown a TCP/UDP/SCTP v4 or v5 tunnel to the target
previously created with <a class="reference internal" href="#ttbl.test_target.ip_tunnel_add" title="ttbl.test_target.ip_tunnel_add"><code class="xref py py-meth docutils literal"><span class="pre">ip_tunnel_add()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> – user descriptor</li>
<li><strong>ip_addr</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – target’s IP address to use (it must be
listed on the targets’s tags <em>ipv4_address</em> or
<em>ipv6_address</em>).</li>
<li><strong>port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – port to redirect to</li>
<li><strong>proto</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) Protocol to tunnel:
{udp,sctp,tcp}[{4,6}] (defaults to v4 and to TCP)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.release">
<code class="descname">release</code><span class="sig-paren">(</span><em>who</em>, <em>force=False</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release the ownership of this target.</p>
<p>If the target is not owned by anyone, it does nothing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – User that is releasing the target (must be the owner)</li>
<li><strong>force</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – force release of a target owned by
someone else (requires admin privilege)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#ttbl.test_target_not_acquired_e" title="ttbl.test_target_not_acquired_e"><code class="xref py py-class docutils literal"><span class="pre">test_target_not_acquired_e</span></code></a> if not taken</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.target_owned_and_locked">
<code class="descname">target_owned_and_locked</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.target_owned_and_locked" title="Permalink to this definition">¶</a></dt>
<dd><p>Ensure the target is locked and owned for an operation that
requires exclusivity</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>who</strong> – User that is calling the operation</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><a class="reference internal" href="#ttbl.test_target_not_acquired_e" title="ttbl.test_target_not_acquired_e"><code class="xref py py-class docutils literal"><span class="pre">test_target_not_acquired_e</span></code></a> if the target is
not acquired by anyone, <a class="reference internal" href="#ttbl.test_target_busy_e" title="ttbl.test_target_busy_e"><code class="xref py py-class docutils literal"><span class="pre">test_target_busy_e</span></code></a> if the
target is owned by someone else.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target.target_is_owned_and_locked">
<code class="descname">target_is_owned_and_locked</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target.target_is_owned_and_locked" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns if a target is locked and owned for an operation that
requires exclusivity</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>who</strong> – User that is calling the operation</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if &#64;who owns the target or is admin, False
otherwise or if the target is not owned</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.interconnect_impl_c">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">interconnect_impl_c</code><a class="headerlink" href="#ttbl.interconnect_impl_c" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="ttbl.interconnect_c">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">interconnect_c</code><span class="sig-paren">(</span><em>name</em>, <em>ic_impl=None</em>, <em>_tags=None</em>, <em>_type=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.interconnect_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Define an interconnect as a target that provides connectivity
services to other targets.</p>
<dl class="attribute">
<dt id="ttbl.interconnect_c.ic_impl">
<code class="descname">ic_impl</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.interconnect_c.ic_impl" title="Permalink to this definition">¶</a></dt>
<dd><p>Interconnect implementation</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt_power_control_impl">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">tt_power_control_impl</code><a class="headerlink" href="#ttbl.tt_power_control_impl" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="ttbl.tt_power_control_impl.retry_all_e">
<em class="property">exception </em><code class="descname">retry_all_e</code><span class="sig-paren">(</span><em>wait=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_power_control_impl.retry_all_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Exception raised for a power control implementation operation
wants the whole power-rail reinitialized</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_power_control_impl.power_cycle_raw">
<code class="descname">power_cycle_raw</code><span class="sig-paren">(</span><em>target</em>, <em>wait=2</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_power_control_impl.power_cycle_raw" title="Permalink to this definition">¶</a></dt>
<dd><p>Do a raw power cycle</p>
<p>This does no pre/post actions, just power cycles this
implementation; used for recovery strategies.</p>
<p>This is called by the likes of <a class="reference internal" href="#ttbl.pc.delay_til_usb_device" title="ttbl.pc.delay_til_usb_device"><code class="xref py py-class docutils literal"><span class="pre">ttbl.pc.delay_til_usb_device</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<a class="reference internal" href="#ttbl.test_target" title="ttbl.test_target"><em>test_target</em></a>) – target on which to act</li>
<li><strong>wait</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – time to wait between power off and on</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_power_control_impl.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_power_control_impl.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd><p>Flip the power on</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_power_control_impl.reset_do">
<code class="descname">reset_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_power_control_impl.reset_do" title="Permalink to this definition">¶</a></dt>
<dd><p>Do a reset</p>
<p>This would ideally trigger a hard reset without a power cycle;
but it can default to a power-cycle. The power has to be on
for this to be usable.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_power_control_impl.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_power_control_impl.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd><p>Flip the power off</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_power_control_impl.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_power_control_impl.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the power state</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt_power_control_mixin">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">tt_power_control_mixin</code><span class="sig-paren">(</span><em>impl=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_power_control_mixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the power control interface</p>
<p>This allows a target to be fully powered off, on, power cycled or
reset.</p>
<p>To run functions before power-off or after power-on, add functions
that take the target object as self to the
power_(on|off)_(post|pre)_fns lists.</p>
<p>Power control is implemented with
<a class="reference internal" href="#ttbl.tt_power_control_mixin" title="ttbl.tt_power_control_mixin"><code class="xref py py-class docutils literal"><span class="pre">ttbl.tt_power_control_mixin</span></code></a>, which can be
subclassed or given a subcless of an implementation object
(<a class="reference internal" href="#ttbl.tt_power_control_impl" title="ttbl.tt_power_control_impl"><code class="xref py py-class docutils literal"><span class="pre">ttbl.tt_power_control_impl</span></code></a>) or a list of them
(to create a power rail).</p>
<p>Power rails allow to create complex power configurations where a
target requires many things to be done in an specific sequence to
power up (and viceversa to power down). For example, for the
Arduino101 boards, the following happens:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">power_control</span> <span class="o">=</span> <span class="p">[</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">pc_ykush</span><span class="o">.</span><span class="n">ykush</span><span class="p">(</span><span class="s2">&quot;YK20954&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>      <span class="c1"># Flyswatter2</span>
  <span class="c1"># delay power-on until the flyswatter2 powers up as a USB device</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay_til_usb_device</span><span class="p">(</span><span class="n">serial</span> <span class="o">=</span> <span class="s2">&quot;FS20000&quot;</span><span class="p">),</span>
  <span class="c1"># delay on power off until the serial console device is gone,</span>
  <span class="c1"># to make sure it re-opens properly later. It also helps the</span>
  <span class="c1"># main board reset properly.</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay_til_file_gone</span><span class="p">(</span><span class="n">off</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-arduino101-02&quot;</span><span class="p">),</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">pc_ykush</span><span class="o">.</span><span class="n">ykush</span><span class="p">(</span><span class="s2">&quot;YK20954&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>      <span class="c1"># serial port</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">cm_serial</span><span class="o">.</span><span class="n">pc</span><span class="p">(),</span>                    <span class="c1"># plug serial ports</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">pc_ykush</span><span class="o">.</span><span class="n">ykush</span><span class="p">(</span><span class="s2">&quot;YK20954&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>      <span class="c1"># board</span>
<span class="p">],</span>
</pre></div>
</div>
<p>this is a six-component power rail, which:</p>
<ol class="arabic simple">
<li>powers a port in a USB hub to power up the Flyswatter2
(firmware flasher) (with a <a class="reference internal" href="#ttbl.pc_ykush.ykush" title="ttbl.pc_ykush.ykush"><code class="xref py py-class docutils literal"><span class="pre">ttbl.pc_ykush.ykush</span></code></a>)</li>
<li>waits for the USB device representing said device to show up in
the system (with <a class="reference internal" href="#ttbl.pc.delay_til_usb_device" title="ttbl.pc.delay_til_usb_device"><code class="xref py py-class docutils literal"><span class="pre">ttbl.pc.delay_til_usb_device</span></code></a>).</li>
<li>(only used during power off) delay until said file is not
present in the system anymore
(<a class="reference internal" href="#ttbl.pc.delay_til_file_gone" title="ttbl.pc.delay_til_file_gone"><code class="xref py py-class docutils literal"><span class="pre">ttbl.pc.delay_til_file_gone</span></code></a>); this is used when we
power off something (like a USB serial device) and we know that
as a consequence, udev will remove a device node from the
system.</li>
<li>powers up a serial port</li>
<li>connects the serial ports of the target (once it has been
powered up in the previous step)</li>
<li>powers up the target itself</li>
</ol>
<p>The power off sequence runs in the inverse, first powering off the
target and then the rest of the components.</p>
<p>These power rails are often necessary for very small, low power
devices, that can get resideual power leaks from anywhere, and
thus anything connected to it has to be powered off (in specific
sequences) to ensure the board fully powers off.</p>
<p>The optional tag <em>idle_poweroff</em> can be given to the target to
control how long the target has to be idle before it is powered
off. If 0, it will never be automatically powered off upon
iddleness. Defaults to <a class="reference internal" href="#ttbl.config.target_max_idle" title="ttbl.config.target_max_idle"><code class="xref py py-data docutils literal"><span class="pre">ttbl.config.target_max_idle</span></code></a>.</p>
<dl class="method">
<dt id="ttbl.tt_power_control_mixin.power_on">
<code class="descname">power_on</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_power_control_mixin.power_on" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_power_control_mixin.reset">
<code class="descname">reset</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_power_control_mixin.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the target (or power it on if off)</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_power_control_mixin.power_off">
<code class="descname">power_off</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_power_control_mixin.power_off" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_power_control_mixin.power_cycle">
<code class="descname">power_cycle</code><span class="sig-paren">(</span><em>who</em>, <em>wait=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_power_control_mixin.power_cycle" title="Permalink to this definition">¶</a></dt>
<dd><p>Power cycle the target, guaranteeing that at the end, it is
powered on.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#tuple" title="(in Python v2.7)"><em>tuple</em></a>) – Identity of the user</li>
<li><strong>wait</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – how much time to wait before powering on
after powering off.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.tt_power_control_mixin.power_state">
<code class="descname">power_state</code><em class="property"> = []</em><a class="headerlink" href="#ttbl.tt_power_control_mixin.power_state" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_power_control_mixin.power_get">
<code class="descname">power_get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_power_control_mixin.power_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.test_target_console_mixin">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">test_target_console_mixin</code><a class="headerlink" href="#ttbl.test_target_console_mixin" title="Permalink to this definition">¶</a></dt>
<dd><p>bidirectional input/output channel</p>
<p>FIXME:</p>
<ul class="simple">
<li>has to allow us to control a serial port (escape sequences?)</li>
<li>buffering? shall it read everything since power on?</li>
<li>serial port not necessarily the endpoint, but ability to set
baud rate and such must be considered</li>
<li>more than one channel?
<em>console_id</em> defaults to None, the first one defined by the
target, which is always available</li>
</ul>
<dl class="exception">
<dt id="ttbl.test_target_console_mixin.test_target_console_e">
<em class="property">exception </em><code class="descname">test_target_console_e</code><a class="headerlink" href="#ttbl.test_target_console_mixin.test_target_console_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.test_target_console_mixin.console_do_read">
<code class="descname">console_do_read</code><span class="sig-paren">(</span><em>console_id=None</em>, <em>offset=0</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_console_mixin.console_do_read" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>offset</strong> – Try to read output from given offset</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">an iterator with the output that <em>HAS TO BE DISPOSED
OF</em> with del once done.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">IndexError if console_id is not implemented,
ValueError if <em>all</em> is not supported.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target_console_mixin.console_do_write">
<code class="descname">console_do_write</code><span class="sig-paren">(</span><em>data</em>, <em>console_id=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_console_mixin.console_do_write" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – byte string to write to the console</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target_console_mixin.console_do_setup">
<code class="descname">console_do_setup</code><span class="sig-paren">(</span><em>console_id=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_console_mixin.console_do_setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Set console-specific parameters</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target_console_mixin.console_do_list">
<code class="descname">console_do_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_console_mixin.console_do_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return list of available <em>console_id</em>s</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target_console_mixin.console_read">
<code class="descname">console_read</code><span class="sig-paren">(</span><em>who</em>, <em>console_id=None</em>, <em>offset=0</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_console_mixin.console_read" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>offset</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – Try to read output from given offset</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">an iterator with the output that <em>HAS TO BE DISPOSED
OF</em> with del once done.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">IndexError if console_id is not implemented,
ValueError if <em>all</em> is not supported.</td>
</tr>
</tbody>
</table>
<p>Note the target does not have to be acquired to read off it’s
console. FIXME: makes sense?</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target_console_mixin.console_write">
<code class="descname">console_write</code><span class="sig-paren">(</span><em>who</em>, <em>data</em>, <em>console_id=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_console_mixin.console_write" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – byte string to write to the console</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target_console_mixin.console_setup">
<code class="descname">console_setup</code><span class="sig-paren">(</span><em>who</em>, <em>console_id=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_console_mixin.console_setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Set console-specific parameters</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target_console_mixin.console_list">
<code class="descname">console_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_console_mixin.console_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return list of available <em>console_id</em>s</p>
</dd></dl>

<dl class="exception">
<dt id="ttbl.test_target_console_mixin.expect_e">
<em class="property">exception </em><code class="descname">expect_e</code><a class="headerlink" href="#ttbl.test_target_console_mixin.expect_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.test_target_console_mixin.expect_failed_e">
<em class="property">exception </em><code class="descname">expect_failed_e</code><a class="headerlink" href="#ttbl.test_target_console_mixin.expect_failed_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.test_target_console_mixin.expect_timeout_e">
<em class="property">exception </em><code class="descname">expect_timeout_e</code><a class="headerlink" href="#ttbl.test_target_console_mixin.expect_timeout_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.test_target_console_mixin.EXPECT_TIMEOUT">
<code class="descname">EXPECT_TIMEOUT</code><em class="property"> = -1</em><a class="headerlink" href="#ttbl.test_target_console_mixin.EXPECT_TIMEOUT" title="Permalink to this definition">¶</a></dt>
<dd><p>Consider a timeout a valid event instead of raising
exceptions in <a class="reference internal" href="#ttbl.test_target_console_mixin.expect" title="ttbl.test_target_console_mixin.expect"><code class="xref py py-func docutils literal"><span class="pre">expect()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target_console_mixin.expect">
<code class="descname">expect</code><span class="sig-paren">(</span><em>expectations</em>, <em>timeout=20</em>, <em>console_id=None</em>, <em>offset=0</em>, <em>max_buffering=4096</em>, <em>poll_period=0.5</em>, <em>what=''</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_console_mixin.expect" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for any of a list of things to come off the given console</p>
<p>Waits for a maximum <em>timeout</em> to receive from a given console
any of the list of things provided as <em>expectations</em>, checking
with a <em>poll_period</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>expectations</strong> – list of strings and/or compiled regular
expressions for which to wait. It can also be the constant
<a class="reference internal" href="#ttbl.test_target_console_mixin.EXPECT_TIMEOUT" title="ttbl.test_target_console_mixin.EXPECT_TIMEOUT"><code class="xref py py-data docutils literal"><span class="pre">EXPECT_TIMEOUT</span></code></a>, in which case, a timeout is a valid
event to expect (instead of causing a <a class="reference internal" href="#ttbl.test_target_console_mixin.expect_timeout_e" title="ttbl.test_target_console_mixin.expect_timeout_e"><code class="xref py py-exc docutils literal"><span class="pre">exception</span></code></a>.</li>
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional, default 20) maximum time in
seconds to wait for any of the expectations.</li>
<li><strong>offset</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional, default 0) offset into the
console from which to read.</li>
<li><strong>max_buffering</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional, default 4k) how much to
look back into the read console data.</li>
<li><strong>poll_period</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – (optional) how often to poll for new
data</li>
<li><strong>what</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) string describing what we are
waiting for (for error messages/logs).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target_console_mixin.expect_sequence">
<code class="descname">expect_sequence</code><span class="sig-paren">(</span><em>sequence</em>, <em>timeout=20</em>, <em>offset=0</em>, <em>console_id=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_console_mixin.expect_sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute a list of expect/send commands to a console</p>
<p>Each step in the list can first send something, then expect to
recevive something to pass (or to fail) and then move on to
the next step until the whole sequence is completed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sequence</strong> – <p>List of dictionaries with the parameters:</p>
<ul>
<li>receive: string/regex of what is expected</li>
<li>fail: (optional) strings/regex of something that if received
will cause a failure</li>
<li>send: (optional) string to send after receiving <em>pass</em></li>
<li>wait: (optional) integer of time to wait before sending <em>send</em></li>
<li>delay: (optional) when sending <em>send</em>, delay <em>delay</em> seconds
in between characters (useful for slow readers)</li>
</ul>
<p>e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="nb">dict</span><span class="p">(</span><span class="n">receive</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;Expecting number [0-9]+&quot;</span><span class="p">),</span>
       <span class="n">fail</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;Error reading&quot;</span><span class="p">),</span>
       <span class="n">send</span> <span class="o">=</span> <span class="s2">&quot;I am good&quot;</span><span class="p">,</span>
       <span class="n">wait</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">delay</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">),</span>
  <span class="nb">dict</span><span class="p">(</span><span class="n">receive</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;Expecting number 1[0-9]+&quot;</span><span class="p">),</span>
       <span class="n">fail</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;Error reading&quot;</span><span class="p">))</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional, default 20s) maximum time in
seconds the operation has to conclude</li>
<li><strong>offset</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional, default 0) offset from which to
read in the console.</li>
<li><strong>console_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) console to use to read/write</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Nothing if everything went well, otherwise raises
exceptions <a class="reference internal" href="#ttbl.test_target_console_mixin.expect_timeout_e" title="ttbl.test_target_console_mixin.expect_timeout_e"><code class="xref py py-class docutils literal"><span class="pre">expect_timeout_e</span></code></a> or <a class="reference internal" href="#ttbl.test_target_console_mixin.expect_failed_e" title="ttbl.test_target_console_mixin.expect_failed_e"><code class="xref py py-class docutils literal"><span class="pre">expect_failed_e</span></code></a>.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.test_target_images_mixin">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">test_target_images_mixin</code><a class="headerlink" href="#ttbl.test_target_images_mixin" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="ttbl.test_target_images_mixin.error">
<em class="property">exception </em><code class="descname">error</code><a class="headerlink" href="#ttbl.test_target_images_mixin.error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.test_target_images_mixin.unsupported_image_e">
<em class="property">exception </em><code class="descname">unsupported_image_e</code><a class="headerlink" href="#ttbl.test_target_images_mixin.unsupported_image_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.test_target_images_mixin.image_type_check">
<code class="descname">image_type_check</code><span class="sig-paren">(</span><em>image_type</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_images_mixin.image_type_check" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.test_target_images_mixin.image_do_set">
<code class="descname">image_do_set</code><span class="sig-paren">(</span><em>image_type</em>, <em>image_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_images_mixin.image_do_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Take file <em>image_name</em> from target-broker storage for the
current user and write it to the target as <em>image-type</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">Any exception on failure</td>
</tr>
</tbody>
</table>
<p>This function has to be specialized for each target type. Upon
finishing, it has to leave the target in the powered off state.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target_images_mixin.images_do_set">
<code class="descname">images_do_set</code><span class="sig-paren">(</span><em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_images_mixin.images_do_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Called once image_do_set() has been called for every image.</p>
<p>This is for targets might need to flash all at the same time,
or some post flash steps.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">Any exception on failure</td>
</tr>
</tbody>
</table>
<p>This function has to be specialized for each target type. Upon
finishing, it has to leave the target in the powered off state.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target_images_mixin.images_set">
<code class="descname">images_set</code><span class="sig-paren">(</span><em>who</em>, <em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_images_mixin.images_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a series of images in the target so it can boot</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>images</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of image type names and image file
names. The file names are names of files uploaded to the broker.</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">Exception on failure</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.test_target_images_mixin.image_get">
<code class="descname">image_get</code><span class="sig-paren">(</span><em>image_type</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.test_target_images_mixin.image_get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt_debug_impl">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">tt_debug_impl</code><a class="headerlink" href="#ttbl.tt_debug_impl" title="Permalink to this definition">¶</a></dt>
<dd><p>Debug object implementation</p>
<dl class="method">
<dt id="ttbl.tt_debug_impl.debug_do_start">
<code class="descname">debug_do_start</code><span class="sig-paren">(</span><em>tt</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_impl.debug_do_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the debugging support for the target</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_impl.debug_do_stop">
<code class="descname">debug_do_stop</code><span class="sig-paren">(</span><em>tt</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_impl.debug_do_stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop the debugging support for the target</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_impl.debug_do_halt">
<code class="descname">debug_do_halt</code><span class="sig-paren">(</span><em>tt</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_impl.debug_do_halt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_impl.debug_do_reset">
<code class="descname">debug_do_reset</code><span class="sig-paren">(</span><em>tt</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_impl.debug_do_reset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_impl.debug_do_reset_halt">
<code class="descname">debug_do_reset_halt</code><span class="sig-paren">(</span><em>tt</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_impl.debug_do_reset_halt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_impl.debug_do_resume">
<code class="descname">debug_do_resume</code><span class="sig-paren">(</span><em>tt</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_impl.debug_do_resume" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_impl.debug_do_info">
<code class="descname">debug_do_info</code><span class="sig-paren">(</span><em>tt</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_impl.debug_do_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a string with information on how to connect to the
debugging target</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_impl.debug_do_openocd">
<code class="descname">debug_do_openocd</code><span class="sig-paren">(</span><em>tt</em>, <em>command</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_impl.debug_do_openocd" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a command to OpenOCD and return its output (if the target
supports it).</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt_debug_mixin">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">tt_debug_mixin</code><span class="sig-paren">(</span><em>impl=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_mixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic debug interface to start and stop debugging on a
target.</p>
<p>When debug is started before the target is powered up, then upon
power up, the debugger stub shall wait for a debugger to connect
before continuing execution.</p>
<p>When debug is started while the target is executing, the target
shall not be stopped and the debugging stub shall permit a
debugger to connect and interrupt the target upon connection.</p>
<p>Each target provides its own debug methodolody; to find out how to
connect, issue a debug-info command to find out where to connect
to.</p>
<dl class="method">
<dt id="ttbl.tt_debug_mixin.debug_start">
<code class="descname">debug_start</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_mixin.debug_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start debugging the target</p>
<p>If called before powering, the target will wait for the
debugger to connect before starting the kernel.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_mixin.debug_halt">
<code class="descname">debug_halt</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_mixin.debug_halt" title="Permalink to this definition">¶</a></dt>
<dd><p>Resume the target’s CPUs after a breakpoint (or similar) stop</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_mixin.debug_reset">
<code class="descname">debug_reset</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_mixin.debug_reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the target’s CPUs</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_mixin.debug_reset_halt">
<code class="descname">debug_reset_halt</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_mixin.debug_reset_halt" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the target’s CPUs</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_mixin.debug_resume">
<code class="descname">debug_resume</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_mixin.debug_resume" title="Permalink to this definition">¶</a></dt>
<dd><p>Resume the target</p>
<p>This is called to instruct the target to resume execution,
following any kind of breakpoint or stop that halted it.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_mixin.debug_info">
<code class="descname">debug_info</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_mixin.debug_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Return information about how to connect to the target to debug
it</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_mixin.debug_stop">
<code class="descname">debug_stop</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_mixin.debug_stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop debugging the target</p>
<p>This might not do anything on the target until power off, or
it might disconnect the debugger currently connected.</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_debug_mixin.debug_openocd">
<code class="descname">debug_openocd</code><span class="sig-paren">(</span><em>who</em>, <em>command</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_debug_mixin.debug_openocd" title="Permalink to this definition">¶</a></dt>
<dd><p>Run an OpenOCD command on the target’s controller (if the
target supports it).</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ttbl.open_close">
<code class="descclassname">ttbl.</code><code class="descname">open_close</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.open_close" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="ttbl.authenticator_c">
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">authenticator_c</code><a class="headerlink" href="#ttbl.authenticator_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class that defines the interface for an authentication system</p>
<p>Upone calling the constructor, it defines a set of roles that will
be returned by the <a class="reference internal" href="#ttbl.authenticator_c.login" title="ttbl.authenticator_c.login"><code class="xref py py-func docutils literal"><span class="pre">login()</span></code></a> if the tokens to be authenticated
are valid</p>
<dl class="staticmethod">
<dt id="ttbl.authenticator_c.login">
<em class="property">static </em><code class="descname">login</code><span class="sig-paren">(</span><em>token</em>, <em>password</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.authenticator_c.login" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate an authentication token exists and the password is valid.</p>
<p>If it is, extract whichever information from the
authentication system is needed to determine if the user
represented by the token is allowed to use the infrastructure
and which with category (as determined by the role mapping)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None if user is not allowed to log in, otherwise a
dictionary with user’s information:<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">roles</span><span class="p">:</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">strings</span> <span class="n">describing</span> <span class="n">roles</span> <span class="n">the</span> <span class="n">user</span> <span class="n">has</span>
</pre></div>
</div>
<p>FIXME: left as a dictionary so we can add more information later</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="exception">
<dt id="ttbl.authenticator_c.error_e">
<em class="property">exception </em><code class="descname">error_e</code><a class="headerlink" href="#ttbl.authenticator_c.error_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.authenticator_c.unknown_user_e">
<em class="property">exception </em><code class="descname">unknown_user_e</code><a class="headerlink" href="#ttbl.authenticator_c.unknown_user_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.authenticator_c.invalid_credentials_e">
<em class="property">exception </em><code class="descname">invalid_credentials_e</code><a class="headerlink" href="#ttbl.authenticator_c.invalid_credentials_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="ttbl.daemon_pid_add">
<code class="descclassname">ttbl.</code><code class="descname">daemon_pid_add</code><span class="sig-paren">(</span><em>pid</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.daemon_pid_add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ttbl.daemon_pid_check">
<code class="descclassname">ttbl.</code><code class="descname">daemon_pid_check</code><span class="sig-paren">(</span><em>pid</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.daemon_pid_check" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ttbl.daemon_pid_rm">
<code class="descclassname">ttbl.</code><code class="descname">daemon_pid_rm</code><span class="sig-paren">(</span><em>pid</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.daemon_pid_rm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ttbl.usb_find_dev_by_serial">
<code class="descclassname">ttbl.</code><code class="descname">usb_find_dev_by_serial</code><span class="sig-paren">(</span><em>cache</em>, <em>log</em>, <em>device_name</em>, <em>serial_number</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usb_find_dev_by_serial" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ttbl.usb_find_sibling_by_serial">
<code class="descclassname">ttbl.</code><code class="descname">usb_find_sibling_by_serial</code><span class="sig-paren">(</span><em>serial</em>, <em>port</em>, <em>log=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usb_find_sibling_by_serial" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a USB device <em>A</em> (with a <em>serial</em> number), find if there is
a USB device <em>B</em> that is connected to the same hub as <em>A</em> on a
given <em>port</em> and return it’s bus number and address</p>
</dd></dl>

<dl class="function">
<dt id="ttbl.usb_find_by_bus_address">
<code class="descclassname">ttbl.</code><code class="descname">usb_find_by_bus_address</code><span class="sig-paren">(</span><em>bus</em>, <em>address</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usb_find_by_bus_address" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a USB device descriptor given it’s bus and address</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>bus</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – bus number</li>
<li><strong>address</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – address in bus</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<span class="target" id="module-ttbl.fsdb"></span><dl class="class">
<dt id="ttbl.fsdb.fsdb">
<em class="property">class </em><code class="descclassname">ttbl.fsdb.</code><code class="descname">fsdb</code><span class="sig-paren">(</span><em>location</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fsdb.fsdb" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a veeeery simple file-system based ‘DB’, atomic access</p>
<ul class="simple">
<li>Atomic access is implemented by storing values in the target of
symlinks</li>
<li>the data stored is strings</li>
<li>the amount of data stored is thus limited (to 1k in OSX, 4k in
Linux/ext3, maybe others dep on the FS).</li>
</ul>
<p>Why? Because to create a symlink, there is only a system call
needed and is atomic. Same to read it. Thus, for small values, it
is very efficient.</p>
<p>Initialize the database to be saved in the give location
directory</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>location</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Directory where the database will be kept</td>
</tr>
</tbody>
</table>
<dl class="exception">
<dt id="ttbl.fsdb.fsdb.exception">
<em class="property">exception </em><code class="descname">exception</code><a class="headerlink" href="#ttbl.fsdb.fsdb.exception" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.fsdb.fsdb.uuid_ns">
<code class="descname">uuid_ns</code><em class="property"> = UUID('a03e9245-d90f-477c-9195-f06b854fd872')</em><a class="headerlink" href="#ttbl.fsdb.fsdb.uuid_ns" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.fsdb.fsdb.keys">
<code class="descname">keys</code><span class="sig-paren">(</span><em>pattern=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fsdb.fsdb.keys" title="Permalink to this definition">¶</a></dt>
<dd><p>List the fields/keys available in the database</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>pattern</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) pattern against the key names
must match, in the style of <a class="reference external" href="https://docs.python.org/2.7/library/fnmatch.html#module-fnmatch" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">fnmatch</span></code></a>. By default, all
keys are listed.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.fsdb.fsdb.set">
<code class="descname">set</code><span class="sig-paren">(</span><em>field</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fsdb.fsdb.set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a field in the database</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>field</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the field to set</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – value to stored; None to remove that field</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.fsdb.fsdb.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>field</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.fsdb.fsdb.get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<div class="section" id="module-ttbl.tt">
<span id="target-types-drivers"></span><h3>8.7.1. Target types drivers<a class="headerlink" href="#module-ttbl.tt" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="ttbl.tt.tt_serial">
<em class="property">class </em><code class="descclassname">ttbl.tt.</code><code class="descname">tt_serial</code><span class="sig-paren">(</span><em>id</em>, <em>power_control</em>, <em>serial_ports</em>, <em>_tags=None</em>, <em>target_type=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_serial" title="Permalink to this definition">¶</a></dt>
<dd><p>A generic test target, power switched with a pluggable power
control implementation and with one or more serial ports.</p>
<p>Example configuration:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tt_serial</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s2">&quot;minnow-01&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">power_control</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://URL&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">serial_ports</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="p">{</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;/dev/tty-minnow-01&quot;</span><span class="p">,</span> <span class="s2">&quot;baudrate&quot;</span><span class="p">:</span> <span class="mi">115200</span> <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">]),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;build_only&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;bsp_models&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="kc">None</span> <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;bsps&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">board</span> <span class="o">=</span> <span class="s1">&#39;minnowboard&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="n">console</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;minnow_max&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>With a udev configuration that generated the <code class="docutils literal"><span class="pre">/dev/tty-minnow-01</span></code>
name such as <code class="docutils literal"><span class="pre">/etc/udev/rules.d/SOMETHING.rules</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;tty&quot;</span><span class="p">,</span> <span class="n">ENV</span><span class="p">{</span><span class="n">ID_SERIAL_SHORT</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>         <span class="n">GROUP</span> <span class="o">=</span> <span class="s2">&quot;SOMEGROUP&quot;</span><span class="p">,</span> <span class="n">MODE</span> <span class="o">=</span> <span class="s2">&quot;0660&quot;</span><span class="p">,</span>         <span class="n">SYMLINK</span> <span class="o">+=</span> <span class="s2">&quot;tty-minnow-01&quot;</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>power_control</strong> – an instance of an implementation
of the power_control_mixin used to implement power control for
the target. Use ttbl.pc.manual() for manual power control that
requires user interaction.</li>
<li><strong>serial_ports</strong> – list of serial port dictionaries, specified
as for <a class="reference external" href="https://pythonhosted.org/pyserial/pyserial_api.html#serial.serial_for_url" title="(in pySerial v3.0)"><code class="xref py py-func docutils literal"><span class="pre">serial.serial_for_url()</span></code></a> with a couple of extras as
specified in <a class="reference internal" href="#module-ttbl.cm_serial" title="ttbl.cm_serial"><code class="xref py py-class docutils literal"><span class="pre">ttbl.cm_serial</span></code></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="ttbl.tt.tt_power">
<em class="property">class </em><code class="descclassname">ttbl.tt.</code><code class="descname">tt_power</code><span class="sig-paren">(</span><em>id</em>, <em>power_control</em>, <em>power=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_power" title="Permalink to this definition">¶</a></dt>
<dd><p>A generic test target for just power control</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">ttbl</span><span class="o">.</span><span class="n">tt</span><span class="o">.</span><span class="n">tt_power</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="n">URL</span><span class="p">),</span> <span class="n">power</span> <span class="o">=</span> <span class="kc">None</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">tags</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">idle_poweroff</span> <span class="o">=</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>power</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – if specified, switch the power of the target
upon initialization; <em>True</em> powers it on, <em>False</em> powers it
off, <em>None</em> does nothing.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="ttbl.tt.tt_power_lc">
<em class="property">class </em><code class="descclassname">ttbl.tt.</code><code class="descname">tt_power_lc</code><span class="sig-paren">(</span><em>id</em>, <em>power_control</em>, <em>power=None</em>, <em>consoles=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_power_lc" title="Permalink to this definition">¶</a></dt>
<dd><p>A generic test target for just power control and fake loopback consoles</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">ttbl</span><span class="o">.</span><span class="n">tt</span><span class="o">.</span><span class="n">tt_power</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="n">URL</span><span class="p">),</span> <span class="n">power</span> <span class="o">=</span> <span class="kc">None</span><span class="p">))</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>power</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – if specified, switch the power of the target
upon initialization; <em>True</em> powers it on, <em>False</em> powers it
off, <em>None</em> does nothing.</li>
<li><strong>consoles</strong> – see <a class="reference internal" href="#ttbl.cm_loopback.cm_loopback" title="ttbl.cm_loopback.cm_loopback"><code class="xref py py-class docutils literal"><span class="pre">ttbl.cm_loopback.cm_loopback</span></code></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="ttbl.tt.tt_arduino2">
<em class="property">class </em><code class="descclassname">ttbl.tt.</code><code class="descname">tt_arduino2</code><span class="sig-paren">(</span><em>_id</em>, <em>serial_port</em>, <em>power_control=None</em>, <em>bossac_cmd='bossac'</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_arduino2" title="Permalink to this definition">¶</a></dt>
<dd><p>Test target for a target flashable with the bossac tool (mostly
Arduino Due)</p>
<p><em>Requirements</em></p>
<ul>
<li><p class="first">Needs a connection to the USB  programming port</p>
</li>
<li><p class="first">Uses the bossac utility built on the <em>arduino</em> branch from
<a class="reference external" href="https://github.com/shumatech/BOSSA/tree/arduino">https://github.com/shumatech/BOSSA/tree/arduino</a>; requires it
to be installed in the path <code class="docutils literal"><span class="pre">bossac_cmd</span></code> (defaults to sytem
path). Supports <code class="docutils literal"><span class="pre">kernel{,-arm}</span></code> images:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git clone https://github.com/shumatech/BOSSA.git bossac.git
$ cd bossac.git
$ make -k
$ sudo install -o root -g root bin/bossac /usr/local/bin
</pre></div>
</div>
</li>
<li><p class="first">TTY devices need to be properly configured permission wise for
bossac and serial console to work; for such, choose a Unix group
which can get access to said devices and add udev rules such as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Arduino2 boards: allow reading USB descriptors</span>
<span class="n">SUBSYSTEM</span><span class="o">==</span><span class="s2">&quot;usb&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">idVendor</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;2a03&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">idProduct</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;003d&quot;</span><span class="p">,</span>               <span class="n">GROUP</span><span class="o">=</span><span class="s2">&quot;GROUPNAME&quot;</span><span class="p">,</span> <span class="n">MODE</span> <span class="o">=</span> <span class="s2">&quot;660&quot;</span>

<span class="c1"># Arduino2 boards: allow reading serial port</span>
<span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;tty&quot;</span><span class="p">,</span> <span class="n">ENV</span><span class="p">{</span><span class="n">ID_SERIAL_SHORT</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;SERIALNUMBER&quot;</span><span class="p">,</span>               <span class="n">GROUP</span> <span class="o">=</span> <span class="s2">&quot;GROUPNAME&quot;</span><span class="p">,</span> <span class="n">MODE</span> <span class="o">=</span> <span class="s2">&quot;0660&quot;</span><span class="p">,</span>               <span class="n">SYMLINK</span> <span class="o">+=</span> <span class="s2">&quot;tty-TARGETNAME&quot;</span>
</pre></div>
</div>
</li>
</ul>
<p>The theory of operation is quite simple. According to
<a class="reference external" href="https://www.arduino.cc/en/Guide/ArduinoDue#toc4">https://www.arduino.cc/en/Guide/ArduinoDue#toc4</a>, the Due will
erase the flash if you open the programming port at 1200bps
and then start a reset process and launch the flash when you
open the port at 115200. This is not so clear in the URL
above, but this is what expermientation found.</p>
<p>So for flashing, we’ll take over the console, set the serial
port to 1200bps, wait a wee bit and then call bossac.</p>
<p>We need power control to fully reset the Arduino Due when it
gets in a tight spot (and to save power when not using it).
There is no reset, we just power cycle – found no way to do a
reset in SW without erasing the flash.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name identifying the target</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – File name of the device node
representing the serial port this device is connected to.</li>
<li><strong>power_control</strong> (<a class="reference internal" href="#ttbl.tt_power_control_impl" title="ttbl.tt_power_control_impl"><em>ttbl.tt_power_control_impl</em></a>) – power controller
(if any)</li>
<li><strong>bossac_cmd</strong> – Path and file where to find the <cite>bossac</cite>
utility.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="ttbl.tt.tt_arduino2.bossac_cmd">
<code class="descname">bossac_cmd</code><em class="property"> = 'bossac'</em><a class="headerlink" href="#ttbl.tt.tt_arduino2.bossac_cmd" title="Permalink to this definition">¶</a></dt>
<dd><p>Command to call to execute the BOSSA command line flasher</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_arduino2.image_do_set">
<code class="descname">image_do_set</code><span class="sig-paren">(</span><em>image_type</em>, <em>image_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_arduino2.image_do_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Just validates the image types are ok. The flashing happens in
images_do_set().</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image_type</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) – Type of the image supported</li>
<li><strong>image_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) – Name of image file in the daemon
storage space for the user</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last">Any exception on failure</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_arduino2.images_do_set">
<code class="descname">images_do_set</code><span class="sig-paren">(</span><em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_arduino2.images_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt.tt_esp32">
<em class="property">class </em><code class="descclassname">ttbl.tt.</code><code class="descname">tt_esp32</code><span class="sig-paren">(</span><em>_id</em>, <em>serial_number</em>, <em>power_control</em>, <em>serial_port</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_esp32" title="Permalink to this definition">¶</a></dt>
<dd><p>Test target ESP32 Tensilica based MCUs that use the ESP-IDF framework</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name identifying the target</li>
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Unique USB serial number of the device (can
be updated with <a class="reference external" href="http://cp210x-program.sourceforge.net/">http://cp210x-program.sourceforge.net/</a>)</li>
<li><strong>power_control</strong> – Power control implementation or rail
(<a class="reference internal" href="#ttbl.tt_power_control_impl" title="ttbl.tt_power_control_impl"><code class="xref py py-class docutils literal"><span class="pre">ttbl.tt_power_control_impl</span></code></a> or list of such)</li>
<li><strong>serial_port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Device name of the serial port where
the console will be found. This can be set with udev to be a
constant name.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The base code will convert the <em>ELF</em> image to the required
<em>bin</em> image using the <code class="docutils literal"><span class="pre">esptool.py</span></code> script. Then it will
flash it via the serial port.</p>
<p><em>Requirements</em></p>
<ul>
<li><p class="first">The ESP-IDK framework, of which <code class="docutils literal"><span class="pre">esptool.py</span></code> is used to
flash the target; to install:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd /opt
$ git clone --recursive https://github.com/espressif/esp-idf.git
</pre></div>
</div>
<p>(note the <code class="docutils literal"><span class="pre">--recursive</span></code>!! it is needed so all the
submodules are picked up)</p>
<p>configure path to it globally by setting
<a class="reference internal" href="#ttbl.tt.tt_esp32.esptool_path" title="ttbl.tt.tt_esp32.esptool_path"><code class="xref py py-attr docutils literal"><span class="pre">esptool_path</span></code></a> in a /etc/ttbd-production/conf_*.py file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ttbl.tt</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">tt</span><span class="o">.</span><span class="n">tt_esp32</span><span class="o">.</span><span class="n">esptool_path</span> <span class="o">=</span> <span class="s2">&quot;/opt/esp-idf/components/esptool_py/esptool/esptool.py&quot;</span>
</pre></div>
</div>
<p>Note you will also most likely need this in the client to
compile code for the board.</p>
</li>
<li><p class="first">Permissions to use USB devices in <em>/dev/bus/usb</em> are needed;
<em>ttbd</em> usually roots with group <em>root</em>, which shall be
enough.</p>
</li>
<li><p class="first">Needs power control for proper operation; FIXME: pending to
make it operate without power control, using <code class="docutils literal"><span class="pre">esptool.py</span></code>.</p>
</li>
</ul>
<dl class="attribute">
<dt id="ttbl.tt.tt_esp32.esptool_path">
<code class="descname">esptool_path</code><em class="property"> = '__unconfigured__tt_esp32.esptool_path__'</em><a class="headerlink" href="#ttbl.tt.tt_esp32.esptool_path" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_esp32.images_do_set">
<code class="descname">images_do_set</code><span class="sig-paren">(</span><em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_esp32.images_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_esp32.image_do_set">
<code class="descname">image_do_set</code><span class="sig-paren">(</span><em>image_type</em>, <em>image_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_esp32.image_do_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Just validates the image types are ok. The flashing happens in
images_do_set().</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image_type</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) – Type of the image supported</li>
<li><strong>image_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) – Name of image file in the daemon
storage space for the user</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last">Any exception on failure</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt.tt_flasher">
<em class="property">class </em><code class="descclassname">ttbl.tt.</code><code class="descname">tt_flasher</code><span class="sig-paren">(</span><em>_id</em>, <em>serial_ports</em>, <em>flasher</em>, <em>power_control</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher" title="Permalink to this definition">¶</a></dt>
<dd><p>Test target flashable, power switchable with debuggin</p>
<p>Any target which supports the <a class="reference internal" href="#ttbl.flasher.flasher_c" title="ttbl.flasher.flasher_c"><code class="xref py py-class docutils literal"><span class="pre">ttbl.flasher.flasher_c</span></code></a>
interface can be used, mostly OpenOCD targets.</p>
<p>How we use this, is for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">flasher_openocd</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">flasher</span><span class="o">.</span><span class="n">openocd_c</span><span class="p">(</span><span class="s2">&quot;frdm_k64f&quot;</span><span class="p">,</span> <span class="n">FRDM_SERIAL</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                         <span class="n">openocd10_path</span><span class="p">,</span> <span class="n">openocd10_scripts</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">ttbl</span><span class="o">.</span><span class="n">tt</span><span class="o">.</span><span class="n">tt_flasher</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">NAME</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">serial_ports</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="s2">&quot;pc&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="nb">dict</span><span class="p">(</span><span class="n">port</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-NAME&quot;</span><span class="p">,</span> <span class="n">baudrate</span> <span class="o">=</span> <span class="mi">115200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">flasher</span> <span class="o">=</span> <span class="n">flasher_obj</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">power_control</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">ttbl</span><span class="o">.</span><span class="n">pc_ykush</span><span class="o">.</span><span class="n">ykush</span><span class="p">(</span><span class="n">YKUSH_SERIAL</span><span class="p">,</span> <span class="n">YKUSH_PORT</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c1"># delay until device comes up</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay_til_usb_device</span><span class="p">(</span><span class="n">FRDM_SERIAL</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">ttbl</span><span class="o">.</span><span class="n">cm_serial</span><span class="o">.</span><span class="n">pc</span><span class="p">(),</span>    <span class="c1"># Connect serial ports</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">flasher_openocd</span><span class="p">,</span>        <span class="c1"># Start / stop OpenOCD</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;bsp_models&#39;</span> <span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;arm&#39;</span><span class="p">:</span> <span class="kc">None</span> <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;bsps&#39;</span> <span class="p">:</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="s2">&quot;arm&quot;</span><span class="p">:</span>  <span class="nb">dict</span><span class="p">(</span><span class="n">board</span> <span class="o">=</span> <span class="s2">&quot;frdm_k64f&quot;</span><span class="p">,</span> <span class="n">kernelname</span> <span class="o">=</span> <span class="s1">&#39;zephyr.bin&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">kernel</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;micro&quot;</span><span class="p">,</span> <span class="s2">&quot;nano&quot;</span> <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">console</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">quark_se_stub</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;slow_flash_factor&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>     <span class="c1"># Flash verification slow</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;flash_verify&#39;</span><span class="p">:</span> <span class="s1">&#39;False&#39;</span><span class="p">,</span>    <span class="c1"># Or disable it ...</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;frdm_k64f&quot;</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – target name</li>
<li><strong>serial_ports</strong> – list of serial port dictionaries,
specified as for <a class="reference external" href="https://pythonhosted.org/pyserial/pyserial_api.html#serial.serial_for_url" title="(in pySerial v3.0)"><code class="xref py py-func docutils literal"><span class="pre">serial.serial_for_url()</span></code></a> with a couple
of extras as specified in <a class="reference internal" href="#module-ttbl.cm_serial" title="ttbl.cm_serial"><code class="xref py py-class docutils literal"><span class="pre">ttbl.cm_serial</span></code></a>.</li>
<li><strong>flasher</strong> (<a class="reference internal" href="#ttbl.flasher.flasher_c" title="ttbl.flasher.flasher_c"><em>ttbl.flasher.flasher_c</em></a>) – flashing object that
provides access to deploy images and debug control</li>
<li><strong>power_control</strong> – an instance of an implementation
of the power_control_mixin used to implement power control for
the target. Use ttbl.pc.manual() for manual power control that
requires user interaction.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="exception">
<dt id="ttbl.tt.tt_flasher.error">
<em class="property">exception </em><code class="descname">error</code><a class="headerlink" href="#ttbl.tt.tt_flasher.error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.debug_do_start">
<code class="descname">debug_do_start</code><span class="sig-paren">(</span><em>tt_ignored</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.debug_do_start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.debug_do_halt">
<code class="descname">debug_do_halt</code><span class="sig-paren">(</span><em>_</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.debug_do_halt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.debug_do_reset">
<code class="descname">debug_do_reset</code><span class="sig-paren">(</span><em>_</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.debug_do_reset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.debug_do_reset_halt">
<code class="descname">debug_do_reset_halt</code><span class="sig-paren">(</span><em>_</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.debug_do_reset_halt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.debug_do_resume">
<code class="descname">debug_do_resume</code><span class="sig-paren">(</span><em>_</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.debug_do_resume" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.debug_do_stop">
<code class="descname">debug_do_stop</code><span class="sig-paren">(</span><em>_</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.debug_do_stop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.debug_do_info">
<code class="descname">debug_do_info</code><span class="sig-paren">(</span><em>_</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.debug_do_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.debug_do_openocd">
<code class="descname">debug_do_openocd</code><span class="sig-paren">(</span><em>_</em>, <em>command</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.debug_do_openocd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.target_reset_halt">
<code class="descname">target_reset_halt</code><span class="sig-paren">(</span><em>for_what=''</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.target_reset_halt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.target_reset">
<code class="descname">target_reset</code><span class="sig-paren">(</span><em>for_what=''</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.target_reset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.power_on_do_post">
<code class="descname">power_on_do_post</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.power_on_do_post" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.power_off_do_pre">
<code class="descname">power_off_do_pre</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.power_off_do_pre" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.reset_do">
<code class="descname">reset_do</code><span class="sig-paren">(</span><em>_</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.reset_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.image_do_set">
<code class="descname">image_do_set</code><span class="sig-paren">(</span><em>image_type</em>, <em>image_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.image_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_flasher.images_do_set">
<code class="descname">images_do_set</code><span class="sig-paren">(</span><em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_flasher.images_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt.tt_dfu">
<em class="property">class </em><code class="descclassname">ttbl.tt.</code><code class="descname">tt_dfu</code><span class="sig-paren">(</span><em>_id</em>, <em>serial_number</em>, <em>power_control</em>, <em>power_control_board</em>, <em>serial_ports=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_dfu" title="Permalink to this definition">¶</a></dt>
<dd><p>Test target for a flashable with DFU Utils</p>
<p><em>Requirements</em></p>
<ul class="simple">
<li>Needs a connection to the USB port that exposes a DFU
interface upon boot</li>
<li>Uses the dfu-utils utility, available for most (if not all)
Linux distributions</li>
<li>Permissions to use USB devices in <em>/dev/bus/usb</em> are needed;
<em>ttbd</em> usually roots with group <em>root</em>, which shall be
enough.</li>
<li>Needs power control for proper operation</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name identifying the target</li>
<li><strong>power_control</strong> (<a class="reference internal" href="#ttbl.tt_power_control_impl" title="ttbl.tt_power_control_impl"><em>ttbl.tt_power_control_impl</em></a>) – Power control implementation or rail
(<a class="reference internal" href="#ttbl.tt_power_control_impl" title="ttbl.tt_power_control_impl"><code class="xref py py-class docutils literal"><span class="pre">ttbl.tt_power_control_impl</span></code></a> or list of such)</li>
<li><strong>power_control</strong> – power controller
<em>just</em> for the board–this is the component in the power
control rail that controls the board only (versus other
parts such as serial ports or pseudo-power-controllers that
wait for the USB device to pop up.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note the tags to the target must include, on each supported
BSP, a tag named <em>dfu_interface_name</em> listing the name of the
<em>altsetting</em> of the DFU interface to which the image for said
BSP needs to be flashed.</p>
<p>This can be found, when the device exposes the DFU interfaces
with the <em>lsusb -v</em> command; for example, for a tinyTILE
(output summarized for clarity):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ lsusb -v
...
Bus 002 Device 110: ID 8087:0aba Intel Corp.
Device Descriptor:
  bLength                18
  bDescriptorType         1
  ...
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update...
      iInterface              4 x86_rom
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update...
      iInterface              5 x86_boot
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface              6 x86_app
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface              7 config
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface              8 panic
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface              9 events
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface             10 logs
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface             11 sensor_core
    Interface Descriptor:
      bInterfaceClass       254 Application Specific Interface
      bInterfaceSubClass      1 Device Firmware Update
      iInterface             12 ble_core
</pre></div>
</div>
<p>In this case, the three cores available are x86 (x86_app), arc
(sensor_core) and ARM (ble_core).</p>
<p><em>Example</em></p>
<p>A Tiny Tile can be connected, without exposing a serial console:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pc_board</span> <span class="o">=</span> <span class="n">ttbl</span><span class="o">.</span><span class="n">pc_ykush</span><span class="o">.</span><span class="n">ykush</span><span class="p">(</span><span class="s2">&quot;YK22909&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tt_dfu</span><span class="p">(</span><span class="s2">&quot;ti-01&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>           <span class="n">serial_number</span> <span class="o">=</span> <span class="s2">&quot;5614010001031629&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>           <span class="n">power_control</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>               <span class="n">pc_board</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>               <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay_til_usb_device</span><span class="p">(</span><span class="s2">&quot;5614010001031629&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>           <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>           <span class="n">power_control_board</span> <span class="o">=</span> <span class="n">pc_board</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;bsp_models&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;x86+arc&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x86&#39;</span><span class="p">,</span> <span class="s1">&#39;arc&#39;</span><span class="p">],</span> <span class="s1">&#39;x86&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;arc&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="s1">&#39;bsps&#39;</span> <span class="p">:</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="s2">&quot;x86&quot;</span><span class="p">:</span>  <span class="nb">dict</span><span class="p">(</span><span class="n">zephyr_board</span> <span class="o">=</span> <span class="s2">&quot;tinytile&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">zephyr_kernelname</span> <span class="o">=</span> <span class="s1">&#39;zephyr.bin&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">dfu_interface_name</span> <span class="o">=</span> <span class="s2">&quot;x86_app&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">console</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="s2">&quot;arm&quot;</span><span class="p">:</span>  <span class="nb">dict</span><span class="p">(</span><span class="n">zephyr_board</span> <span class="o">=</span> <span class="s2">&quot;arduino_101_ble&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">zephyr_kernelname</span> <span class="o">=</span> <span class="s1">&#39;zephyr.bin&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">dfu_interface_name</span> <span class="o">=</span> <span class="s2">&quot;ble_core&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">console</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="s2">&quot;arc&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">zephyr_board</span> <span class="o">=</span> <span class="s2">&quot;arduino_101_sss&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="n">zephyr_kernelname</span> <span class="o">=</span> <span class="s1">&#39;zephyr.bin&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="n">dfu_interface_name</span> <span class="o">=</span> <span class="s1">&#39;sensor_core&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                        <span class="n">console</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">},</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;tile&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="ttbl.tt.tt_dfu.images_do_set">
<code class="descname">images_do_set</code><span class="sig-paren">(</span><em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_dfu.images_do_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Just validates the image types are ok. The flashing happens in
images_do_set().</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image_type</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) – Type of the image supported</li>
<li><strong>image_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) – Name of image file in the daemon
storage space for the user</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last">Any exception on failure</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_dfu.image_do_set">
<code class="descname">image_do_set</code><span class="sig-paren">(</span><em>t</em>, <em>n</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_dfu.image_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt.tt_max10">
<em class="property">class </em><code class="descclassname">ttbl.tt.</code><code class="descname">tt_max10</code><span class="sig-paren">(</span><em>_id</em>, <em>device_id</em>, <em>power_control</em>, <em>serial_port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_max10" title="Permalink to this definition">¶</a></dt>
<dd><p>Test target for an Altera MAX10</p>
<p>This allows to flash images to an Altera MAX10, using the Quartus
tools, freely downloadable from <a class="reference external" href="http://dl.altera.com">http://dl.altera.com</a>.</p>
<p>Exports the following interfaces:</p>
<ul class="simple">
<li>power control (using any AC power switch, such as the
<a class="reference internal" href="#ttbl.pc.dlwps7" title="ttbl.pc.dlwps7"><code class="xref py py-class docutils literal"><span class="pre">Digital</span> <span class="pre">Web</span> <span class="pre">Power</span> <span class="pre">Switch</span> <span class="pre">7</span></code></a>)</li>
<li>serial console</li>
<li>image (in hex format) flashing (using the Quartus Prime tools
package)</li>
</ul>
<p>Multiple instances at the same time are supported; however, due to
the JTAG interface not exporting a serial number, addressing has
to be done by USB path, which is risky (as it will change when the
cable is plugged to another port or might be enumerated in a
different number).</p>
<p>Note that:</p>
<ul class="simple">
<li>when flashing LED1 blinks green/blue</li>
<li>the blue power switch must be pressed, to ensure the board is
<em>ON</em> when we switch the AC power to the power brick on</li>
<li>SW2 DIP bank on the back of the board has to be all OFF (down)
except for 3, that has to be ON (this comes from the Zephyr
Altera MAX10 configuration)</li>
<li>J7 (at the front of the board, next to the coaxial connectors)
has to be open</li>
</ul>
<p>Pending:</p>
<ul class="simple">
<li>CPU design hardcoded to use Zephyr’s – it shall be possible to
flash it</li>
</ul>
<dl class="attribute">
<dt id="ttbl.tt.tt_max10.quartus_path">
<code class="descname">quartus_path</code><em class="property"> = '__unconfigured__tt_max10.quartus_path__'</em><a class="headerlink" href="#ttbl.tt.tt_max10.quartus_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Path where the Quartus Programmer binaries have been installed</p>
<ol class="arabic">
<li><p class="first">Download Quartus Prime Programmer and Tools from
<a class="reference external" href="http://dl.altera.com/17.1/?edition=lite&amp;platform=linux&amp;download_manager=direct">http://dl.altera.com/17.1/?edition=lite&amp;platform=linux&amp;download_manager=direct</a></p>
</li>
<li><p class="first">Install to e.g <cite>/opt/intelFPGA/17.1/qprogrammer/bin</cite>.</p>
</li>
<li><p class="first">Configure in /etc/ttbd-production/conf_00_max10.py:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">:</span> <span class="n">python</span>
</pre></div>
</div>
<blockquote>
<div><p>import ttbl.tt
ttbl.tt.tt_max10.quartus_path = “/opt/intelFPGA/17.1/qprogrammer/bin”</p>
</div></blockquote>
</li>
</ol>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.tt.tt_max10.input_sof">
<code class="descname">input_sof</code><em class="property"> = '__unconfigured__tt_max10.input_sof__'</em><a class="headerlink" href="#ttbl.tt.tt_max10.input_sof" title="Permalink to this definition">¶</a></dt>
<dd><p>Path to where the NIOS Zephyr CPU image has been installed</p>
<ol class="arabic">
<li><p class="first">Download the CPU image to <cite>/var/lib/ttbd</cite>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ wget -O /var/lib/ttbd/ghrd_10m50da.sof \
     https://github.com/zephyrproject-rtos/zephyr/raw/master/arch/nios2/soc/nios2f-zephyr/cpu/ghrd_10m50da.sof
</pre></div>
</div>
</li>
</ol>
<ol class="arabic simple" start="3">
<li>Configure in /etc/ttbd-production/conf_00_max10.py:</li>
</ol>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.tt.tt_max10.quartus_cpf_template">
<code class="descname">quartus_cpf_template</code><em class="property"> = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;US-ASCII&quot; standalone=&quot;yes&quot;?&gt;\n&lt;cof&gt;\n\t&lt;output_filename&gt;${OUTPUT_FILENAME}&lt;/output_filename&gt;\n\t&lt;n_pages&gt;1&lt;/n_pages&gt;\n\t&lt;width&gt;1&lt;/width&gt;\n\t&lt;mode&gt;14&lt;/mode&gt;\n\t&lt;sof_data&gt;\n\t\t&lt;user_name&gt;Page_0&lt;/user_name&gt;\n\t\t&lt;page_flags&gt;1&lt;/page_flags&gt;\n\t\t&lt;bit0&gt;\n\t\t\t&lt;sof_filename&gt;${SOF_FILENAME}&lt;compress_bitstream&gt;1&lt;/compress_bitstream&gt;&lt;/sof_filename&gt;\n\t\t&lt;/bit0&gt;\n\t&lt;/sof_data&gt;\n\t&lt;version&gt;10&lt;/version&gt;\n\t&lt;create_cvp_file&gt;0&lt;/create_cvp_file&gt;\n\t&lt;create_hps_iocsr&gt;0&lt;/create_hps_iocsr&gt;\n\t&lt;auto_create_rpd&gt;0&lt;/auto_create_rpd&gt;\n\t&lt;rpd_little_endian&gt;1&lt;/rpd_little_endian&gt;\n\t&lt;options&gt;\n\t\t&lt;map_file&gt;1&lt;/map_file&gt;\n\t&lt;/options&gt;\n\t&lt;MAX10_device_options&gt;\n\t\t&lt;por&gt;0&lt;/por&gt;\n\t\t&lt;io_pullup&gt;1&lt;/io_pullup&gt;\n\t\t&lt;config_from_cfm0_only&gt;0&lt;/config_from_cfm0_only&gt;\n\t\t&lt;isp_source&gt;0&lt;/isp_source&gt;\n\t\t&lt;verify_protect&gt;0&lt;/verify_protect&gt;\n\t\t&lt;epof&gt;0&lt;/epof&gt;\n\t\t&lt;ufm_source&gt;2&lt;/ufm_source&gt;\n\t\t&lt;ufm_filepath&gt;${KERNEL_FILENAME}&lt;/ufm_filepath&gt;\n\t&lt;/MAX10_device_options&gt;\n\t&lt;advanced_options&gt;\n\t\t&lt;ignore_epcs_id_check&gt;2&lt;/ignore_epcs_id_check&gt;\n\t\t&lt;ignore_condone_check&gt;2&lt;/ignore_condone_check&gt;\n\t\t&lt;plc_adjustment&gt;0&lt;/plc_adjustment&gt;\n\t\t&lt;post_chain_bitstream_pad_bytes&gt;-1&lt;/post_chain_bitstream_pad_bytes&gt;\n\t\t&lt;post_device_bitstream_pad_bytes&gt;-1&lt;/post_device_bitstream_pad_bytes&gt;\n\t\t&lt;bitslice_pre_padding&gt;1&lt;/bitslice_pre_padding&gt;\n\t&lt;/advanced_options&gt;\n&lt;/cof&gt;\n'</em><a class="headerlink" href="#ttbl.tt.tt_max10.quartus_cpf_template" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.tt.tt_max10.quartus_pgm_template">
<code class="descname">quartus_pgm_template</code><em class="property"> = '/* Quartus Prime Version 16.0.0 Build 211 04/27/2016 SJ Lite Edition */\nJedecChain;\n\tFileRevision(JESD32A);\n\tDefaultMfr(6E);\n\n\tP ActionCode(Cfg)\n\t\tDevice PartName(10M50DAF484ES) Path(&quot;${POF_DIR}/&quot;) File(&quot;${POF_FILE}&quot;) MfrSpec(OpMask(1));\n\nChainEnd;\n\nAlteraBegin;\n\tChainType(JTAG);\nAlteraEnd;'</em><a class="headerlink" href="#ttbl.tt.tt_max10.quartus_pgm_template" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_max10.images_do_set">
<code class="descname">images_do_set</code><span class="sig-paren">(</span><em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_max10.images_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.tt_max10.image_do_set">
<code class="descname">image_do_set</code><span class="sig-paren">(</span><em>image_type</em>, <em>image_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.tt_max10.image_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt.grub2elf">
<em class="property">class </em><code class="descclassname">ttbl.tt.</code><code class="descname">grub2elf</code><span class="sig-paren">(</span><em>_id</em>, <em>power_controller</em>, <em>usb_drive_serial</em>, <em>usbrly08b_serial</em>, <em>usbrly08b_bank</em>, <em>serial_port</em>, <em>boot_coercer=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.grub2elf" title="Permalink to this definition">¶</a></dt>
<dd><p>Boot anything that can take an ELF image with grub2</p>
<p><strong>Overview</strong></p>
<p>A platform that can EFI boot off a multiplexed boot USB drive;
this drive:</p>
<ul class="simple">
<li>when connected to the target, acts as boot drive which boots
into grub2 which multiboots into whatever ELF binary we gave it</li>
<li>when connected to the server, we partition, format, install
grub2 and the ELF kernel to be booted.</li>
</ul>
<p>An eight-port USBRLY8 relay bank acting as a USB switcher, each
relay switching one of the four USB lines from target to server,
using <a class="reference internal" href="#ttbl.usbrly08b.plugger" title="ttbl.usbrly08b.plugger"><code class="xref py py-class docutils literal"><span class="pre">ttbl.usbrly08b.plugger</span></code></a>:</p>
<ul class="simple">
<li>the USB-A female cable is connected to the C relay terminals</li>
<li>the USB-A male cable for the server is connected to the NC relay
terminals</li>
<li>the USB-A male cable for the client is connected to the NO relay
terminal</li>
<li>a target that EFI/boots and can boot off a USB drive</li>
</ul>
<p>Limitations:</p>
<ul class="simple">
<li>kinda hardcoded x86-64, shall be easy to fix</li>
</ul>
<p><strong>Methodology</strong></p>
<p>The power rail for the target ensures that when the target is
powered on, the USB boot drive is connected to the target by the
USB multiplexor. When the target is off, the USB boot drive is
connected to the server.</p>
<p>The imaging process in <a class="reference internal" href="#ttbl.tt.grub2elf.image_do_set" title="ttbl.tt.grub2elf.image_do_set"><code class="xref py py-meth docutils literal"><span class="pre">image_do_set()</span></code></a> will make sure the USB
drive is connected to the server (by powering off the target) and
then use the helper script <code class="docutils literal"><span class="pre">/usr/share/tcf/setup-efi-grub2-elf.sh</span></code>
to flash the ELF kernel to the drive (as well, will create the
grub2 boot structure)–for this we need the drive’s USB serial
number and the ELF file  to boot.</p>
<p>Upon boot, the boot drive will be detected and booted by default,
as the grub configuration is set to just boot that ELF kernel.</p>
<p>For cases where BIOS interaction with the console might be
necessary, a boot coercer can be implemented in the form of a
power control implementation that in its <cite>power_on_do()</cite> method
talks to the serial port to do whatever is needed. See for example
<a class="reference internal" href="#conf_00_lib.minnowboard_EFI_boot_grub_pc" title="conf_00_lib.minnowboard_EFI_boot_grub_pc"><code class="xref py py-class docutils literal"><span class="pre">conf_00_lib.minnowboard_EFI_boot_grub_pc</span></code></a> which does so
for Minnowboards.</p>
<p><strong>Setup</strong></p>
<ul>
<li><p class="first">the helper script <code class="docutils literal"><span class="pre">/usr/share/tcf/setup-efi-grub2-elf.sh</span></code> is
used to partition, configure and setup the USB drive–it
is run with <em>sudo</em> (via the sudo configurations script
<a class="reference download internal" href="../_downloads/ttbd_sudo" download=""><code class="xref download docutils literal"><span class="pre">/etc/sudoers.d/ttbd_sudo</span></code></a>)</p>
</li>
<li><p class="first">The daemon will require specific capabilities for being able to
run <em>sudo</em> (<em>CAP_SETGID</em>, <em>CAP_SETUID</em>, <em>CAP_SYS_ADMIN</em>,
<em>CAP_FOWNER</em>, <em>CAP_DAC_OVERRIDE</em>) setup in
<a class="reference download internal" href="../_downloads/ttbd@.service" download=""><code class="xref download docutils literal"><span class="pre">/etc/systemd/system/ttbd&#64;.service</span></code></a>.</p>
</li>
<li><p class="first">Ensure the following packages are available in the system:</p>
<ul class="simple">
<li>parted</li>
<li>dosfstools</li>
<li>grub2-efi-x64-cdboot and grub2-efi-x64-modules</li>
<li>util-linux</li>
</ul>
</li>
<li><p class="first">Identify the serial number for the USB drive; plug it to a
machine and issue:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ lsblk -o &quot;NAME,SERIAL,VENDOR,MODEL&quot;
NAME   SERIAL    VENDOR   MODEL
sdb    AOJROZB8  JetFlash Transcend 8GB
sdj    76508A8E  JetFlash Transcend 8GB
...
</pre></div>
</div>
<p>(for this example, ours is <em>76508A8E</em>, <cite>/dev/sdj</cite>)</p>
<p>blank the USB drive (<strong>NOTE!!!</strong> This will destroy the drive’s
contents):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ dd if=/dev/zero of=/dev/sdj
</pre></div>
</div>
</li>
<li><p class="first">Create a power controller</p>
</li>
<li><p class="first">Setup the target’s BIOS to boot by default off the USB drive</p>
</li>
</ul>
<p>See <a class="reference internal" href="#conf_00_lib.minnowboard_add" title="conf_00_lib.minnowboard_add"><code class="xref py py-func docutils literal"><span class="pre">conf_00_lib.minnowboard_add()</span></code></a> for an example instantiation.</p>
<dl class="attribute">
<dt id="ttbl.tt.grub2elf.image_types_valid">
<code class="descname">image_types_valid</code><em class="property"> = ('kernel', 'kernel-x86')</em><a class="headerlink" href="#ttbl.tt.grub2elf.image_types_valid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.grub2elf.image_do_set">
<code class="descname">image_do_set</code><span class="sig-paren">(</span><em>image_type</em>, <em>image_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.grub2elf.image_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.grub2elf.images_do_set">
<code class="descname">images_do_set</code><span class="sig-paren">(</span><em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.grub2elf.images_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt.simics">
<em class="property">class </em><code class="descclassname">ttbl.tt.</code><code class="descname">simics</code><span class="sig-paren">(</span><em>_id</em>, <em>simics_cmds</em>, <em>_tags=None</em>, <em>image_size_mb=100</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.simics" title="Permalink to this definition">¶</a></dt>
<dd><p>Driver for a target based on Simics simulation of a platform</p>
<p>Currently this driver is quite basic and supports only the image
and console management interfaces:</p>
<ul class="simple">
<li>images are only supported as an ELF file that is booted by
<em>grub2</em> when simics boots from a hard disk image generated on
the fly.</li>
<li>the only supported console is a serial output (no input)</li>
</ul>
<p><strong>System setup</strong></p>
<ol class="arabic">
<li><p class="first">In a configuration file (e.g. <em>/etc/environment</em>), set the base
package for Simics:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SIMICS_BASE_PACKAGE</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">simics</span><span class="o">/</span><span class="mf">5.0</span><span class="o">/</span><span class="n">simics</span><span class="o">-</span><span class="mf">5.0</span><span class="o">.</span><span class="mi">136</span>
</pre></div>
</div>
<p>note that all the packages and extensions installed in there
must have been registered with the global Simics configuration,
as it will execute under the user as which the daemon is run
(usually <em>ttbd</em>).</p>
<p>Note that the installation of Simics and any extra packages
needed can be done automagically with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ destdir=/opt/simics/5.0
$ mkdir -p $destdir
# --batch: no questions asked, just proceed
# -a: auto select packages and register them
$ ./install-simics.pl --batch -a --prefix $destdir \
    package-1000-5.0.136-linux64.tar.gz.aes KEY-1000 \
    package-1001-5.0.54-linux64.tar.gz.aes  KEY-1001 \
    package-1010-5.0.59-linux64.tar.gz.aes  KEY-1010 \
    package-1012-5.0.24-linux64.tar.gz.aes  KEY-1012 \
    package-2018-5.0.31-linux64.tar.gz.aes  KEY-2018 \
    package-2075-5.0.50-linux64.tar.gz.aes  KEY-2075
</pre></div>
</div>
</li>
</ol>
<dl class="exception">
<dt id="ttbl.tt.simics.error_e">
<em class="property">exception </em><code class="descname">error_e</code><a class="headerlink" href="#ttbl.tt.simics.error_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.tt.simics.simics_start_e">
<em class="property">exception </em><code class="descname">simics_start_e</code><a class="headerlink" href="#ttbl.tt.simics.simics_start_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.tt.simics.base_package">
<code class="descname">base_package</code><em class="property"> = '/opt/simics/5.0/simics-5.0.136'</em><a class="headerlink" href="#ttbl.tt.simics.base_package" title="Permalink to this definition">¶</a></dt>
<dd><p>location of the base Simics installation in the file system; by
default this taken from the <em>SIMICS_BASE_PACKAGE</em> environment
variable, if it exists; it can also be set in a configuration
file as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ttbl</span><span class="o">.</span><span class="n">tt</span><span class="o">.</span><span class="n">simics</span><span class="o">.</span><span class="n">base_package</span> <span class="o">=</span> <span class="s2">&quot;/some/path/simics-5.0.136&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.tt.simics.simics_vars">
<code class="descname">simics_vars</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.tt.simics.simics_vars" title="Permalink to this definition">¶</a></dt>
<dd><p>Variables that can be expanded in the Simics configuration
script passed as an argument</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.tt.simics.image_types_valid">
<code class="descname">image_types_valid</code><em class="property"> = ('kernel', 'kernel-x86')</em><a class="headerlink" href="#ttbl.tt.simics.image_types_valid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.simics.image_do_set">
<code class="descname">image_do_set</code><span class="sig-paren">(</span><em>image_type</em>, <em>image_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.simics.image_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.simics.images_do_set">
<code class="descname">images_do_set</code><span class="sig-paren">(</span><em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.simics.images_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.simics.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.simics.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.simics.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.simics.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.simics.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.simics.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.simics.console_do_list">
<code class="descname">console_do_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.simics.console_do_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.simics.console_do_read">
<code class="descname">console_do_read</code><span class="sig-paren">(</span><em>console_id=None</em>, <em>offset=0</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.simics.console_do_read" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt.simics.console_do_write">
<code class="descname">console_do_write</code><span class="sig-paren">(</span><em>_data</em>, <em>_console_id=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt.simics.console_do_write" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.tt_qemu"></span><dl class="class">
<dt id="ttbl.tt_qemu.qmp_c">
<em class="property">class </em><code class="descclassname">ttbl.tt_qemu.</code><code class="descname">qmp_c</code><span class="sig-paren">(</span><em>sockfile</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.qmp_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Dirty handler for the Qemu Monitor Protocol that allows us to run
QMP commands and report on status.</p>
<dl class="method">
<dt id="ttbl.tt_qemu.qmp_c.command">
<code class="descname">command</code><span class="sig-paren">(</span><em>command</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.qmp_c.command" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt_qemu.tt_qemu">
<em class="property">class </em><code class="descclassname">ttbl.tt_qemu.</code><code class="descname">tt_qemu</code><span class="sig-paren">(</span><em>id</em>, <em>bsps</em>, <em>_tags</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a test target that runs under a QEMU subprocess.</p>
<p>Supports power control, serial consoles and image flashing.</p>
<p>A subclass of this must provide a command line to start QEMU, as
described in <a class="reference internal" href="#ttbl.tt_qemu.tt_qemu.qemu_cmdlines" title="ttbl.tt_qemu.tt_qemu.qemu_cmdlines"><code class="xref py py-data docutils literal"><span class="pre">qemu_cmdlines</span></code></a>.</p>
<p>For the console read interface to work, the configuration must export a
logfile called BSP-console.read in the state directory. For write
to work, it must provide a socket BSP-console.write:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Serial console tt_qemu.py can grok</span>
<span class="o">-</span><span class="n">chardev</span> <span class="n">socket</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">ttyS0</span><span class="p">,</span><span class="n">server</span><span class="p">,</span><span class="n">nowait</span><span class="p">,</span><span class="n">path</span><span class="o">=%</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="n">s</span><span class="o">/%</span><span class="p">(</span><span class="n">bsp</span><span class="p">)</span><span class="n">s</span><span class="o">-</span><span class="n">console</span><span class="o">.</span><span class="n">write</span><span class="p">,</span><span class="n">logfile</span><span class="o">=%</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="n">s</span><span class="o">/%</span><span class="p">(</span><span class="n">bsp</span><span class="p">)</span><span class="n">s</span><span class="o">-</span><span class="n">console</span><span class="o">.</span><span class="n">read</span>
<span class="o">-</span><span class="n">serial</span> <span class="n">chardev</span><span class="p">:</span><span class="n">ttyS0</span>
</pre></div>
</div>
<p>Using power_on_pre, power_on_post and power_off_pre functions, one
can add functionality without modifying this file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>bsps</strong> – list of BSPs to start in parallel (normally only one
is set); information has to be present in the tags description
for it to be valid, as well as command lines for starting
each. If more than one BSP is available, this is the equivalent
of having a multicore machine that can be asymetric. Thisis
mostly used for testing.</td>
</tr>
</tbody>
</table>
<p><strong>WARNING</strong></p>
<p>Note this might be called from different processes who share the
same configuration; hence we can’t rely on any runtime
storage. Any values that are needed are kept on a filesystem
database (<cite>self.fsdb</cite>). We start the process with Python’s
subprocess.Popen(), but then it goes on background and if the
parent dies, the main server process will reap it (as prctl() has
set with SIG_IGN on SIGCHLD) and any subprocess of the main
process might kill it when power-off is called on it.</p>
<div class="admonition-examples admonition">
<p class="first admonition-title">Examples</p>
<ul class="last simple">
<li><a class="reference internal" href="#conf_00_lib.tt_qemu_zephyr" title="conf_00_lib.tt_qemu_zephyr"><code class="xref py py-class docutils literal"><span class="pre">VMs</span> <span class="pre">for</span> <span class="pre">Zephyr</span> <span class="pre">OS</span></code></a></li>
<li><a class="reference internal" href="#conf_00_lib.tt_qemu_linux" title="conf_00_lib.tt_qemu_linux"><code class="xref py py-class docutils literal"><span class="pre">VMs</span> <span class="pre">for</span> <span class="pre">Fedora</span> <span class="pre">Linux</span> <span class="pre">Cloud</span> <span class="pre">images</span> <span class="pre">OS</span></code></a></li>
</ul>
</div>
<dl class="attribute">
<dt id="ttbl.tt_qemu.tt_qemu.qemu_cmdlines">
<code class="descname">qemu_cmdlines</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu.qemu_cmdlines" title="Permalink to this definition">¶</a></dt>
<dd><p>Command line to launch QEMU, keyed for the BSP it implements
(eg: ‘x86’, or ‘arc’, or ‘arm’).</p>
<p>Note this can contain %(FIELD)[sd] to replace values coming
from <code class="docutils literal"><span class="pre">self.kws</span></code>.</p>
<ul class="simple">
<li>derivative classes can add values in their <em>__init__()</em> methods</li>
<li>default values:
- <em>path</em>: location of the directory where state is kept
- <em>targetname</em>: name of this target<ul>
<li><em>bsp</em>: BSP on which we are acting (as a target might have
multiple BSPs)</li>
</ul>
</li>
</ul>
<p>:func:power_on_do() will add a few command line options to add
QMP socket that we use to talk to QEMU, to introduce a pidfile,
and a GDB socket (for debugging).</p>
<p>Note this is per-instance and not per-class as each
instance might add different command line switches based on
its networking needs (for example)</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.tt_qemu.tt_qemu.debug_do_start">
<code class="descname">debug_do_start</code><span class="sig-paren">(</span><em>tt_ignored</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu.debug_do_start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_qemu.tt_qemu.debug_do_stop">
<code class="descname">debug_do_stop</code><span class="sig-paren">(</span><em>tt_ignored</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu.debug_do_stop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_qemu.tt_qemu.debug_do_info">
<code class="descname">debug_do_info</code><span class="sig-paren">(</span><em>tt_ignored</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu.debug_do_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_qemu.tt_qemu.image_do_set">
<code class="descname">image_do_set</code><span class="sig-paren">(</span><em>image_type</em>, <em>image_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu.image_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_qemu.tt_qemu.images_do_set">
<code class="descname">images_do_set</code><span class="sig-paren">(</span><em>images</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu.images_do_set" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_qemu.tt_qemu.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_qemu.tt_qemu.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_qemu.tt_qemu.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>_target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_qemu.tt_qemu.console_do_list">
<code class="descname">console_do_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu.console_do_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_qemu.tt_qemu.console_do_read">
<code class="descname">console_do_read</code><span class="sig-paren">(</span><em>console_id=None</em>, <em>offset=0</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu.console_do_read" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_qemu.tt_qemu.console_do_write">
<code class="descname">console_do_write</code><span class="sig-paren">(</span><em>data</em>, <em>console_id=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.tt_qemu.console_do_write" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.tt_qemu.plugger">
<em class="property">class </em><code class="descclassname">ttbl.tt_qemu.</code><code class="descname">plugger</code><span class="sig-paren">(</span><em>name</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.plugger" title="Permalink to this definition">¶</a></dt>
<dd><p>Plugger class to plug external devices to QEMU VMs</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>kwargs</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>parameters for <a class="reference internal" href="#ttbl.tt_qemu.qmp_c.command" title="ttbl.tt_qemu.qmp_c.command"><code class="xref py py-meth docutils literal"><span class="pre">qmp_c.command()</span></code></a>’s
<cite>device_add</cite> method, which for example, could be:</p>
<ul class="simple">
<li>driver = “usb-host”</li>
<li>hostbus = BUSNUMBER</li>
<li>hostaddr = USBADDRESS</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.tt_qemu.plugger.plug">
<code class="descname">plug</code><span class="sig-paren">(</span><em>target</em>, <em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.plugger.plug" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.tt_qemu.plugger.unplug">
<code class="descname">unplug</code><span class="sig-paren">(</span><em>target</em>, <em>thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.tt_qemu.plugger.unplug" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.flasher"></span><dl class="class">
<dt id="ttbl.flasher.flasher_c">
<em class="property">class </em><code class="descclassname">ttbl.flasher.</code><code class="descname">flasher_c</code><a class="headerlink" href="#ttbl.flasher.flasher_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Interface to flash and debug a target</p>
<p>Implementations shall derive from here to provide the actual
functionality, such as for example,
<a class="reference internal" href="#ttbl.flasher.openocd_c" title="ttbl.flasher.openocd_c"><code class="xref py py-class docutils literal"><span class="pre">openocd_c</span></code></a>.</p>
<dl class="exception">
<dt id="ttbl.flasher.flasher_c.error">
<em class="property">exception </em><code class="descname">error</code><a class="headerlink" href="#ttbl.flasher.flasher_c.error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.flasher_c.start">
<code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.flasher_c.start" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.flasher_c.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.flasher_c.stop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.flasher_c.image_write">
<code class="descname">image_write</code><span class="sig-paren">(</span><em>image_type</em>, <em>file_name</em>, <em>timeout_factor=1</em>, <em>verify=True</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.flasher_c.image_write" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.flasher_c.image_erase">
<code class="descname">image_erase</code><span class="sig-paren">(</span><em>image_type</em>, <em>size</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.flasher_c.image_erase" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.flasher_c.image_hash">
<code class="descname">image_hash</code><span class="sig-paren">(</span><em>image_type</em>, <em>size</em>, <em>timeout_factor=1</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.flasher_c.image_hash" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.flasher_c.target_halt">
<code class="descname">target_halt</code><span class="sig-paren">(</span><em>targets=None</em>, <em>for_what=''</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.flasher_c.target_halt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.flasher_c.target_reset">
<code class="descname">target_reset</code><span class="sig-paren">(</span><em>for_what=''</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.flasher_c.target_reset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.flasher_c.target_reset_halt">
<code class="descname">target_reset_halt</code><span class="sig-paren">(</span><em>for_what=''</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.flasher_c.target_reset_halt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.flasher_c.target_resume">
<code class="descname">target_resume</code><span class="sig-paren">(</span><em>targets=None</em>, <em>for_what=''</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.flasher_c.target_resume" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.flasher_c.debug">
<code class="descname">debug</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.flasher_c.debug" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="ttbl.flasher.flasher_c.openocd_cmd">
<em class="property">static </em><code class="descname">openocd_cmd</code><span class="sig-paren">(</span><em>cmd</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.flasher_c.openocd_cmd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.flasher_c.test_target_link">
<code class="descname">test_target_link</code><span class="sig-paren">(</span><em>tt</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.flasher_c.test_target_link" title="Permalink to this definition">¶</a></dt>
<dd><p>Tell this flasher who is our target – we can’t do that in
__init__() because we don’t necessarily know it at the time,
so the class that uses us must do it.</p>
<p>The implementation might use it or not, their choice.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.flasher.action_logadapter_c">
<em class="property">class </em><code class="descclassname">ttbl.flasher.</code><code class="descname">action_logadapter_c</code><span class="sig-paren">(</span><em>logger</em>, <em>extra</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.action_logadapter_c" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="ttbl.flasher.action_logadapter_c.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>msg</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.action_logadapter_c.process" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.flasher.openocd_c">
<em class="property">class </em><code class="descclassname">ttbl.flasher.</code><code class="descname">openocd_c</code><span class="sig-paren">(</span><em>_board_name</em>, <em>serial=None</em>, <em>openocd_path='openocd'</em>, <em>openocd_scripts='/usr/share/openocd/scripts'</em>, <em>debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.openocd_c" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a flasher object that uses OpenOCD to provide flashing
and GDB server support.</p>
<p>The object starts an OpenOCD instance (that runs as a daemon)
– it does this behaving as a power-control implementation
that is plugged at the end of the power rail.</p>
<p>To execute commands, it connects to the daemon via TCL and
runs them using the <code class="docutils literal"><span class="pre">'capture</span> <span class="pre">&quot;OPENOCDCOMMAND&quot;'</span></code> TCL command
(FIXME: is there a better way?). The telnet port is open for
manual debugging (check your firewall! <strong>no passwords!</strong>); the GDB
ports are also available.</p>
<p>The class knows the configuration settings for different
boards (as given in the <cite>board_name</cite> parameter. It is also
possible to point it to specific OpenOCD paths when different
builds / versions need to be used.</p>
<p>Note how entry points from the flasher_c class all start with
underscore. Functions <code class="docutils literal"><span class="pre">__SOMETHING()</span></code> are those that have to be
called with a <code class="docutils literal"><span class="pre">_expect_mgr</span></code> context taken [see comments
on <code class="docutils literal"><span class="pre">__send_command</span></code> for the reason.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>board_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the board to use, to select
proper configuration parameters</td>
</tr>
</tbody>
</table>
<dl class="exception">
<dt id="ttbl.flasher.openocd_c.error">
<em class="property">exception </em><code class="descname">error</code><a class="headerlink" href="#ttbl.flasher.openocd_c.error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.flasher.openocd_c.error_eof">
<em class="property">exception </em><code class="descname">error_eof</code><a class="headerlink" href="#ttbl.flasher.openocd_c.error_eof" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.flasher.openocd_c.error_timeout">
<em class="property">exception </em><code class="descname">error_timeout</code><a class="headerlink" href="#ttbl.flasher.openocd_c.error_timeout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.flasher.openocd_c.expect_connect_e">
<em class="property">exception </em><code class="descname">expect_connect_e</code><a class="headerlink" href="#ttbl.flasher.openocd_c.expect_connect_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.openocd_c.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.openocd_c.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.openocd_c.reset_do">
<code class="descname">reset_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.openocd_c.reset_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.openocd_c.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.openocd_c.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.openocd_c.openocd_cmd">
<code class="descname">openocd_cmd</code><span class="sig-paren">(</span><em>cmd</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.openocd_c.openocd_cmd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.flasher.openocd_c.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.flasher.openocd_c.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-ttbl.user_control">
<span id="user-access-control-and-authentication"></span><h3>8.7.2. User access control and authentication<a class="headerlink" href="#module-ttbl.user_control" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="ttbl.user_control.User">
<em class="property">class </em><code class="descclassname">ttbl.user_control.</code><code class="descname">User</code><span class="sig-paren">(</span><em>userid</em>, <em>fail_if_new=False</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a database of users that are allowed to use this system</p>
<p>The information on this database is obtained from authentication
systems and just stored locally for caching–it’s mainly to set
roles for users.</p>
<dl class="attribute">
<dt id="ttbl.user_control.User.file_access_lock">
<code class="descname">file_access_lock</code><em class="property"> = &lt;thread.lock object&gt;</em><a class="headerlink" href="#ttbl.user_control.User.file_access_lock" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="ttbl.user_control.User.user_not_existant_e">
<em class="property">exception </em><code class="descname">user_not_existant_e</code><a class="headerlink" href="#ttbl.user_control.User.user_not_existant_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Exception raised when information about a user cannot be
located</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.user_control.User.state_dir">
<code class="descname">state_dir</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.user_control.User.state_dir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="ttbl.user_control.User.is_authenticated">
<em class="property">static </em><code class="descname">is_authenticated</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.is_authenticated" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="ttbl.user_control.User.is_active">
<em class="property">static </em><code class="descname">is_active</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.is_active" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="ttbl.user_control.User.is_anonymous">
<em class="property">static </em><code class="descname">is_anonymous</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.is_anonymous" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.User.is_admin">
<code class="descname">is_admin</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.is_admin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.User.get_id">
<code class="descname">get_id</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.get_id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.User.set_role">
<code class="descname">set_role</code><span class="sig-paren">(</span><em>role</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.set_role" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.User.has_role">
<code class="descname">has_role</code><span class="sig-paren">(</span><em>role</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.has_role" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.User.save_data">
<code class="descname">save_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.save_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="ttbl.user_control.User.load_user">
<em class="property">static </em><code class="descname">load_user</code><span class="sig-paren">(</span><em>userid</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.load_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="ttbl.user_control.User.create_filename">
<em class="property">static </em><code class="descname">create_filename</code><span class="sig-paren">(</span><em>userid</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.create_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a safe filename based on the user ID</p>
</dd></dl>

<dl class="staticmethod">
<dt id="ttbl.user_control.User.search_user">
<em class="property">static </em><code class="descname">search_user</code><span class="sig-paren">(</span><em>userid</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.User.search_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.user_control.local_user">
<em class="property">class </em><code class="descclassname">ttbl.user_control.</code><code class="descname">local_user</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.local_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Define a local anonymous user that we can use to skip
authentication on certain situations (when the user starts the
daemon as such, for example).</p>
<p>See <a class="reference external" href="https://flask-login.readthedocs.org/en/latest/#anonymous-users">https://flask-login.readthedocs.org/en/latest/#anonymous-users</a> for
the Flask details.</p>
<dl class="method">
<dt id="ttbl.user_control.local_user.save_data">
<code class="descname">save_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.local_user.save_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.local_user.is_authenticated">
<code class="descname">is_authenticated</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.local_user.is_authenticated" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.local_user.is_anonymous">
<code class="descname">is_anonymous</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.local_user.is_anonymous" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.local_user.is_active">
<code class="descname">is_active</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.local_user.is_active" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.user_control.local_user.is_admin">
<code class="descname">is_admin</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.user_control.local_user.is_admin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.auth_ldap"></span><dl class="class">
<dt id="ttbl.auth_ldap.authenticator_ldap_c">
<em class="property">class </em><code class="descclassname">ttbl.auth_ldap.</code><code class="descname">authenticator_ldap_c</code><span class="sig-paren">(</span><em>url</em>, <em>roles=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_ldap.authenticator_ldap_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Use LDAP to authenticate users</p>
<p>To configure, create a config file that looks like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ttbl.auth_ldap</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add_authenticator</span><span class="p">(</span><span class="n">timo</span><span class="o">.</span><span class="n">auth_ldap</span><span class="o">.</span><span class="n">authenticator_ldap_c</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;ldap://URL:PORT&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">roles</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="o">....</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">roles</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="s1">&#39;role1&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;users&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;john&quot;</span><span class="p">,</span> <span class="s2">&quot;lamar&quot;</span><span class="p">,</span> <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;Occupants of building 3&quot;</span>  <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="s1">&#39;role2&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;users&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;anthony&quot;</span><span class="p">,</span> <span class="s2">&quot;mcclay&quot;</span> <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;Administrators&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="s2">&quot;Knights who say ni&quot;</span> <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">}))</span>
</pre></div>
</div>
<p>The <em>roles</em> dictionary determines <em>who gets to be an admin</em> or who gets
access to XYZ resources.</p>
<p>This will make that <em>john</em>, <em>lamar</em> and any user on the group
<em>Occupants of building 3</em> to have the role <em>role1</em>.</p>
<p>Likewise for <em>anthony</em>, <em>mcclay</em> and any user who is a member of
either the group <em>Administrators</em> or the group <em>Knights who say
ni</em>, they are given role <em>role2</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – URL of the LDAP server</li>
<li><strong>roles</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – map of roles to users and groups</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.auth_ldap.authenticator_ldap_c.login">
<code class="descname">login</code><span class="sig-paren">(</span><em>email</em>, <em>password</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_ldap.authenticator_ldap_c.login" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate a email|token/password combination and pull which roles it
has assigned</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">set listing the roles the token/password combination
has according to the configuration</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#ttbl.fsdb.fsdb.set" title="ttbl.fsdb.fsdb.set">set</a></td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.invalid_credentials_e if the
token/password is not valid</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.error_e if any kind of error
during the process happens</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.auth_localdb"></span><dl class="class">
<dt id="ttbl.auth_localdb.authenticator_localdb_c">
<em class="property">class </em><code class="descclassname">ttbl.auth_localdb.</code><code class="descname">authenticator_localdb_c</code><span class="sig-paren">(</span><em>name</em>, <em>users</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_localdb.authenticator_localdb_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Use a simple DB to authenticate users</p>
<p>To configure, create a config file that looks like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ttbl.auth_localdb</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add_authenticator</span><span class="p">(</span><span class="n">ttbl</span><span class="o">.</span><span class="n">auth_localdb</span><span class="o">.</span><span class="n">authenticator_localdb_c</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;NAME&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="p">[</span><span class="s1">&#39;user1&#39;</span><span class="p">,</span> <span class="s1">&#39;password1&#39;</span><span class="p">,</span> <span class="s1">&#39;role1&#39;</span><span class="p">,</span> <span class="s1">&#39;role2&#39;</span><span class="p">,</span> <span class="s1">&#39;role3&#39;</span><span class="o">...</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="p">[</span><span class="s1">&#39;user2&#39;</span><span class="p">,</span> <span class="s1">&#39;password2&#39;</span><span class="p">,</span> <span class="s1">&#39;role1&#39;</span><span class="p">,</span> <span class="s1">&#39;role4&#39;</span><span class="p">,</span> <span class="s1">&#39;role3&#39;</span> <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="p">[</span><span class="s1">&#39;user3&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;role2&#39;</span><span class="p">,</span> <span class="s1">&#39;role3&#39;</span><span class="o">...</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>      <span class="p">[</span><span class="s1">&#39;user4&#39;</span><span class="p">,</span> <span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>     <span class="p">]))</span>
</pre></div>
</div>
<p>Each item in the users list is a list containing:</p>
<blockquote>
<div><ul class="simple">
<li>the user id (<em>userX</em>)</li>
<li>the password in plaintext (FIXME: add digests); if empty, then
the user has no password.</li>
<li>list of roles (<em>roleX</em>)</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – FIXME</li>
<li><strong>users</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – map of roles to users and groups</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.auth_localdb.authenticator_localdb_c.login">
<code class="descname">login</code><span class="sig-paren">(</span><em>email</em>, <em>password</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_localdb.authenticator_localdb_c.login" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate a email|token/password combination and pull which roles it
has assigned</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">set listing the roles the token/password combination
has according to the configuration</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#ttbl.fsdb.fsdb.set" title="ttbl.fsdb.fsdb.set">set</a></td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.invalid_credentials_e if the
token/password is not valid</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.error_e if any kind of error
during the process happens</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.auth_party"></span><dl class="class">
<dt id="ttbl.auth_party.authenticator_party_c">
<em class="property">class </em><code class="descclassname">ttbl.auth_party.</code><code class="descname">authenticator_party_c</code><span class="sig-paren">(</span><em>roles=None</em>, <em>local_addresses=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_party.authenticator_party_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Life is a party! Authenticator that allows anyone to log in and be
an admin.</p>
<p>To configure, create a config file that looks like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">timo.auth_party</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add_authenticator</span><span class="p">(</span><span class="n">timo</span><span class="o">.</span><span class="n">auth_party</span><span class="o">.</span><span class="n">authenticator_party_c</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="p">[</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;role3&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">local_addresses</span> <span class="o">=</span> <span class="p">[</span>  <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.0.2&#39;</span> <span class="p">]</span> <span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Where you list the roles that everyone will get all the time.</p>
<p>Normally you want this only for debugging or for local
instances. Note you can set a list of local addresses to match
against (strings or regular expressions) which will enforce that
only authentication from those addresses will just be allowed.</p>
<p>FIXME: check connections are coming only from localhost</p>
<dl class="method">
<dt id="ttbl.auth_party.authenticator_party_c.login">
<code class="descname">login</code><span class="sig-paren">(</span><em>email</em>, <em>password</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.auth_party.authenticator_party_c.login" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate a email|token/password combination and pull which roles it
has assigned</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Kwargs:</th><td class="field-body">‘remote_addr’ set to a string describing the IP
address where the connection comes from.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">set listing the roles the token/password combination
has according to the configuration</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#ttbl.fsdb.fsdb.set" title="ttbl.fsdb.fsdb.set">set</a></td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.invalid_credentials_e if the
token/password is not valid</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.unknown_user_e if there are remote
addresses initialized and the request comes from a non-local
address.</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">authenticator_c.error_e if any kind of error
during the process happens</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="console-management-interface">
<h3>8.7.3. Console Management Interface<a class="headerlink" href="#console-management-interface" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">test_target_console_mixin</code></dt>
<dd><p>bidirectional input/output channel</p>
<p>FIXME:</p>
<ul class="simple">
<li>has to allow us to control a serial port (escape sequences?)</li>
<li>buffering? shall it read everything since power on?</li>
<li>serial port not necessarily the endpoint, but ability to set
baud rate and such must be considered</li>
<li>more than one channel?
<em>console_id</em> defaults to None, the first one defined by the
target, which is always available</li>
</ul>
<dl class="exception">
<dt>
<em class="property">exception </em><code class="descname">test_target_console_e</code></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">console_do_read</code><span class="sig-paren">(</span><em>console_id=None</em>, <em>offset=0</em><span class="sig-paren">)</span></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>offset</strong> – Try to read output from given offset</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">an iterator with the output that <em>HAS TO BE DISPOSED
OF</em> with del once done.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">IndexError if console_id is not implemented,
ValueError if <em>all</em> is not supported.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">console_do_write</code><span class="sig-paren">(</span><em>data</em>, <em>console_id=None</em><span class="sig-paren">)</span></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – byte string to write to the console</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">console_do_setup</code><span class="sig-paren">(</span><em>console_id=None</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Set console-specific parameters</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">console_do_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Return list of available <em>console_id</em>s</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">console_read</code><span class="sig-paren">(</span><em>who</em>, <em>console_id=None</em>, <em>offset=0</em><span class="sig-paren">)</span></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>offset</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – Try to read output from given offset</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">an iterator with the output that <em>HAS TO BE DISPOSED
OF</em> with del once done.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body">IndexError if console_id is not implemented,
ValueError if <em>all</em> is not supported.</td>
</tr>
</tbody>
</table>
<p>Note the target does not have to be acquired to read off it’s
console. FIXME: makes sense?</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">console_write</code><span class="sig-paren">(</span><em>who</em>, <em>data</em>, <em>console_id=None</em><span class="sig-paren">)</span></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – byte string to write to the console</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">console_setup</code><span class="sig-paren">(</span><em>who</em>, <em>console_id=None</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Set console-specific parameters</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">console_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Return list of available <em>console_id</em>s</p>
</dd></dl>

<dl class="exception">
<dt>
<em class="property">exception </em><code class="descname">expect_e</code></dt>
<dd></dd></dl>

<dl class="exception">
<dt>
<em class="property">exception </em><code class="descname">expect_failed_e</code></dt>
<dd></dd></dl>

<dl class="exception">
<dt>
<em class="property">exception </em><code class="descname">expect_timeout_e</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">EXPECT_TIMEOUT</code><em class="property"> = -1</em></dt>
<dd><p>Consider a timeout a valid event instead of raising
exceptions in <a class="reference internal" href="#ttbl.test_target_console_mixin.expect" title="ttbl.test_target_console_mixin.expect"><code class="xref py py-func docutils literal"><span class="pre">expect()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">expect</code><span class="sig-paren">(</span><em>expectations</em>, <em>timeout=20</em>, <em>console_id=None</em>, <em>offset=0</em>, <em>max_buffering=4096</em>, <em>poll_period=0.5</em>, <em>what=''</em><span class="sig-paren">)</span></dt>
<dd><p>Wait for any of a list of things to come off the given console</p>
<p>Waits for a maximum <em>timeout</em> to receive from a given console
any of the list of things provided as <em>expectations</em>, checking
with a <em>poll_period</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>expectations</strong> – list of strings and/or compiled regular
expressions for which to wait. It can also be the constant
<a class="reference internal" href="#ttbl.test_target_console_mixin.EXPECT_TIMEOUT" title="ttbl.test_target_console_mixin.EXPECT_TIMEOUT"><code class="xref py py-data docutils literal"><span class="pre">EXPECT_TIMEOUT</span></code></a>, in which case, a timeout is a valid
event to expect (instead of causing a <a class="reference internal" href="#ttbl.test_target_console_mixin.expect_timeout_e" title="ttbl.test_target_console_mixin.expect_timeout_e"><code class="xref py py-exc docutils literal"><span class="pre">exception</span></code></a>.</li>
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional, default 20) maximum time in
seconds to wait for any of the expectations.</li>
<li><strong>offset</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional, default 0) offset into the
console from which to read.</li>
<li><strong>max_buffering</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional, default 4k) how much to
look back into the read console data.</li>
<li><strong>poll_period</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – (optional) how often to poll for new
data</li>
<li><strong>what</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – (optional) string describing what we are
waiting for (for error messages/logs).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">expect_sequence</code><span class="sig-paren">(</span><em>sequence</em>, <em>timeout=20</em>, <em>offset=0</em>, <em>console_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Execute a list of expect/send commands to a console</p>
<p>Each step in the list can first send something, then expect to
recevive something to pass (or to fail) and then move on to
the next step until the whole sequence is completed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sequence</strong> – <p>List of dictionaries with the parameters:</p>
<ul>
<li>receive: string/regex of what is expected</li>
<li>fail: (optional) strings/regex of something that if received
will cause a failure</li>
<li>send: (optional) string to send after receiving <em>pass</em></li>
<li>wait: (optional) integer of time to wait before sending <em>send</em></li>
<li>delay: (optional) when sending <em>send</em>, delay <em>delay</em> seconds
in between characters (useful for slow readers)</li>
</ul>
<p>e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="nb">dict</span><span class="p">(</span><span class="n">receive</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;Expecting number [0-9]+&quot;</span><span class="p">),</span>
       <span class="n">fail</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;Error reading&quot;</span><span class="p">),</span>
       <span class="n">send</span> <span class="o">=</span> <span class="s2">&quot;I am good&quot;</span><span class="p">,</span>
       <span class="n">wait</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">delay</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">),</span>
  <span class="nb">dict</span><span class="p">(</span><span class="n">receive</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;Expecting number 1[0-9]+&quot;</span><span class="p">),</span>
       <span class="n">fail</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;Error reading&quot;</span><span class="p">))</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional, default 20s) maximum time in
seconds the operation has to conclude</li>
<li><strong>offset</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional, default 0) offset from which to
read in the console.</li>
<li><strong>console_id</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – (optional) console to use to read/write</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Nothing if everything went well, otherwise raises
exceptions <a class="reference internal" href="#ttbl.test_target_console_mixin.expect_timeout_e" title="ttbl.test_target_console_mixin.expect_timeout_e"><code class="xref py py-class docutils literal"><span class="pre">expect_timeout_e</span></code></a> or <a class="reference internal" href="#ttbl.test_target_console_mixin.expect_failed_e" title="ttbl.test_target_console_mixin.expect_failed_e"><code class="xref py py-class docutils literal"><span class="pre">expect_failed_e</span></code></a>.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.cm_serial"></span><dl class="class">
<dt id="ttbl.cm_serial.cm_serial">
<em class="property">class </em><code class="descclassname">ttbl.cm_serial.</code><code class="descname">cm_serial</code><span class="sig-paren">(</span><em>state_dir</em>, <em>specs</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_serial.cm_serial" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement console/s over serial ports or network connections using
the Python serial module</p>
<p>The consoles maybe be open right after power on (if the target
supports the power-on interface) and closed right before power off
– this is needed for device nodes that are powered off AT the
same time as the target.
This also means that you can loose console output from the time
the target is powered on until the serial port is attached to the
system.</p>
<p>FIXME</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>specs</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>list of serial ports or dictionaries
describing how to open serial ports</p>
<ul>
<li>string “post-open”: the serial ports have to be open after
the target powers up.<p>This is needed for ports whose power is tied to the
target’s power (thus, when the target is off, the port is
gone).</p>
<p>NOTE: you will lose serial output since
the time the target is powered up until the serial port
starts being monitored.</p>
</li>
<li>string “pc”: there is a power-control unit (cm_serial.pc)
tied to the power-control rail for this target that will
turn ports on and off.<p>This is needed for ports whose power is tied to the
target’s power (thus, when the target is off, the port is
gone).</p>
<p>NOTE: you will lose serial output since the time the
target is powered up until the serial port starts being
monitored.</p>
</li>
<li>A dictionary describing how to open a serial port eg:<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">DEVNAME</span><span class="p">,</span>
    <span class="s2">&quot;console&quot;</span> <span class="p">:</span> <span class="n">CONSOLENAME</span><span class="p">,</span>
    <span class="s2">&quot;baudrate&quot;</span><span class="p">:</span> <span class="mi">115200</span><span class="p">,</span>
    <span class="s2">&quot;bytesize&quot;</span><span class="p">:</span> <span class="n">EIGHTBITS</span><span class="p">,</span>
    <span class="s2">&quot;parity&quot;</span><span class="p">:</span> <span class="n">PARITY_NONE</span><span class="p">,</span>
    <span class="s2">&quot;stopbits&quot;</span><span class="p">:</span> <span class="n">STOPBITS_ONE</span><span class="p">,</span>
    <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;rtscts&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<p>see the documentation for <a class="reference external" href="https://pythonhosted.org/pyserial/url_handlers.html#module-serial" title="(in pySerial v3.0)"><code class="xref py py-mod docutils literal"><span class="pre">serial</span></code></a> for more
information as the elements on this dictionary would match
the keyword arguments to <a class="reference external" href="https://pythonhosted.org/pyserial/pyserial_api.html#serial.serial_for_url" title="(in pySerial v3.0)"><code class="xref py py-func docutils literal"><span class="pre">serial.serial_for_url()</span></code></a>.</p>
<p>Note <code class="docutils literal"><span class="pre">console</span></code> is the name of the console associated to
this port; the first one registered is always considered the
default and assigned the name “default” if none given.</p>
</li>
<li><strong>save_log</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – shall the server record anything that
comes through this serial port?</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.cm_serial.cm_serial.consoles_close">
<code class="descname">consoles_close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_serial.cm_serial.consoles_close" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.cm_serial.cm_serial.consoles_open">
<code class="descname">consoles_open</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_serial.cm_serial.consoles_open" title="Permalink to this definition">¶</a></dt>
<dd><p>Open all serial ports assigned to the target</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.cm_serial.cm_serial.consoles_reset">
<code class="descname">consoles_reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_serial.cm_serial.consoles_reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Truncate all the logfiles (usually called when running a reset)</p>
</dd></dl>

<dl class="method">
<dt id="ttbl.cm_serial.cm_serial.console_do_list">
<code class="descname">console_do_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_serial.cm_serial.console_do_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.cm_serial.cm_serial.console_do_read">
<code class="descname">console_do_read</code><span class="sig-paren">(</span><em>console_id=None</em>, <em>offset=0</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_serial.cm_serial.console_do_read" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.cm_serial.cm_serial.console_do_write">
<code class="descname">console_do_write</code><span class="sig-paren">(</span><em>data</em>, <em>console_id=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_serial.cm_serial.console_do_write" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.cm_serial.cm_serial.console_takeover">
<code class="descname">console_takeover</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_serial.cm_serial.console_takeover" title="Permalink to this definition">¶</a></dt>
<dd><p>Indicate the console serial background port reading thread
that it has to stop reading from the port.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">object</span><span class="o">.</span><span class="n">console_takeover</span><span class="p">(</span><span class="n">CONSOLEID</span><span class="p">)</span> <span class="k">as</span> <span class="n">descr</span><span class="p">,</span> <span class="n">log</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="c1"># ... operate the descr serial object and log file</span>
</pre></div>
</div>
<p>When the with statement is left, the background reader takes
control of the port again.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.cm_serial.pc">
<em class="property">class </em><code class="descclassname">ttbl.cm_serial.</code><code class="descname">pc</code><a class="headerlink" href="#ttbl.cm_serial.pc" title="Permalink to this definition">¶</a></dt>
<dd><p>Treat taget’s serial ports like a <em>power controller</em> so that it is
opened when the power control object is powering up all the power
control implementations that give power to a target.</p>
<p>This is used when a serial port adapter has to be powered up
before powering up the target it is connected to. The power
control implementation would be a list of three objects:</p>
<blockquote>
<div><ul class="simple">
<li>power control implementation for the serial port</li>
<li>this object</li>
<li>power control implementation for the tatrget</li>
</ul>
</div></blockquote>
<dl class="method">
<dt id="ttbl.cm_serial.pc.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_serial.pc.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.cm_serial.pc.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_serial.pc.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.cm_serial.pc.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_serial.pc.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.cm_loopback"></span><dl class="class">
<dt id="ttbl.cm_loopback.cm_loopback">
<em class="property">class </em><code class="descclassname">ttbl.cm_loopback.</code><code class="descname">cm_loopback</code><span class="sig-paren">(</span><em>state_dir</em>, <em>names=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_loopback.cm_loopback" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement console/s over serial ports or network connections using
the Python serial module</p>
<p>The consoles maybe be open right after power on (if the target
supports the power-on interface) and closed right before power off
– this is needed for device nodes that are powered off AT the
same time as the target.
This also means that you can loose console output from the time
the target is powered on until the serial port is attached to the
system.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>names</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – string or list of strings with the names of
the consoles to open.</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ttbl.cm_loopback.cm_loopback.consoles_close">
<code class="descname">consoles_close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_loopback.cm_loopback.consoles_close" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.cm_loopback.cm_loopback.consoles_open">
<code class="descname">consoles_open</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_loopback.cm_loopback.consoles_open" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.cm_loopback.cm_loopback.consoles_reset">
<code class="descname">consoles_reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_loopback.cm_loopback.consoles_reset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.cm_loopback.cm_loopback.console_do_list">
<code class="descname">console_do_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_loopback.cm_loopback.console_do_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.cm_loopback.cm_loopback.console_do_read">
<code class="descname">console_do_read</code><span class="sig-paren">(</span><em>console_id=None</em>, <em>offset=0</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_loopback.cm_loopback.console_do_read" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.cm_loopback.cm_loopback.console_do_write">
<code class="descname">console_do_write</code><span class="sig-paren">(</span><em>data</em>, <em>console_id=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_loopback.cm_loopback.console_do_write" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.cm_loopback.cm_loopback.console_takeover">
<code class="descname">console_takeover</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_loopback.cm_loopback.console_takeover" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.cm_logger"></span><dl class="function">
<dt id="ttbl.cm_logger.setup">
<code class="descclassname">ttbl.cm_logger.</code><code class="descname">setup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_logger.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME</p>
</dd></dl>

<dl class="function">
<dt id="ttbl.cm_logger.spec_add">
<code class="descclassname">ttbl.cm_logger.</code><code class="descname">spec_add</code><span class="sig-paren">(</span><em>logfile_name</em>, <em>spec</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_logger.spec_add" title="Permalink to this definition">¶</a></dt>
<dd><p>FIXME</p>
</dd></dl>

<dl class="function">
<dt id="ttbl.cm_logger.spec_write">
<code class="descclassname">ttbl.cm_logger.</code><code class="descname">spec_write</code><span class="sig-paren">(</span><em>logfile_name</em>, <em>data=None</em>, <em>filename=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_logger.spec_write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write to a file descriptor monitored by a logger</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>logfile_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Name of the logger to which file
descriptor to write to</li>
<li><strong>data</strong> – data to be written; use this only for short amounts
of data</li>
<li><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – name of the file that contains the data that
has to be written, use this for longer data.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ttbl.cm_logger.spec_rm">
<code class="descclassname">ttbl.cm_logger.</code><code class="descname">spec_rm</code><span class="sig-paren">(</span><em>logfile_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_logger.spec_rm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ttbl.cm_logger.spec_reset">
<code class="descclassname">ttbl.cm_logger.</code><code class="descname">spec_reset</code><span class="sig-paren">(</span><em>logfile_name</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.cm_logger.spec_reset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="debugging-interface">
<h3>8.7.4. Debugging Interface<a class="headerlink" href="#debugging-interface" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">tt_debug_mixin</code><span class="sig-paren">(</span><em>impl=None</em><span class="sig-paren">)</span></dt>
<dd><p>Generic debug interface to start and stop debugging on a
target.</p>
<p>When debug is started before the target is powered up, then upon
power up, the debugger stub shall wait for a debugger to connect
before continuing execution.</p>
<p>When debug is started while the target is executing, the target
shall not be stopped and the debugging stub shall permit a
debugger to connect and interrupt the target upon connection.</p>
<p>Each target provides its own debug methodolody; to find out how to
connect, issue a debug-info command to find out where to connect
to.</p>
<dl class="method">
<dt>
<code class="descname">debug_start</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span></dt>
<dd><p>Start debugging the target</p>
<p>If called before powering, the target will wait for the
debugger to connect before starting the kernel.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">debug_halt</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span></dt>
<dd><p>Resume the target’s CPUs after a breakpoint (or similar) stop</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">debug_reset</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span></dt>
<dd><p>Reset the target’s CPUs</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">debug_reset_halt</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span></dt>
<dd><p>Reset the target’s CPUs</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">debug_resume</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span></dt>
<dd><p>Resume the target</p>
<p>This is called to instruct the target to resume execution,
following any kind of breakpoint or stop that halted it.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">debug_info</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span></dt>
<dd><p>Return information about how to connect to the target to debug
it</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">debug_stop</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span></dt>
<dd><p>Stop debugging the target</p>
<p>This might not do anything on the target until power off, or
it might disconnect the debugger currently connected.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">debug_openocd</code><span class="sig-paren">(</span><em>who</em>, <em>command</em><span class="sig-paren">)</span></dt>
<dd><p>Run an OpenOCD command on the target’s controller (if the
target supports it).</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="power-control-interface">
<h3>8.7.5. Power Control Interface<a class="headerlink" href="#power-control-interface" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">ttbl.</code><code class="descname">tt_power_control_mixin</code><span class="sig-paren">(</span><em>impl=None</em><span class="sig-paren">)</span></dt>
<dd><p>This is the power control interface</p>
<p>This allows a target to be fully powered off, on, power cycled or
reset.</p>
<p>To run functions before power-off or after power-on, add functions
that take the target object as self to the
power_(on|off)_(post|pre)_fns lists.</p>
<p>Power control is implemented with
<a class="reference internal" href="#ttbl.tt_power_control_mixin" title="ttbl.tt_power_control_mixin"><code class="xref py py-class docutils literal"><span class="pre">ttbl.tt_power_control_mixin</span></code></a>, which can be
subclassed or given a subcless of an implementation object
(<a class="reference internal" href="#ttbl.tt_power_control_impl" title="ttbl.tt_power_control_impl"><code class="xref py py-class docutils literal"><span class="pre">ttbl.tt_power_control_impl</span></code></a>) or a list of them
(to create a power rail).</p>
<p>Power rails allow to create complex power configurations where a
target requires many things to be done in an specific sequence to
power up (and viceversa to power down). For example, for the
Arduino101 boards, the following happens:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">power_control</span> <span class="o">=</span> <span class="p">[</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">pc_ykush</span><span class="o">.</span><span class="n">ykush</span><span class="p">(</span><span class="s2">&quot;YK20954&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>      <span class="c1"># Flyswatter2</span>
  <span class="c1"># delay power-on until the flyswatter2 powers up as a USB device</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay_til_usb_device</span><span class="p">(</span><span class="n">serial</span> <span class="o">=</span> <span class="s2">&quot;FS20000&quot;</span><span class="p">),</span>
  <span class="c1"># delay on power off until the serial console device is gone,</span>
  <span class="c1"># to make sure it re-opens properly later. It also helps the</span>
  <span class="c1"># main board reset properly.</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay_til_file_gone</span><span class="p">(</span><span class="n">off</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty-arduino101-02&quot;</span><span class="p">),</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">pc_ykush</span><span class="o">.</span><span class="n">ykush</span><span class="p">(</span><span class="s2">&quot;YK20954&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>      <span class="c1"># serial port</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">cm_serial</span><span class="o">.</span><span class="n">pc</span><span class="p">(),</span>                    <span class="c1"># plug serial ports</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">pc_ykush</span><span class="o">.</span><span class="n">ykush</span><span class="p">(</span><span class="s2">&quot;YK20954&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>      <span class="c1"># board</span>
<span class="p">],</span>
</pre></div>
</div>
<p>this is a six-component power rail, which:</p>
<ol class="arabic simple">
<li>powers a port in a USB hub to power up the Flyswatter2
(firmware flasher) (with a <a class="reference internal" href="#ttbl.pc_ykush.ykush" title="ttbl.pc_ykush.ykush"><code class="xref py py-class docutils literal"><span class="pre">ttbl.pc_ykush.ykush</span></code></a>)</li>
<li>waits for the USB device representing said device to show up in
the system (with <a class="reference internal" href="#ttbl.pc.delay_til_usb_device" title="ttbl.pc.delay_til_usb_device"><code class="xref py py-class docutils literal"><span class="pre">ttbl.pc.delay_til_usb_device</span></code></a>).</li>
<li>(only used during power off) delay until said file is not
present in the system anymore
(<a class="reference internal" href="#ttbl.pc.delay_til_file_gone" title="ttbl.pc.delay_til_file_gone"><code class="xref py py-class docutils literal"><span class="pre">ttbl.pc.delay_til_file_gone</span></code></a>); this is used when we
power off something (like a USB serial device) and we know that
as a consequence, udev will remove a device node from the
system.</li>
<li>powers up a serial port</li>
<li>connects the serial ports of the target (once it has been
powered up in the previous step)</li>
<li>powers up the target itself</li>
</ol>
<p>The power off sequence runs in the inverse, first powering off the
target and then the rest of the components.</p>
<p>These power rails are often necessary for very small, low power
devices, that can get resideual power leaks from anywhere, and
thus anything connected to it has to be powered off (in specific
sequences) to ensure the board fully powers off.</p>
<p>The optional tag <em>idle_poweroff</em> can be given to the target to
control how long the target has to be idle before it is powered
off. If 0, it will never be automatically powered off upon
iddleness. Defaults to <a class="reference internal" href="#ttbl.config.target_max_idle" title="ttbl.config.target_max_idle"><code class="xref py py-data docutils literal"><span class="pre">ttbl.config.target_max_idle</span></code></a>.</p>
<dl class="method">
<dt>
<code class="descname">power_on</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">reset</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span></dt>
<dd><p>Reset the target (or power it on if off)</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">power_off</code><span class="sig-paren">(</span><em>who</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">power_cycle</code><span class="sig-paren">(</span><em>who</em>, <em>wait=None</em><span class="sig-paren">)</span></dt>
<dd><p>Power cycle the target, guaranteeing that at the end, it is
powered on.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>who</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#tuple" title="(in Python v2.7)"><em>tuple</em></a>) – Identity of the user</li>
<li><strong>wait</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – how much time to wait before powering on
after powering off.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">power_state</code><em class="property"> = []</em></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">power_get</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.pc"></span><dl class="class">
<dt id="ttbl.pc.nil">
<em class="property">class </em><code class="descclassname">ttbl.pc.</code><code class="descname">nil</code><span class="sig-paren">(</span><em>id</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.nil" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="ttbl.pc.nil.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.nil.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.nil.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.nil.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.nil.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.nil.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.pc.manual">
<em class="property">class </em><code class="descclassname">ttbl.pc.</code><code class="descname">manual</code><span class="sig-paren">(</span><em>id</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.manual" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a manual power control interface that prompts the user
to do the stuff.</p>
<dl class="method">
<dt id="ttbl.pc.manual.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.manual.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.manual.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.manual.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.manual.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.manual.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.pc.delay">
<em class="property">class </em><code class="descclassname">ttbl.pc.</code><code class="descname">delay</code><span class="sig-paren">(</span><em>on=0</em>, <em>off=0</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay" title="Permalink to this definition">¶</a></dt>
<dd><p>Introduce artificial delays when calling on/off/get to allow
targets to settle.</p>
<p>This is meant to be used in a stacked list of power
implementations given to a power control interface.</p>
<dl class="method">
<dt id="ttbl.pc.delay.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.pc.delay_til_file_gone">
<em class="property">class </em><code class="descclassname">ttbl.pc.</code><code class="descname">delay_til_file_gone</code><span class="sig-paren">(</span><em>poll_period=0.25</em>, <em>timeout=25</em>, <em>on=None</em>, <em>off=None</em>, <em>get=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_gone" title="Permalink to this definition">¶</a></dt>
<dd><p>Delay until a file dissapears.</p>
<p>This is meant to be used in a stacked list of power
implementations given to a power control interface.</p>
<dl class="method">
<dt id="ttbl.pc.delay_til_file_gone.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_gone.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_file_gone.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_gone.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_file_gone.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_gone.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.pc.delay_til_file_appears">
<em class="property">class </em><code class="descclassname">ttbl.pc.</code><code class="descname">delay_til_file_appears</code><span class="sig-paren">(</span><em>filename</em>, <em>poll_period=0.25</em>, <em>timeout=25</em>, <em>action=None</em>, <em>action_args=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_appears" title="Permalink to this definition">¶</a></dt>
<dd><p>Delay until a file appears.</p>
<p>This is meant to be used in a stacked list of power
implementations given to a power control interface.</p>
<dl class="method">
<dt id="ttbl.pc.delay_til_file_appears.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_appears.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_file_appears.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_appears.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_file_appears.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_file_appears.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.pc.delay_til_usb_device">
<em class="property">class </em><code class="descclassname">ttbl.pc.</code><code class="descname">delay_til_usb_device</code><span class="sig-paren">(</span><em>serial</em>, <em>when_powering_on=True</em>, <em>want_connected=True</em>, <em>poll_period=0.25</em>, <em>timeout=25</em>, <em>action=None</em>, <em>action_args=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_usb_device" title="Permalink to this definition">¶</a></dt>
<dd><p>Delay power-on until a USB device dis/appears.</p>
<p>This is meant to be used in a stacked list of power
implementations given to a power control interface.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Serial number of the USB device to monitor</li>
<li><strong>when_powering_on</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – Check when powering on if True
(default) or when powering off (if false)</li>
<li><strong>want_connected</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – when checking, we want the device to
be connected (True) or disconnected (False)</li>
<li><strong>action</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#callable" title="(in Python v2.7)"><em>callable</em></a>) – action to execute when the device is not
found, before waiting. Note the first parameter passed to the
action is the target itself and then any other parameter given
in action)_args</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="exception">
<dt id="ttbl.pc.delay_til_usb_device.not_found_e">
<em class="property">exception </em><code class="descname">not_found_e</code><a class="headerlink" href="#ttbl.pc.delay_til_usb_device.not_found_e" title="Permalink to this definition">¶</a></dt>
<dd><p>Exception raised when a USB device is not found</p>
</dd></dl>

<dl class="attribute">
<dt id="ttbl.pc.delay_til_usb_device.backend">
<code class="descname">backend</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.pc.delay_til_usb_device.backend" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_usb_device.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_usb_device.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_usb_device.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_usb_device.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.delay_til_usb_device.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.delay_til_usb_device.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.pc.dlwps7">
<em class="property">class </em><code class="descclassname">ttbl.pc.</code><code class="descname">dlwps7</code><span class="sig-paren">(</span><em>_url</em>, <em>reboot_wait_s=0.5</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.dlwps7" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a power control interface to the Digital Logger’s Web
Power Switch 7</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>_url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) – <p>URL describing the unit and outlet number, in
the form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">USER</span><span class="p">:</span><span class="n">PASSWORD</span><span class="nd">@HOST</span><span class="p">:</span><span class="n">PORT</span><span class="o">/</span><span class="n">OUTLETNUMBER</span>
</pre></div>
</div>
<p>where <cite>USER</cite> and <cite>PASSWORD</cite> are valid accounts set in the
Digital Logger’s Web Power Switch 7 administration interface
with access to the <cite>OUTLETNUMBER</cite>.</p>
</li>
<li><strong>reboot_wait</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – Seconds to wait in when power cycling an
outlet from off to on (defaults to 0.5s) or after powering up.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Access language documented at <a class="reference external" href="http://www.digital-loggers.com/http.html">http://www.digital-loggers.com/http.html</a>.</p>
<p>If you get an error like:</p>
<blockquote>
<div>Exception: Cannot find ‘&lt;!– state=(?P&lt;state&gt;[0-9a-z][0-9a-z]) lock=[0-9a-z][0-9a-z] –&gt;’ in power switch response</div></blockquote>
<p>this might be that you are going through a proxy that is messing
up things. In some cases the proxy was messing up the
authentication and imposing javascript execution that made the
driver fail.</p>
<dl class="method">
<dt id="ttbl.pc.dlwps7.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.dlwps7.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.dlwps7.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.dlwps7.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.dlwps7.power_cycle_do">
<code class="descname">power_cycle_do</code><span class="sig-paren">(</span><em>target</em>, <em>wait=0</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.dlwps7.power_cycle_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.pc.dlwps7.state_regex">
<code class="descname">state_regex</code><em class="property"> = &lt;_sre.SRE_Pattern object&gt;</em><a class="headerlink" href="#ttbl.pc.dlwps7.state_regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc.dlwps7.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc.dlwps7.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the power status for the outlet</p>
<p>The unit returns the power state when querying the
<code class="docutils literal"><span class="pre">/index.htm</span></code> path…as a comment inside the HTML body of the
respose. <em>Chuckle</em></p>
<p>So we look for:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;!-- state=XY lock=ANY --&gt;
</pre></div>
</div>
<p><em>XY</em> is the hex bitmap of states against the outlet
number. <em>ANY</em> is the hex lock bitmap (outlets that can’t
change).</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.pc_ykush"></span><dl class="class">
<dt id="ttbl.pc_ykush.ykush">
<em class="property">class </em><code class="descclassname">ttbl.pc_ykush.</code><code class="descname">ykush</code><span class="sig-paren">(</span><em>ykush_serial</em>, <em>port</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.ykush" title="Permalink to this definition">¶</a></dt>
<dd><p>A power control implementation using an YKUSH switchable hub
<a class="reference external" href="https://www.yepkit.com/products/ykush">https://www.yepkit.com/products/ykush</a></p>
<p>This is mainly devices that are USB powered and the ykush hub
is used to control the power to the ports.</p>
<p>Note this devices appears as a child connected to the YKUSH
hub, with vendor/device IDs 0x04d8:f2f7 (Microchip Technology)</p>
<p>You can find the right one with <cite>lsusb.py -ciu</cite>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">usb1</span>             <span class="mi">1</span><span class="n">d6b</span><span class="p">:</span><span class="mi">0002</span> <span class="mi">09</span>  <span class="mf">2.00</span>  <span class="mi">480</span><span class="n">MBit</span><span class="o">/</span><span class="n">s</span> <span class="mi">0</span><span class="n">mA</span> <span class="mi">1</span><span class="n">IF</span>  <span class="p">(</span><span class="n">Linux</span> <span class="mf">4.3</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="mf">300.</span><span class="n">fc23</span><span class="o">.</span><span class="n">x86_64</span> <span class="n">xhci</span><span class="o">-</span><span class="n">hcd</span> <span class="n">xHCI</span> <span class="n">Host</span> <span class="n">Controller</span> <span class="mi">0000</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">14.0</span><span class="p">)</span> <span class="n">hub</span>
 <span class="mi">1</span><span class="o">-</span><span class="mi">2</span>             <span class="mi">2001</span><span class="p">:</span><span class="n">f103</span> <span class="mi">09</span>  <span class="mf">2.00</span>  <span class="mi">480</span><span class="n">MBit</span><span class="o">/</span><span class="n">s</span> <span class="mi">0</span><span class="n">mA</span> <span class="mi">1</span><span class="n">IF</span>  <span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="n">Link</span> <span class="n">Corp</span><span class="o">.</span> <span class="n">DUB</span><span class="o">-</span><span class="n">H7</span> <span class="mi">7</span><span class="o">-</span><span class="n">port</span> <span class="n">USB</span> <span class="mf">2.0</span> <span class="n">hub</span><span class="p">)</span> <span class="n">hub</span>
  <span class="mi">1</span><span class="o">-</span><span class="mf">2.5</span>          <span class="mi">0424</span><span class="p">:</span><span class="mi">2514</span> <span class="mi">09</span>  <span class="mf">2.00</span>  <span class="mi">480</span><span class="n">MBit</span><span class="o">/</span><span class="n">s</span> <span class="mi">2</span><span class="n">mA</span> <span class="mi">1</span><span class="n">IF</span>  <span class="p">(</span><span class="n">Standard</span> <span class="n">Microsystems</span> <span class="n">Corp</span><span class="o">.</span> <span class="n">USB</span> <span class="mf">2.0</span> <span class="n">Hub</span><span class="p">)</span> <span class="n">hub</span>
   <span class="mi">1</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">4</span>       <span class="mi">04</span><span class="n">d8</span><span class="p">:</span><span class="n">f2f7</span> <span class="mi">00</span>  <span class="mf">2.00</span>   <span class="mi">12</span><span class="n">MBit</span><span class="o">/</span><span class="n">s</span> <span class="mi">100</span><span class="n">mA</span> <span class="mi">1</span><span class="n">IF</span>  <span class="p">(</span><span class="n">Yepkit</span> <span class="n">Lda</span><span class="o">.</span> <span class="n">YKUSH</span> <span class="n">YK20345</span><span class="p">)</span>
    <span class="mi">1</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">4</span><span class="p">:</span><span class="mf">1.0</span>   <span class="p">(</span><span class="n">IF</span><span class="p">)</span> <span class="mi">03</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="mi">2</span><span class="n">EPs</span> <span class="p">(</span><span class="n">Human</span> <span class="n">Interface</span> <span class="n">Device</span><span class="p">:</span><span class="n">No</span> <span class="n">Subclass</span><span class="p">:</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the <em>Yepkit Ltd, YK20345</em>; <em>YK20345</em> is the serial number.</p>
<p>To avoid permission issues:</p>
<ul>
<li><p class="first">choose a Unix group that the daemon will be running under</p>
</li>
<li><p class="first">add a UDEV rule to <code class="docutils literal"><span class="pre">/etc/udev/rules.d/90-tcf.rules</span></code> (or
other name):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># YKUSH power switch hubs</span>
<span class="n">SUBSYSTEM</span><span class="o">==</span><span class="s2">&quot;usb&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">idVendor</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;04d8&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">idProduct</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;f2f7&quot;</span><span class="p">,</span>               <span class="n">GROUP</span><span class="o">=</span><span class="s2">&quot;GROUPNAME&quot;</span><span class="p">,</span> <span class="n">MODE</span> <span class="o">=</span> <span class="s2">&quot;660&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">restart UDEV, replug your hubs:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo udevadm control --reload-rules
</pre></div>
</div>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ykush_serial</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Serial number of the ykush’s control
device.</li>
<li><strong>port</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – Port number in the hub (one-based)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="exception">
<dt id="ttbl.pc_ykush.ykush.notfound_e">
<em class="property">exception </em><code class="descname">notfound_e</code><a class="headerlink" href="#ttbl.pc_ykush.ykush.notfound_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.pc_ykush.ykush.backend">
<code class="descname">backend</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.pc_ykush.ykush.backend" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc_ykush.ykush.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.ykush.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc_ykush.ykush.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.ykush.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc_ykush.ykush.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.ykush.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.pc_ykush.plugger">
<em class="property">class </em><code class="descclassname">ttbl.pc_ykush.</code><code class="descname">plugger</code><span class="sig-paren">(</span><em>ykush_serial</em>, <em>port</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.plugger" title="Permalink to this definition">¶</a></dt>
<dd><p>Plugger to connect/disconnect a USB device with a YKUSH</p>
<dl class="method">
<dt id="ttbl.pc_ykush.plugger.plug">
<code class="descname">plug</code><span class="sig-paren">(</span><em>target</em>, <em>_thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.plugger.plug" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.pc_ykush.plugger.unplug">
<code class="descname">unplug</code><span class="sig-paren">(</span><em>target</em>, <em>_thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.pc_ykush.plugger.unplug" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-ttbl.usbrly08b"></span><dl class="class">
<dt id="ttbl.usbrly08b.rly08b">
<em class="property">class </em><code class="descclassname">ttbl.usbrly08b.</code><code class="descname">rly08b</code><span class="sig-paren">(</span><em>serial_number</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.rly08b" title="Permalink to this definition">¶</a></dt>
<dd><p>A power control implementation for the USB-RLY08B relay controller
<a class="reference external" href="https://www.robot-electronics.co.uk/htm/usb_rly08btech.htm">https://www.robot-electronics.co.uk/htm/usb_rly08btech.htm</a>.</p>
<p>This serves as base for other drivers to implement <a class="reference internal" href="#ttbl.usbrly08b.pc" title="ttbl.usbrly08b.pc"><code class="xref py py-class docutils literal"><span class="pre">per</span>
<span class="pre">relay</span> <span class="pre">power</span> <span class="pre">controllers</span></code></a>, <a class="reference internal" href="#ttbl.usbrly08b.plugger" title="ttbl.usbrly08b.plugger"><code class="xref py py-class docutils literal"><span class="pre">USB</span> <span class="pre">pluggers</span> <span class="pre">as</span> <span class="pre">*thing*</span> <span class="pre">or</span>
<span class="pre">power</span> <span class="pre">controllers</span></code></a>.</p>
<p>This device offers eight relays for AC and DC. The relays being on
or off are controlled by a byte-oriented serial protocol over an
FTDI chip that shows as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ lsusb.py -iu
...
1-1.1.1       04d8:ffee 02  2.00   12MBit/s 100mA 2IFs (Devantech Ltd. USB-RLY08 00023456)
   1-1.1.1:1.0   (IF) 02:02:01 1EP  (Communications:Abstract (modem):AT-commands (v.25ter)) cdc_acm tty/ttyACM0
   1-1.1.1:1.1   (IF) 0a:00:00 2EPs (CDC Data:) cdc_acm
...
</pre></div>
</div>
<p>Note the <em>00023456</em> is the serial number.</p>
<p>To avoid permission issues, it can either:</p>
<ul>
<li><p class="first">The default rules in most Linux platforms will make the
device node owned by group <em>dialout</em>, so make the daemon
have that supplementary GID.</p>
</li>
<li><p class="first">add a UDEV rule to <code class="docutils literal"><span class="pre">/etc/udev/rules.d/90-ttbd.rules</span></code> (or
other name):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SUBSYSTEM</span> <span class="o">==</span> <span class="s2">&quot;tty&quot;</span><span class="p">,</span> <span class="n">ENV</span><span class="p">{</span><span class="n">ID_SERIAL_SHORT</span><span class="p">}</span> <span class="o">==</span> <span class="s2">&quot;00023456&quot;</span><span class="p">,</span>           <span class="n">GROUP</span><span class="o">=</span><span class="s2">&quot;GROUPNAME&quot;</span><span class="p">,</span> <span class="n">MODE</span> <span class="o">=</span> <span class="s2">&quot;660&quot;</span>
</pre></div>
</div>
<p>restart <em>udev*</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo udevadm control --reload-rules
</pre></div>
</div>
<p>replug your hubs so the rule is set.</p>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Serial number of the relay’s control
device.</li>
<li><strong>relay</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of the relay to control (1-8)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="exception">
<dt id="ttbl.usbrly08b.rly08b.not_found_e">
<em class="property">exception </em><code class="descname">not_found_e</code><a class="headerlink" href="#ttbl.usbrly08b.rly08b.not_found_e" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ttbl.usbrly08b.rly08b.backend">
<code class="descname">backend</code><em class="property"> = None</em><a class="headerlink" href="#ttbl.usbrly08b.rly08b.backend" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.usbrly08b.pc">
<em class="property">class </em><code class="descclassname">ttbl.usbrly08b.</code><code class="descname">pc</code><span class="sig-paren">(</span><em>serial_number</em>, <em>relay</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.pc" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="ttbl.usbrly08b.pc.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.pc.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.pc.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.pc.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.pc.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.pc.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="ttbl.usbrly08b.plugger">
<em class="property">class </em><code class="descclassname">ttbl.usbrly08b.</code><code class="descname">plugger</code><span class="sig-paren">(</span><em>serial_number</em>, <em>bank</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.plugger" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement a USB multiplexor/plugger that allows a DUT to be
plugged to Host B and to Host A when unplugged. It follows it can
work as a USB cutter if Host A is disconnected.</p>
<p>It also implements a power control implementation, so when powered
off, it plugs-to-Host-B and when powered on, it
plugs-to-host-A. Likewise, if Host B is disconnected, when off it
is effectively disconnected. This serves to for example, connect a
USB storage drive to a target that will be able to access it when
turned on and when off, it can be connected to another machine
that can, eg: use it to flash software.</p>
<p>This uses a <a class="reference internal" href="#ttbl.usbrly08b.rly08b" title="ttbl.usbrly08b.rly08b"><code class="xref py py-class docutils literal"><span class="pre">rly08b</span></code></a> relay bank to do the switching.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>serial_number</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – USB serial number of the USB-RLY8B
device used to control</li>
<li><strong>bank</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – bank of relays to use; bank 0 are relays 1-4,
bank 1 are relays 5-8. Note below for connection information.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>System setup details</strong></p>
<ul>
<li><p class="first">A USB connection is four cables: VCC (red), D+ (white), D-
(green), GND (black) plus a shielding wrapping it all.</p>
</li>
<li><p class="first">A relay has three terminals; NO, C and NC.
- ON means C and NC are connected
- OFF means C and NO are connected</p>
<dl class="docutils">
<dt>(it is recommended to label the cable connected to NO as</dt>
<dd><p class="first last">OFF/PLUGGED and the one to NC as ON/UNPLUGGED)</p>
</dd>
</dl>
</li>
<li><p class="first">We use the USB-RLY8B, which has eight individual relays, so we can
switch two devices between two USB hosts each.</p>
</li>
</ul>
<p>We connect the DUT’s cables and host cables as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="7%" />
<col width="26%" />
<col width="7%" />
<col width="26%" />
<col width="7%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DUT1</td>
<td>pin</td>
<td>Host A1/ON</td>
<td>pin</td>
<td>Host B1/OFF</td>
<td>pin</td>
</tr>
<tr class="row-even"><td>VCC (red)</td>
<td>1C</td>
<td>VCC (red)</td>
<td>1NO</td>
<td>VCC (red)</td>
<td>1NC</td>
</tr>
<tr class="row-odd"><td>D+  (white)</td>
<td>2C</td>
<td>D+  (white)</td>
<td>2NO</td>
<td>D+  (white)</td>
<td>2NC</td>
</tr>
<tr class="row-even"><td>D-  (green)</td>
<td>3C</td>
<td>D-  (green)</td>
<td>3NO</td>
<td>D-  (green)</td>
<td>3NC</td>
</tr>
<tr class="row-odd"><td>GND (black)</td>
<td>4C</td>
<td>GND (black)</td>
<td>4NO</td>
<td>GND (black)</td>
<td>4NC</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="7%" />
<col width="26%" />
<col width="7%" />
<col width="26%" />
<col width="7%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DUT2</td>
<td>pin</td>
<td>Host A2/ON</td>
<td>pin</td>
<td>Host B1/OFF</td>
<td>pin</td>
</tr>
<tr class="row-even"><td>VCC (red)</td>
<td>5C</td>
<td>VCC (red)</td>
<td>5NO</td>
<td>VCC (red)</td>
<td>5NC</td>
</tr>
<tr class="row-odd"><td>D+  (white)</td>
<td>6C</td>
<td>D+  (white)</td>
<td>6NO</td>
<td>D+  (white)</td>
<td>6NC</td>
</tr>
<tr class="row-even"><td>D-  (green)</td>
<td>7C</td>
<td>D-  (green)</td>
<td>7NO</td>
<td>D-  (green)</td>
<td>7NC</td>
</tr>
<tr class="row-odd"><td>GND (black)</td>
<td>8C</td>
<td>GND (black)</td>
<td>8NO</td>
<td>GND (black)</td>
<td>8NC</td>
</tr>
</tbody>
</table>
<p>For example, to switch an Arduino 101 between a NUC and the TTBD
server that flashes and controls it:</p>
<ul class="simple">
<li>DUT (C) is our Arduino 101,</li>
<li>Host B (NC) is another NUC machine in the TCF infrastructure</li>
<li>Host A (NO) is the TTBD server (via the YKUSH port)</li>
</ul>
<p>For a pure USB cutter (where we don’t need the connection to a
TTBD server on MCU boards that expose a separate debugging cable
for power and flashing), we’d connect the USB port like:</p>
<ul class="simple">
<li>DUT (C) is the MCU’s USB port</li>
<li>Host B (NC) is the NUC machine in the TCF infrastructure</li>
<li>Host A (NO) is left disconnected</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>switching <em>ONLY</em> the VCC and GND connections (always
leave D+ and D- connected the the Host A to avoid Host B
doing a data connection and only being used to supply
power) does not work.</p>
<p class="last">Host A still detects the power differential in D+ D- and
thought there was a device; tried to enable it, failed
and disabled the port.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We can’t turn them on or off at the same time because
the HW doesn’t allow to set a mask and we could override
settings for the other ports we are not controlling
here–another server process might be tweaking the other
ports.</p>
</div>
<p>** Configuration details **</p>
<p>Example:</p>
<blockquote>
<div><p>To connect a USB device from system A to system B, so power off
means connected to B, power-on connected to A, add to the
configuration:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">tt</span><span class="o">.</span><span class="n">tt_power</span><span class="p">(</span>
      <span class="s2">&quot;devicename&quot;</span><span class="p">,</span>
      <span class="n">power_control</span> <span class="o">=</span> <span class="p">[</span>
          <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">plugger</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
      <span class="p">]),</span>
    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;device-switcher&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Thus to connect to system B:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf acquire devicename
$ tcf power-off devicename
</pre></div>
</div>
<p>Thus to connect to system A:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf power-on devicename
</pre></div>
</div>
</div></blockquote>
<p>Example:</p>
<blockquote>
<div><p>If system B is the ttbd server, then you can refine it to test
the USB device is connecting/disconnecting.</p>
<p>To connect a USB drive to a target before the target is powered
on (in this example, a NUC mini-PC with a USB drive connected
to boot off it, the configuration block would be as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">target_add</span><span class="p">(</span>
  <span class="n">ttbl</span><span class="o">.</span><span class="n">tt</span><span class="o">.</span><span class="n">tt_power</span><span class="p">(</span>
      <span class="s2">&quot;nuc-43&quot;</span><span class="p">,</span>
      <span class="n">power_control</span> <span class="o">=</span> <span class="p">[</span>
          <span class="c1"># Ensure the dongle is / has been connected to the server</span>
          <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay_til_usb_device</span><span class="p">(</span><span class="s2">&quot;7FA50D00FFFF00DD&quot;</span><span class="p">,</span>
                                       <span class="n">when_powering_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                       <span class="n">want_connected</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
          <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">plugger</span><span class="p">(</span><span class="s2">&quot;00023456&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
          <span class="c1"># Ensure the dongle disconnected from the server</span>
          <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay_til_usb_device</span><span class="p">(</span><span class="s2">&quot;7FA50D00FFFF00DD&quot;</span><span class="p">,</span>
                                       <span class="n">when_powering_on</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                       <span class="n">want_connected</span> <span class="o">=</span> <span class="kc">False</span><span class="p">),</span>
          <span class="c1"># power on the target</span>
          <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">dlwps7</span><span class="p">(</span><span class="s2">&quot;http://admin:1234@SPNAME/SPPORT&quot;</span><span class="p">),</span>
          <span class="c1"># let it boot</span>
          <span class="n">ttbl</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
      <span class="p">]),</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;linux&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;bsp_models&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">:</span> <span class="kc">None</span> <span class="p">},</span>
        <span class="s1">&#39;bsps&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;x86_64&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;linux&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;nuc-linux-x86_64&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that the serial number <em>7FA50D00FFFF00DD</em> is that of the
USB drive and <em>00023456</em> is the serial number of the USB-RLY8b
board which implements the switching (in this case we use bank 0
of relays, from 1 to 4).</p>
</div></blockquote>
<p>Example:</p>
<p>An Arduino 101 is connected to a NUC mini-PC as a USB device using
the <em>thing</em> interface that we can control from a script or command line:</p>
<p>In this case we create an <em>interconnect</em> that wraps all the
targets together (the Arduino 101, the NUC) to indicate they
operate together and the configuration block would be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">interconnect_add</span><span class="p">(</span><span class="n">ttbl</span><span class="o">.</span><span class="n">test_target</span><span class="p">(</span><span class="s2">&quot;usb__nuc-02__a101-04&quot;</span><span class="p">),</span>
                            <span class="n">ic_type</span> <span class="o">=</span> <span class="s2">&quot;usb__host__device&quot;</span><span class="p">)</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;nuc-02&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_to_interconnect</span><span class="p">(</span><span class="s1">&#39;usb__nuc-02__a101-04&#39;</span><span class="p">)</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;a101-04&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_to_interconnect</span><span class="p">(</span><span class="s1">&#39;usb__nuc-02__a101-04&#39;</span><span class="p">)</span>
<span class="n">ttbl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="s1">&#39;nuc-02&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">thing_add</span><span class="p">(</span><span class="s1">&#39;a101-04&#39;</span><span class="p">,</span>
                                        <span class="n">ttbl</span><span class="o">.</span><span class="n">usbrly08b</span><span class="o">.</span><span class="n">plugger</span><span class="p">(</span><span class="s2">&quot;00033085&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>Where <em>00033085</em> is the serial number for the USB-RLY8b which
implements the USB plugging/unplugging (in this case we use bank 1
of relays, from 5 to 8)</p>
<dl class="method">
<dt id="ttbl.usbrly08b.plugger.plug">
<code class="descname">plug</code><span class="sig-paren">(</span><em>target</em>, <em>_thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.plugger.plug" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.plugger.unplug">
<code class="descname">unplug</code><span class="sig-paren">(</span><em>target</em>, <em>_thing</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.plugger.unplug" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.plugger.power_on_do">
<code class="descname">power_on_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.plugger.power_on_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.plugger.power_off_do">
<code class="descname">power_off_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.plugger.power_off_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ttbl.usbrly08b.plugger.power_get_do">
<code class="descname">power_get_do</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.usbrly08b.plugger.power_get_do" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<div class="section" id="module-ttbl.target">
<span id="miscelaneous"></span><h4>8.7.5.1. Miscelaneous<a class="headerlink" href="#module-ttbl.target" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="ttbl.target.expect_send_sequence">
<code class="descclassname">ttbl.target.</code><code class="descname">expect_send_sequence</code><span class="sig-paren">(</span><em>logger</em>, <em>e</em>, <em>_list</em><span class="sig-paren">)</span><a class="headerlink" href="#ttbl.target.expect_send_sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute a list of expect/send commands</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>logger</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/logging.html#logging.Logger" title="(in Python v2.7)"><em>logging.Logger</em></a>) – a logging object to report progress
to.</li>
<li><strong>e</strong> (<a class="reference external" href="https://pexpect.readthedocs.io/en/stable/api/pexpect.html#pexpect.spawn" title="(in Pexpect v4.6)"><em>pexpect.spawn</em></a>) – <p>Expect-like object on which to execute the
commands; for example, a expect object connected to a serial
line to control a remote device:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s2">&quot;/dev/ttyS0&quot;</span><span class="p">,</span> <span class="n">baudrate</span> <span class="o">=</span> <span class="mi">115200</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">fdpexpect</span><span class="o">.</span><span class="n">fdspawn</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">logfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;file.log&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">),</span>
                      <span class="n">timeout</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><strong>_list</strong> – <p>List of tuples <code class="docutils literal"><span class="pre">(EXPECT[,</span> <span class="pre">SEND[,</span> <span class="pre">WAIT[,</span>
<span class="pre">DELAY]]])</span></code>:</p>
<ul>
<li>EXPECT: string that is expected to be received</li>
<li>SEND: string to send (or None if nothing shall be sent.)</li>
</ul>
<p>The tuple can just be a string for an EXPECT</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="module-commonl.expr_parser">
<span id="common-helper-library"></span><h3>8.7.6. Common helper library<a class="headerlink" href="#module-commonl.expr_parser" title="Permalink to this headline">¶</a></h3>
<p>This module implements a simple expression language.</p>
<p>The grammar for this language is as follows:</p>
<blockquote>
<div><dl class="docutils">
<dt>expression ::= expression “and” expression</dt>
<dd><div class="first last line-block">
<div class="line">expression “or” expression</div>
<div class="line">“not” expression</div>
<div class="line">“(” expression “)”</div>
<div class="line">symbol “==” constant</div>
<div class="line">symbol “!=” constant</div>
<div class="line">symbol “&lt;” number</div>
<div class="line">symbol “&gt;” number</div>
<div class="line">symbol “&gt;=” number</div>
<div class="line">symbol “&lt;=” number</div>
<div class="line">symbol “in” list</div>
<div class="line">symbol</div>
</div>
</dd>
</dl>
<p>list ::= “[” list_contents “]”</p>
<dl class="docutils">
<dt>list_contents ::= constant</dt>
<dd><div class="first last line-block">
<div class="line">list_contents “,” constant</div>
</div>
</dd>
<dt>constant ::= number</dt>
<dd><div class="first last line-block">
<div class="line">string</div>
</div>
</dd>
</dl>
</div></blockquote>
<p>When symbols are encountered, they are looked up in an environment
dictionary supplied to the parse() function.</p>
<p>For the case where</p>
<blockquote>
<div>expression ::= symbol</div></blockquote>
<p>it evaluates to true if the symbol is defined to a non-empty string.</p>
<p>For all comparison operators, if the config symbol is undefined, it will
be treated as a 0 (for &gt; &lt; &gt;= &lt;=) or an empty string “” (for == != in).
For numerical comparisons it doesn’t matter if the environment stores
the value as an integer or string, it will be cast appropriately.</p>
<p>Operator precedence, starting from lowest to highest:</p>
<blockquote>
<div>or (left associative)
and (left associative)
not (right associative)
all comparison operators (non-associative)</div></blockquote>
<p>The ‘:’ operator compiles the string argument as a regular expression,
and then returns a true value only if the symbol’s value in the environment
matches. For example, if CONFIG_SOC=”quark_se” then</p>
<blockquote>
<div>filter = CONFIG_SOC : “quark.*”</div></blockquote>
<p>Would match it.</p>
<dl class="function">
<dt id="commonl.expr_parser.t_HEX">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">t_HEX</code><span class="sig-paren">(</span><em>t</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.t_HEX" title="Permalink to this definition">¶</a></dt>
<dd><p>0x[0-9a-fA-F]+</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.t_INTEGER">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">t_INTEGER</code><span class="sig-paren">(</span><em>t</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.t_INTEGER" title="Permalink to this definition">¶</a></dt>
<dd><p>d+</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.t_STR">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">t_STR</code><span class="sig-paren">(</span><em>t</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.t_STR" title="Permalink to this definition">¶</a></dt>
<dd><p>“([^\n]|(.))*?”<a href="#id1"><span class="problematic" id="id2">|</span></a>’([^\n]|(.))*?’</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.t_SYMBOL">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">t_SYMBOL</code><span class="sig-paren">(</span><em>t</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.t_SYMBOL" title="Permalink to this definition">¶</a></dt>
<dd><p>[<a href="#id3"><span class="problematic" id="id4">A-Za-z_</span></a>][-/.0-<a href="#id5"><span class="problematic" id="id6">9A-Za-z_</span></a>]*</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.t_error">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">t_error</code><span class="sig-paren">(</span><em>t</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.t_error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_expr_or">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_expr_or</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_expr_or" title="Permalink to this definition">¶</a></dt>
<dd><p>expr : expr OR expr</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_expr_and">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_expr_and</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_expr_and" title="Permalink to this definition">¶</a></dt>
<dd><p>expr : expr AND expr</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_expr_not">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_expr_not</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_expr_not" title="Permalink to this definition">¶</a></dt>
<dd><p>expr : NOT expr</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_expr_parens">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_expr_parens</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_expr_parens" title="Permalink to this definition">¶</a></dt>
<dd><p>expr : OPAREN expr CPAREN</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_expr_eval">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_expr_eval</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_expr_eval" title="Permalink to this definition">¶</a></dt>
<dd><p>expr : SYMBOL EQUALS const
| SYMBOL NOTEQUALS const
| SYMBOL GT number
| SYMBOL LT number
| SYMBOL GTEQ number
| SYMBOL LTEQ number
| SYMBOL IN list
| SYMBOL IN SYMBOL
| SYMBOL COLON STR</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_expr_single">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_expr_single</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_expr_single" title="Permalink to this definition">¶</a></dt>
<dd><p>expr : SYMBOL</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_list">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_list</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_list" title="Permalink to this definition">¶</a></dt>
<dd><p>list : OBRACKET list_intr CBRACKET</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_list_intr_single">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_list_intr_single</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_list_intr_single" title="Permalink to this definition">¶</a></dt>
<dd><p>list_intr : const</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_list_intr_mult">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_list_intr_mult</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_list_intr_mult" title="Permalink to this definition">¶</a></dt>
<dd><p>list_intr : list_intr COMMA const</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_const">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_const</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_const" title="Permalink to this definition">¶</a></dt>
<dd><p>const : STR
| number</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_number">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_number</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_number" title="Permalink to this definition">¶</a></dt>
<dd><p>number : INTEGER
| HEX</p>
</dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.p_error">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">p_error</code><span class="sig-paren">(</span><em>p</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.p_error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.ast_sym">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">ast_sym</code><span class="sig-paren">(</span><em>ast</em>, <em>env</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.ast_sym" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.ast_sym_int">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">ast_sym_int</code><span class="sig-paren">(</span><em>ast</em>, <em>env</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.ast_sym_int" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.ast_expr">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">ast_expr</code><span class="sig-paren">(</span><em>ast</em>, <em>env</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.ast_expr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.expr_parser.parse">
<code class="descclassname">commonl.expr_parser.</code><code class="descname">parse</code><span class="sig-paren">(</span><em>expr_text</em>, <em>env</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.expr_parser.parse" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a text representation of an expression in our language,
use the provided environment to determine whether the expression
is true or false</p>
</dd></dl>

<span class="target" id="module-commonl.tcob"></span><div class="section" id="tcob-fixture-setup-instructions">
<h4>8.7.6.1. TCOB Fixture setup instructions<a class="headerlink" href="#tcob-fixture-setup-instructions" title="Permalink to this headline">¶</a></h4>
<p>The TCOB board is a rectangular board, considered to be:</p>
<ul class="simple">
<li>facing up (DIP switches 1, 2 3, and 4 facing the viewer)   -</li>
<li><dl class="first docutils">
<dt>top left is the side where the power barrel connector J4 is</dt>
<dd><ul class="first last">
<li></li>
</ul>
</dd>
</dl>
</li>
<li>bottom is the side where jumpers J1, J2, J3, J6 and J7, J8, J9 are</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">+---------------------------------------------------------------+</span>
<span class="o">|+----+</span>       <span class="o">+--</span><span class="n">J11</span><span class="o">----------------+</span>  <span class="o">+---</span><span class="n">J10</span><span class="o">---------------+</span>  <span class="o">|</span>
<span class="o">||</span> <span class="n">J4</span> <span class="o">|</span>       <span class="o">|</span> <span class="n">X11</span> <span class="n">X10</span> <span class="n">X9</span><span class="o">...</span> <span class="n">X1</span> <span class="n">X0</span> <span class="o">|</span>  <span class="o">|</span> <span class="n">X11</span> <span class="n">X10</span> <span class="n">X9</span><span class="o">...</span> <span class="n">X1</span> <span class="n">X0</span> <span class="o">|</span>  <span class="o">|</span>
<span class="o">|+----+</span>       <span class="o">+---------------------+</span>  <span class="o">+---------------------+</span>  <span class="o">|</span>
<span class="o">|</span>            <span class="o">+------------------+</span> <span class="o">+-----------------+</span>           <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----+</span>    <span class="o">|</span>     <span class="n">DIP3</span>         <span class="o">|</span> <span class="o">|</span>    <span class="n">DIP2</span>         <span class="o">|</span>           <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span> <span class="n">J5</span> <span class="o">|</span>    <span class="o">+------------------+</span> <span class="o">+-----------------+</span>  <span class="o">+---+</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----+</span>                                              <span class="o">|</span> <span class="n">D</span> <span class="o">|</span>    <span class="o">|</span>
<span class="o">|</span>                                                      <span class="o">|</span> <span class="n">I</span> <span class="o">|</span>    <span class="o">|</span>
<span class="o">|</span>                                                      <span class="o">|</span> <span class="n">P</span> <span class="o">|</span>    <span class="o">|</span>
<span class="o">|</span>                                                      <span class="o">|</span> <span class="mi">4</span> <span class="o">|</span>    <span class="o">|</span>
<span class="o">|</span>                                        <span class="o">+---------+</span>   <span class="o">+---+</span>    <span class="o">|</span>
<span class="o">|</span>                                        <span class="o">|</span>  <span class="n">DIP1</span>   <span class="o">|</span>            <span class="o">|</span>
<span class="o">|</span>                                        <span class="o">+---------+</span>            <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----+----+----+</span>         <span class="o">+----+</span>            <span class="o">+----+----+----+</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span> <span class="n">J2</span> <span class="o">|</span> <span class="n">J3</span> <span class="o">|</span> <span class="n">J6</span> <span class="o">|</span>         <span class="o">|</span> <span class="n">J1</span> <span class="o">|</span>            <span class="o">|</span> <span class="n">J7</span> <span class="o">|</span> <span class="n">J8</span> <span class="o">|</span> <span class="n">J9</span> <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----+----+----+</span>         <span class="o">+----+</span>  <span class="o">+-----+</span>   <span class="o">+----+----+----+</span>  <span class="o">|</span>
<span class="o">+-----------------------------------|</span> <span class="n">J13</span> <span class="o">|---------------------+</span>
                                    <span class="o">+-----+</span>
</pre></div>
</div>
<p><strong>Sensing pins banks</strong></p>
<p>These are the pins that are connected to the Arduino header for
testing</p>
<ul>
<li><p class="first">J11 is a bank of 12 pins on the top left of the board, named X0
through X11 (from right to left)</p>
<p>J11’s I2C 3-bit address is controlled by J2/J3/J6. Shorting the two
left pins of the jumper means 1, shorting the two right pins means
0. The address is computed as:</p>
<blockquote>
<div><p>J2 &lt;&lt; 2 | J3 &lt;&lt; 1| J6</p>
</div></blockquote>
</li>
<li><p class="first">J10 is a bank of 12 pins on the top left of the board, named X0
through X11 (from right to left)</p>
<p>J11’s I2C address is controlled by J7/J8/J9; same SPI address
assignment strategy as for J11.</p>
</li>
</ul>
<p>To address the sensing pins XN we use the tuple <em>(addr, N)</em>, where
addr is the address of the J11 or J10 block where the pin is
physically located. Thus, if J11 has assigned address 3, J11’s X5
would be <em>(3, 5)</em>.</p>
<p><strong>DIP configuration to allow control of the TCOB via the I2C protocol</strong></p>
<ul class="simple">
<li>DIP3: turn on 1, 2 and 4 (I2C SCL, SDA and GND)</li>
<li>DIP2: turn on 6 (reset)</li>
<li>DIP3: FIXME? turn on 3, 9, 10 on first TCOB layer</li>
<li>DIP4: turn on 2, 3, 4 and 5 to use the Arduino Due SPI port for pins
MISO/MOSI/SCK/CS (FIXME: not clear).</li>
</ul>
<p><strong>Power configuration</strong></p>
<ul class="simple">
<li>default power supply: short J5 two bottom pins (we use this by default)</li>
<li>external (barrel) 12 VDC power supply: open all of J5 pins</li>
<li>J1: reference voltage<ul>
<li>short J1 if if the Arduino (FIXME: Dut? controller?) logic voltage
level is 3.3V</li>
<li>connect to 5V for reference voltage otherwise</li>
</ul>
</li>
</ul>
<p><strong>Stacking</strong></p>
<p>TCOBs are designed to be stacked, the top level J1, J5 and J21 being
passed through. The top level board shall be the one used to short J1
and J5 if such is the configuration.</p>
<p><strong>Connection map</strong></p>
<p>We will give the TCOB controller a connection and a pin map, in which
we describe to which pins the different Arduino pins are connected,
for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">_common_connections</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
  <span class="c1"># switch 0</span>
  <span class="n">DUT_SCL</span> <span class="o">=</span> <span class="s2">&quot;0 0&quot;</span><span class="p">,</span>
  <span class="n">DUT_SDA</span> <span class="o">=</span> <span class="s2">&quot;0 1&quot;</span><span class="p">,</span>
  <span class="n">SPI_0_MOSI</span> <span class="o">=</span> <span class="s2">&quot;0 2&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>pin map: FIXME, what is it for?</p>
<p>Indicates that pin X0 of the bank which I2C address 0 is to be
connected to the Arduino headers <em>SCL</em> line. By definition, it means
there has to be a sensing pink bank with address 0</p>
<p>For most configurations described below, we stack two TCOBs:</p>
<blockquote>
<div><ul class="simple">
<li>top TCOB: J11 is #1 (001), J10 is #0 (000)</li>
<li>bottom TCOB: J11 is #3 (011), J10 is #2 (010)</li>
</ul>
</div></blockquote>
<dl class="function">
<dt id="commonl.tcob.validate_pin_map">
<code class="descclassname">commonl.tcob.</code><code class="descname">validate_pin_map</code><span class="sig-paren">(</span><em>pin_map</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.tcob.validate_pin_map" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="commonl.tcob.validate_connections">
<code class="descclassname">commonl.tcob.</code><code class="descname">validate_connections</code><span class="sig-paren">(</span><em>connections</em><span class="sig-paren">)</span><a class="headerlink" href="#commonl.tcob.validate_connections" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="glossary.html" class="btn btn-neutral float-right" title="9. Glossary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="07-Architecture.html" class="btn btn-neutral" title="7. Architecture" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Author.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.11',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>