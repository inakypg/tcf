

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Quickstart &mdash; Test Case Framework 0.11 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Test Case Framework 0.11 documentation" href="index.html"/>
        <link rel="next" title="2. Guides" href="doc/02-guides.html"/>
        <link rel="prev" title="TCF" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Test Case Framework
          

          
          </a>

          
            
            
              <div class="version">
                0.11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#playing-around-with-a-server">1.1. <em>Playing around with a server</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-zephyr-os-testcases">1.2. Running Zephyr OS testcases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-in-multiple-targets">1.2.1. Running in multiple targets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-many-testcases">1.2.2. Running many testcases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#automating-test-case-building-and-execution">1.3. Automating test case building and execution</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="doc/02-guides.html">2. Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/03-server-setup.html">3. Server deployment guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/04-HOWTOs.html">4. HOWTOs</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/05-RFAQs.html">5. Rationales and Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/06-troubleshooting.html">6. Support &amp; Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/07-Architecture.html">7. Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/09-api.html">8. APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/10-Status.html">10. Current status and plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="01-CHANGELOG.html">11. TCF release v0.11</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Test Case Framework</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>1. Quickstart</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/02-QUICKSTART.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart">
<span id="id1"></span><h1>1. Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<ol class="arabic" id="install-tcf-client">
<li><p class="first">Install the client software from source:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git clone http://github.com/intel/tcf tcf.git
$ cd tcf.git
$ pip2 install --user -r requirements.txt  # dependencies
$ python2 setup.py install --user
$ cd zephyr
$ python2 setup.py install --user
</pre></div>
</div>
<p>You can also run <em>tcf</em> from the <a class="reference internal" href="doc/02-guides.html#tcf-run-from-source-tree"><span class="std std-ref">source directory</span></a>.</p>
</li>
<li><p class="first"><a class="reference internal" href="doc/02-guides.html#tcf-guide-configuration"><span class="std std-ref">Configure it</span></a>, adding to
<cite>~/.tcf/conf_servers.py</cite> or <cite>/etc/tcf/conf_servers.py</cite></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tcfl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">url_add</span><span class="p">(</span><span class="s1">&#39;https://SERVER1:5000&#39;</span><span class="p">,</span> <span class="n">ssl_ignore</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">tcfl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">url_add</span><span class="p">(</span><span class="s1">&#39;https://SERVER2:5000&#39;</span><span class="p">,</span> <span class="n">ssl_ignore</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">tcfl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">url_add</span><span class="p">(</span><span class="s1">&#39;https://SERVER3:5000&#39;</span><span class="p">,</span> <span class="n">ssl_ignore</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">tcfl</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">url_add</span><span class="p">(</span><span class="s1">&#39;https://SERVER3:5000&#39;</span><span class="p">,</span> <span class="n">ssl_ignore</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>You will need permission for the server’s admins, in the form of a
login and password that they need to provide to you so you can login
to them using <cite>tcf login LOGIN</cite>.</p>
<p>You can also <a class="reference internal" href="doc/03-server-setup.html#ttbd-guide-deployment"><span class="std std-ref">install a server</span></a>, in
your machine or another one.</p>
</li>
<li><p class="first">Now, login with the provided <em>login</em> and <em>password</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf login LOGIN
Login to https://SERVER1:5000 as LOGIN
Password: &lt;your password&gt;
Login to https://SERVER2:5000 as LOGIN
Password: &lt;your password&gt;
Login to https://SERVER3:5000 as LOGIN
Password: &lt;your password&gt;
</pre></div>
</div>
</li>
<li><p class="first">If you want to run Zephyr testcases you will also need to follow
the <a class="reference external" href="https://docs.zephyrproject.org/latest/getting_started/installation_linux.html">Zephyr Development Environment Setup on Linux</a>
and run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git clone https://github.com/zephyrproject-rtos/zephyr.git zephyr.git
$ source zephyr.git/zephyr-env.sh
</pre></div>
</div>
<p>before getting running <em>tcf</em> commands that involve Zephyr.</p>
</li>
</ol>
<p><a class="reference internal" href="doc/02-guides.html#tcf-contributing"><span class="std std-ref">Contributions</span></a> welcome!</p>
<div class="section" id="playing-around-with-a-server">
<h2>1.1. <em>Playing around with a server</em><a class="headerlink" href="#playing-around-with-a-server" title="Permalink to this headline">¶</a></h2>
<p>Once a server is configured and logged in, list with <em>tcf</em> which
targets it gives you acces to (this list is for the targets a default
<a class="reference internal" href="doc/03-server-setup.html#ttbd-guide-install-default-config"><span class="std std-ref">server install provides</span></a>,
<em>qz</em>* for Zephyr OS QEMU targets, <em>qlf</em>* for Fedora Linux targets):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list
local/nwa
...
local/qz30a-x86
local/qz30b-x86
local/qz30c-x86
...
local/qz39c-arm
local/qz40a-nios2
..
local/qz45a-riscv32
...
local/qlf04c
local/qlf05cH
...
</pre></div>
</div>
<p>There are three test networks defined (<em>nwa</em>, <em>nwb</em> and <em>nwc</em>) and
targets assigned to each network. Thus, <em>qz39c-arm</em> is an ARM virtual
target, on network <em>c</em> (<em>192.168.12/0/24</em>) with IP address
<em>192.168.12.39</em></p>
<p><em>qlf</em> are QEMU Linux Fedora numbers <em>04</em> or <em>05</em> connected to network
<em>c</em> and <em>H</em> connected to upstream internet via NAT.</p>
<p>Feel free to add <cite>-v</cite>s after <em>tcf</em> (to increase <em>tcf*`s verbosity)
or after the *list</em> command (to increase the amount of information for
each target).</p>
<p>As installing <cite>tcf-zephyr</cite> has brought the dependencies needed to
build the Zephyr OS you can run one of its test cases on it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git clone http://github.com/zephyrproject-rtos/zephyr
$ export ZEPHYR_BASE=$HOME/zephyr
$ export ZEPHYR_TOOLCHAIN_VARIANT=zephyr
$ export ZEPHYR_SDK_INSTALL_DIR=/opt/zephyr-sdk-0.9.3

$ cd $ZEPHYR_BASE/samples/hello_world
$ make BOARD=qemu_x86

$ tcf acquire qz30a-x86
# Note that depending on which target you use you might need
# zephyr.bin instead of zephyr.elf
$ tcf images-upload-set qz30a-x86 kernel-x86:outdir/qemu_x86/zephyr/zephyr.elf
$ tcf power-cycle qz30a-x86
$ tcf console-read qz30a-x86
***** BOOTING ZEPHYR OS v1.6.99 - BUILD: Jan 14 2017 06:04:22 *****
Hello World! x86
$ tcf power-off qz30a-x86
</pre></div>
</div>
<p><em>tcf</em> provides primitives to (see <em>tcf –help</em>):</p>
<blockquote>
<div><ul class="simple">
<li>power control: on, off, cycle, reset</li>
<li>debugging: reset/halt/resume CPUs, attach GDB, run openocd commands</li>
<li>read/write (serial) consoles</li>
<li>deploy/flash images, roms, etc</li>
</ul>
</div></blockquote>
<p>these are available if the targets supports the interfaces for it,
which you can find by listing it
with <code class="docutils literal"><span class="pre">-vv</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf list -vv arduino101-15 | grep interfaces:
interfaces: test_target_console_mixin test_target_images_mixin tt_debug_mixin tt_power_control_mixin
</pre></div>
</div>
<p>use <em>tcf –help</em> to discover what is available.</p>
<p>Targets can also support one or more BSPs. A BSP in a target is
something we can use to run code on. When targets support multiple
BSPs, then we can decide to run the target in different <em>BSP models</em>,
each model determining which BSPs are used of all the ones available.</p>
<p>For example, the <em>Arduino 101</em> supports has two different BSPs (ARC
and x86) and can be used in three BSP models: as <em>x86</em> only, as <em>arc</em>
only and as <em>x86+arc</em>.</p>
</div>
<div class="section" id="running-zephyr-os-testcases">
<h2>1.2. Running Zephyr OS testcases<a class="headerlink" href="#running-zephyr-os-testcases" title="Permalink to this headline">¶</a></h2>
<p>Zephyr OS testcases can be run directly thanks to a <a class="reference internal" href="doc/09-api.html#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c"><code class="xref py py-class docutils literal"><span class="pre">driver</span></code></a> (loaded by the TCF
configuration file <a class="reference download internal" href="_downloads/conf_zephyr.py" download=""><code class="xref download docutils literal"><span class="pre">/etc/tcf/conf_zephyr.py</span></code></a>), with <em>tcf run</em> doing the building,
flashing, power cycling, reading and checking for you (including
choosing one or more suitable targets):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd $ZEPHYR_BASE
$ tcf run -vvy tests/kernel/common
INFO2/        toplevel @local: scanning for test cases
INFO1/oqep    tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: will run on target group &#39;target=locals/qz30b-x86:x86&#39;
PASS2/oqep    tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: configure passed
PASS1/oqep    tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: build passed
PASS2/oqep    tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: deploy passed
INFO2/oqepE#1 tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: Reset
PASS2/oqepE#1 tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: found expected `RunID: :gn0v` in console `locals/qz30b-x86:default` at 1.86s
PASS2/oqepE#1 tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: eval pass: found expected `RunID: :gn0v` in console `locals/qz30b-x86:default` at 1.86s
PASS2/oqepE#1 tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: found expected `PROJECT EXECUTION SUCCESSFUL` in console `locals/qz30b-x86:default` at 0.02s
PASS2/oqepE#1 tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: eval pass: found expected `PROJECT EXECUTION SUCCESSFUL` in console `locals/qz30b-x86:default` at 0.02s
PASS1/oqep    tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: evaluation passed
PASS0/        toplevel @local: 1 tests (1 passed, 0 failed, 0 blocked, 0 skipped, in 0:00:24.056627) - passed
</pre></div>
</div>
<p>In here:</p>
<ul>
<li><p class="first"><em>-y</em> means pick just one target to run on; by default
<em>tcf run</em> will try to run each testcase in as many different target
types as possible, but just one per type. With <em>-u</em> (unlimited)
you’d ask <em>tcf run</em> to run in every single target, even if it means
more than one of a different type.</p>
</li>
<li><p class="first"><em>tests/kernel/common</em> is the path to a directory in the Zephyr OS
source tree–<em>tcf run</em> will look for stuff in directories, and in
there it will find <em>testcase.yaml</em>, which the Zephyr driver will
recognize.</p>
</li>
<li><p class="first">after building and deploying, <em>tcf run</em> has reset the target and
read from the console until it found a few things the Zephyr driver
told it to look for:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">RunID:</span> <span class="pre">:gn0v</span></code>: during the compilation, this was passed as
<code class="docutils literal"><span class="pre">-DTC_RUNID=:gn0v</span></code>, serves to ensure the right image got flashed
and ran.</p>
<p>Note this ID is unique to the testcase path, the target is run
into and a bunch of other things, so it can be guaranteed that if
the image that boots does not have that, it is likely the wrong
image and shall be a failure.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">PROJECT</span> <span class="pre">EXECUTION</span> <span class="pre">SUCCESFUL</span></code>: every Zephyr OS testcase prints
this on success. If we got <code class="docutils literal"><span class="pre">...FAILED</span></code>, then the testcase
execution would be marked as failed.</p>
</li>
<li><p class="first">The driver also keeps an eye for telltales of issues, like <code class="docutils literal"><span class="pre">USAGE</span>
<span class="pre">FAULT</span></code>, <code class="docutils literal"><span class="pre">fatal</span> <span class="pre">fault</span></code> and will report failure if those are seen.</p>
</li>
</ul>
</li>
</ul>
<div class="section" id="running-in-multiple-targets">
<h3>1.2.1. Running in multiple targets<a class="headerlink" href="#running-in-multiple-targets" title="Permalink to this headline">¶</a></h3>
<p>Now if you ran (note there is no <em>-y</em> and only one <em>-v</em> to reduce
verbosity):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd $ZEPHYR_BASE
$ tcf run -v tests/kernel/common
INFO1/ep8q    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz39a-xtensa:xtensa: will run on target group &#39;target=locals/qz39a-xtensa:xtensa&#39;
INFO1/foav    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz36b-riscv32:riscv32: will run on target group &#39;target=locals/qz36b-riscv32:riscv32&#39;
INFO1/kmat    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz33b-arm:arm: will run on target group &#39;target=locals/qz33b-arm:arm&#39;
INFO1/oqep    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: will run on target group &#39;target=locals/qz30b-x86:x86&#39;
INFO1/ilrv    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz35a-nios2:nios2: will run on target group &#39;target=locals/qz35a-nios2:nios2&#39;
PASS1/foav    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz36b-riscv32:riscv32: build passed
PASS1/ilrv    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz35a-nios2:nios2: build passed
PASS1/ep8q    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz39a-xtensa:xtensa: build passed
PASS1/kmat    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz33b-arm:arm: build passed
PASS1/oqep    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: build passed
PASS1/kmat    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz33b-arm:arm: evaluation passed
PASS1/ilrv    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz35a-nios2:nios2: evaluation passed
PASS1/oqep    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz30b-x86:x86: evaluation passed
BLCK0/foav    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz36b-riscv32:riscv32: evaluation blocked
PASS1/ep8q    zephyr.git/tests/kernel/common/testcase.yaml#kernel.common @locals/qz39a-xtensa:xtensa: evaluation passed
BLCK0/        toplevel @local: 5 tests (4 passed, 0 failed, 1 blocked, 0 skipped, in 0:00:43.538684) - blocked
make: *** [/tmp/tcf-OL1zv6.mk:2: tcf-jobserver-run] Error 127
</pre></div>
</div>
<p>in this case we are telling <em>tcf run</em> to find all the testcases in
Zephyr OS’s <em>tests/kernel/common</em> (there is only one) but it will try
to run each one on each different types of targets available–in this
case, there is five different QEMUs of different architectures.</p>
<p>Note how they all pass, except for the one for <em>riscv32</em> which
<em>blocks</em>–meaning something happened that forbade us from telling if
the testcase passes or fails.</p>
<p>When something doesn’t pass (it <em>fails</em>, <em>skips</em> or <em>blocks</em>), the
default reporting driver creates a <em>report</em> file with the ID of the
testcase, in this case <em>report-foav.txt</em> (in your case it might have a
different ID)–sometimes it is related to conditions or bugs in the
server.</p>
</div>
<div class="section" id="running-many-testcases">
<h3>1.2.2. Running many testcases<a class="headerlink" href="#running-many-testcases" title="Permalink to this headline">¶</a></h3>
<p>Following the example before, we can run for example two paths at
the same time; note <em>tcf run</em> will spread around multiple targets in
parallel–because it’d get very verbose, we removed the <em>-v</em> and <em>tcf
run</em> will only report about things that don’t pass:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf run tests/kernel/common/ tests/kernel/mem_slab/
BLCK0/kijl    tests/kernel/common/testcase.yaml#kernel.common @locals/qz37a-riscv32:riscv32: evaluation blocked
BLCK0/8thb    tests/kernel/mem_slab/mslab_threadsafe/testcase.yaml#kernel.memory_slabs @locals/qz37b-riscv32:riscv32: evaluation blocked
BLCK0/605h    tests/kernel/mem_slab/mslab/testcase.yaml#kernel.memory_slabs @locals/qz37a-riscv32:riscv32: evaluation blocked
BLCK0/wveb    tests/kernel/mem_slab/mslab_concept/testcase.yaml#kernel.memory_slabs @locals/qz37b-riscv32:riscv32: evaluation blocked
BLCK0/sdlb    tests/kernel/mem_slab/mslab_api/testcase.yaml#kernel.memory_slabs @locals/qz37b-riscv32:riscv32: evaluation blocked
BLCK0/        toplevel @local: 25 tests (20 passed, 0 failed, 5 blocked, 0 skipped, in 0:02:51.895300) - blocked
make: *** [/tmp/tcf-jbll1L.mk:2: tcf-jobserver-run] Error 127
</pre></div>
</div>
<p>at the end the summary tell us how it run 25 testcases, of which
twenty passed, five blocked and it took about three minutes.</p>
</div>
</div>
<div class="section" id="automating-test-case-building-and-execution">
<span id="tcf-run-automating-intro"></span><h2>1.3. Automating test case building and execution<a class="headerlink" href="#automating-test-case-building-and-execution" title="Permalink to this headline">¶</a></h2>
<p>Automation can be done in any language, provided there is a driver for
it; however, the default automation script is Python.</p>
<p>Create a file called <cite>test_hello_world.py</cite> with the following:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/python2</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2017 Intel Corporation</span>
<span class="c1">#</span>
<span class="c1"># SPDX-License-Identifier: Apache-2.0</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># We don&#39;t care for documenting all the interfaces, names should be</span>
<span class="c1"># self-descriptive:</span>
<span class="c1">#</span>
<span class="c1"># - pylint: disable = missing-docstring</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tcfl.tc</span>
<span class="kn">import</span> <span class="nn">tcfl.tl</span>

<span class="nd">@tcfl.tc.tags</span><span class="p">(</span><span class="o">**</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">zephyr_tags</span><span class="p">())</span>
<span class="c1"># Ask for a target that defines an zephyr_board field, which indicates</span>
<span class="c1"># it can run the Zephyr OS</span>
<span class="nd">@tcfl.tc.target</span><span class="p">(</span><span class="s2">&quot;zephyr_board&quot;</span><span class="p">,</span>
                <span class="n">app_zephyr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">ZEPHYR_BASE</span><span class="p">,</span>
                                          <span class="s2">&quot;samples&quot;</span><span class="p">,</span> <span class="s2">&quot;hello_world&quot;</span><span class="p">))</span>
<span class="k">class</span> <span class="nc">_test</span><span class="p">(</span><span class="n">tcfl</span><span class="o">.</span><span class="n">tc</span><span class="o">.</span><span class="n">tc_c</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
        <span class="n">target</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;Hello World! </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;zephyr_board&#39;</span><span class="p">])</span>
</pre></div>
</td></tr></table></div>
<p>this tells <em>tcf</em>’s test runner:</p>
<blockquote>
<div><ul>
<li><p class="first">With the <a class="reference internal" href="doc/09-api.html#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target()</span></code></a> class decorator, we declare this
test needs a single target on which we are going to deploy a Zephyr
application.</p>
<ul>
<li><p class="first"><em>“zephyr_board”</em> is a <a class="reference internal" href="doc/02-guides.html#tcf-target-specs"><span class="std std-ref">target specification</span></a>, which in this case makes sure the target
exposes said tag, which indicates it can run Zephyr OS Apps.</p>
</li>
<li><p class="first"><em>app_zephyr</em> is an <a class="reference internal" href="doc/02-guides.html#tcf-guide-app-builder"><span class="std std-ref">App Builder</span></a> and
provides the information for a Zephyr Application to build and
load into the target.</p>
<p>It will provide/impose additional conditions on the target
selection process so Zephyr can be deployed on it. It also
provides the instructions needed to build the app, deploy it to
the target, setup the testcase for operation (like installing
hooks to catch error messages) and starting the target. That is
provided in the form of Python functions added to the test object
<cite>_test</cite>) (<a class="reference internal" href="doc/02-guides.html#tcf-guide-tests"><span class="std std-ref">more information</span></a>).</p>
</li>
</ul>
</li>
<li><p class="first">we create a <cite>_test</cite> class, deriving from <a class="reference internal" href="doc/09-api.html#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal"><span class="pre">tcfl.tc.tc_c</span></code></a>, so
the testcase can be located and integrated</p>
</li>
<li><p class="first">there is an evaluation function, <cite>_test.eval(target)</cite> which is used
to tell if the test case succeeded or failed.</p>
<p>The testcase runner will call it with a target object, which
represents a remote target with which you can interact via the
<a class="reference internal" href="doc/09-api.html#tcfl.tc.target_c" title="tcfl.tc.target_c"><code class="xref py py-class docutils literal"><span class="pre">API</span></code></a> it provides.</p>
<p>If it returns, it is a <em>pass</em>. A failure can be indicated by
raising <a class="reference internal" href="doc/09-api.html#tcfl.tc.failed_e" title="tcfl.tc.failed_e"><code class="xref py py-exc docutils literal"><span class="pre">tcfl.tc.failed_e</span></code></a>; any other exception raised is
captured and converted to a <a class="reference internal" href="doc/09-api.html#tcfl.tc.blocked_e" title="tcfl.tc.blocked_e"><code class="xref py py-exc docutils literal"><span class="pre">blockage</span></code></a>,
which is a situation considered to impede the evaluation of the
testcase.</p>
<p>Multiple evaluation functions can be provided (named <cite>eval*()</cite>,
each taking none or different targets, as many as declared by the
testcase (see <a class="reference internal" href="doc/09-api.html#tcfl.tc.tc_c" title="tcfl.tc.tc_c"><code class="xref py py-class docutils literal"><span class="pre">test</span> <span class="pre">class</span> <span class="pre">overview</span></code></a>). For the
testcase to pass, all the evaluation functions have to pass.</p>
<p>FIXME: ensure the tc_c and target_c class descriptions are adequate
from this context</p>
</li>
</ul>
</div></blockquote>
<p><em>tcf run</em> finds the <cite>.py</cite> file, queries which targets available and
selects the ones that match the conditions imposed with
<a class="reference internal" href="doc/09-api.html#tcfl.tc.target" title="tcfl.tc.target"><code class="xref py py-func docutils literal"><span class="pre">tcfl.tc.target()</span></code></a>; it then builds the <em>Hello World!</em> app for each
of them, pulling configuration from the target’s description tags
(that you can see with <cite>tcf list -vvv TARGETNAME</cite>) and then evaluates
the output for success.</p>
<p>Let’s ask it to run against an specific target, <em>local/qz39c-arm</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf run -vv -t local/qz39c-arm test_zephyr_hello_world.py
INFO2/        toplevel @local: scanning for test cases
INFO2/n9gc    test_zephyr_hello_world.py#_test @local/qz39c-arm:arm: will run on target group &#39;xqkw (target=local/qz39c-arm:arm)&#39;
PASS1/n9gc    test_zephyr_hello_world.py#_test @local/qz39c-arm:arm: configure passed
PASS1/n9gc    test_zephyr_hello_world.py#_test @local/qz39c-arm:arm: build passed
PASS2/n9gc    test_zephyr_hello_world.py#_test @local/qz39c-arm:arm: deploy passed
INFO2/n9gcE#1 test_zephyr_hello_world.py#_test @local/qz39c-arm:arm: Reset
PASS2/n9gcE#1 test_zephyr_hello_world.py#_test @local/qz39c-arm:arm: found expected `Hello World! arm` in console `default` at 0.03s
PASS2/n9gcE#1 test_zephyr_hello_world.py#_test @local/qz39c-arm:arm: eval pass: found expected `Hello World! arm` in console `default` at 0.03s
PASS1/n9gc    test_zephyr_hello_world.py#_test @local/qz39c-arm:arm: evaluation passed
PASS0/        toplevel @local: 1 tests (1 passed, 0 failed, 0 blocked, 0 skipped) - passed
</pre></div>
</div>
<p>You want less information about what happened? remove <cite>-v</cite>s. Want a
full record? add a <cite>–log-file=something.log</cite> –that will show build
logs, read texts, etc.</p>
<p>Each line contains a high level tag (<em>INFO</em>, <em>PASS</em>, <em>FAIL</em>, <em>BLCK</em>),
followed by a verbosity level, a <em>unique ID</em> that identifies the
testcase and the target(s) on which it is being run (and will prefix
all the reports about it), the name of the test case and the target
where it runs and information on what happened (<a class="reference internal" href="doc/02-guides.html#tcf-run-output-groking"><span class="std std-ref">more details</span></a>).</p>
<p>At this point, you can ask it to run anywhere it can; <em>tcf run</em> will
try to run on all targets it can find, running by default only one
target of each type:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ tcf run test_zephyr_hello_world.py
PASS0/  toplevel @local: 3 tests (3 passed, 0 failed, 0 blocked, 0 skipped) - passed
</pre></div>
</div>
<p>The testcase was run in three different targets, so we have three
testst that passed.</p>
<p>Note <em>tcf</em> is very shy, by default it only reports about things that
fail or error (and generates individual <cite>report-*.txt</cite> files about
it. For more information, throw in <em>-v</em>s</p>
<p><em>tcf</em> can be taught about other testcase formats using <a class="reference internal" href="doc/glossary.html#term-test-case-driver"><span class="xref std std-term">test
case driver</span></a>s; (like <a class="reference internal" href="doc/09-api.html#tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c" title="tcfl.tc_zephyr_sanity.tc_zephyr_sanity_c"><code class="xref py py-class docutils literal"><span class="pre">Zephyr's</span> <span class="pre">Sanity</span> <span class="pre">Checks</span></code></a>)</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="doc/02-guides.html" class="btn btn-neutral float-right" title="2. Guides" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="TCF" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Author.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.11',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>